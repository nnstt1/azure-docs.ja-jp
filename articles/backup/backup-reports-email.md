---
title: Azure バックアップ レポートをメールで送信する
description: 定期的なレポートをメールで受信する自動化されたタスクを作成します
ms.topic: conceptual
ms.date: 10/19/2021
ms.openlocfilehash: dd5e31663262463449df4377329edc6604ffb691
ms.sourcegitcommit: 692382974e1ac868a2672b67af2d33e593c91d60
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/22/2021
ms.locfileid: "130235983"
---
# <a name="email-azure-backup-reports"></a>Azure バックアップ レポートをメールで送信する

バックアップ レポートで使用できる **メール レポート** 機能を使用すると、自動化されたタスクを作成して、メールで定期的なレポートを受信できます。 この機能を利用するには、指定した入力に基づいて、選択した Log Analytics (LA) ワークスペースからデータのクエリを実行するロジック アプリを Azure 環境にデプロイします。 [ロジック アプリとその価格については、こちらをご覧ください](https://azure.microsoft.com/pricing/details/logic-apps/)。

## <a name="getting-started"></a>作業の開始

バックアップ レポートでメール タスクを構成するには、次の手順のようにします。

1.  **[バックアップ センター]**  >  **[バックアップ レポート]** に移動し、 **[レポートのメール送信]** タブをクリックします。
2.  次の情報を指定して、タスクを作成します。
    * **[タスクの詳細]** - 作成するロジック アプリの名前と、それを作成する必要があるサブスクリプション、リソース グループ、場所。 ロジック アプリを使用すると、複数のサブスクリプション、リソース グループ、場所を対象にしてデータのクエリを実行できますが (レポート フィルターのセクションで選択)、ロジック アプリの作成は 1 つのサブスクリプション、リソース グループ、場所のコンテキストで行われることに注意してください。
    * **[エクスポートするデータ]** - エクスポートするタブ。 タブごとに 1 つのタスク アプリを作成することも、 **[すべてのタブ]** オプションを選択することにより、1 つのタスクを使用してすべてのタブをメールで送信することもできます。
    * **[電子メール オプション]** : メールの頻度、受信者のメール ID、メールの件名。

    ![電子メール タブ](./media/backup-azure-configure-backup-reports/email-tab.png)

3.  **[送信]** と **[確認]** をクリックすると、ロジック アプリが作成されます。 作成されるロジック アプリおよび関連付けられた API 接続には、簡単に見つけられるよう、**UsedByBackupReports: true** というタグが付けられます。 次のセクションで説明するように、ロジック アプリを正常に実行するには、承認手順を 1 回だけ実行する必要があります。

## <a name="authorize-connections-to-azure-monitor-logs-and-office-365"></a>Azure Monitor ログと Office 365 への接続を承認する

ロジック アプリによる LA ワークスペースのクエリの実行には [azuremonitorlogs](/connectors/azuremonitorlogs/) コネクタが使用され、メールの送信には [Office365 Outlook](/connectors/office365connector/) コネクタが使用されます。 これら 2 つのコネクタについて、承認を 1 回だけ行う必要があります。 
 
承認を実行するには、次の手順のようにします。

1.  Azure portal で **[Logic Apps]** に移動します。
2.  作成したロジック アプリの名前を検索し、リソースに移動します。

    ![Logic Apps](./media/backup-azure-configure-backup-reports/logic-apps.png)

3.  **[API 接続]** メニュー項目をクリックします。

    ![API 接続](./media/backup-azure-configure-backup-reports/api-connections.png)

4.  `<location>-azuremonitorlogs` および `<location>-office365` という形式の 2 つの接続が表示されます。つまり、_eastus-azuremonitorlogs_ と _eastus-office365_ です。
5.  これらの各接続に移動し、 **[API 接続の編集]** メニュー項目を選択します。 表示される画面で **、[承認]** を選択し、承認が完了したら接続を保存します。

    ![接続の承認](./media/backup-azure-configure-backup-reports/authorize-connections.png)

6.  承認の後でロジック アプリが動作するかどうかをテストするには、ロジック アプリに戻り、 **[概要]** を開いて上部のウィンドウで **[トリガーの実行]** を選択して、メールが正常に生成されているかどうかをテストします。

## <a name="contents-of-the-email"></a>メールの内容

* ポータルに表示されるすべてのチャートとグラフを、メールでインライン コンテンツとして使用できます。 バックアップ レポートで示される情報についての[詳細を確認](configure-reports.md)してください。
* ポータルに表示されるグリッドは、メールでは *.csv の添付ファイルとして使用できます。
* メール タスクの作成時に、レポートでユーザーによって選択されたすべてのレポートレベルのフィルターが、メールに表示されるデータで使用されます。
* **[バックアップ インスタンス名]** 、 **[ポリシー名]** などのタブレベルのフィルターは適用されません。 この唯一の例外は、 **[最適化]** タブの **[リテンション期間の最適化]** グリッドです。ここでは、 **[毎日]** 、 **[毎週]** 、 **[毎月]** 、 **[毎年]** の RP 保有期間のフィルターが適用されます。
* 時間範囲と集計の種類 (グラフの場合) は、ユーザーによるレポートでの時間範囲の選択に基づいています。 たとえば、時間範囲の選択が過去 60 日 (毎週集計の種類に変換) で、メールの頻度が毎日の場合、受信者は毎日メールを受け取り、グラフのデータの範囲は過去 60 日間で、データは 1 週間ごとに集計されています。

## <a name="troubleshooting-issues"></a>問題のトラブルシューティング

ロジック アプリが正常にデプロイされた後でも、予想どおりにメールを受け取らない場合は、次の手順のようにして構成のトラブルシューティングを行うことができます。

### <a name="scenario-1-receiving-neither-a-successful-email-nor-an-error-email"></a>シナリオ 1: 正常なメールもエラー メールも受け取らない

* この問題は、Outlook API コネクタが承認されていないために発生する可能性があります。 接続を承認するには、上で説明した承認手順のようにします。

* この問題は、ロジック アプリを作成するときに正しくないメール受信者を指定した場合にも、発生する可能性があります。 メールの受信者が正しく指定されていることを確認するには、Azure portal でロジック アプリに移動し、ロジック アプリ デザイナーを開き、電子メールのステップを選択して、正しいメール ID が使用されているかどうかを確認します。

### <a name="scenario-2-receiving-an-error-email-that-says-that-the-logic-app-failed-to-execute-to-completion"></a>シナリオ 2: ロジック アプリの実行を完了できなかったことを示すエラー メールを受け取る

この問題のトラブルシューティングを行うには:
1.  Azure portal でロジック アプリに移動します。
2.  **[概要]** 画面の下部に、 **[実行の履歴]** セクションが表示されます。 最新の実行を開き、ワークフローのどのステップで失敗したかを確認できます。 次のような原因が考えられます。
    * **Azure Monitor ログ コネクタが承認されていない**: この問題を解決するには、上で説明した承認手順のようにします。
    * **LA クエリでのエラー**: 独自のクエリを使用してロジック アプリをカスタマイズした場合、いずれかの LA クエリのエラーにより、ロジック アプリが失敗する可能性があります。 関連するステップを選択して、クエリが正しく実行されない原因となっているエラーを確認することができます。

引き続き問題が発生する場合は、Microsoft サポートにお問い合わせください。

## <a name="next-steps"></a>次のステップ
[バックアップ レポートに関する詳細を確認する](./configure-reports.md)