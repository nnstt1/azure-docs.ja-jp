### YamlMime:FAQ
metadata:
  title: FAQ - Azure VM 上の SAP HANA データベースのバックアップ
  description: この記事では、Azure Backup サービスを使用した SAP HANA データベースのバックアップに関する一般的な質問への回答を示します。
  ms.topic: article
  ms.service: backup
  ms.date: 09/27/2021
  ms.openlocfilehash: fd2fee68735686a15720c87bc4fb1f3ce9f410b5
  ms.sourcegitcommit: 692382974e1ac868a2672b67af2d33e593c91d60
  ms.translationtype: HT
  ms.contentlocale: ja-JP
  ms.lasthandoff: 10/22/2021
  ms.locfileid: "130244244"
title: よく寄せられる質問 - Azure VM 上の SAP HANA データベースをバックアップする
summary: この記事では、Azure Backup サービスを使用した SAP HANA データベースのバックアップに関する一般的な質問への回答を示します。
sections:
- name: バックアップ
  questions:
  - question: >
      1 日あたり何回の完全バックアップがサポートされていますか?
    answer: >
      1 日に 1 回の完全バックアップと複数のオンデマンド バックアップをスケジュールできます。


      | バックアップの種類 | スケジュールされたバックアップ | オンデマンド バックアップ |

      | --- | --- | --- |

      | [完全] | 1 日に 1 回のみサポートされています。 | 1 日に複数回サポートされています。 |

      | 差分 (差分/増分) | 1 日に 1 回のみサポートされています。 <br><br> **注:** <br> 差分バックアップは、特定の日に完全バックアップがスケジュールされていない場合にのみスケジュールできます。 また、バックアップ ポリシーでは、1 つの差分バックアップの種類 (差分/増分) のみをスケジュールできます。 | 1 日に複数回サポートされています。 |
  - question: >
      バックアップ関連のアラートはどこで確認できますか?
    answer: >
      現在、成功したバックアップ ジョブではアラートは生成されません。 アラートは、失敗したバックアップ ジョブに対してのみ生成されます。 Azure portal を使用してバックアップ アラートを表示する[方法を参照してください](backup-azure-monitoring-built-in-monitor.md)。
  - question: >
      バックアップ (スケジュールまたはオンデマンド) が正常に行われるかどうかを確認するにはどうすればよいですか?
    answer: "次のいずれかの場所から、バックアップ (スケジュールまたはオンデマンド) の状態を確認できます。\n\n1. **バックアップ ジョブ**: Azure Backup では、手動でトリガーされたすべてのジョブが Azure portal の [バックアップ ジョブ] セクションに表示されます。  <br><br>   Azure portal に表示されるジョブには、データベースの検出と登録操作、バックアップと復元操作などがあります。 スケジュールされたジョブ (ログ バックアップを含む) はこのセクションに表示されません。 また、SAP HANA ネイティブ クライアント (Studio、Cockpit、または DBA Cockpit) から手動でトリガーされたバックアップも、ここには表示されません。\n\n   :::image type=\"content\" source=\"./media/sap-hana-faq-backup-azure-vm/manually-triggered-jobs.png\" alt-text=\"Azure portal の [バックアップ ジョブ] セクションの手動でトリガーされたジョブを示すスクリーンショット。\":::\n\n   :::image type=\"content\" source=\"./media/sap-hana-faq-backup-azure-vm/jobs-and-operations-list.png\" alt-text=\"データベースの検出と登録、およびバックアップと復元の操作などのジョブを示すスクリーンショット。\":::\n \n1. **バックアップ アラート**: アラートは、SAP HANA データベースのバックアップを監視するために役立ちます。 これらを使用すると、必要なイベントに集中できるため、バックアップによって生成される多数のイベントを頻繁にチェックする手間を省くことができます。 詳細については、「[バックアップ アラートを表示する](./sap-hana-db-manage.md#view-backup-alerts)」を参照してください。\n\n1. **バックアップ レポート**: バックアップ ジョブの状態を表示するためのもう 1 つの方法がレポートです。 レポートは、次のようになります。\n\n   :::image type=\"content\" source=\"./media/sap-hana-faq-backup-azure-vm/backup-reports.png\" alt-text=\"Azure portal でのレポートの一種を示すスクリーンショット。\":::\n\n   :::image type=\"content\" source=\"./media/sap-hana-faq-backup-azure-vm/backup-reports-mabs.png\" alt-text=\"Azure portal でのもう一種のレポートを示すスクリーンショット。\":::\n\n   [Azure Backup のレポートを構成する方法](./configure-reports.md)について学習してください。\n\n1. **SAP HANA ネイティブ クライアント**: SAP HANA のユーザーの場合は、最も一般的な HANA クライアントの 1 つである HANA Studio を使用することもできます。 このクライアントで **バックアップの状態** を確認するには、**[Backup Console]\\(バックアップ コンソール\\)** -> **[Backup Catalog]\\(バックアップ カタログ\\)** の順に移動します。\n\n   :::image type=\"content\" source=\"./media/sap-hana-faq-backup-azure-vm/sap-hana-native-client-reports.png\" alt-text=\"SAP HANA ネイティブ クライアントでのレポートを示すスクリーンショット。\":::\n"
  - question: >
      スケジュールされたバックアップ ジョブを [バックアップ ジョブ] メニューで確認できますか?
    answer: >
      [バックアップ ジョブ] メニューには、進行中か、成功したか、失敗したオンデマンド バックアップ ジョブだけが表示されます。 スケジュールされたジョブの場合は、[Azure Monitor](./backup-azure-monitoring-use-azuremonitor.md) を使用します。
  - question: >
      LSNValidation エラーによってトリガーされる自動修復の完全バックアップでは、保持期間はどうなっていますか?
    answer: >
      Azure Backup では、自動修復の完全バックアップに対して明示的な保持期間が設定されていません。 このバックアップは、依存デルタ (差分または増分) とログ バックアップを保持するまで保持されます。 この自動修復バックアップの最後の依存バックアップを削除すると、自動修復バックアップも削除されます。
  - question: >
      今後作成されるデータベースはバックアップに自動的に追加されますか?
    answer: >
      いいえ。これは現在サポートされていません。
  - question: >
      インスタンスからデータベースを削除した場合、バックアップはどうなりますか?
    answer: >
      SAP HANA インスタンスからデータベースが削除された場合でも、データベース バックアップは引き続き試行されます。 これは、削除されたデータベースが **[バックアップ項目]** に異常として表示され始め、引き続き保護されていることを示しています。

      このデータベースの保護を停止するための正しい方法は、このデータベースに対して "**バックアップを停止してデータを削除する**" を実行することです。
  - question: >
      データベースが保護された後にその名前を変更した場合、その動作はどうなりますか?
    answer: >
      名前が変更されたデータベースは、新しいデータベースとして処理されます。 このため、サービスにより、この状況は、データベースが見つからず、バックアップが失敗した場合と同様に処理されます。 名前が変更されたデータベースは新しいデータベースとして表示されるため、保護するように構成する必要があります。
  - question: >
      Azure Backup を使用して SAP HANA データベースのバックアップを開始するにはどうすればよいですか?
    answer: >
      SAP HANA データベースのために Azure Backup の使用を開始する手順のガイドについては、[チュートリアル](./tutorial-backup-sap-hana-db.md)を参照してください。 また、[CLI](./tutorial-sap-hana-backup-cli.md) を使用してバックアップを構成および管理することもできます。
  - question: >
      Azure Backup を使用して SAP HANA データベースをバックアップするための前提条件がありますか?
    answer: >
      SAP HANA で Azure Backup を使用するための[前提条件](./tutorial-backup-sap-hana-db.md#prerequisites)を参照してください。
  - question: >
      SAP HANA を SDC から MDC に移行した後、バックアップは機能しますか?
    answer: >
      トラブルシューティング ガイドの[こちらのセクション](./backup-azure-sap-hana-database-troubleshoot.md#sdc-to-mdc-upgrade-with-a-change-in-sid)をご覧ください。
  - question: >
      同一の HANA バージョン内で HANA インスタンスをでアップグレードした後もバックアップが続行されるようにするにはどうすればよいですか?
    answer: >
      トラブルシューティング ガイドの[こちらのセクション](backup-azure-sap-hana-database-troubleshoot.md#sdc-version-upgrade-or-mdc-version-upgrade-on-the-same-vm)を参照してください。
  - question: >
      仮想マシンではなく、仮想 IP (ロード バランサー) に対して Azure HANA バックアップを設定できますか?
    answer: >
      現時点では、仮想 IP またはプロキシに対してソリューションを設定することはできません。 ソリューションを実行するには、仮想マシンが必要です。
  - question: >
      オンデマンド バックアップを Azure コンテナーではなくローカル ファイル システムに移動する方法はありますか?
    answer: >
      1. 目的のデータベースで現在実行中のバックアップが完了するまで待ちます (完了は Studio で確認します)。

      1. 次の手順を使用して、目的の DB のログ バックアップを無効にし、カタログ バックアップを **[Filesystem]\(ファイルシステム\)** に設定します。

      1. **[SYSTEMDB]**  ->  **[構成]**  ->  **[データベースの選択]**  ->  **[Filter (log)]\(フィルター (ログ)\)** の順にダブルクリックします
          1. [enable_auto_log_backup] を **[no]** に設定します。
          1. [catalog_backup_using_backint] を **[false]** に設定します。
      1. 目的のデータベースでオンデマンド バックアップ (完全/差分/増分) を実行し、バックアップとカタログ バックアップが完了するまで待ちます。

      1. ログ バックアップもファイルシステムに移動する場合は、[enable_auto_log_backup] を **[yes]** に設定します。

      1. 以前の設定に戻して、バックアップが Azure コンテナーにフローできるようにします。
          1. [enable_auto_log_backup] を **[yes]** に設定します。
          1. [catalog_backup_using_backint] を **[true]** に設定します。

      > [!NOTE]

      > バックアップをローカル ファイルシステムに移動し、再度 Azure コンテナーに切り替えると、コンテナー内のログ バックアップでログ チェーンが切断される場合があります。 これにより完全バックアップがトリガーされます。正常に完了すると、ログのバックアップが開始されます。
  - question: >
      HANA レプリケーションの設定で SAP HANA バックアップを使用するにはどうすればよいですか?
    answer: >
      現時点では、Azure Backup は HSR の設定を理解する機能を備えていません。 つまり、HSR のプライマリおよびセカンダリのノードは、関連のない 2 つの個別の VM として扱われます。 最初に、プライマリ ノードでバックアップを構成する必要があります。 フェールオーバーが発生した場合は、セカンダリ ノード (こちらがプライマリ ノードになります) でバックアップを構成する必要があります。 他のノードに対するバックアップの自動フェールオーバーはありません。


      任意の時点のアクティブ (プライマリ) ノードからデータをバックアップするには、フェールオーバー後にプライマリになったセカンダリ ノードに **保護を切り替える** ことができます。


      この **保護の切り替え** を実行するには、次の手順に従います。


      - プライマリで (データを保持して) [保護を停止](sap-hana-db-manage.md#stop-protection-for-an-sap-hana-database)します

      - セカンダリ ノードで[事前登録スクリプト](https://go.microsoft.com/fwlink/?linkid=2173610)を実行します

      - セカンダリ ノードで[データベースを検出](tutorial-backup-sap-hana-db.md#discover-the-databases)し、それらに[バックアップを構成](tutorial-backup-sap-hana-db.md#configure-backup)します


      これらの手順は、フェールオーバーが終了するたびに手動で実行する必要があります。 これらの手順は、Azure portal に加えて、コマンド ライン/HTTP REST を使用して実行できます。 これらの手順を自動化するには、Azure Runbook を使用します。


      **保護の切り替え** を実行する方法の詳細な例を次に示します。


      この例では、HSR セットアップにノード 1 (プライマリ) とノード 2 (セカンダリ) の 2 つのノードがあります。  バックアップはノード 1 で構成されています。 前述のように、まだノード 2 でバックアップを構成しないようにしてください。


      最初のフェールオーバーが発生すると、ノード 2 がプライマリになります。 このとき、次のようになります。


      1. [データの保持] オプションを使用して、ノード 1 (前のプライマリ) の保護を停止します。

      1. ノード 2 (現在のプライマリ) で事前登録スクリプトを実行します。

      1. ノード 2 のデータベースを検出し、バックアップ ポリシーを割り当て、バックアップを構成します。


      その後、ノード 2 で最初の完全バックアップがトリガーされ、その完了後にログ バックアップが開始されます。


      次のフェールオーバーが発生すると、ノード 1 が再びプライマリになり、ノード 2 がセカンダリになります。 ここで、手順を繰り返します。


      1. [データの保持] オプションを使用して、ノード 2 の保護を停止します。

      1. ノード 1 (再びプライマリになっています) で事前登録スクリプトを実行します。

      1. 次に、必要なポリシーを使用してノード 1 で[バックアップを再開](sap-hana-db-manage.md#resume-protection-for-an-sap-hana-database)します (前にノード 1 でバックアップが停止されているため)。


      その後、ノード 1 で完全バックアップが再度トリガーされ、その完了後にログ バックアップが開始されます。


      >[!Note]

      >カスタム バックアップ ユーザーを入力として[事前登録スクリプトを実行する](./tutorial-backup-sap-hana-db.md#prerequisites)と、HSR のバックアップをより適切に管理することができます。 これは、HSR セットアップの両方のノードに同じバックアップ キーが確実に設定され、バックアップの同期と失敗の問題が軽減されるためです。
  - question: >
      HSR セットアップのセカンダリで非アクティブのノードに対する保護を停止 (データを保持) しないと、どうなりますか?
    answer: >
      1. HANA システム レプリケーション (HSR) の場合、セカンダリ ノードはどのような接続も受け付けません。 バックアップが構成された後、Azure Backup サービスは定期的に ping を実行し、失敗します。 これらの失敗した試行が、プライマリ ノードに反映される場合があります。 複数のエラーが発生すると、ユーザーはロックされ、プライマリ ノードが _ODBCConnectionError_ で失敗し始めます。   <br><br>すべてのユーザーにこの問題が発生するのではないことが確認されています。 セカンダリ ノードでユーザー接続が失敗した場合には、プライマリ ノードでユーザーがロックされる原因を調査するようにお勧めします。


      1. 事前登録スクリプトを実行すると、プライマリ ノードの新しいパスワードでユーザー情報が更新されます。 その後、バックアップを試行するための接続が再確立されます。 しかし、同じシナリオが再現される場合があります。


      1. また、セカンダリ ノードで失敗するバックアップ (完全バックアップ) によってアラートが作成されます。


      上の問題を回避するには、ノードがセカンダリになったら (接続が試行されず、ユーザーがロックされないように) 保護を停止し、プライマリになったら保護を再開することをお勧めします。 HSR セットアップでこのロックされる状況に直面せず、アラートが発生しても問題ない場合は、サービスが引き継ぎとフェールバックを処理するように、両方のノードでバックアップを構成できます。
  - question: >
      Azure Backup で提供されるバックアップと復元のスループット パフォーマンスはどのくらいですか? また、この最大スループットになるように HANA システムを設定するにはどうすればよいですか?
    answer: >
      Azure Backup によって HANA ワークロードに対して提供される[バックアップと復元のスループット パフォーマンス](./tutorial-backup-sap-hana-db.md#understanding-backup-and-restore-throughput-performance)に関するセクションを参照してください。 <br><br> 向上したパフォーマンスを活用するように HANA システムを設定するには、以下のリソースを使用してください。

       - [Azure IaaS VM 用のディスクの種類の選択 - マネージド ディスク](../virtual-machines/disks-types.md)
       - [Azure マネージド ディスクのパフォーマンス レベル](../virtual-machines/disks-change-performance.md)
       - [M シリーズ](../virtual-machines/m-series.md)
       - [SAP HANA Azure 仮想マシンのストレージ構成](../virtual-machines/workloads/sap/hana-vm-operations-storage.md#solutions-with-premium-storage-and-azure-write-accelerator-for-azure-m-series-virtual-machines)

      >[!Note]

      >バックアップのスループット パフォーマンスを制限することもできます。 [詳細については、こちらを参照してください](./tutorial-backup-sap-hana-db.md#limiting-backup-throughput-performance)。
- name: 復元
  questions:
  - question: >
      データベースの復元先の HANA システムが表示されないのはなぜですか?
    answer: >
      ターゲットの SAP HANA インスタンスに復元するためのすべての前提条件が満たされているかどうかを確認してください。 詳しくは、[Azure VM の SAP HANA データベースの復元の前提条件](./sap-hana-db-restore.md#prerequisites)に関する記事をご覧ください。
  - question: >
      データベースで DB の上書き復元が失敗するのはなぜですか?
    answer: >
      復元の間に **[強制的に上書きします]** オプションが選択されていることを確認します。
  - question: "\"復元のソース システムとターゲット システムには互換性がありません\" というエラーが表示されるのはなぜですか?\n"
    answer: >
      SAP HANA ノート [1642148](https://launchpad.support.sap.com/#/notes/1642148) を参照し、現在サポートされている復元の種類を確認してください。
  - question: >
      SLES で実行されているデータベースのバックアップを使用して RHEL HANA システムを復元できますか? また、その逆は可能ですか?
    answer: >
      はい。SLES で実行されている HANA データベースでトリガーされたストリーミング バックアップを使用して、RHEL HANA システムに復元できます。また、その逆も可能です。 つまり、ストリーミング バックアップを使用すると、OS を跨いだ復元が可能になります。 ただし、復元先の HANA システムと復元に使用する HANA システムの両方が、SAP による復元に互換性があることを確認する必要があります。 互換性のある復元の種類については、SAP HANA メモ [1642148](https://launchpad.support.sap.com/#/notes/1642148) を参照してください。
- name: ポリシー
  questions:
  - question: >
      SAP HANA バックアップの新しいポリシーを作成するときに使用できるさまざまなオプション
    answer: >
      ポリシーを作成する前に、RPO および RTO の要件とその関連コストへの影響について明確にする必要があります。


      RPO (目標復旧時点) は、ユーザーまたは顧客が許容できるデータ損失量を示します。 これは、ログ バックアップの頻度によって決まります。 ログ バックアップの頻度が高いほど RPO は短くなります。Azure Backup サービスでサポートされる最小値は 15 分です。 このため、ログ バックアップの頻度は、15 分以上にすることができます。


      RTO (目標復旧時間) は、データ損失シナリオの後、最後の使用可能な時点にデータを復元する速度を示します。 これは、HANA によって採用される回復戦略によって異なり、通常は、復元に必要なファイルの数によって異なります。 これはコストにも影響します。次の表は、すべてのシナリオとその影響を理解するのに役立ちます。


      |バックアップ ポリシー  |RTO  |コスト  |

      |---------|---------|---------|

      |毎日の完全 + ログ     |   ポイントインタイム リストアに必要なのは、1 つの完全なコピーとログのみであるため、最も速い      |    完全なコピーが毎日作成され、保持期間が経過するまでバックエンドに蓄積されるデータが増えるため、最もコストがかかるオプション   |

      |毎週の完全 + 毎日の差分 + ログ     |   上記のオプションよりも低速ですが、ポイントインタイム リストアには、1 つの完全なコピー、1 つの差分コピー、ログが必要であるため、次のオプションよりは高速      |    通常、毎日の差分は完全よりも小さく、完全なコピーは週に 1 回だけ作成されるため、より安価なオプション      |

      |毎週の完全 + 毎日の増分 + ログ     |  ポイントインタイム リストアのために 1 つの完全なコピー、'n' 個の増分、ログが必要なため、最も遅い       |     毎日の増分は差分よりも小さく、完全なコピーが作成されるのは週 1 回のみであるため、最も安価なオプション    |


      > [!NOTE]

      > 上記のオプションは最も一般的ですが、この限りではありません。 たとえば、毎週の完全バックアップ、週 2 回の差分、ログを使用することもできます。


      このため、RPO と RTO の目標とコストに関する考慮事項に基づいてポリシーのバリエーションを選択できます。
  - question: >
      ポリシー変更の影響
    answer: >
      バックアップ項目のポリシーをポリシー 1 (P1) からポリシー 2 (P2) に切り替えるか、またはポリシー 1 (P1) を編集することによる影響を判断する場合、いくつかの原則に留意する必要があります。


      - すべての変更はさかのぼっても適用されます。 最新のバックアップ ポリシーは、以前に作成した復旧ポイントにも適用されます。 たとえば、現在アクティブなポリシーに従って、毎日の完全なコピーの保持期間が 30 日で、10 個の復旧ポイントが作成されたとします。 毎日の完全コピーの保持期間を 10 日に変更した場合、以前のポイントの有効期限も、開始時間 + 10 日として再計算され、有効期限が切れている場合は削除されます。

      - 変更の範囲には、保持期間だけでなく、バックアップの日、バックアップの種類も含まれます。 次に例を示します。ポリシーを毎日の完全から毎週日曜日の完全に変更した場合、日曜日以外の以前の完全コピーはすべて削除対象としてマークされます。

      - 子が非アクティブまたは期限切れになるまで、親は削除されません。 すべてのバックアップの種類には、現在アクティブなポリシーに従って有効期限があります。 しかし、完全バックアップの種類は、それ以降の '差分'、'増分'、'ログ' の親と見なされます。 '差分' と 'ログ' は、他のどのバックアップの親でもありません。 '増分' は、それ以降の '増分' の親になることができます。 '親' が削除対象としてマークされても、子の '差分' または 'ログ' の有効期限が切れていなければ、実際には削除されません。 たとえば、ポリシーを毎日の完全から毎週日曜日の完全に変更した場合、日曜日以外の以前の完全なコピーはすべて削除対象としてマークされます。 しかし、それらは、以前に毎日作成されたログが期限切れになるまで実際には削除されません。 つまり、最新のログ期間に従って保持されます。 ログの有効期限が切れると、ログとこれらの完全なコピーの両方が削除されます。


      これらの原則に留意して次の表を読むと、ポリシー変更の影響を理解することができます。


      |古いポリシー/新しいポリシー  |毎日の完全 + ログ  | 毎週の完全 + 毎日の差分 + ログ  |毎週の完全 + 毎日の増分 + ログ  |

      |---------|---------|---------|---------|

      |毎日の完全 + ログ     |   -      |    同じ曜日以外の以前の完全コピーは削除対象としてマークされますが、ログの保持期間が経過するまで保持されます     |    同じ曜日以外の以前の完全コピーは削除対象としてマークされますが、ログの保持期間が経過するまで保持されます     |

      |毎週の完全 + 毎日の差分 + ログ     |   以前が作成された毎週の完全コピーの保持期間は、最新のポリシーに従って再計算されます。 以前の差分は即座に削除されます      |    -     |    以前の差分は即座に削除されます     |

      |毎週の完全 + 毎日の増分 + ログ     |     以前が作成された毎週の完全コピーの保持期間は、最新のポリシーに従って再計算されます。 以前の増分は即座に削除されます    |     以前の増分は即座に削除されます    |    -     |
additionalContent: "\n## <a name=\"next-steps\"></a>次のステップ\n\nAzure VM で実行されている [SAP HANA データベースをバックアップする](./backup-azure-sap-hana-database.md)方法を学習します。"
