### YamlMime:FAQ
metadata:
  title: Azure Files のバックアップに関する FAQ
  description: この記事では、Azure Backup サービスを使用して Azure ファイル共有を保護する方法に関してよく寄せられる質問への回答を示します。
  ms.date: 10/08/2021
  ms.topic: article
  ms.service: backup
  ms.openlocfilehash: b85496805337da460a9512dc69813240f1022800
  ms.sourcegitcommit: 677e8acc9a2e8b842e4aef4472599f9264e989e7
  ms.translationtype: HT
  ms.contentlocale: ja-JP
  ms.lasthandoff: 11/11/2021
  ms.locfileid: "132290193"
title: Azure Files のバックアップに関する質問
summary: >
  この記事では、Azure Files のバックアップについてよくある質問への回答を示します。 一部の回答は、より詳しい情報を扱った記事にリンクされています。 また、<bpt id="p1">[</bpt>Microsoft Q&A の質問ページ<ept id="p1">](/answers/topics/azure-backup.html)</ept>に Azure Backup サービスに関する質問を投稿してディスカッションすることもできます。


  この記事の各セクションの内容をひととおり確認するには、右側の「<bpt id="p1">**</bpt>この記事の内容<ept id="p1">**</ept>」にあるリンクをご利用ください。
sections:
- name: Azure Files のバックアップ ジョブの構成
  questions:
  - question: >
      有効な Azure ファイル共有を含む、保護したいストレージ アカウントの一部が表示されないのはなぜですか?
    answer: >
      ストレージ アカウントがサポートされているストレージ アカウントの種類のいずれかに属していることを確実にするために、「<bpt id="p1">[</bpt>Azure ファイル共有のバックアップのサポート マトリックス<ept id="p1">](azure-file-share-support-matrix.md)</ept>」を参照してください。 探しているストレージ アカウントが既に保護されている、または別のコンテナーに登録されている可能性もあります。 コンテナーから<bpt id="p1">[</bpt>ストレージ アカウントの登録を解除<ept id="p1">](manage-afs-backup.md#unregister-a-storage-account)</ept>して、保護のために他のコンテナー内のストレージ アカウントを検出します。
  - question: >
      バックアップを構成しようとしているときに、ストレージ アカウントに Azure ファイル共有の一部が表示されないのはなぜですか。
    answer: >
      その Azure ファイル共有が既に同じ Recovery Services コンテナー内で保護されているかどうかと、その Azure ファイル共有を最近削除したかどうかを確認してください。
  - question: >
      Azure Files Sync で同期グループに接続されているファイル共有を保護することはできますか?
    answer: >
      はい。 同期グループに接続されている Azure ファイル共有の保護は有効になっています。
  - question: >
      ファイル共有をバックアップしようとして、ストレージ アカウント内のファイル共有を検出するために、そのストレージ アカウントを選択しました。 しかし、それらを保護することはしませんでした。 これらのファイル共有を他のコンテナーで保護するにはどうすればよいのですか?
    answer: >
      バックアップを試みる際、ストレージ アカウントを選択して、その中からファイル共有を検出すると、これを行ったストレージ アカウントがコンテナーに登録されます。 別のコンテナーでファイル共有を保護する場合は、このコンテナーから選択したストレージ アカウントを<bpt id="p1">[</bpt>登録解除<ept id="p1">](manage-afs-backup.md#unregister-a-storage-account)</ept>してください。
  - question: >
      ファイル共有のバックアップを構成するためにコンテナーを変更できないのはなぜですか?
    answer: >
      ストレージ アカウントが既にコンテナーに登録されているか、またはストレージ アカウント内の他のファイル共有がコンテナーを使用して保護されている場合、それを変更することはできません。 1 つのストレージ アカウントに存在するすべてのファイル共有は、必ず同じコンテナーで保護する必要があります。 コンテナーを変更する必要がある場合は、接続されているコンテナーから<bpt id="p1">[</bpt>ストレージ アカウント内のすべてのファイル共有の保護を停止<ept id="p1">](manage-afs-backup.md#stop-protection-on-a-file-share)</ept>し、ストレージ アカウントの<bpt id="p2">[</bpt>登録を解除<ept id="p2">](manage-afs-backup.md#unregister-a-storage-account)</ept>してから、保護する別のコンテナーを選択する必要があります。
  - question: >
      自分のファイル共有のバックアップ先コンテナーを変更することはできますか?
    answer: >
      はい。 しかし、接続されているコンテナーからの<bpt id="p1">[</bpt>ファイル共有の保護を停止<ept id="p1">](manage-afs-backup.md#stop-protection-on-a-file-share)</ept>し、このストレージ アカウントを<bpt id="p2">[</bpt>登録解除<ept id="p2">](manage-afs-backup.md#unregister-a-storage-account)</ept>したうえで、別のコンテナーから保護する必要があります。
  - question: >
      同じストレージ アカウントにある 2 つの異なるファイル共有を別々のコンテナーで保護することはできますか?
    answer: >
      いいえ。 1 つのストレージ アカウントに存在するすべてのファイル共有は、必ず同じコンテナーで保護する必要があります。
- name: バックアップ
  questions:
  - question: >
      上限に達したエラーのためにバックアップが失敗し始めた場合はどうすればよいですか?
    answer: >
      どの時点でも、ファイル共有のスナップショットを 200 個まで作成することができます。 この制限には、ポリシーの定義に従って Azure Backup により作成されたスナップショットの数も含まれます。 この制限に達した後でバックアップが失敗するようになったら、将来のバックアップを正常に実行できるよう、オンデマンド スナップショットを削除してください。
- name: 復元
  questions:
  - question: >
      削除した Azure ファイル共有から復旧できますか。
    answer: >
      ファイル共有が論理的に削除された状態にある場合、復元操作を実行するには、ファイル共有の削除を先に取り消しておく必要があります。 削除の取り消し操作によって、ファイル共有がアクティブ状態になり、任意の時点への復元を実行できるようになります。 ファイル共有の削除を取り消す方法については、<bpt id="p1">[</bpt>こちらのリンク<ept id="p1">](../storage/files/storage-files-enable-soft-delete.md?tabs=azure-portal#restore-soft-deleted-file-share)</ept>をクリックするか、または<bpt id="p2">[</bpt>ファイル共有の削除を取り消すためのスクリプト<ept id="p2">](./scripts/backup-powershell-script-undelete-file-share.md)</ept>を参照してください。 ファイル共有が完全に削除されると、コンテンツとスナップショットを復元することはできなくなります。
  - question: >
      Azure ファイル共有の保護を停止した場合、バックアップから復元することはできますか。
    answer: >
      はい。 保護を停止するときに <bpt id="p1">**</bpt>[バックアップ データの保持]<ept id="p1">**</ept> を選択した場合は、既存のすべての復元ポイントから復元できます。
  - question: >
      進行中の復元ジョブをキャンセルした場合、どうなりますか。
    answer: >
      進行中の復元ジョブがキャンセルされると、復元プロセスが停止され、すべてのファイルがキャンセル前に復元されます。ロールバックされずに、構成された変換先 (元の場所または別の場所) は保持されます。
- name: バックアップの管理
  questions:
  - question: >
      PowerShell を使用して、Azure ファイル共有のバックアップを構成/管理/復元できますか。
    answer: >
      はい。 詳細なドキュメントを<bpt id="p1">[</bpt>こちら<ept id="p1">](backup-azure-afs-automation.md)</ept>で参照してください
  - question: >
      バックアップ ジョブで転送されたデータが MB 単位で 0 であるのはなぜですか。
    answer: >
      Azure Files の現在のバックアップ ソリューションでは、データはコンテナーに転送されず、スナップショットはバックアップ ファイル共有と同じストレージ アカウント内に保持されます。 そのため、転送されたデータは MB 単位で 0 になります。
  - question: >
      Azure Files のバックアップが、コンテナーの [ストレージ レプリケーションの種類] 設定に基づいてレプリケーションされないのはなぜですか。
    answer: >
      コンテナーの [ストレージのレプリケーション] 設定は、Azure Files のバックアップには関係ありません。 これは、現在のソリューションがスナップショット ベースであり、コンテナーに転送されるデータがないためです。 スナップショットは、バックアップされたファイル共有と同じストレージ アカウントに格納されるため、ストレージ アカウントのレプリケーション設定に従ってレプリケートされます。
  - question: >
      Azure Backup によって作成されたスナップショットにアクセスしてマウントできますか?
    answer: >
      Azure Backup によって作成されたスナップショットはすべて、ポータル、PowerShell、または CLI でスナップショットを表示することでアクセスできます。 Azure Files 共有スナップショットの詳細については、「<bpt id="p1">[</bpt>Azure Files の共有スナップショットの概要<ept id="p1">](../storage/files/storage-snapshots-files.md)</ept>」を参照してください。
  - question: >
      バックアップされたファイル共有を別のサブスクリプションに移動した後はどうなりますか?
    answer: "ファイル共有を別のサブスクリプションに移動すると、Azure Backup によって新しいファイル共有と見なされます。 推奨される手順を以下に示します。\n \nシナリオ:ファイル共有 <bpt id=\"p1\">*</bpt>FS1<ept id=\"p1\">*</ept> がサブスクリプション <bpt id=\"p2\">*</bpt>S1<ept id=\"p2\">*</ept> にあり、<bpt id=\"p3\">*</bpt>V1<ept id=\"p3\">*</ept> コンテナーを使用して保護されているとします。 現在、そのファイル共有をサブスクリプション <bpt id=\"p1\">*</bpt>S2<ept id=\"p1\">*</ept> に移動したいと考えています。\n \n1.  目的のストレージ アカウントとファイル共有 (FS1) を別のサブスクリプション (S2) に移動します。\n2.  V1 コンテナーで、FS1 に対して \"データを削除して保護を停止\" 操作をトリガーします。\n3.  FS1 をホストしているストレージ アカウントを V1 コンテナーから登録解除します。\n4.  S2 サブスクリプションでコンテナー (V2) を使用して、先ほど S2 に移動した FS1 のバックアップを再構成します。 \n \nV2 を使用してバックアップを再構成した後、V1 で作成されたスナップショットは Azure Backup によって管理されなくなることに注意してください。 そのため、必要に応じて、これらのスナップショットを手動で削除する必要があります。\n"
  - question: >
      バックアップしたファイル共有を別のリソース グループに移動できますか?
    answer: >
      はい、バックアップしたファイル共有を別のリソース グループに移動できます。 ただし、Azure Backup によって新しいリソースと見なされるため、そのファイル共有のバックアップを再構成する必要があります。 また、リソース グループの移動前に作成されたスナップショットは、Azure backup によって管理されなくなります。 そのため、必要に応じて、これらのスナップショットを手動で削除する必要があります。
  - question: >
      バックアップについて構成できる保持期間の上限はどの位ですか?
    answer: >
      最大保有期間の詳細については、<bpt id="p1">[</bpt>サポート マトリックス<ept id="p1">](azure-file-share-support-matrix.md)</ept>を参照してください。 バックアップ ポリシーの構成中に保有期間の値を入力すると、Azure Backup によってスナップショットの数がリアルタイムで計算されます。 定義された保有期間の値に対応するスナップショットの数が 200 を超えるとすぐに、ポータルには保有期間の値を調整するよう要求する警告が表示されます。 これは、任意の時点で任意のファイル共有に対して Azure Files でサポートされるスナップショットの最大数の上限を超えないようにするためです。
  - question: >
      Azure ファイル共有のバックアップ ポリシーを "日単位のポリシー" から "GFS ポリシー" に変更すると、既存の復旧ポイントとスナップショットにどのような影響がありますか?
    answer: >
      日単位のバックアップ ポリシーを GFS ポリシーに変更すると (週/月/年単位の保持期間を追加)、動作は次のようになります。


      - <bpt id="p1">**</bpt>保持期間<ept id="p1">**</ept>:ポリシーを変更する際に週/月/年単位の保持期間を追加すると、スケジュールされたバックアップの一部として作成される将来のすべての復旧ポイントは、新しいポリシーに基づいてタグ付けされます。 既存のすべての復旧ポイントは、日単位の復旧ポイントと見なされるので、週/月/年単位としてタグ付けされません。


      - <bpt id="p1">**</bpt>スナップショットと復旧ポイントのクリーンアップ<ept id="p1">**</ept>:

        - 日単位の保持期間が延長される場合、既存の復旧ポイントの有効期限が、新しいポリシーに構成された日単位の保持期間の値に応じて更新されます。
        - 日単位の保持期間が短縮される場合、既存の復旧ポイントとスナップショットは、新しいポリシーに構成された日単位の保持期間の値に応じて次のクリーンアップ実行ジョブの削除対象としてマークされ、削除されます。

      この動作の例を次に示します。


      <bpt id="p1">**</bpt>既存のポリシー [P1]<ept id="p1">**</ept>


      |リテンション期間の種類 |スケジュール |保持  |

      |---------|---------|---------|

      |毎日    |    毎日午後 8 時    |  100 日間       |


      <bpt id="p1">**</bpt>新しいポリシー [変更された P1]<ept id="p1">**</ept>


      | リテンション期間の種類 | スケジュール                       | 保持 |

      | -------------- | ------------------------------ | --------- |

      | 毎日          | 毎日午後 9 時              | 50 日間   |

      | 週単位         | 日曜日午後 9 時              | 3 週間   |

      | 月単位        | 最終月曜日午後 9 時         | 1 か月   |

      | 年単位         | 1 月第 3 日曜日午後 9 時 | 4 年間   |


      **影響**


      1. 既存の復旧ポイントの有効期限は、新しいポリシーの日単位の保持期間の値 (50 日) に従って調整されます。 したがって、50 日よりも古い復旧ポイントは削除対象としてマークされます。


      2. 既存の復旧ポイントには、新しいポリシーに基づいた週/月/年単位のタグ付けはされません。


      3. 今後のすべてのバックアップは、新しいスケジュール (午後 9 時) に従ってトリガーされます。


      4. 今後のすべての復旧ポイントの有効期限は、新しいポリシーに合わせて調整されます。


      >[!NOTE]

      >ポリシーの変更は、スケジュールされたバックアップ ジョブ実行の一部として作成された復旧ポイントにのみ影響します。 オンデマンド バックアップの場合、保持期間はバックアップ作成時に指定する <bpt id="p1">**</bpt>[Retain Till]\(保持期限\)<ept id="p1">**</ept> 値によって決まります。
  - question: >
      既存の GFS ポリシーを変更すると、既存の復旧ポイントにどのような影響がありますか?
    answer: >
      ファイル共有に新しいポリシーが適用されると、今後スケジュールされているバックアップはすべて、変更されたポリシーで構成されているスケジュールに従って実行されます。  既存のすべての復旧ポイントの保持期間は、構成された新しい保持値に従って調整されます。 つまり、保持期間が延長された場合、既存の復旧ポイントは、新しいポリシーに従って保持されるようにマーキングされます。 保持期間が短縮された場合、それらは次回のクリーンアップ ジョブで排除対象としてマーキングされて、その後削除されます。


      この動作の例を次に示します。


      <bpt id="p1">**</bpt>既存のポリシー [P2]<ept id="p1">**</ept>


      | リテンション期間の種類 | スケジュール           | 保持 |

      | -------------- | ------------------ | --------- |

      | 毎日          | 毎日午後 8 時 | 50 日間   |

      | 週単位         | 月曜日午後 8 時  | 3 週間   |


      <bpt id="p1">**</bpt>新しいポリシー [変更された P2]<ept id="p1">**</ept>


      | リテンション期間の種類 | スケジュール               | 保持 |

      | -------------- | ---------------------- | --------- |

      | 毎日          | 毎日午後 9 時     | 10 日   |

      | 週単位         | 月曜日午後 9 時      | 2 週間   |

      | 月単位        | 最終月曜日午後 9 時 | 2 か月間  |


      <bpt id="p1">**</bpt>変更の影響<ept id="p1">**</ept>


      1. 既存の日単位の復旧ポイントの有効期限は、新しい日単位の保持期間の値 (10 日間) に従って調整されます。 そのため、10 日よりも古い日単位の復旧ポイントは削除されます。


      2. 既存の週単位の復旧ポイントの有効期限は、新しい週単位の保持期間の値 (2 週間) に従って調整されます。 そのため、2 週間よりも古い週単位の復旧ポイントは削除されます。


      3. 月単位の復旧ポイントは、新しいポリシー構成に基づいた今後のバックアップの一部としてのみ作成されます。


      4. 今後のすべての復旧ポイントの有効期限は、新しいポリシーに合わせて調整されます。


      >[!NOTE]

      >ポリシーの変更は、スケジュールされたバックアップの一部として作成された復旧ポイントにのみ影響します。 オンデマンド バックアップの場合、保持期間はバックアップ作成時に指定する <bpt id="p1">**</bpt>[Retain Till]\(保持期限\)<ept id="p1">**</ept> 値によって決まります。
  - question: >
      Azure Files バックアップ ポリシーの [期間] 属性は何を表しますか?
    answer: "**[期間]** 属性は、その日の最後のバックアップのタイムスタンプを判別するのに役立ちます。 \n\nたとえば、**[開始時刻]** が \"午前 x 時\" で、**[期間]** が \"y 時間\" の場合、ポリシーで定義されている **[スケジュール]** 属性に基づいて、バックアップは \"午前 x 時\" から (午前 x 時 + y 時間) の間でスケジュールされます。 この属性を使用すると、ファイル共有の内容に対する更新操作が頻繁に行われる場合に、作業時間中にのみバックアップがトリガーされるようにできます。従って、複数のスナップショットを取得することで、データを誤った変更から保護できます。\n"
  - question: >
      バックアップは、開始時刻、スケジュール、期間の各属性に基づいてどのようにスケジュールされますか?
    answer: >
      たとえば、次の構成でポリシーを作成したとします。


      - **開始時刻:** 午前 9 時

      - **スケジュール**: 4 時間ごと

      - **期間**: 12 時間


      これらの値に基づいて、バックアップの時間枠は、午前 9 時から (午前 9 時 + 12 時間)、つまり午前 9 時から午後 9 時として計算されます。 そのため、すべてのバックアップは、この時間枠内でスケジュールされます。


      1 日の最初のバックアップは、ポリシーに記載されている開始時刻 (午前 9 時) にトリガーされ、**スケジュール** により、連続するバックアップの間の時間差 (つまり 4 時間) が決まります。 この計算によって、バックアップ スケジュールは、午前 9 時、午後 1 時 (午前 9 時 + 4 時間)、午後 5 時 (午後 1 時 + 4 時間)、午後 9 時 (午後 5 時 + 4 時間) になります。


      計算したバックアップ時間枠の終了時刻は午後 9 時だったので、この時間以降、バックアップはトリガーされません。
  - question: "\"The selected configuration will trigger only 1 backup per day (選択した構成ではバックアップは 1 日 1 回のみトリガーされます)\" というエラーが表示されるのはなぜですか?\n"
    answer: >
      このエラーは、**期間** を超える **スケジュール** を指定した場合に発生します。 たとえば、**[開始時刻]** を午前 9 時、**[スケジュール]** を 6 時間、**[期間]** を 4 時間として構成したとします。 このシナリオでは、バックアップ ジョブでトリガーできる唯一の時間は午前 9 時です。その理由は、次回の午後 3 時 (午前 9 時 + 6 時間) はバックアップの時間枠の午前 9 時から午後 1 時 (午前 9 時 + 4 時間) を越えるためです。


      これを修正するには、スケジュールまたは期間を調整するか、**[毎時]** の代わりに、**[毎日]** を選択することをお勧めします。
  - question: "\"The selected configuration extends backup window to next day (選択した構成ではバックアップの時間枠が翌日に達します)\" というエラーが表示されるのはなぜですか?\n"
    answer: >
      このエラーは、バックアップの **スケジュール** と **期間** に基づいて決定されたバックアップ時間枠の **開始時刻** と **終了時刻** が 2 つの異なる日になる場合に発生します。


      たとえば、次のパラメーターを使用してポリシーを構成したとします。


      - **スケジュール**: 4 時間ごと

      - **開始時刻**: 午後 12 時

      - **期間**: 15 時間


      この構成に基づいて、バックアップの時間枠は午後 12 時から午前 3 時 (午後 12 時 + 15 時間) になります。 開始と終了の時刻は 2 つの異なる日になるので、**開始時刻** または **期間** を調整して、同じ日になるようにすることをお勧めします。


      上記の構成の開始時刻を午前 6 時に変更するとします。 これで、バックアップの時間枠は午前 6 時から午後 9 時 (午前 6 時 + 15 時間) になります。 これは、サポートされている構成です。
  - question: >
      頻度を [毎日] から [毎時] に切り替えると、既存の復旧ポイントにどのような影響がありますか?
    answer: >
      **[毎日]** から **[毎時]** に切り替えると、動作は次のようになります。


      - <bpt id="p1">**</bpt>保持期間<ept id="p1">**</ept>:ポリシーを変更する際に週/月/年単位の保持期間を追加すると、スケジュールされたバックアップの一部として作成される将来のすべての復旧ポイントは、新しいポリシーに基づいてタグ付けされます。 既存のすべての復旧ポイントは、引き続き日単位の復旧ポイントと見なされるので、週/月/年単位としてタグ付けされません。


      - <bpt id="p1">**</bpt>スナップショットと復旧ポイントのクリーンアップ<ept id="p1">**</ept>:

        - 日単位の保持期間が延長される場合、既存の日単位復旧ポイントの有効期限が、新しいポリシーに構成された日単位の保持期間の値に応じて更新されます。
        - 日単位の保持期間が短縮される場合、既存の日単位の復旧ポイントとスナップショットは、新しいポリシーに構成された日単位の保持期間の値に応じて次のクリーンアップ実行ジョブの削除対象としてマークされ、削除されます。
additionalContent: "\n## <a name=\"next-steps\"></a>次のステップ\n- <bpt id=\"p1\">[</bpt>Azure ファイル共有のバックアップ中の問題のトラブルシューティング<ept id=\"p1\">](troubleshoot-azure-files.md)</ept>"
