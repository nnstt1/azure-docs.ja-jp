---
title: 課金データを Azure にアップロードして Azure portal に表示する
description: 課金データを Azure にアップロードして Azure portal に表示する
services: azure-arc
ms.service: azure-arc
ms.subservice: azure-arc-data
author: twright-msft
ms.author: twright
ms.reviewer: mikeray
ms.date: 11/03/2021
ms.topic: how-to
ms.openlocfilehash: b54d77c5abb5e8043368ad1e8bce3d3865e68fd7
ms.sourcegitcommit: e41827d894a4aa12cbff62c51393dfc236297e10
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/04/2021
ms.locfileid: "131558765"
---
# <a name="upload-billing-data-to-azure-and-view-it-in-the-azure-portal"></a>課金データを Azure にアップロードして Azure portal に表示する




## <a name="connectivity-modes---implications-for-billing-data"></a>接続モード - 課金データに対する影響

次の 2 つのモードで Azure Arc 対応データ サービスを実行できます。

- **間接接続** - Azure に直接接続することはできません。 データは、エクスポートとアップロードのプロセスを通してのみ Azure に送信されます。
- **直接接続** - このモードでは、Azure Arc 対応 Kubernetes サービスに存在する依存関係により、Azure と、Azure Arc 対応データ サービスがデプロイされている Kubernetes クラスターとの間に、直接接続が提供されます。 これにより、Azure からより多くの機能が有効になり、Azure PaaS でデータ サービスを管理するのと同じように、Azure portal を使用して Azure Arc 対応データ サービスを管理することもできます。  

[接続モード](./connectivity.md)に関するページで、両者の違いの詳細を確認できます。

間接接続モードでの課金データは、Azure Arc データ コントローラーからセキュリティで保護されたファイルに定期的にエクスポートされた後、Azure にアップロードされて処理されます。  将来の直接接続モードでの課金データは、だいたい 1 時間に 1 回 Azure に自動的に送信され、サービスのコストをほぼリアルタイムで見ることができます。 間接接続モードでのデータのエクスポートとアップロードのプロセスは、スクリプトを使用して自動化でき、それを自動的に行うサービスが作成される可能性もあります。

## <a name="upload-billing-data-to-azure---indirectly-connected-mode"></a>課金データを Azure にアップロードする - 間接接続モード

> [!NOTE]
> 使用状況 (課金) データのアップロードは、直接接続モードで自動的に行われます。 次の手順は、間接接続モードにのみ該当します。 

課金データを Azure にアップロードするには、まず次のことを行う必要があります。

1. Azure Arc 対応データ サービスがまだない場合は作成します。 たとえば、次のいずれかを作成します。
   - [Azure Arc で Azure SQL Managed Instance を作成する](create-sql-managed-instance.md)
   - [Azure Arc 対応 PostgreSQL Hyperscale サーバー グループを作成する](create-postgresql-hyperscale-server-group.md)
2. 課金テレメトリ収集プロセスで課金データを収集できるように、データ サービスが作成されてから少なくとも 2 時間待ちます。
3. [リソース インベントリ、使用状況データ、メトリック、およびログを Azure Monitor にアップロードする](upload-metrics-and-logs-to-azure-monitor.md)で説明されている手順に従い、使用状況/課金/ログ データをアップロードするための前提条件を設定し、[使用状況データを Azure にアップロードする](upload-usage-data.md)に進んで、課金データをアップロードします。 


## <a name="view-billing-data-in-azure-portal"></a>Azure portal で課金データを表示する

Azure portal で課金データを表示するには、次の手順のようにします。

1. [Azure Portal](https://portal.azure.com)を開きます。
1. 画面の上部にある検索ボックスに「**Cost Management**」と入力し、Cost Management サービスをクリックします。
1. **[Cost Management の概要]** で、 **[Cost Management]** タブをクリックします。
1. 左側の **[コスト分析]** タブをクリックします。
1. ビューの上部にある **[リソースごとのコスト]** ボタンをクリックします。
1. スコープが、データ サービス リソースが作成されたサブスクリプションに設定されていることを確認します。
1. ビューの上部近くにある [スコープ] セレクターの横の [ビュー] ドロップダウンで、 **[リソースごとのコスト]** を選択します。
1. 日付フィルターが、 **[今月]** またはデータ サービス リソースを作成したときのタイミングによって意味のある他の時間範囲に設定されていることを確認します。
1. Azure Arc 対応データ サービスの 1 つの種類にフィルターを絞り込む場合は、 **[フィルターの追加]** をクリックし、 **[リソースの種類]**  = `Microsoft.AzureArcData/<data service type>` でフィルターを追加します。
1. 作成されて Azure にアップロードされたすべてのリソースの一覧が表示されます。 課金メーターは $0 であるため、コストは常に $0 であることがわかります。

## <a name="download-billing-data"></a>課金データをダウンロードする

課金概要データを、Azure portal から直接ダウンロードできます。

1. 上の手順に従って表示される **[コスト分析] のリソース種類別ビュー** で、上部の近くにある [ダウンロード] ボタンをクリックします。
1. ダウンロード ファイルの種類 (Excel または CSV) を選択し、 **[データのダウンロード]** ボタンをクリックします。
1. 選択したファイルの種類に応じて、適切なエディターでファイルを開きます。

## <a name="export-billing-data"></a>課金データをエクスポートする

課金エクスポート ジョブを作成することにより、**詳細な** 使用状況と課金データを Azure Storage コンテナーに定期的にエクスポートすることもできます。 これは、請求期間内に特定のインスタンスが課金された時間数など、課金の詳細を確認したい場合に便利です。

課金エクスポート ジョブを設定するには、次の手順のようにします。

1. 左側の **[エクスポート]** をクリックします。
1. **[追加]** をクリックします。
1. 名前とエクスポートの頻度を入力し、[次へ] をクリックします。
1. 新しいストレージ アカウントの作成または既存の使用を選択し、課金データ ファイルのエクスポート先のストレージ アカウント、コンテナー、ディレクトリ パスの指定をフォームに入力して、[次へ] をクリックします。
1. **Create** をクリックしてください。

課金データのエクスポート ファイルは約 4 時間使用でき、課金エクスポート ジョブを作成するときに指定したスケジュールに基づいてエクスポートされます。

エクスポートされた課金データ ファイルを表示するには、次の手順のようにします。

Azure portal で課金データ ファイルを検証できます。 

> [!IMPORTANT]
> 課金エクスポート ジョブを作成した後、4 時間待ってから次の手順に進んでください。

1. ポータルの上部にある検索ボックスに「**ストレージ アカウント**」と入力し、 **[ストレージ アカウント]** をクリックし ます。
3. 上で課金エクスポート ジョブを作成するときに指定したストレージ アカウントをクリックします。
4. 左側の [コンテナー] をクリックします。
5. 上で課金エクスポート ジョブを作成するときに指定したコンテナーをクリックします。
6. 上で課金エクスポート ジョブを作成するときに指定したフォルダーをクリックします。
7. 生成されたフォルダーとファイルにドリルダウンし、生成された .csv ファイルの 1 つをクリックします。
8. **[ダウンロード]** ボタンをクリックすると、ファイルがローカル環境のダウンロード フォルダーに保存されます。
9. Excel などの .csv ファイル ビューアーを使用してファイルを開きます。
10. 結果をフィルター処理して、**リソースの種類** = `Microsoft.AzureArcData/<data service resource type` の行のみを表示します。
11. 現在の 24 時間の期間中にインスタンスが使用された時間数が、UsageQuantity 列に表示されます。
