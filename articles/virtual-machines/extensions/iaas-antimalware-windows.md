---
title: Azure での Windows VM 用の Microsoft Antimalware 拡張機能
description: 拡張機能を使用して、Windows 仮想マシンに Azure のマルウェア対策拡張機能をデプロイします。
services: virtual-machines
documentationcenter: ''
author: TerryLanfear
manager: rkarlin
editor: ''
ms.assetid: ''
ms.service: virtual-machines
ms.subservice: extensions
ms.collection: windows
ms.topic: article
ms.tgt_pltfrm: vm-windows
ms.workload: infrastructure-services
ms.date: 07/30/2021
ms.author: terrylan
ms.openlocfilehash: 11a67e773313fb48023864eeb2ee6ead9d8d10bd
ms.sourcegitcommit: 677e8acc9a2e8b842e4aef4472599f9264e989e7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2021
ms.locfileid: "132277184"
---
# <a name="microsoft-antimalware-extension-for-windows"></a>Windows 用の Microsoft マルウェア対策拡張機能

## <a name="overview"></a>概要

最近のクラウド環境に対する脅威は非常に変化が激しく、コンプライアンスとセキュリティの要件を満たすために効果的な保護を維持しなければならないというビジネス IT クラウドのサブスクライバーに対する圧力はますます大きくなっています。 Azure 向けの Microsoft マルウェア対策は、ウイルスやスパイウェアなどの悪意のあるソフトウェアを識別して削除する無料のリアルタイム保護機能であり、既知のマルウェアや不要なソフトウェアが Azure システムへのインストールまたは実行を試みた場合に警告する構成可能なアラートを備えています。 このソリューションの基になっているマルウェア対策プラットフォームは、Microsoft Security Essentials (MSE)、Microsoft Forefront Endpoint Protection、Microsoft System Center Endpoint Protection、Windows Intune、Windows Defender for Windows 8.0 以降と同じです。
Azure 向け Microsoft マルウェア対策は、アプリケーションおよびテナント環境のための単一エージェント ソリューションであり、ユーザーの介入なしにバック グラウンドで実行するように作られています。 アプリケーションのワークロードのニーズに基づいて、マルウェア対策監視など、基本的な既定のセキュリティまたは高度なカスタム構成で、保護をデプロイできます。

## <a name="prerequisites"></a>前提条件

### <a name="operating-system"></a>オペレーティング システム

Azure 向け Microsoft マルウェア対策ソリューションには、Microsoft マルウェア対策クライアントとサービス、マルウェア対策クラシック デプロイ モデル、マルウェア対策 PowerShell コマンドレット、および Azure Diagnostics 拡張機能が含まれます。 Microsoft マルウェア対策ソリューションは、Windows Server 2008 R2、Windows Server 2012、および Windows Server 2012 R2 の各オペレーティング システム ファミリでサポートされます。 Windows Server 2008 オペレーティング システムではサポートされず、Linux でもサポートされません。 

Windows Defender は Windows Server 2016 で有効になっている組み込みのマルウェア対策です。 Windows Defender インターフェイスは、一部の Windows Server 2016 SKU でも既定で有効になっています。
Azure VM マルウェア対策拡張機能も引き続き、Windows Server 2016 Azure VM と Windows Defender の組み合わせに追加できますが、その場合、Windows Defender によって使用される任意の構成ポリシーがあれば、それが拡張機能によって適用されます。拡張機能によって、追加のマルウェア対策サービスがデプロイされることはありません。 詳細については、「[クラウド サービス用の Azure マルウェア対策拡張機能に更新する](/archive/blogs/azuresecurity/update-to-azure-antimalware-extension-for-cloud-services)」を参照してください。

### <a name="internet-connectivity"></a>インターネット接続

Windows 用の Microsoft マルウェア対策では、定期的なエンジンとシグネチャの更新を受信するために、ターゲットの仮想マシンがインターネットに接続されている必要があります。 

## <a name="template-deployment"></a>テンプレートのデプロイ
Azure VM 拡張機能は、Azure Resource Manager テンプレートでデプロイできます。 テンプレートは、デプロイ後の構成 (Azure マルウェア対策へのオンボードなど) が必要な仮想マシンを 1 つ以上デプロイするときに最適です。

仮想マシン拡張機能の JSON 構成は、仮想マシン リソース内に入れ子にすることも、Resource Manager JSON テンプレートのルートまたは最上位レベルに配置することもできます。 JSON 構成の配置は、リソースの名前と種類の値に影響します。 詳細については、[子リソースの名前と種類の設定](../../azure-resource-manager/templates/child-resource-name-type.md)に関する記事を参照してください。 

次の例では、VM 拡張機能が仮想マシン リソース内で入れ子になっていることを前提としています。 拡張機能リソースを入れ子にすると、JSON は仮想マシンの `"resources": []` オブジェクトに配置されます。

```json
{
      "type": "Microsoft.Compute/virtualMachines/extensions",
      "name": "[concat(parameters('vmName'),'/', parameters('vmExtensionName'))]",
      "apiVersion": "2019-07-01",
      "location": "[resourceGroup().location]",
      "dependsOn": [
        "[concat('Microsoft.Compute/virtualMachines/', parameters('vmName'))]"
      ],

      "properties": {
        "publisher": "Microsoft.Azure.Security",
        "type": "IaaSAntimalware",
        "typeHandlerVersion": "1.3",
        "autoUpgradeMinorVersion": true,
        "settings": {
          "AntimalwareEnabled": "true",
          "Exclusions": {
            "Extensions": ".ext1;.ext2",
            "Paths": "c:\excluded-path-1;c:\excluded-path-2",
            "Processes": "excludedproc1.exe;excludedproc2.exe"
          },

          "RealtimeProtectionEnabled": "true",
          "ScheduledScanSettings": {
            "isEnabled": "true",
            "scanType": "Quick",
            "day": "7",
            "time": "120"
          }
        },
        "protectedSettings": null
      }
}
```
Microsoft Antimalware 拡張機能を有効にするには、少なくとも次の内容を含める必要があります。 

`{ "AntimalwareEnabled": true }`

Microsoft Antimalware の JSON 構成のサンプル:

```json
{ "AntimalwareEnabled": true, "RealtimeProtectionEnabled": true, "ScheduledScanSettings": { "isEnabled": true, "day": 1, "time": 120, "scanType": "Full" },

"Exclusions": { "Extensions": ".ext1;.ext2", "Paths": "c:\excluded-path-1;c:\excluded-path-2", "Processes": "excludedproc1.exe;excludedproc2.exe" }
}
```


AntimalwareEnabled

- 必須パラメーター
- 値: true/false

  - true = 有効
  - false = エラー出力、false はサポートされている値ではありません

RealtimeProtectionEnabled

- 値: true/false、既定値は true

  - true = 有効
  - false = 無効

ScheduledScanSettings

- isEnabled = true/false
- day = 0 - 8 (0 - 毎日、1 - 日曜日、2 - 月曜日、 ....、7 - 土曜日、8 - 無効)
- time = 0 - 1440 (深夜 0 時からの分数 - 60 - > 午前 1 時、120 -> 午前 2 時、 ... )
- scanType = Quick/Full、既定値は Quick

- isEnabled = true が指定されている唯一の設定である場合、既定値は次のように設定されます: day = 7 (土曜日)、time = 120 (午前 2 時)、scanType = "Quick"

除外

- 同じリスト内で複数を除外するには、セミコロン区切り記号を使用して指定します
- 除外を指定しないと、既存の除外がある場合は、システムでの空白によって上書きされます

## <a name="powershell-deployment"></a>PowerShell でのデプロイ
Azure マルウェア対策の仮想マシン拡張機能を既存の仮想マシンにデプロイするには、デプロイの種類に応じて対応するコマンドを使用します。

  * [Azure Resource Manager ベースの仮想マシン](../../security/fundamentals/antimalware-code-samples.md#enable-and-configure-microsoft-antimalware-for-azure-resource-manager-vms)
  * [Azure Service Fabric クラスター](../../security/fundamentals/antimalware-code-samples.md#add-microsoft-antimalware-to-azure-service-fabric-clusters)
  * [従来のクラウド サービス](/powershell/module/servicemanagement/azure.service/set-azureserviceextension)

## <a name="troubleshoot-and-support"></a>トラブルシューティングとサポート

### <a name="troubleshoot"></a>[トラブルシューティング]

Microsoft マルウェア対策拡張機能のログは、%Systemdrive%\WindowsAzure\Logs\Plugins\Microsoft.Azure.Security.IaaSAntimalware(または PaaSAntimalware)\1.5.5.x(バージョン #)\CommandExecution.log で入手できます

### <a name="error-codes-and-their-meanings"></a>エラー コードとその意味

| エラー コード | 意味 | 可能なアクション |
| :---: | --- | --- |
| -2147156224 | MSI が別のインストールでビジー状態です | 後でインストールを実行してみてください |
| -2147156221 | MSE セットアップが既に実行されています | 一度に 1 つインスタンスのみを実行してください |
| -2147156208 | ディスク領域不足 (200 MB 未満) | 使用されていないファイルを削除し、インストールを再試行してください |
| -2147156187 | 前回のインストール、アップグレード、更新、またはアンインストールによって再起動が要求されました | 再起動して、インストールを再試行してください |
| -2147156121 | セットアップで競合他社製品の削除が試みられました。 しかし、競合他社製品のアンインストールが失敗しました | 競合他社製品を手動で削除し、再起動してから、インストールを再試行してみてください  |
| -2147156116 | ポリシー ファイルの検証に失敗しました | 必ずセットアップに有効なポリシー XML ファイルを渡してください  |
| -2147156095 | セットアップでマルウェア対策サービスを開始できませんでした | すべてのバイナリが正しく署名されていて、適切なライセンス ファイルがインストールされていることを確認してください |
| -2147023293 | インストール中に致命的なエラーが発生しました。 これはほとんどの場合に発生します。 Epp.msi では、AM サービスまたはミニ フィルタ ドライバを登録、開始、停止することはできません | 今後の調査のために、ここで EPP.msi からの MSI ログが必要です |
| -2147023277 | インストール パッケージを開くことができませんでした | パッケージが存在していて、アクセス可能であることを確認してください。または、アプリケーション ベンダーに問い合わせて、この Windows インストーラー パッケージが有効かどうかを確認してください |
| -2147156109 | Windows Defender は前提条件として必須です |  |
| -2147205073 | Websso 発行者がサポートされていません | |
| -2147024893 | 指定されたパスが見つかりません |  |
| -2146885619 | 暗号メッセージがないか、暗号メッセージの形式が正しくありません |  |
| -1073741819 | 0x %p にある命令が 0x%p にあるメモリを参照していました。 メモリを %s にすることができませんでした |  |
| 1 | 関数が正しくありません |  |

### <a name="support"></a>サポート

この記事についてさらにヘルプが必要な場合は、いつでも [MSDN の Azure フォーラムと Stack Overflow フォーラム](https://azure.microsoft.com/support/forums/)で Azure エキスパートに問い合わせることができます。 または、Azure サポート インシデントを送信できます。 [Azure サポートのサイト](https://azure.microsoft.com/support/options/)に移動して、[サポートの要求] をクリックしてください。 Azure サポートの使用方法の詳細については、「 [Microsoft Azure サポートに関する FAQ](https://azure.microsoft.com/support/faq/)」を参照してください。
