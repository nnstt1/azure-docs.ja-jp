---
title: 仮想マシンから SAP HANA on Azure (L インスタンス) への接続のセットアップ | Microsoft Docs
description: SAP HANA on Azure (L インスタンス) を使用するための仮想マシンからの接続のセットアップ。
services: virtual-machines-linux
documentationcenter: ''
author: msjuergent
manager: patfilot
editor: ''
tags: azure-resource-manager
keywords: ''
ms.service: virtual-machines-sap
ms.subservice: baremetal-sap
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 05/28/2021
ms.author: madhukan
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: d38953e4ba4a50f1349e99384e31cf0b01f1fab2
ms.sourcegitcommit: c385af80989f6555ef3dadc17117a78764f83963
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/04/2021
ms.locfileid: "111409489"
---
# <a name="connecting-azure-vms-to-hana-large-instances"></a>HANA L インスタンスへの Azure VM の接続

この記事では、Azure VM を HANA L インスタンス (BareMetal インフラストラクチャ インスタンスとも呼ばれます) に接続するときに行うことについて説明します。 

「[SAP HANA on Azure (L インスタンス) とは](./hana-overview-architecture.md)」の記事 で触れているように、Azure における SAP アプリケーション レイヤーと HANA L インスタンスの最小デプロイ環境は次のようになります。

![SAP HANA on Azure (L インスタンス) およびオンプレミスに接続された Azure VNet](./media/hana-overview-architecture/image1-architecture.png)

Azure 仮想ネットワーク側をよく見ると、次のものが必要であることがわかります。

- SAP アプリケーション レイヤーの VM のデプロイ先となる Azure 仮想ネットワークの定義。
- 実際に VM のデプロイ先である、Azure 仮想ネットワーク内の既定のサブネットの定義。
- 作成される Azure 仮想ネットワークには、少なくとも 1 つの VM サブネットと 1 つの Azure ExpressRoute 仮想ネットワーク ゲートウェイ サブネットが必要です。 これらのサブネットには、以降のセクションで指定および説明されているとおりに IP アドレス範囲を割り当てる必要があります。

## <a name="create-the-azure-virtual-network-for-hana-large-instances"></a>HANA L インスタンス向けの Azure 仮想ネットワークを作成する

>[!Note]
>HANA L インスタンス向けの Azure 仮想ネットワークは、Azure Resource Manager デプロイ モデルを使って作成する必要があります。 クラシック デプロイ モデルとして一般的に知られている以前の Azure デプロイ モデルは、HANA L インスタンス ソリューションではサポートされていません。

仮想ネットワークは、Azure portal、PowerShell、Azure テンプレート、または Azure CLI を使用して作成することができます。 (詳細については、「[Azure portal を使用した仮想ネットワークの作成](../../../virtual-network/manage-virtual-network.md#create-a-virtual-network)」をご覧ください)。 次の例では、Azure portal を使用して作成された仮想ネットワークについて説明しています。

このドキュメントでは、**アドレス空間** とは、Azure 仮想ネットワークが使用できるアドレス空間のことです。 仮想ネットワークが BGP ルートの伝播に使用するアドレス範囲でもあります。 この **アドレス空間** は、次の画面で確認できます。

![Azure portal に表示される Azure 仮想ネットワークのアドレス空間](./media/hana-overview-connectivity/image1-azure-vnet-address-space.png)

前の例では、Azure 仮想ネットワークで使用される IP アドレス範囲が 10.16.0.0/16 と、かなり広範囲に割り当てられています。 この仮想ネットワーク内の後続のサブネットにはすべて、このアドレス空間内の IP アドレス範囲を割り当てることができます。 通常は、そのような大きいアドレス範囲は、Azure の単一の仮想ネットワークには推奨されません。 Azure 仮想ネットワークに定義されているサブネットを見てみましょう。

![Azure 仮想ネットワークのサブネットとその IP アドレス範囲](./media/hana-overview-connectivity/image2b-vnet-subnets.png)

この仮想ネットワークにはまず "default" という VM サブネットがあり、さらに "GatewaySubnet" というサブネットがあります。

前の 2 つの画像では、**仮想ネットワーク アドレス空間** に、**Azure VM のサブネット IP アドレス範囲** と仮想ネットワーク ゲートウェイのサブネット IP アドレス範囲の両方が含まれています。

**仮想ネットワーク アドレス空間** を、各サブネットで使用されている特定の範囲に限定できます。 また、はっきり限定された複数の範囲として、次のように **仮想ネットワーク アドレス空間** を定義することもできます。

![2 つの空間から成る Azure 仮想ネットワークのアドレス空間](./media/hana-overview-connectivity/image3-azure-vnet-address-space_alternate.png)

このケースでは、**仮想ネットワーク アドレス空間** に 2 つの空間が定義されています。 これらは、Azure VM のサブネット IP アドレス範囲と仮想ネットワーク ゲートウェイのサブネット IP アドレス範囲に対して定義されている IP アドレス範囲と同じです。 

これらのテナント サブネット (VM サブネット) には、任意の命名標準を使用できます。 ただし、**各仮想ネットワークにゲートウェイ サブネットが常に 1 つだけ存在する必要があります**。それが SAP HANA on Azure (L インスタンス) ExpressRoute 回線に接続します。 **このゲートウェイ サブネットは "GatewaySubnet" という名前である必要があります**。これは、ExpressRoute ゲートウェイが適切に配置されるようにするためです。

> [!WARNING] 
> ゲートウェイ サブネットに必ず "GatewaySubnet" と命名することは非常に重要です。

複数の VM サブネットと不連続のアドレス範囲を使用することができます。 これらのアドレス範囲は、仮想ネットワークの **仮想ネットワーク アドレス空間** に含まれている必要があります。 これらは、集約された形式にすることができます。 VM サブネットとゲートウェイ サブネットの範囲を厳密に列挙したリスト形式にすることもできます。

次の一覧には、HANA L インスタンスに接続する Azure 仮想ネットワークに関する重要な情報がまとめられています。

- HANA L インスタンスを最初にデプロイする際は、**仮想ネットワーク アドレス空間** を Microsoft に提出する必要があります。 
- **仮想ネットワーク アドレス空間** は、Azure VM と仮想ネットワーク ゲートウェイの両方のサブネット IP アドレス範囲の範囲を含む 1 つの大きな範囲にすることができます。
- また、VM サブネット IP アドレス範囲と仮想ネットワーク ゲートウェイ サブネット IP アドレス範囲という異なる IP アドレス範囲を含んだ複数の範囲を送信することもできます。
- 定義した **仮想ネットワーク アドレス空間** は、BGP ルートの伝播に使用されます。
- ゲートウェイ サブネットの名前は次にする必要があります: **"GatewaySubnet"** 。
- アドレス空間は、HANA L インスタンス側で、Azure から HANA L インスタンス ユニットへのトラフィックを許可または拒否するためのフィルターとして使用されます。 Azure 仮想ネットワークの BGP ルーティング情報と、HANA L インスタンス側でフィルター処理用に構成されている IP アドレス範囲は一致する必要があります。 そうしないと、接続に問題が生じることがあります。
- ゲートウェイ サブネットに関するさらに重要な詳細があります。 詳細については、「[HANA Large Instances に仮想ネットワークを接続する](hana-connect-vnet-express-route.md)」を参照してください。

## <a name="different-ip-address-ranges-to-be-defined"></a>定義する各種の IP アドレス範囲 

HANA L インスタンスをデプロイするために必要な IP アドレス範囲のいくつかは既に挙げています。 この他にも重要な IP アドレス範囲があります。 次の IP アドレスは、必ずしもすべてを Microsoft に提出する必要はありません。 ただし、初期デプロイの要求を送信する前に定義する必要があります。

- **仮想ネットワークのアドレス空間**:**仮想ネットワーク アドレス空間** は、Azure 仮想ネットワーク内のアドレス空間パラメーターに割り当てる IP アドレスの範囲です。 これらのネットワークは、SAP HANA L インスタンス環境に接続します。 このアドレス空間パラメーターは複数行の値として指定することをお勧めします。 Azure VM のサブネット範囲と Azure ゲートウェイのサブネット範囲から構成してください。 
    
    これまでの図ではこのサブネット範囲が表示されていました。 これを、オンプレミスのアドレス範囲やサーバー IP プールのアドレス範囲、ER-P2P のアドレス範囲と重複させることはできません。 これらの IP アドレス範囲を取得するには、どうすればよいでしょうか。 通常、社内のネットワークで使われていない 1 つまたは複数の IP アドレス範囲は、社内のネットワーク チームまたはサービス プロバイダーから入手できます。 たとえば、Azure VM のサブネットが 10.0.1.0/24 で、Azure ゲートウェイ サブネットのサブネットが 10.0.2.0/28 としましょう。  Azure 仮想ネットワーク アドレス空間を次のように定義することをお勧めします: 10.0.1.0/24 および 10.0.2.0/28。 アドレス空間の値を集約させることはできますが、サブネット範囲に一致させることをお勧めします。 このようにして、ネットワークのどこかで大きなアドレス空間内の IP アドレス範囲が誤って再利用されることを回避できます。 **仮想ネットワーク アドレス空間はアドレス範囲です。初期デプロイを依頼するときに、これを Microsoft に送信する必要があります**。
- **Azure VM のサブネット IP アドレス範囲:** この IP アドレス範囲は、Azure 仮想ネットワーク サブネットのパラメーターに割り当てたものです。 このパラメーターは Azure 仮想ネットワーク内にあり、SAP HANA L インスタンス環境に接続します。 この IP アドレス範囲は、Azure VM に IP アドレスを割り当てる目的で使用されます。 この範囲外の IP アドレスは、SAP HANA L インスタンス サーバーへの接続が許可されます。 必要に応じて、複数の Azure VM サブネットを使用できます。 各 Azure VM サブネットに /24 CIDR ブロックの使用をお勧めします。 このアドレス範囲は、Azure 仮想ネットワーク アドレス空間に使用されている値の範囲内であることが必要です。 この IP アドレス範囲を取得するには、どうすればよいでしょうか。 通常、社内のネットワークで使われていない IP アドレス範囲は、社内のネットワーク チームまたはサービス プロバイダーから入手できます。
- **仮想ネットワーク ゲートウェイ サブネットの IP アドレス範囲:** 使用する予定の機能に応じて、推奨のサイズは以下のようになります。
   - Ultra-performance ExpressRoute ゲートウェイ: /26 アドレス ブロック--Type II クラスの SKU で必要。
   - High Performance ExpressRoute 仮想ネットワーク ゲートウェイ (以下) を使った ExpressRoute と VPN の共存: /27 アドレス ブロック。
   - その他すべて: /28 アドレス ブロック。 このアドレス範囲は、"VNet アドレス空間" に使用されている値の範囲内であることが必要です。 このアドレス範囲は、Microsoft に提出する Azure 仮想ネットワーク アドレス空間に使用されている値の範囲内であることが必要です。 この IP アドレス範囲を取得するには、どうすればよいでしょうか。 通常、社内のネットワークで使われていない IP アドレス範囲は、社内のネットワーク チームまたはサービス プロバイダーから入手できます。 
- **ER-P2P 接続のアドレス範囲:** SAP HANA L インスタンスの ExpressRoute (ER) P2P 接続に使用する IP 範囲です。 この範囲の IP アドレスは、/29 CIDR の IP アドレス範囲であることが必要です。 この範囲をオンプレミスのアドレス範囲や他の Azure IP アドレス範囲と重複させることはできません。 この IP アドレス範囲は、ExpressRoute 仮想ゲートウェイから SAP HANA L インスタンス サーバーへの ER 接続を設定する際に使用されます。 この IP アドレス範囲を取得するには、どうすればよいでしょうか。 通常、社内のネットワークで使われていない IP アドレス範囲は、社内のネットワーク チームまたはサービス プロバイダーから入手できます。 **この範囲は IP アドレスの範囲です。初期デプロイを依頼するときに、これを Microsoft に送信する必要があります**。  
- **サーバー IP プール アドレス範囲:** HANA L インスタンス サーバーに個々の IP アドレスを割り当てるときに、この IP アドレス範囲が使用されます。 推奨されるサブネット サイズは、/24 CIDR ブロックです。 必要に応じて小さくして、わずか 64 個の IP アドレスにすることができます。 この範囲の先頭から 30 個の IP アドレスは、Microsoft 用に予約されています。 範囲のサイズを選択する際は、これを必ず考慮してください。 この範囲をオンプレミスのアドレス範囲や他の Azure IP アドレスと重複させることはできません。 この IP アドレス範囲を取得するには、どうすればよいでしょうか。 通常、社内のネットワークで使われていない IP アドレス範囲は、社内のネットワーク チームまたはサービス プロバイダーから入手できます。  **この IP アドレス範囲は、初期デプロイを依頼する際に Microsoft に提出する必要があります**。

最終的に Microsoft に送信するオプションの IP アドレス範囲:

- [ExpressRoute Global Reach](../../../expressroute/expressroute-global-reach.md) を使用してオンプレミスから HANA Large インスタンス ユニットへの直接ルーティングを有効にする場合は、別の /29 IP アドレス範囲を予約する必要があります。 この範囲は、以前に定義した他のどの IP アドレス範囲とも重複しないようにする必要があります。
- [ExpressRoute Global Reach](../../../expressroute/expressroute-global-reach.md) を使用して、ある Azure リージョン内の HANA L インスタンス テナントから別の Azure リージョン内の別の HANA L インスタンス テナントへの直接ルーティングを有効にする場合は、別の /29 IP アドレス範囲を予約する必要があります。 この範囲は、以前に定義した他の IP アドレス範囲と重複しないようにする必要があります。

ExpressRoute Global Reach の詳細および HANA L インスタンスの使用法については、以下を参照してください。

- [SAP HANA (L インスタンス) のネットワーク アーキテクチャ](./hana-network-architecture.md)
- [HANA Large Instances に仮想ネットワークを接続する](./hana-connect-vnet-express-route.md)
 
前述の IP アドレス範囲を自分で設計、定義する必要がありますが、 そのすべてを Microsoft に送信する必要はありません。 Microsoft に提出する必要がある IP アドレス範囲は次のとおりです。

- Azure 仮想ネットワークのアドレス空間
- ER-P2P 接続のアドレス範囲
- サーバー IP プールのアドレス範囲

HANA L インスタンスへの接続を必要とする仮想ネットワークをさらに追加する場合は、新たに追加する Azure 仮想ネットワークのアドレス空間を Microsoft に提出します。 

以下に、各種アドレス範囲の例を示します。また、ご自分で構成して最終的に Microsoft に提出することになるアドレス範囲の例もいくつか挙げています。 1 つ目の例では Azure 仮想ネットワークのアドレス空間の値が集約されていません。 ただし、これは、先頭の Azure VM サブネット IP アドレス範囲と仮想ネットワークの ゲートウェイ サブネット IP アドレス範囲に基づいて定義されています。 

Azure 仮想ネットワークのアドレス空間に追加する新しい VM サブネットのその他の IP アドレス範囲を新たに構成して提出する際は、Azure 仮想ネットワーク内で複数の VM サブネットを使用できます。

![SAP HANA on Azure (L インスタンス) の最小デプロイ環境に必要な IP アドレス範囲](./media/hana-overview-connectivity/image4b-ip-addres-ranges-necessary.png)

前の画像には、ExpressRoute Global Reach のオプション使用に必要な追加の IP アドレス範囲は示されていません。

また、Microsoft に送信するデータを集約することもできます。 その場合、Azure 仮想ネットワークのアドレス空間に含まれる空間は 1 つだけです。 前述の例の IP アドレスの範囲を使用すると、集約された仮想ネットワークのアドレス空間は次の図のようになります。

![SAP HANA on Azure (L インスタンス) の最小限のデプロイに必要な IP アドレス範囲の例 (その 2)](./media/hana-overview-connectivity/image5b-ip-addres-ranges-necessary-one-value.png)

この例では、小さい範囲を 2 つ使って Azure 仮想ネットワークのアドレス空間を定義する代わりに、4,096 個の IP アドレスを含んだ、より大きい範囲が 1 つ使われています。 このように大きなアドレス空間を定義すると、かなり大きな範囲が未使用のまま残ってしまいます。 仮想ネットワークのアドレス空間の値は BGP ルートの伝播に使用されるため、未使用の範囲がオンプレミスまたはネットワーク内のどこかで使用されると、ルーティングに問題が生じる可能性があります。 前の図には、ExpressRoute Global Reach のオプション使用に必要な追加の IP アドレス範囲は示されていません。

アドレス空間は、実際に使用するサブネットのアドレス空間の境界と厳密に合わせることをお勧めします。 必要に応じて、仮想ネットワークにダウンタイムを発生させることなく、後からいつでも新しいアドレス空間の値を追加することができます。
 
> [!IMPORTANT] 
> ER-P2P、サーバー IP プール、および Azure 仮想ネットワーク アドレス空間の各 IP アドレス範囲は、互いに、またはネットワーク内で使用されている他の範囲と **重複** しないようにしてください。 それぞれが不連続である必要があります。 前の 2 つの図に示されているように、他の範囲のサブネットにすることもできません。 範囲が重複すると、Azure 仮想ネットワークが ExpressRoute 回線に接続できなくなる可能性があります。

## <a name="next-steps-after-address-ranges-have-been-defined"></a>アドレス範囲を定義した後に行う手順
IP アドレス範囲の定義後、次の作業を行う必要があります。

1. Azure 仮想ネットワーク アドレス空間の IP アドレス範囲、ER-P2P 接続のアドレス範囲、サーバー IP プールのアドレス範囲を、このドキュメントの冒頭で挙げた他のデータと一緒に提出します。 この時点で、仮想ネットワークと VM サブネットの作成を開始することもできます。 
2. Azure サブスクリプションと HANA L インスタンス スタンプの間の ExpressRoute 回線が Microsoft によって作成されます。
3. Microsoft によって、L インスタンス スタンプにテナント ネットワークが作成されます。
4. Microsoft が SAP HANA on Azure (L インスタンス) インフラストラクチャ内に、HANA L インスタンスと通信する Azure 仮想ネットワークのアドレス空間からの IP アドレスを受け入れるネットワークを構成します。
5. 購入した SAP HANA on Azure (L インスタンス) SKU に応じて、Microsoft がテナント ネットワークにコンピューティング ユニットを割り当てます。 また、ストレージを割り当ててマウントし、オペレーティング システム (SUSE または Red Hat Linux) をインストールします。 これらのユニットの IP アドレスは、お客様が Microsoft に提出したサーバー IP プール アドレス範囲から割り当てられます。

デプロイ プロセスの最後に、Microsoft からお客様に以下のデータが送信されます。
- Azure 仮想ネットワークを HANA L インスタンスに接続する ExpressRoute 回線にお客様の Azure 仮想ネットワークを接続するために必要な情報。
     - 承認キー
     - ExpressRoute PeerID
- ExpressRoute 回線と Azure 仮想ネットワークを設定した後で HANA L インスタンスにアクセスするためのデータ。

HANA L インスタンスを接続する手順については、[SAP HANA on Azure (L インスタンス) のセットアップ](https://azure.microsoft.com/resources/sap-hana-on-azure-large-instances-setup/)に関するドキュメントで確認することもできます。 手順の多くは、そのドキュメントのデプロイの例に示されています。 

## <a name="next-steps"></a>次の手順

HANA L インスタンスの ExpressRoute への仮想ネットワークの接続について確認します。

> [!div class="nextstepaction"]
> [HANA Large Instances に仮想ネットワークを接続する](hana-connect-vnet-express-route.md)
