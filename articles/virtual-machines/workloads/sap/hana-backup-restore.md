---
title: SAP HANA on Azure での HANA のバックアップと復元 (ラージ インスタンス) | Microsoft Docs
description: HANA Large Instances 上の SAP HANA のバックアップと復元を行う方法について説明します。
services: virtual-machines-linux
documentationcenter: ''
author: Ajayan1008
manager: gwallace
editor: ''
ms.service: virtual-machines-sap
ms.subservice: baremetal-sap
ms.topic: article
ms.tgt_pltfrm: vm-linux
ms.workload: infrastructure
ms.date: 7/02/2021
ms.author: madhukan
ms.custom: H1Hack27Feb2017
ms.openlocfilehash: 7b60ba5c169f660cd01f95f53fbc292a768f1b5e
ms.sourcegitcommit: 82d82642daa5c452a39c3b3d57cd849c06df21b0
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/07/2021
ms.locfileid: "113358941"
---
# <a name="backup-and-restore-of-sap-hana-on-hana-large-instances"></a>HANA Large Instances での SAP HANA のバックアップと復元

>[!IMPORTANT]
>この記事は、SAP HANA の管理ドキュメントまたは SAP Note に代わるものではありません。 SAP HANA の管理と操作 (特にバックアップ、復元、高可用性、ディザスター リカバリーのトピック) について、読者が専門知識を有していることを前提としています。 この記事では、SAP HANA Studio のスクリーンショットを示します。 SAP 管理ツールの画面およびツール自体の内容、構造、特徴は、SAP HANA のリリースごとに変わる可能性があります。

この記事では、HANA Large Instances (BareMetal インフラストラクチャとも呼ばれる) 上の SAP HANA のバックアップと復元を行う手順について説明します。 

この記事で説明する手順は一部簡略化されています。 操作ハンドブックに含まれる詳細な手順としては意図されていません。 お使いの構成に対応した操作ハンドブックを作成するには、お使いの特定の HANA バージョンとリリースでプロセスを実行してテストします。 そのうえで、お使いの構成に合った手順を文書化してください。

データベースを運用するうえで最も重要な点の 1 つは、危機的な事象からデータベースを保護することです。 こうした事象の原因には、自然災害から単純なユーザー エラーまで、あらゆることが考えられます。 データベースをバックアップし、任意の時点 (たとえば、だれかが重要なデータを削除してしまう前など) にまで復元できるできるようにすることで、きわめて大きな保護効果が得られます。 中断の発生前にできる限り近い状態へのデータベースの復元が可能になります。

復元機能を実現するには、2 種類のバックアップを実行する必要があります。

- データベースのバックアップ:完全、増分、または差分バックアップ
- トランザクション ログのバックアップ

アプリケーション レベルでデータベースの完全バックアップを実行できるほか、ストレージ スナップショットを使用してバックアップを実行することもできます。 ストレージ スナップショットはトランザクション ログ バックアップの代わりになるものではありません。 データベースを特定の時点に復元したり、既にコミットされたトランザクションのログを削除したりするために、トランザクション ログ バックアップが重要であることに変わりはありません。 ストレージ スナップショットでは、データベースのロールフォワード イメージが速やかに提供されるので、復旧を迅速化できます。 

SAP HANA on Azure (L インスタンス) には、次の 2 つのバックアップと復元のオプションがあります。

- サードパーティのデータ保護ツールを使用してバックアップを作成する。 このツールは、アプリケーション コンシステントなスナップショットを作成できること、またはバッキング インターフェイスを使用して複数のセッションを適切なバックアップ場所にストリーム配信できることが必要です。 サポートされるツールがいくつか提供されています。 ユーザーのバックアップ時間帯の要件を満たすために、ツールを選ぶにあたっては、プロジェクト チームで協議、検討する必要があります。 そして、プロジェクト フェーズ中にバックアップと復元の手順をテストすることが非常に重要となります。
- ストレージ スナップショット バックアップと Microsoft から提供されるユーティリティ (次の章で説明) を併用する

>[!NOTE]
>HANA2.0 SPS4 より前では、マルチテナント データベース コンテナー (複数テナント) のデータベース スナップショット作成はサポートされていません。
このスナップショット機能は、SPS4 以降の SAP で完全にサポートされます。



## <a name="use-storage-snapshots-of-sap-hana-on-azure-large-instances"></a>SAP HANA on Azure (Large Instances) のストレージ スナップショットを使用する

SAP HANA on Azure (L インスタンス) の基になっているストレージ インフラストラクチャでは、ボリュームのストレージ スナップショットがサポートされています。 ボリュームのバックアップと復元の両方がサポートされていますが、次の点を考慮する必要があります。

- データベースの完全バックアップの代わりに、ストレージ ボリューム スナップショットが頻繁に作成されます。
- /hana/data ボリュームに対するストレージ スナップショットがトリガーされる前に、スナップショット ツール (azacsnap) によって SAP HANA スナップショットが開始されます。 この SAP HANA スナップショットが、ストレージ スナップショットの復旧後、最終的なログ復元の整合性ポイントとなります。 
- HANA スナップショットが成功するには、アクティブな HANA インスタンスが必要です。 HANA System Replication (HSR) を使用したシナリオの場合、HANA スナップショットを実行できない現在のセカンダリ ノードでは、ストレージ スナップショットはサポートされていません。
- ストレージ スナップショットが正常に実行された後、SAP HANA スナップショットは削除されます
- その他のボリューム、たとえば /hana/shared (/usr/sap を含む) は、データベースを対話的に操作することなく、いつでもスナップショットを作成できます

トランザクション ログ バックアップが頻繁に作成され、/hana/logbackups ボリュームまたは Azure に保存されます。 トランザクション ログ バックアップを格納する /hana/logbackups ボリュームをトリガーしてスナップショットを個別に実行できます。 その場合、HANA データ スナップショットを実行する必要はありません。 /hana/logbackup 内のファイルはいずれも "オフライン" であり、整合性のある状態であるため、いつでも別の場所にバックアップしてアーカイブすることができます。
運用環境の障害でデータベースを特定の時点にまで復元する必要が生じた場合、azacsnap ツールでデータ スナップショットを新しいボリュームにクローンしてデータベースを復旧するか (推奨される復元方法はこちらです)、データベースがある場所と同じデータ ボリュームにスナップショットを復元することができます

>[!NOTE]
> 元のデータボリュームに以前のスナップショットを復元 (snaprevert) すると、それよりも後に作成されたスナップショットはすべて削除されます。 ストレージ システムがそのような動作になっているのは、以前のスナップショットよりも後に作成されたスナップショットのデータ ポイントは無効になるためです。 常に最新のスナップショットから復元してください。または、スナップショットを新しいボリュームにクローンするとなおよいでしょう。 クローン処理では何も削除されません。


## <a name="storage-snapshot-considerations"></a>ストレージ スナップショットに関する考慮事項

>[!NOTE]
>ストレージ スナップショットは、HANA Large Instance ユニットに割り当てられているストレージ スペースを使います。 ストレージ スナップショットのスケジュール設定と、保持するストレージ スナップショットの数については、以下の点を考慮します。 

SAP HANA on Azure (L インスタンス) のストレージ スナップショットに固有のメカニズムは、次のとおりです。

- 作成時点での特定のストレージ スナップショットでは、ストレージをほとんど使われません。
- データの内容が変化し、ストレージ ボリュームで SAP HANA データ ファイルの内容が変化したら、元のブロックの内容とデータの変更がスナップショットに保存される必要があります。
- そのため、ストレージ スナップショットのサイズは増加します。 スナップショットの存在期間が長くなるほど、ストレージ スナップショットが大きくなります。
- ストレージ スナップショットの有効期間に SAP HANA データベース ボリュームに対する変更が多くなるほど、ストレージ スナップショットの領域の消費量が大きくなります。

SAP HANA on Azure (L インスタンス) には、SAP HANA のデータとログ ボリューム用の固定ボリューム サイズがあります。 これらのボリュームのスナップショットを作成すると、ボリューム領域が消費されます。 以下を実行する必要があります。

- ストレージ スナップショットのスケジュールを決めす。
- ストレージ ボリュームの領域使用量を監視します。 
- 格納するスナップショットの数を管理します。 

大量のデータをインポートする場合や、HANA データベースに対する他の大きな変更を実行する場合、ストレージ スナップショットを無効にすることができます。 


以降のセクションでは、これらのスナップショットの作成に関する情報と、一般的な推奨事項について説明します。

- ハードウェアではボリュームごとに 255 個のスナップショットを保持できますが、この数よりも十分に少なくしておくことをお勧めします。 推奨値は 250 以下です。
- ストレージ スナップショットを実行する前に、空き領域を監視して追跡します。
- 空き領域に基づいて、ストレージ スナップショットの数を減らします。 場合によっては、保持するスナップショットの数を減らしたり、ボリュームを拡大したりする必要があります。 追加のストレージは 1 TB 単位で注文できます。
- SAP プラットフォーム移行ツール (R3load) を使用した SAP HANA へのデータの移動や、バックアップからの SAP HANA データベースの復元などの操作の実行中は、/hana/data ボリュームでストレージ スナップショットを無効にします。 
- SAP HANA テーブルの大規模な再編成中は、できるだけストレージ スナップショットを避けます。
- ストレージ スナップショットは、SAP HANA on Azure (Large Instances) の DR 機能を利用するための前提条件です。

## <a name="prerequisites-for-using-self-service-storage-snapshots"></a>セルフサービスのストレージ スナップショットを使用するための前提条件

ドキュメント「[Azure アプリケーション整合性スナップショット ツールとは](../../../azure-netapp-files/azacsnap-introduction.md)」を参照してください

このツールには 2 とおりの導入方法があります。 
1)  ローカル (データベース サーバー)
2)  リモート ("バックアップ" VM)

バックアップ VM を作成する場合は、その VM に最新の HANA クライアントがインストールされていることを確認してください。 この方法では、azacsnap から、別の VM で実行されている HANA インスタンスへのリモート データベース接続を開く必要があります。
ストレージにアクセスするためには、Microsoft サポート チームに SSH キーとストレージ ユーザーを要求する必要があります。 この SSH キーとユーザーを使用しないと、スナップショットを作成できません。

## <a name="download-and-set-up-azacsnap"></a>azacsnap をダウンロードしてセットアップする

HANA Large Instances でストレージ スナップショットをセットアップするには、まず「[Azure アプリケーション整合性スナップショット ツールの使用を開始する](../../../azure-netapp-files/azacsnap-get-started.md)」の説明に従い、azacsnap ツールをダウンロードしてインストールします

azacsnap では、azacsnap というユーザーが既定で作成されます。 別の名前を希望する場合は、インストール時に指定できます。 詳細については、前述のドキュメントを参照してください。

## <a name="subsequent-next-steps"></a>この後に続けて行う手順
azacsnap のドキュメントに従ってください。

- [Azure アプリケーション整合性スナップショット ツールをインストールする](../../../azure-netapp-files/azacsnap-installation.md)
- [Azure アプリケーション整合性スナップショット ツールを構成する](../../../azure-netapp-files/azacsnap-cmd-ref-configure.md)
- [Azure アプリケーション整合性スナップショット ツールをテストする](../../../azure-netapp-files/azacsnap-cmd-ref-test.md)
- [Azure アプリケーション整合性スナップショット ツールを使用してバックアップする](../../../azure-netapp-files/azacsnap-cmd-ref-backup.md)
- [Azure アプリケーション整合性スナップショット ツールを使用して詳細を取得する](../../../azure-netapp-files/azacsnap-cmd-ref-details.md)
- [Azure アプリケーション整合性スナップショット ツールを使用して削除する](../../../azure-netapp-files/azacsnap-cmd-ref-delete.md)
- [Azure アプリケーション整合性スナップショット ツールを使用して復元する](../../../azure-netapp-files/azacsnap-cmd-ref-restore.md)
- [Azure アプリケーション整合性スナップショット ツールを使用したディザスター リカバリー](../../../azure-netapp-files/azacsnap-disaster-recovery.md)
- [Azure アプリケーション整合性スナップショット ツールのトラブルシューティング](../../../azure-netapp-files/azacsnap-troubleshoot.md)
- [Azure アプリケーション整合性スナップショット ツールを使用するためのヒントとテクニック](../../../azure-netapp-files/azacsnap-tips.md)


## <a name="next-steps"></a>次のステップ

「[Azure アプリケーション整合性スナップショット ツールとは](../../../azure-netapp-files/azacsnap-introduction.md)」の記事を参照してください

  



