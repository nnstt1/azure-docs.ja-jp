---
title: 仮想マシン用 Azure 専用ホストの概要
description: Azure 専用ホストを使用して仮想マシンをデプロイする方法の詳細について説明します。
author: brittanyrowe
ms.service: virtual-machines
ms.subservice: dedicated-hosts
ms.topic: conceptual
ms.workload: infrastructure
ms.date: 12/07/2020
ms.author: brittanyrowe
ms.reviewer: brittanyrowe
ms.openlocfilehash: 6e34d5c638c8501840c9ef8d9bbaf22ae2874ff1
ms.sourcegitcommit: f6e2ea5571e35b9ed3a79a22485eba4d20ae36cc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/24/2021
ms.locfileid: "128557100"
---
# <a name="azure-dedicated-hosts"></a>Azure 専用ホスト

**適用対象:** :heavy_check_mark: Linux VM :heavy_check_mark: Windows VM :heavy_check_mark: ユニフォーム スケール セット

Azure 専用ホストは、1 つの Azure サブスクリプションに対して専用の物理サーバーを提供するサービスであり、1 つ以上の仮想マシンをホストできます。 専用ホストは、データ センターで使用されるものと同じ物理サーバーであり、リソースとして提供されます。 リージョン、可用性ゾーン、障害ドメイン内に専用ホストをプロビジョニングできます。 次に、プロビジョニングされたホストに VM を直接配置し、ニーズに最も合った構成にすることができます。


## <a name="benefits"></a>メリット

ホスト全体を予約すると、次のような利点があります。

-   物理サーバー レベルでのハードウェアの分離。 他の VM はホスト上に配置されません。 専用ホストは同じデータ センターに展開され、他の分離されていないホストと同じネットワークおよび基になるストレージ インフラストラクチャを共有します。
-   Azure プラットフォームによって開始されるメンテナンス イベントの制御。 ほとんどのメンテナンス イベントでは仮想マシンに対する影響はほとんど、またはまったくありませんが、1 秒間の一時停止が影響する可能性のある機密性の高いワークロードがいくつかあります。 専用ホストを使用すると、メンテナンス期間を選択して、サービスへの影響を減らすことができます。
-   Azure ハイブリッド特典を使用すると、Windows と SQL のライセンスを Azure に持ち込むことができます。 ハイブリッド特典を使用すると、追加のメリットが得られます。 詳細については、「[Azure ハイブリッド特典](https://azure.microsoft.com/pricing/hybrid-benefit/)」を参照してください。


## <a name="groups-hosts-and-vms"></a>グループ、ホスト、VM

![専用ホストの新しいリソースのビュー。](./media/virtual-machines-common-dedicated-hosts/dedicated-hosts2.png)

**ホスト グループ** は、専用ホストのコレクションを表すリソースです。 リージョンと可用性ゾーンにホスト グループを作成し、それにホストを追加します。

**ホスト** はリソースであり、Azure データ センター内の物理サーバーにマップされます。 物理サーバーは、ホストの作成時に割り当てられます。 ホストは、ホスト グループ内に作成されます。 ホストには、作成できる VM サイズが記述されている SKU があります。 各ホストでは、同じサイズ シリーズのものである限り、異なるサイズの複数の VM をホストできます。


## <a name="high-availability-considerations"></a>高可用性に関する考慮事項

高可用性を実現するには、複数の VM を複数のホスト (最低 2 つ) に分散させて展開する必要があります。 Azure 専用ホストには、障害分離境界を形成するようにインフラストラクチャをプロビジョニングするためのオプションがいくつかあります。

### <a name="use-availability-zones-for-fault-isolation"></a>障害分離のために可用性ゾーンを使用する

可用性ゾーンは、Azure リージョン内の一意の物理的な場所です。 それぞれのゾーンは、独立した電源、冷却手段、ネットワークを備えた 1 つまたは複数のデータセンターで構成されています。 ホスト グループは、1 つの可用性ゾーン内に作成されます。 作成されると、すべてのホストがそのゾーン内に配置されます。 ゾーンをまたいで高可用性を実現するには、複数のホスト グループ (ゾーンごとに 1 つ) を作成し、それに応じてホストを分散させる必要があります。

可用性ゾーンにホスト グループを割り当てる場合は、そのホスト上に作成されるすべての VM を、同じゾーン内に作成する必要があります。

### <a name="use-fault-domains-for-fault-isolation"></a>障害ドメインを使用して障害の分離を行う

ホストは特定の障害ドメインに作成することができます。 スケール セットまたは可用性セット内の VM と同様に、異なる障害ドメインのホストは、データ センター内の異なる物理ラックに配置されます。 ホスト グループを作成するときは、障害ドメインの数を指定する必要があります。 ホスト グループ内にホストを作成するときは、各ホストに障害ドメインを割り当てます。 VM に障害ドメインを割り当てる必要はありません。

障害ドメインは、コロケーションと同じものではありません。 2 つのホストを同じ障害ドメインにしても、互いに近接しているとは限りません。

障害ドメインはホスト グループにスコープされます。 2 つのホスト グループ間の非アフィニティについては、何も想定しないでください (異なる可用性ゾーンに存在しない場合)。

異なる障害ドメインでホストに展開された VM では、障害分離保護を強化するため、複数のストレージ スタンプで基になるマネージド ディスク サービスが使用されます。

### <a name="using-availability-zones-and-fault-domains"></a>可用性ゾーンと障害ドメインの使用

両方の機能を一緒に使用して、より高い障害の分離を実現できます。 この場合は、各ホスト グループに対して可用性ゾーンと障害ドメインの数を指定し、グループ内の各ホストに対して障害ドメインを割り当てて、各 VM に可用性ゾーンを割り当てます。

[Resource Manager のサンプル テンプレート](https://github.com/Azure/azure-quickstart-templates/blob/master/quickstarts/microsoft.compute/vm-dedicated-hosts/README.md)では、ゾーンと障害ドメインを使用して、リージョン内の回復性を最大にするためにホストが分散されます。


## <a name="manual-vs-automatic-placement"></a>手動配置と自動配置

Azure で VM を作成するときに、使用する専用ホストを選択できます。 また、ホスト グループ内の既存のホストに VM を自動的に配置するオプションを使用することもできます。

新しいホスト グループを作成する際には、VM の自動配置の設定が選択されていることを確認してください。 VM を作成する際は、ホスト グループを選択すると、Azure によって VM に最適なホストが選択されます。

自動配置が有効になっているホスト グループでは、すべての VM が自動的に配置される必要はありません。 ホスト グループに対して自動配置が選択されている場合でも、ホストを明示的に選択することができます。

### <a name="limitations"></a>制限事項

VM の自動配置を使用する場合の既知の問題と制限事項:

- VM を再デプロイすることはできません。
- 専用ホストで Lsv2、NVasv4、NVsv3、Msv2、または M シリーズの VM を使用することはできません


## <a name="virtual-machine-scale-set-support"></a>仮想マシン スケール セットのサポート

仮想マシン スケール セットを使用すると、仮想マシンのグループを 1 つのリソースとして扱い、可用性、管理、スケーリング、およびオーケストレーションのポリシーをグループとして適用できます。 仮想マシン スケール セットには、既存の専用ホストを使用することもできます。

仮想マシン スケール セットを作成するときに、既存のホスト グループを指定して、すべての VM インスタンスを専用ホスト上に作成することができます。

専用ホスト グループに仮想マシン スケール セットを作成する場合は、次の要件が適用されます。

- VM の自動配置を有効にする必要があります。
- ホスト グループの可用性設定は、使用しているスケール セットと一致している必要があります。
    - リージョン スケール セットでは、(可用性ゾーンを指定せずに作成された) リージョン ホスト グループを使用する必要があります。
    - ホスト グループとスケール セットでは、同じ可用性ゾーンが使用されている必要があります。
    - ホスト グループ レベルの障害ドメインの数は、スケール セットの障害ドメインの数と一致している必要があります。 Azure portal では、スケール セットの "*最大拡散*" を指定できます。これにより、障害ドメインの数が 1 に設定されます。
- 専用ホストは、十分な容量を確保し、スケール セット ゾーンおよび障害ドメインで同じ設定を適用した上で最初に作成する必要があります。
- 専用ホストでサポートされている VM のサイズは、スケール セットで使用されているものと一致している必要があります。

すべてのスケール セットのオーケストレーションと最適化設定が、専用ホストでサポートされているわけではありません。 次の設定をスケール セットに適用します。
- オーバープロビジョニングは推奨されません。既定では無効になっています。 オーバープロビジョニングを有効にすることは可能ですが、ホスト グループに、オーバープロビジョニングされたインスタンスを含むすべての VM に対応する容量がない場合は、スケール セットの割り当てが失敗します。
- ScaleSetVM オーケストレーション モードの使用
- コロケーションに近接配置グループを使用しない



## <a name="maintenance-control"></a>メンテナンス管理

仮想マシンをサポートするインフラストラクチャは、信頼性、パフォーマンス、セキュリティを向上させ、新機能を投入するために、ときどき更新されることがあります。 Azure Platform では、可能な限りプラットフォーム メンテナンスの影響が最小限に抑えられますが、"*メンテナンスの影響を受けやすい*" ワークロードを使用するお客様は、メンテナンスのために VM が数秒でもフリーズまたは切断されることを許容できません。

**メンテナンス管理** により、お客様は、専用ホストでスケジュールされた通常のプラットフォーム更新をスキップし、35 日のローリングウィンドウ内で選択した時点で適用することができます。 メンテナンス期間内では、メンテナンスを任意の順序で、ホストレベルで直接適用できます。 メンテナンス期間が終了すると、Microsoft は処理を進め、ユーザー定義の障害ドメインに従っていない可能性のある順序で、保留中のメンテナンスをホストに適用します。

詳細については、「[メンテナンス コントロールによるプラットフォームの更新の管理](./maintenance-control.md)」を参照してください。

## <a name="capacity-considerations"></a>容量に関する考慮事項

プロビジョニングされた専用ホストは、Azure によって物理サーバーに割り当てられます。 これにより、VM をプロビジョニングする必要があるときの容量の可用性が保証されます。 Azure では、ホストの物理サーバーを選択するために、リージョン (またはゾーン) の全容量が使用されます。 またそれは、クラスター内の領域の不足を心配することなく専用のホスト フットプリントを拡張できることをお客様が期待できることを意味します。

## <a name="quotas"></a>Quotas (クォータ)

専用ホストをデプロイするときに使用されるクォータには、次の 2 種類があります。

1. 専用ホストの vCPU クォータ。 既定のクォータ制限は、リージョンごとに 3000 vCPU です。
1. VM サイズ ファミリ クォータ。 たとえば、**従量課金制** サブスクリプションの場合、米国東部リージョンで使用可能な Dsv3 サイズ シリーズの vCPU には 10 個のクォータがあります。 Dsv3 専用ホストをデプロイするには、専用ホストをデプロイする前に、少なくとも 64 vCPU にクォータを増やすように要求する必要があります。

クォータの増加を要求するには、[Azure portal](https://portal.azure.com/#blade/Microsoft_Azure_Support/HelpAndSupportBlade/newsupportrequest) でサポート リクエストを作成します。

専用ホストをプロビジョニングすると、専用ホストの vCPU と VM ファミリの vCPU クォータの両方が使用されますが、リージョンの vCPU は使用されません。 専用ホストに配置される VM は、VM ファミリ vCPU クォータに対してカウントされません。 専用ホストからマルチテナント環境に VM を移動する場合、その VM では VM ファミリ vCPU クォータが使用されます。


![ポータルの使用量とクォータのページのスクリーンショット](./media/virtual-machines-common-dedicated-hosts/quotas.png)

詳しくは、「[仮想マシンの vCPU クォータ](./windows/quotas.md)」をご覧ください。

無料試用版および MSDN サブスクリプションには、Azure 専用ホストのクォータはありません。

## <a name="pricing"></a>価格

ユーザーは、展開されている VM の数に関係なく、専用ホストごとに課金されます。 毎月の明細書では、新しい課金対象のホストのリソース種類が示されています。 専用ホスト上の VM は明細書で引き続き示されますが、料金は 0 になります。

ホスト価格は、VM ファミリ、タイプ (ハードウェア サイズ)、およびリージョンに基づいて設定されます。 ホストの価格は、ホストでサポートされている最大の VM サイズが基準になります。

ソフトウェア ライセンス、ストレージ、およびネットワークの使用量は、ホストおよび VM とは別に課金されます。 それらの課金対象アイテムに変更はありません。

詳しくは、「[Azure 専用ホストの価格](https://aka.ms/ADHPricing)」をご覧ください。

また、[Azure Dedicated Host](prepay-dedicated-hosts-reserved-instances.md)の予約インスタンスを使用してコストを節約することもできます。

## <a name="sizes-and-hardware-generations"></a>サイズとハードウェアの世代

SKU はホストに対して定義され、VM サイズ シリーズとタイプを表します。 同じサイズ シリーズであれば、1 つのホスト内に異なるサイズの複数の VM を混在させることができます。

"*種類*" はハードウェアの世代です。 同じ VM シリーズの異なるハードウェアの種類では、CPU ベンダーが異なり、CPU の世代とコアの数が異なります。

サイズとハードウェアの種類はリージョンによって異なります。 詳しくは、ホストの[価格のページ](https://aka.ms/ADHPricing) を参照してください。

> [!NOTE]
> 専用ホストをプロビジョニングした後に、サイズや種類を変更することはできません。 サイズや種類の異なるホストが必要な場合は、新しいホストを作成する必要があります。

## <a name="host-life-cycle"></a>ホストのライフ サイクル


Azure では、ホストの正常性状態が監視および管理されます。 ホストのクエリを実行すると、次の状態が返されます。

| 正常性の状態   | 説明       |
|----------|----------------|
| 使用可能なホスト     | ホストに既知の問題はありません。   |
| 調査対象のホスト  | ホストには調査中の問題がいくつかあります。 これは、識別された問題のスコープと根本原因を Azure で特定するために必要な移行状態です。 ホストで実行されている仮想マシンが影響を受ける可能性があります。 |
| Host Pending Deallocate (割り当て解除中保留中のホスト)   | Azure では、ホストを正常な状態に復元することができず、このホストから仮想マシンを再デプロイすることをユーザーに求めます。 `autoReplaceOnFailure` が有効になっている場合、仮想マシンは正常なハードウェアに "*サービス復旧*" されます。 それ以外の場合、仮想マシンは障害が発生しようとしているホストで実行される可能性があります。|
| Host deallocated (割り当て解除済みのホスト)  | すべての仮想マシンがホストから削除されました。 ハードウェアがローテーションから外されたため、このホストに対して課金されることはありません。   |


## <a name="next-steps"></a>次のステップ

- 専用ホストをデプロイするには、「[VM とスケール セットを専用ホストにデプロイする](./dedicated-hosts-how-to.md)」を参照してください。

- リージョン内の回復性を最大にするためにゾーンと障害ドメインの両方を使用する[サンプル テンプレート](https://github.com/Azure/azure-quickstart-templates/blob/master/quickstarts/microsoft.compute/vm-dedicated-hosts/README.md)があります。

- また、[Azure Dedicated Host](prepay-dedicated-hosts-reserved-instances.md)の予約インスタンスを使用してコストを節約することもできます。
