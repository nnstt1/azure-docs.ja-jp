---
title: Azure でのオンデマンドの容量予約 (プレビュー)
description: 容量予約を使用して、Azure リージョンまたは可用性ゾーンでコンピューティング容量を予約する方法について説明します。
author: vargupt
ms.author: vargupt
ms.service: virtual-machines
ms.topic: how-to
ms.date: 08/09/2021
ms.reviewer: cynthn, jushiman
ms.custom: template-how-to
ms.openlocfilehash: b2fa87d140a9a86c3ced814d15a3898b34c9d4d1
ms.sourcegitcommit: 37cc33d25f2daea40b6158a8a56b08641bca0a43
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/15/2021
ms.locfileid: "130072938"
---
# <a name="on-demand-capacity-reservation-preview"></a>オンデマンドの容量予約 (プレビュー)

オンデマンドの容量予約を使用すると、任意の期間、Azure リージョンまたは可用性ゾーンでコンピューティング容量を予約できます。 [予約インスタンス](https://azure.microsoft.com/pricing/reserved-vm-instances/)とは異なり、1 年間または 3 年間の契約にサインアップする必要はありません。 いつでも予約を作成および削除することができ、予約の管理方法を完全に制御できます。  

容量予約を作成すると、すぐに容量を使用でき、予約を削除するまで自分専用に予約されます。  


> [!IMPORTANT]
> 容量予約は現在パブリック プレビュー段階にあります。
> このプレビュー バージョンはサービス レベル アグリーメントなしで提供されており、運用環境のワークロードに使用することは推奨されません。 特定の機能はサポート対象ではなく、機能が制限されることがあります。 詳しくは、[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)に関するページをご覧ください。


容量予約には、作成時に常に定義されるいくつかの基本的なプロパティがあります。 
- **VM のサイズ** - 各予約は、1 つの VM サイズに対するものです。 たとえば、「 `Standard_D2s_v3` 」のように入力します。 
- **場所** - 各予約は、1 つの場所 (リージョン) に対するものです。 その場所に可用性ゾーンがある場合は、予約でゾーンの 1 つを指定することもできます。 
- **数量** - 各予約には、予約するインスタンスの量があります。 

容量予約を作成するには、これらのパラメーターを容量要求として Azure に渡します。 サブスクリプションに必要なクォータがない場合、または指定を満たすために使用できる容量が Azure にない場合、予約のデプロイは失敗します。 デプロイが失敗しないようにするには、クォータの増量を要求するか、別の VM サイズ、場所、またはゾーンの組み合わせを試します。 

Azure によって予約要求が受け入れられると、一致する構成の VM で使用できるようになります。 容量予約を使用するには、VM のプロパティの 1 つとして予約を指定する必要があります。 そうしないと、容量予約はいつまでも使用されません。 この設計の利点の 1 つは、重要なワークロードのみを予約の対象にし、他の重要でないワークロードは予約容量を使用しないで実行できることです。   

> [!NOTE]
> 容量予約には、仮想マシンで使用する Azure 可用性 SLA も付属しています。 SLA は、パブリック プレビューの期間中は適用されず、容量予約が一般提供されるようになった時点で定義されます。

## <a name="benefits-of-capacity-reservation"></a>容量予約のベネフィット 

- デプロイが済むと、容量が予約されて使用できるようになり、該当する SLA の範囲内で常に使用できます  
- 契約期間の縛りなしで、いつでもデプロイおよび削除できます 
- 予約インスタンスと自動的に組み合わせて、期間コミットメントの割引を利用できます  

## <a name="sla-for-capacity-reservation"></a>容量予約の SLA 

容量予約の SLA は、将来この機能が一般提供される時点で定義されます。  


## <a name="limitations-and-restrictions"></a>制限事項と制約事項 

- 容量予約を作成するには、仮想マシンの作成と同じ方法でクォータが必要です。 
- スポット VM および Azure Dedicated Host ノードは、容量予約ではサポートされていません。 
- デプロイの一部の制約はサポートされていません。 
    - 近接配置グループ 
    - 更新ドメイン 
    - Ultra SSD ストレージ  
- パブリック プレビュー期間中は、Av2、B、D、E、F の VM シリーズのみがサポートされます。 
- パブリック プレビュー期間中にサポートされる VM シリーズについては、最大 3 つの障害ドメイン (FD) がサポートされます。 含まれる FD が 3 つより多いデプロイは、容量予約にはデプロイできません。 
- 可用性セットは、容量予約ではサポートされていません。 
- このプレビュー期間中は、予約を作成したサブスクリプションだけがそれを使用できます。 
- 予約を利用できるのは、Azure の有料のお客様だけです。 無料試用版や Microsoft Azure for Students などのスポンサー プラン アカウントは、この機能を使用できません。 


## <a name="pricing-and-billing"></a>価格と課金 

容量予約は、基になる VM サイズと同じ料金で課金されます。 たとえば、10 台の D2s_v3 VM で予約を作成した場合、予約が作成されるとすぐに、予約が使用されていない場合でも、D2s_v3 VM 10 台分の請求が開始されます。  

その後、D2s_v3 VM をデプロイし、そのプロパティとして予約を指定すると、容量予約が使用されるようになります。 いったん使い始めた VM について支払うのは、その VM に対する料金だけであり、容量予約についての余分な料金はかかりません。 たとえば、前述の容量予約で 5 台の D2s_v3 VM をデプロイするとします。 請求には 5 台の D2s_v3 VM と 5 つの未使用の容量予約が示されており、どちらも D2s_v3 VM と同じ料金です。    

使用済みと未使用の両方の容量予約は、予約インスタンスの期間コミットメント割引の対象となります。 上の例では、同じ Azure リージョンに 2 台の D2s_v3 VM の予約インスタンスがある場合、2 つのリソース (VM または未使用の容量予約) の請求はゼロになり、残りの 8 つのリソース (つまり、5 つの未使用の容量予約と 3 台の D2s_v3 VM) についてのみ支払います。 この場合、期間コミットメント割引は、VM または未使用の容量予約のいずれにも適用でき、どちらも同じ PAYG レートで課金されます。 

## <a name="difference-between-on-demand-capacity-reservation-and-reserved-instances"></a>オンデマンド容量予約と予約インスタンスの違い 


| 相違点 | オンデマンド容量予約 | 予約インスタンス|
|---|---|---|
| 期間 | 期間コミットメントは不要。 顧客要件に従って作成し、削除できる | 1 年間または 3 年間で期間コミットメントが固定される|
| 課金割引 | 基になる VM サイズの従量課金制料金で課金 | 従量課金制料金よりも大幅なコスト削減 |
| 容量 SLA | 指定の場所 (リージョンまたは可用性ゾーン) で容量が保証される | 容量は保証されない。 顧客は "容量優先度" を選択してアクセスを向上させることができるが、そのオプションでは SLA が遂行されない |
| リージョンと可用性ゾーン | リージョンまたは可用性ゾーンごとにデプロイ可能 | リージョン レベルでのみ利用可能 |

*別途購入した場合、予約インスタンス割引の対象になります


## <a name="work-with-capacity-reservation"></a>容量予約を使用する 

容量予約は、Azure リージョンまたは可用性ゾーン内の特定の VM サイズに対して作成できます。 すべての予約は容量予約グループの一部として作成および管理されるので、グループを作成して、1 つの多層アプリケーションで異なる VM サイズを管理できます。 各予約の対象は 1 つの VM サイズであり、グループに含めることができるのは VM サイズごとに 1 つの予約のみです。  

容量予約を使用するには、VM プロパティの 1 つとして容量予約グループを指定します。 グループに一致する予約が存在しない場合、Azure からエラー メッセージが返されます。 

予約用に予約する数量は、初期デプロイ後に、容量のプロパティを変更することで調整できます。 それ以外の容量予約の VM サイズや場所などは変更できません。 推奨される方法は、既存の予約を削除し、新しい要件で新しい予約を作成することです。 

容量予約では、VM のデプロイの数に対する制限はありません。 Azure では、予約に必要なだけいくつでも VM を割り当てることができます。 予約自体にクォータが必要なので、予約された数量までは VM デプロイでのクォータ チェックは省略されます。 予約に対してさらに多くの VM を割り当てると、クォータ チェックと Azure による追加容量の充当の対象になります。 これらの追加の VM インスタンスをデプロイすると、予約に対して割り当てられた VM の数が、予約の数量を超える可能性があります。 この状態は過剰割り当てと呼ばれます。 詳細については、「[容量予約の過剰割り当て](capacity-reservation-overallocate.md)」を参照してください。 


## <a name="capacity-reservation-lifecycle"></a>容量予約のライフサイクル

予約が作成されると、Azure によって、指定した場所に要求した数の容量インスタンスが確保されます。 

![容量予約の図 1。](./media/capacity-reservation-overview/capacity-reservation-1.jpg) 

予約全体の状態を追跡するには、次のプロパティが使用されます。  
- `capacity` = お客様によって予約されたインスタンスの合計数 
- `virtualMachinesAllocated` = 容量予約に割り当てられた VM の一覧。容量が使用されると追加されます。 これらの VM は、"*実行中*&quot; または &quot;*停止*&quot; (&quot;*割り当て済み*") のいずれかであり、"*開始中*" や "*停止中*" などの過渡的状態になる可能性があります。 この一覧には、"*停止*" ("*未取り当て*") と呼ばれる割り当てられていない状態の VM は含まれません。 
- `virtualMachinesAssociated` = 容量予約に関連付けられている VM の一覧。 この一覧には、割り当てられていない状態の VM も含め、予約を使用するように構成されているすべての VM が含まれます。  

上の例では、`capacity` は 2 で始まり、`virutalMachinesAllocated` と `virtualMachinesAssociated` の長さは 0 です。  

その後、VM が容量予約に対して割り当てられると、予約容量インスタンスの 1 つが論理的に消費されます。 

![容量予約の図 2。](./media/capacity-reservation-overview/capacity-reservation-2.jpg) 

容量予約の状態は、`capacity` が 2 で、`virutalMachinesAllocated` と `virtualMachinesAssociated` の長さは 1 と表示されるようになります。  

VM のプロパティが一致し、空の容量インスタンスが少なくとも 1 つ存在する限り、容量予約に対する割り当ては成功します。  

この例で、3 番目の VM が容量予約に割り当てられると、その予約は[過剰割り当て](capacity-reservation-overallocate.md)状態になります。 この 3 番目の VM には、未使用のクォータと、Azure からの追加容量の充当が必要です。 3 番目の VM が割り当てられると、容量予約は次のようになります。 

![容量予約の図 3。](./media/capacity-reservation-overview/capacity-reservation-3.jpg) 

`capacity` は 2 で、`virutalMachinesAllocated` と `virtualMachinesAssociated` の長さは 3 です。 

ここで、アプリケーションが最小限 2 つの VM にスケールダウンするとします。 VM 0 には更新が必要なため、割り当て解除の対象に選択されます。 予約は、次の状態に自動的に移ります。 

![容量予約の図 4。](./media/capacity-reservation-overview/capacity-reservation-4.jpg) 

`capacity` と `virtualMachinesAllocated` の長さは両方とも 2 です。 ただし、VM 0 は割り当てを解除されましたが、依然として容量予約に関連付けられているため、`virtualMachinesAssociated` の長さはまだ 3 です。  

容量予約は、明示的に削除されるまで存在します。 容量予約を削除するには、最初に、`virtualMachinesAssociated` プロパティに含まれるすべての VM の関連付けを解除します。 関連付けの解除が完了すると、容量予約は次のようになります。 

![容量予約の図 5。](./media/capacity-reservation-overview/capacity-reservation-5.jpg) 

容量予約の状態は、`capacity` が 2 で、`virtualMachinesAssociated` と `virtualMachinesAllocated` の長さは 0 と表示されるようになります。 この状態からであれば、容量予約を削除できます。 削除が済むと、予約に対して課金されなくなります。  

![容量予約の図 6。](./media/capacity-reservation-overview/capacity-reservation-6.jpg)


## <a name="usage-and-billing"></a>使用量と課金 

容量予約が空の場合、VM の使用量は、対応する VM サイズと場所について報告されます。 [VM 予約インスタンス](https://azure.microsoft.com/pricing/reserved-vm-instances/)は、VM がデプロイされていない場合でも、容量予約の使用の一部またはすべてに対応できます。 

### <a name="example"></a>例

たとえば、予約数量 2 で容量予約が作成されているとします。 サブスクリプションは、同じサイズの 1 つの一致する予約 VM インスタンスにアクセスできます。 その結果、容量予約には 2 つの使用ストリームがあり、そのうちの 1 つは予約インスタンスによってカバーされます。 

![容量予約の図 7。](./media/capacity-reservation-overview/capacity-reservation-7.jpg)

上の図で、予約 VM インスタンスの割引が未使用のインスタンスの 1 つに適用され、そのインスタンスのコストはゼロになります。他のインスタンスについては、予約されている VM サイズに対する PAYG 料金が課金されます。  

1 つの VM が容量予約に割り当てられたら、他の VM のディスク、ネットワーク、拡張機能、その他の要求されたコンポーネントなどのコンポーネントも、割り当てられる必要があります。 この状態では、VM の使用量には 1 つの割り当て済み VM と 1 つの未使用の容量インスタンスが反映されます。 予約 VM インスタンスにより、VM または未使用の容量インスタンスのいずれかのコストがゼロになります。 割り当て済み VM に関連付けられているディスク、ネットワーク、その他のコンポーネントに対するその他の料金も、請求書に表示されます。 

![容量予約の図 8。](./media/capacity-reservation-overview/capacity-reservation-8.jpg)

上の図で、VM 予約インスタンスの割引は VM 0 に適用されており、そのディスクやネットワークなどの他のコンポーネントに対してのみ課金されます。 他の未使用のインスタンスは、予約済みの VM サイズの PAYG 料金で課金されます。


## <a name="frequently-asked-questions"></a>よく寄せられる質問 

- **オンデマンド容量予約の料金はいくらですか?**

    オンデマンド容量予約の価格は、予約に関連付けられた基になる VM サイズの料金と同じです。 容量予約を使用すると、VM がプロビジョニングされているかどうかにかかわらず、選択した VM サイズが従量課金制料金で課金されます。  詳細については、[Windows](https://azure.microsoft.com/pricing/details/virtual-machines/windows/) および [Linux](https://azure.microsoft.com/pricing/details/virtual-machines/linux/) の VM の価格ページを参照してください。

- **オンデマンド容量予約のコストと、VM の最終的な実際のプロビジョニングで、2 回課金されますか?**

    いいえ、オンデマンド容量予約の課金は 1 回だけです。   

- **予約仮想マシン インスタンス (RI) をオンデマンド容量予約に適用して、コストを下げることはできますか?**

    はい。既存または将来の RI をオンデマンド容量予約に適用して、RI 割引を受けることができます。 使用可能な RI は、VM に適用される場合と同じように、容量予約に自動的に適用されます。

- **予約仮想マシン インスタンス (RI) とオンデマンド容量予約の違いは何ですか?**

    RI とオンデマンド容量予約はどちらも、Azure VM に適用されます。 ただし、RI では、1 年または 3 年の契約期間の結果として、従量課金制の料金と比較して割り引かれた予約料金が VM に提供されます。 一方、オンデマンド容量予約にはコミットメントは必要ありません。 容量予約はいつでも作成またはキャンセルできます。 ただし、割引は適用されず、容量予約が正常にプロビジョニングされた後は、従量課金制の料金が発生します。 容量を優先的に使用できますが保証はされない RI とは異なり、オンデマンド容量予約を購入すると、Azure によって VM のコンピューティング容量が確保され、SLA の保証が提供されます。  

- **オンデマンド容量予約のベネフィットが最大になるのは、どのようなシナリオですか?**

    一般的なシナリオとしては、ビジネス継続性、ディザスター リカバリー、ミッション クリティカルなアプリケーションのスケールアウトなどがあります。  


## <a name="next-steps"></a>次のステップ

容量予約を作成し、Azure リージョンまたは可用性ゾーンでのコンピューティング容量の予約を始めます。 

> [!div class="nextstepaction"]
> [容量予約を作成する](capacity-reservation-create.md)
