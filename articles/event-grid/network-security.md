---
title: Azure Event Grid リソースのネットワーク セキュリティ
description: この記事では、Azure Event Grid で、エグレス用のサービス タグ、イングレス用の IP ファイアウォール規則、イングレス用のプライベート エンドポイントを使用する方法について説明します。
author: VidyaKukke
ms.topic: conceptual
ms.date: 09/28/2021
ms.author: vkukke
ms.openlocfilehash: 041c09a23b25b2ffe487b6d13171c51f2d96e6e1
ms.sourcegitcommit: e8c34354266d00e85364cf07e1e39600f7eb71cd
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/29/2021
ms.locfileid: "129212762"
---
# <a name="network-security-for-azure-event-grid-resources"></a>Azure Event Grid リソースのネットワーク セキュリティ
この記事では、Azure Event Grid で次のセキュリティ機能を使用する方法について説明します。 

- 送信用のサービス タグ
- イングレス用の IP ファイアウォール規則
- イングレス用のプライベート エンドポイント


## <a name="service-tags"></a>サービス タグ
サービス タグは、指定された Azure サービスからの IP アドレス プレフィックスのグループを表します。 サービス タグに含まれるアドレス プレフィックスの管理は Microsoft が行い、アドレスが変化するとサービス タグは自動的に更新されます。これにより、ネットワーク セキュリティ規則に対する頻繁な更新の複雑さを最小限に抑えられます。 サービス タグの詳細については、[サービス タグの概要](../virtual-network/service-tags-overview.md)に関する記事を参照してください。

サービス タグを使用して、[ネットワーク セキュリティ グループ](../virtual-network/network-security-groups-overview.md#security-rules)または [Azure Firewall](../firewall/service-tags.md) でのネットワーク アクセス制御を定義できます。 セキュリティ規則を作成するときに、特定の IP アドレスの代わりにサービス タグを使用します。 規則の適切な *ソース* または *ターゲット* のフィールドにサービス タグ名 (たとえば **AzureEventGrid**) を指定することにより、対応するサービスのトラフィックを許可または拒否できます。

| サービス タグ | 目的 | 受信または送信で使用できるか | リージョン別か | Azure Firewall と共に使用できるか |
| --- | -------- |:---:|:---:|:---:|
| AzureEventGrid | Azure Event Grid。 | 両方 | いいえ | いいえ |


## <a name="ip-firewall"></a>IP ファイアウォール 
Azure Event Grid は、トピックおよびドメインへの発行に IP ベースのアクセス制御をサポートしています。 IP ベースの制御を使用すると、トピックまたはドメインへのパブリッシャーを、承認されている一連のマシンおよびクラウド サービスだけに制限できます。 この機能は、Event Grid でサポートされている[認証メカニズム](security-authentication.md)を補完します。

既定では、要求が有効な認証と認可を受けている限り、トピックおよびドメインにはインターネットからアクセスできます。 IP ファイアウォールを使用すると、[CIDR (クラスレス ドメイン間ルーティング)](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing) 表記の一連の IP アドレスまたは IP アドレス範囲のみにアクセスを制限できます。 他の IP アドレスから発信するパブリッシャーは拒否され、403 (禁止) の応答が返されます。

トピックとドメインに対して IP ファイアウォールを構成する詳細な手順については、[IP ファイアウォールの構成](configure-firewall.md)に関する記事を参照してください。

## <a name="private-endpoints"></a>プライベート エンドポイント
[プライベート エンドポイント](../private-link/private-endpoint-overview.md)を使用すると、パブリック インターネットを経由せずに[プライベート リンク](../private-link/private-link-overview.md)上で安全に仮想ネットワークからトピックおよびドメインへ直接、イベントのイングレスを行えるようになります。 プライベート エンドポイントは、VNet 内の Azure サービス用の特別なネットワーク インターフェイスです。 トピックまたはドメインのプライベート エンドポイントを作成すると、VNet 上のクライアントと Event Grid リソース間の安全な接続が提供されます。 プライベート エンドポイントには、VNet の IP アドレス範囲から IP アドレスが割り当てられます。 プライベート エンドポイントと Event Grid サービス間の接続には、セキュリティで保護されたプライベート リンクが使用されます。

![アーキテクチャの図](./media/network-security/architecture-diagram.png)

Event Grid リソースにプライベート エンドポイントを使用すると、次のことが可能になります。

- パブリック インターネットではなく、Microsoft のバックボーン ネットワーク経由で VNet からトピックまたはドメインへのアクセスをセキュリティで保護する。
- VPN または ExpressRoutes とプライベート ピアリングを使用して VNet に接続するオンプレミス ネットワークから安全に接続する。

お使いの VNet でトピックまたはドメイン用プライベート エンドポイントを作成すると、承認を得るために同意要求がリソース所有者に送信されます。 プライベート エンドポイントの作成を要求しているユーザーがリソースの所有者でもある場合、この同意要求は自動的に承認されます。 それ以外の場合、接続は承認されるまで **保留中** の状態になります。 VNet 内のアプリケーションは、プライベート エンドポイント経由で Event Grid サービスにシームレスに接続できます。その際、使用される接続文字列と承認メカニズムは、それを経由しない場合と同じものになります。 リソースの所有者は、Azure portal でリソースの **[プライベート エンドポイント]** タブを使用して、同意要求とプライベート エンドポイントを管理できます。

### <a name="connect-to-private-endpoints"></a>プライベート エンドポイントに接続する
プライベート エンドポイントを使用する VNet 上のパブリッシャーは、パブリック エンドポイントに接続するクライアントと同じ接続文字列をトピックまたはドメインに対して使用する必要があります。 DNS 解決により、VNet からトピックまたはドメインへの接続が自動的にプライベート リンクでルーティングされます。 Event Grid では、既定で、VNet に接続されている[プライベート DNS ゾーン](../dns/private-dns-overview.md)が作成され、プライベート エンドポイントに必要な更新も行われます。 ただし、独自の DNS サーバーを使用している場合は、DNS 構成に追加の変更が必要になることがあります。

### <a name="dns-changes-for-private-endpoints"></a>プライベート エンドポイントの DNS の変更
プライベート エンドポイントを作成すると、リソースの DNS CNAME レコードは、プレフィックス `privatelink` を持つサブドメイン内のエイリアスに更新されます。 既定では、プライベート リンクのサブドメインに対応するプライベート DNS ゾーンが作成されます。 

プライベート エンドポイントを持つ VNet の外部からトピックまたはドメインのエンドポイント URL を解決すると、サービスのパブリック エンドポイントに解決されます。 'topicA' の DNS リソース レコードは、プライベート エンドポイントをホストしている **VNet 外部** から解決されると、次のようになります。

| 名前                                          | 種類      | 値                                         |
| --------------------------------------------- | ----------| --------------------------------------------- |  
| `topicA.westus.eventgrid.azure.net`             | CNAME     | `topicA.westus.privatelink.eventgrid.azure.net` |
| `topicA.westus.privatelink.eventgrid.azure.net` | CNAME     | \<Azure traffic manager profile\>

[IP ファイアウォール](#ip-firewall)を使用して、VNet の外部のクライアントによるパブリック エンドポイント経由のアクセスを拒否または制御することができます。 

プライベート エンドポイントをホストしている VNet から解決されると、トピックまたはドメインのエンドポイント URL はプライベート エンドポイントの IP アドレスに解決されます。 'topicA' の DNS リソース レコードは、プライベート エンドポイントをホストしている **VNet 内部** から解決されると、次のようになります。

| 名前                                          | 種類      | 値                                         |
| --------------------------------------------- | ----------| --------------------------------------------- |  
| `topicA.westus.eventgrid.azure.net`             | CNAME     | `topicA.westus.privatelink.eventgrid.azure.net` |
| `topicA.westus.privatelink.eventgrid.azure.net` | A         | 10.0.0.5

この方法を使用すると、プライベート エンドポイントをホストしている VNet 上のクライアントと、VNet の外部のクライアントから同じ接続文字列を使用してトピックまたはドメインにアクセスできます。

ネットワーク上でカスタム DNS サーバーを使用している場合、クライアントで、トピックまたはドメインのエンドポイントの FQDN をプライベート エンドポイントの IP アドレスに解決できます。 プライベート リンク サブドメインを VNet のプライベート DNS ゾーンに委任するように DNS サーバーを構成するか、プライベート エンドポイントの IP アドレスを使用して `topicOrDomainName.regionName.privatelink.eventgrid.azure.net` の A レコードを構成します。

推奨される DNS ゾーン名は `privatelink.eventgrid.azure.net` です。

### <a name="private-endpoints-and-publishing"></a>プライベート エンドポイントと発行

次の表では、プライベート エンドポイント接続のさまざまな状態と、発行に対する影響について説明します。

| 接続状態   |  正常に発行 (はい/いいえ) |
| ------------------ | -------------------------------|
| Approved           | はい                            |
| 拒否           | いいえ                             |
| 保留中            | いいえ                             |
| [Disconnected]\(切断済み\)       | いいえ                             |

発行を成功させるには、プライベート エンドポイントの接続状態が **承認済み** である必要があります。 接続が拒否された場合は、Azure portal を使用して承認することはできません。 唯一の方法は、接続を削除し、代わりに新しい接続を作成することです。

## <a name="pricing-and-quotas"></a>価格とクォータ
**プライベート エンドポイント** は、Event Grid の Basic レベルと Premium レベルの両方で使用できます。 Event Grid では、1 つのトピックまたはドメインにつき最大 64 のプライベート エンドポイント接続を作成できます。 

**IP ファイアウォール** 機能は、Basic レベルと Premium レベルの両方の Event Grid で使用できます。 トピックまたはドメインごとに最大 16 の IP ファイアウォール規則を作成できます。

## <a name="next-steps"></a>次のステップ
Event Grid リソースに IP ファイアウォールを構成して、パブリック インターネット経由のアクセスを、IP アドレスまたは IP アドレス範囲の選択されたセットからのみに制限することができます。 詳細な手順については、[IP ファイアウォールの構成](configure-firewall.md)に関する記事を参照してください。

選択した仮想ネットワークからのアクセスのみに制限するようにプライベート エンドポイントを構成できます。 詳細な手順については、[プライベート エンドポイントの構成](configure-private-endpoints.md)に関する記事を参照してください。

ネットワーク接続の問題をトラブルシューティングするには、[ネットワーク接続の問題のトラブルシューティング](troubleshoot-network-connectivity.md)に関するページを参照してください。
