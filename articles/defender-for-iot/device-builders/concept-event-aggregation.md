---
title: マイクロ エージェントのイベント コレクション (プレビュー)
description: Defender for IoT セキュリティ エージェントにより、ローカル デバイスからデータとシステム イベントを収集し、処理と分析を行うためにこのデータを Azure クラウドに送信します。
ms.date: 11/09/2021
ms.topic: conceptual
ms.openlocfilehash: 36cce317c4e53f7578dace7faba5e2fb567f42cc
ms.sourcegitcommit: 677e8acc9a2e8b842e4aef4472599f9264e989e7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2021
ms.locfileid: "132289983"
---
# <a name="micro-agent-event-collection-preview"></a>マイクロ エージェントのイベント コレクション (プレビュー)

Defender for IoT セキュリティ エージェントにより、ローカル デバイスからデータとシステム イベントが収集され、処理と分析のために Azure クラウドにデータが送信されます。 Defender for IoT マクロ エージェントは、新しいプロセスなどのさまざまな種類のデバイス イベントとすべての新しい接続イベントを収集します。 新しいプロセスと新しい接続イベントの両方が、デバイス上で頻繁に発生する可能性があります。 この機能は、包括的なセキュリティを実現するために重要ですが、セキュリティ エージェントが送信するメッセージの数は、IoT Hub のクォータとコストの上限に短期間で達するか、それを超える可能性があります。 これらのメッセージとイベントには、デバイスの保護に不可欠な重要なセキュリティ情報が含まれています。

デバイスのセキュリティを維持しながら、メッセージの数とコストを減らすため、Defender for IoT エージェントにより次の種類のイベントが集計されます。

- ProcessCreate (Linux のみ)

- ログイン アクティビティ (Linux のみ)

- Network ConnectionCreate

- システム情報

- ベースライン

イベント ベースのコレクターは、デバイス内からの対応するアクティビティに基づいてトリガーされるコレクターです。 たとえば、「 ``a process was started in the device`` 」のように入力します。  

トリガー ベースのコレクターは、顧客の構成に応じて、スケジュールに従ってトリガーされるコレクターです。

## <a name="how-does-event-aggregation-work"></a>イベント集計のしくみ

Defender for IoT エージェントにより、間隔の期間または時間枠についてイベントが集計されます。 間隔の期間が経過すると、エージェントは、詳細な分析のために、集計されたイベントを Azure クラウドに送信します。 集計されたイベントは、Azure クラウドに送信されるまでメモリに格納されます。

エージェントにより、既にメモリに格納されているものと同じイベントが収集されます。 この収集により、エージェントでこの特定のイベントのヒット カウントが増え、エージェントのメモリ フットプリントが減ります。 集計の時間枠が経過すると、エージェントは、発生したそれぞれの種類のイベントのヒット カウントを送信します。 イベント集計は、単に、収集された各種類のイベントのヒット カウントの集計です。

## <a name="process-events-event-based"></a>プロセス イベント (イベント ベース)

プロセス イベントは Linux オペレーティング システムでサポートされています。

プロセス イベントは、*コマンド ライン* と  *userid* が同一である場合は同一であると見なされます。

プロセス イベントの既定のバッファーは 256 プロセスです。 この制限に達すると、バッファーが循環し、最も古いプロセス イベントが破棄されて、最も新しく処理されたイベントのための領域が確保されます。 キャッシュ サイズを増やす際の警告がログに記録されます。

各イベントで収集されるデータは次のとおりです。

| パラメーター | 説明|
|--|--|
| **Timestamp** | プロセスが最初に観察された時刻。 |
| **process_id** | Linux の PID。 |
| **parent_process_id** | Linux の親 PID (存在する場合)。 |
| **Commandline** | コマンド ライン。 |
| **Type** | `fork` または `exec` のいずれかです。 |
| **hit_count** | 集計カウント。 同じ概算時間中の、イベントがクラウドに送信されるまでの、同じプロセスの実行数。 |

## <a name="network-connection-events-event-based-collector"></a>ネットワーク接続イベント (イベント ベースのコレクター)

ネットワーク接続イベントは、ローカル ポート、リモート ポート、トランスポート プロトコル、ローカル アドレス、およびリモート アドレスが同一である場合に同一と見なされます。

ネットワーク接続イベントの既定のバッファーは 256 です。 キャッシュがいっぱいの場合、次のようになります。

- **Azure RTOS デバイス**: 次の収集サイクルが始まるまで、新しいネットワーク イベントはキャッシュされません。  

- **Linux デバイス**: 新しいイベントごとに、最も古いイベントが置き換えられます。 キャッシュ サイズを増やす際の警告がログに記録されます。

Linux デバイスでは、IPv4 のみがサポートされます。

各イベントで収集されるデータは次のとおりです。

| パラメーター | 説明|
|--|--|
| **ローカル アドレス** | 接続のソース アドレス。 |
| **リモート アドレス** | 接続の宛先アドレス。 |
| **ローカル ポート** | 接続のソース ポート。 |
| **リモート ポート** | 接続の宛先ポート。 |
| **Bytes_in** | 接続の集計済み RX バイトの合計。 |
| **Bytes_out** | 接続の集計済み TX バイトの合計。 |
| **Transport_protocol** | TCP、UDP、または ICMP です。 |
| **アプリケーション プロトコル** | 接続に関連付けられたアプリケーション プロトコル。 |
| **拡張プロパティ** | 接続の追加の詳細。 たとえば、「 `host name` 」のように入力します。 |

## <a name="login-collector-event-based-collector"></a>ログイン コレクター (イベント ベースのコレクター)

ログイン コレクターにより、ユーザーのログイン、ログアウト、失敗したログイン試行が収集されます。

現在は、SSH と Telnet が完全にサポートされています。  

収集されるデータは次のとおりです。

| パラメーター | 説明|
|--|--|
| **operation** | Login、Logout、または LoginFailed。 |
| **process_id** | Linux の PID。 |
| **user_name** | Linux ユーザー。 |
| **executable** | ターミナル デバイス。 たとえば、tty1..6 や pts/n などです。 |
| **remote_address** | 接続元。IPv6 または IPv4 形式のリモート IP、またはローカル接続を示す 127.0.0.1/0.0.0.0。 |

> [!Note]
> ログイン イベントは、ユーザーが実際にログインする前、デバイスでターミナルが開かれた時点でキャプチャされます。 このイベントには、TTY プロセス、ログイン イベントの種類、ユーザー名が含まれています。 たとえば、「 `LOGIN` 」のように入力します。

## <a name="system-information-trigger-based-collector"></a>システム情報 (トリガー ベースのコレクター)

各イベントで収集されるデータは次のとおりです。

| パラメーター | 説明|
|--|--|
| **hardware_vendor** | デバイスのベンダーの名前。 |
| **hardware_model** | デバイスのモデル番号。 |
| **os_dist** | オペレーティング システムのディストリビューション。 たとえば、「 `Linux` 」のように入力します。 |
| **os_version** | オペレーティング システムのバージョン。 たとえば、`Windows 10`、または `Ubuntu 20.04.1` です。 |
| **os_platform** | デバイスの OS。 |
| **os_arch** | OS のアーキテクチャ。 たとえば、「 `x86_64` 」のように入力します。 |
| **nics** | ネットワーク インターフェイス コントローラー。 プロパティの完全な一覧を以下に示します。 |

**nics** プロパティは以下のもので構成されます。

| パラメーター | 説明|
|--|--|
|**type** | 次のいずれかの値: `UNKNOWN`、`ETH`、`WIFI`、`MOBILE`、`SATELLITE`。 |
| **vlans** | ネットワーク インターフェイスに関連付けられている仮想 LAN。 |
| **vendor** | ネットワーク コントローラーのベンダー。 |
| **info** | IPS と、ネットワーク コントローラーに関連付けられている MAC。 これには、次のフィールドが含まれます。 <br> - **ipv4_address**: IPv4 アドレス。 <br> - **ipv6_address**: IPv6 アドレス。 <br> - **mac**: MAC アドレス。|

## <a name="baseline-trigger-based"></a>ベースライン (トリガー ベース)

ベースライン コレクターでは、CIS チェックを定期的に実行します。 失敗した結果のみがクラウドに送信されます。 クラウドにより結果が集計され、推奨事項が提供されます。

### <a name="data-collection"></a>データ コレクション

各イベントで収集されるデータは次のとおりです。

| パラメーター | 説明|
|--|--|
| **チェック ID** | CIS 形式。 たとえば、「 `CIS-debian-9-Filesystem-1.1.2` 」のように入力します。 |
| **チェック結果** | `Error` または `Fail`。 たとえば、チェックを実行できない状況では `Error` です。 |
| **Error** | エラーの情報と説明。 |
| **説明** | CIS からのチェックの説明。 |
| **修正** | CIS からの修復のための推奨事項。 |
| **重大度** | 重大度のレベル。 |

## <a name="next-steps"></a>次のステップ

[Defender for IoT のセキュリティ アラート](concept-security-alerts.md)について確認します。
