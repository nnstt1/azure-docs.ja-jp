---
title: 監視するトラフィックを制御する
description: センサーは、IT および OT トラフィックのディープ パケット検出を自動的に実行し、デバイス属性やネットワーク動作などネットワーク デバイスに関する情報を解決します。 各センサーが検出するトラフィックの種類を制御するために、いくつかのツールを使用できます。
ms.date: 11/09/2021
ms.topic: how-to
ms.openlocfilehash: 76923afc40469ba30e4a2ce8ead6696f056a7580
ms.sourcegitcommit: 677e8acc9a2e8b842e4aef4472599f9264e989e7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2021
ms.locfileid: "132305942"
---
# <a name="control-what-traffic-is-monitored"></a>監視するトラフィックを制御する

センサーは、IT および OT トラフィックのディープ パケット検出を自動的に実行し、デバイスの属性や動作などネットワーク デバイスに関する情報を解決します。 各センサーが検出するトラフィックの種類を制御するために、いくつかのツールを使用できます。

## <a name="learning-and-smart-it-learning-modes"></a>学習モードおよびスマート IT 学習モード

学習モードは、ネットワークの通常のアクティビティを学習するようセンサーに指示します。 たとえば、ネットワークで検出されるデバイス、ネットワークで検出されるプロトコル、特定のデバイス間でのファイル転送などです。 このアクティビティがネットワークのベースラインになります。

学習モードはインストール後に自動的に有効になり、オフにするまで有効です。 おおよその学習モード期間は、ネットワークのサイズと複雑さに応じて 2 - 6 週間です。 この期間の後で、学習モードが無効になると、新しいアクティビティの検出によってアラートがトリガーされます。 アラートがトリガーされるのは、学習したベースラインからの逸脱がポリシー エンジンによって検出されたときです。

学習期間が終了して、学習モードが無効になると、通常の IT アクティビティ (DNS や HTTP 要求など) の結果である異常に高いレベルのベースライン変更がセンサーによって検出される可能性があります。 このアクティビティは、非決定的な IT 動作と呼ばれます。 この動作によって、不必要なポリシー違反アラートやシステム通知がトリガーされることもあります。 これらのアラートと通知の量を減らすには、**スマート IT 学習** 機能を有効にします。

スマート IT 学習が有効になっているとき、センサーは、特定のアラート シナリオに基づいて非決定的な IT 動作を生成するネットワーク トラフィックを追跡します。

センサーはこのトラフィックを 7 日間監視します。 7 日以内に同じ非決定的な IT トラフィックが検出されると、そのトラフィックの監視がさらに 7 日間続けられます。 7 日間でトラフィックが検出されない場合、そのシナリオに対してスマート IT 学習は無効になります。 そのシナリオで検出された新しいトラフィックでは、アラートと通知のみが生成されます。

スマート IT 学習を使用すると、ノイズの多い IT シナリオに起因する不要なアラートや通知の数を減らすことができます。

センサーがオンプレミス管理コンソールによって制御されている場合、学習モードを無効にすることはできません。 このような場合は、学習モードを無効にできるのは管理コンソールのみです。

学習機能 (学習およびスマート IT 学習) は、既定で有効になっています。

学習の有効と無効を切り替えるには:

- **[システム設定]** を選択し、 **[学習]** オプションと **[Smart IT Learning]\(スマート IT 学習\)** オプションを切り替えます。

:::image type="content" source="media/concept-learning-modes/toggle-options-for-learning-and-smart-it-learning.png" alt-text="[システム設定] の切り替え画面。":::

## <a name="configure-subnets"></a>サブネットを構成する

サブネットの構成は、デバイス マップでデバイスがどのように表示されるかに影響します。

既定では、センサーがサブネットの設定を検出して、その情報を **[サブネット構成]** ダイアログ ボックスに表示します。

OT デバイスに対するフォーカスを有効にするため、IT デバイスはデバイス マップのサブネットごとに自動的に集計されます。 各サブネットはマップ上で 1 つのエンティティとして表示され、IT サブネットに "ドリルダウン" するために対話型の折りたたみ/展開機能も含まれます。

サブネットを使用している場合は、OT サブネットを識別するために ICS サブネットを選択します。 これで、OT および ICS ネットワーク上でマップ ビューにフォーカスしたり、最小限の IT ネットワーク要素の表示に折りたたんだりすることができます。 この操作によって、マップに表示されるデバイスの合計数が減り、OT および ICS ネットワークの要素を明確に把握できるようになります。

:::image type="content" source="media/how-to-control-what-traffic-is-monitored/expand-network-option.png" alt-text="ネットワークのフィルターを示すスクリーンショット。":::

構成を変更するか、サブネット情報を手動で変更できます。これには、検出されたデータをエクスポートし、それを手動で変更してから、手動で定義したサブネットの一覧をインポートして戻します。 エクスポートとインポートの詳細については、「[デバイス情報のインポート](how-to-import-device-information.md)」を参照してください。

内部範囲としてパブリック範囲を使用する環境など、場合によっては、 **[Do Not Detect Internet Activity]\(インターネット アクティビティを検出しない\)** オプションを選択して、すべてのサブネットを内部サブネットとして解決するようにセンサーに指示できます。 このオプションを選択すると、次のようになります。

- パブリック IP アドレスがローカル アドレスとして扱われます。

- 承認されていないインターネット アクティビティについてのアラートは送信されないため、外部アドレスで受信される通知とアラートが減少します。

サブネットを構成するには:

1. サイド メニューで、 **[システム設定]** を選択します。

2. **[システム設定]** ウィンドウで、 **[サブネット]** を選択します。

   :::image type="content" source="media/how-to-control-what-traffic-is-monitored/edit-subnets-configuration-screen.png" alt-text="サブネット構成画面を示すスクリーンショット。"::: 

3. 新しいデバイスが検出されたときにサブネットを自動的に追加するには、 **[Auto Subnets Learning]\(自動サブネット学習\)** を選択したままにします。

4. すべてのサブネットを内部サブネットとして解決するには、 **[Don't Detect Internet Activity]\(インターネット アクティビティを検出しない\)** を選択します。

5. **[ネットワークの追加]** を選択し、各サブネットについて次のパラメーターを定義します。

    - サブネット IP アドレス。
    - サブネット マスク アドレス。
    - サブネット名。 各サブネットにわかりやすい名前を付けて、簡単に識別できるようにすることをお勧めします。これにより、IT ネットワークと OT ネットワークを区別できるようになります。 名前の最大長は 60 文字です。

6. このサブネットを OT サブネットとしてマークするには、 **[ICS Subnet]\(ICS サブネット\)** を選択します。

7. Purdue レベルに従ってマップを配置するときにサブネットを個別に表示するには、 **[Segregated]\(分離\)** を選択します。

8. サブネットを削除するには、:::image type="icon" source="media/how-to-control-what-traffic-is-monitored/delete-icon.png" border="false"::: を選択します。

9. すべてのサブネットを削除するには、 **[Clear All]\(すべてクリア\)** を選択します。

10. 構成したサブネットをエクスポートするには、 **[エクスポート]** を選択します。 サブネット テーブルがワークステーションにダウンロードされます。

11. **[保存]** を選択します。

### <a name="importing-information"></a>情報をインポートする 

サブネット情報をインポートするには、 **[インポート]** を選択し、インポートする CSV ファイルを選択します。 サブネット情報が、インポートした情報で更新されます。 空のフィールドをインポートした場合は、データが失われます。

## <a name="detection-engines"></a>検出エンジン

自己学習分析エンジンを使用すると、署名を更新したり、ルールを定義したりする必要がなくなります。 これらのエンジンは、ICS 固有の動作分析とデータ サイエンスを使用し、異常、マルウェア、操作上の問題、プロトコル違反、およびベースライン ネットワーク アクティビティの逸脱に関して、OT ネットワーク トラフィックを継続的に分析します。

> [!NOTE]
> すべてのセキュリティ エンジンを有効にすることをお勧めします。

エンジンが逸脱を検出すると、アラートがトリガーされます。 アラートの表示および管理は、アラート画面またはパートナー システムから行うことができます。

:::image type="content" source="media/how-to-control-what-traffic-is-monitored/deviation-alert-screen.png" alt-text="逸脱の検出を示すスクリーンショット。":::

アラートをトリガーしたエンジンの名前は、アラート タイトルの下に表示されます。

### <a name="protocol-violation-engine"></a>プロトコル違反エンジン 

プロトコル違反は、パケット構造またはフィールド値がプロトコル仕様に準拠していない場合に発生します。

サンプル シナリオ: *[Illegal MODBUS Operation (Function Code Zero)]\(無効な MODBUS 操作 (関数コード ゼロ)\)* アラート。 このアラートは、プライマリ デバイスが、セカンダリ デバイスに対して関数コード 0 の要求を送信したことを示します。 この操作はプロトコルの仕様によって許可されません。セカンダリ デバイスは、入力を正しく処理できない可能性があります。

### <a name="policy-violation-engine"></a>ポリシー違反エンジン

ポリシー違反は、学習された設定または構成された設定で定義されているベースライン動作からの逸脱によって発生します。

サンプル シナリオ: *[Unauthorized HTTP User Agent]\(承認されていない HTTP ユーザー エージェント\)* アラート。 このアラートは、学習されていないアプリケーションまたはポリシーによって承認されていないアプリケーションが、デバイス上で HTTP クライアントとして使用されていることを示します。 これは、そのデバイス上の新しい Web ブラウザーまたはアプリケーションである可能性があります。

### <a name="malware-engine"></a>マルウェア対策エンジン

マルウェア対策エンジンは、悪意のあるネットワーク アクティビティを検出します。

サンプル シナリオ: *[Suspicion of Malicious Activity (Stuxnet)]\(悪意のあるアクティビティ (Stuxnet) の疑い\)* アラート。 このアラートは、センサーが、Stuxnet マルウェアに関連することがわかっているネットワーク アクティビティを検出したことを示します。 このマルウェアは、産業用制御および SCADA ネットワークを狙う高度で永続的な脅威です。

### <a name="anomaly-engine"></a>異常エンジン

異常エンジンは、ネットワーク動作の異常を検出します。

サンプル シナリオ: *[Periodic Behavior in Communication Channel]\(通信チャネルの定期的な動作\)* アラート。 このコンポーネントはネットワーク接続を検査し、データ転送の定期的な動作や周期的な動作を検出します。 この動作は産業ネットワークでは一般的です。

### <a name="operational-engine"></a>運用エンジン

運用エンジンは、運用中のインシデントまたは誤動作したエンティティを検出します。

サンプル シナリオ: *[Device is Suspected to be Disconnected (Unresponsive)]\(デバイスは切断されている可能性があります (応答していません)\)* アラート。 このアラートが発生するのは、事前に定義された期間に、デバイスがすべての種類の要求に応答していない場合に発生します。 このアラートは、デバイスのシャットダウン、切断、または誤動作を示している可能性があります。

### <a name="enable-and-disable-engines"></a>エンジンの有効と無効を切り替える

ポリシー エンジンを無効にすると、エンジンによって生成される情報がセンサーで使用できなくなります。 たとえば、異常エンジンを無効にした場合、ネットワークの異常に関するアラートを受け取りません。 転送ルールを作成していても、エンジンが学習する異常は送信されません。 ポリシー エンジンを有効または無効にするには、特定のエンジンについて **[有効]** または **[無効]** を選択します。

全体のスコアは、 **[システム設定]** 画面の右下隅に表示されます。 スコアは、脅威保護エンジンによって使用可能になった保護の割合を示します。 各エンジンは、使用可能な保護の 20% に相当します。

:::image type="content" source="media/how-to-control-what-traffic-is-monitored/protection-score-screen.png" alt-text="スコアを示すスクリーンショット。":::

## <a name="configure-dhcp-address-ranges"></a>DHCP アドレス範囲を構成する

ネットワークは、静的 IP アドレスと動的 IP アドレスの両方で構成される場合があります。 通常、静的アドレスは、OT ネットワーク上のヒストリアン、コントローラー、ネットワーク インフラストラクチャ デバイス (スイッチやルーターなど) にあります。 動的 IP 割り当ては、通常、(さまざまな場所で Wi-Fi または LAN 物理接続を使用する) ラップトップ、PC、スマートフォン、他のポータブル機器を含むゲスト ネットワークに実装されています。

動的ネットワークを使用している場合は、新しい IP アドレスが割り当てられたときに発生する IP アドレスの変更を処理します。 これを行うには、DHCP アドレス範囲を定義します。

変更が発生する可能性があるのは、たとえば、DHCP サーバーが IP アドレスを割り当てるときです。

各センサーに動的 IP アドレスを定義することで、IP アドレスの変更において、包括的かつ透過的なサポートが可能になります。 これで、一意のデバイスごとに包括的なレポートが作成できます。

センサー コンソールには、デバイスに関連付けられている最新の IP アドレスが表示され、どのデバイスが動的であるかが示されます。 例:

- データ マイニング レポートとデバイス インベントリ レポートでは、IP アドレスの変更に関係なく、そのデバイスから得られたすべてのアクティビティが 1 つのエンティティに統合されます。 これらのレポートでは、どのアドレスが DHCP アドレスとして定義されたかが示されます。

  :::image type="content" source="media/how-to-control-what-traffic-is-monitored/populated-device-inventory-screen-v2.png" alt-text="デバイス インベントリを示すスクリーンショット。":::

- The **[Device Properties]\(デバイス プロパティ\)** ウィンドウは、デバイスが DHCP デバイスとして定義されたかどうかを示します。

DHCP アドレス範囲を設定するには:

1.  サイド メニューで、 **[システム設定]** ウィンドウの **[DHCP Ranges]\(DHCP 範囲\)** を選択します。

    :::image type="content" source="media/how-to-control-what-traffic-is-monitored/dhcp-address-range-screen.png" alt-text="DHCP 範囲の選択を示すスクリーンショット。":::

2.  **[From]\(開始\)** と **[To]\(終了\)** の値を設定して、新しい範囲を定義します。

3.  省略可能: 範囲名を 256 文字以内で定義します。

4.  範囲を CSV ファイルにエクスポートするには、 **[エクスポート]** を選択します。

5. CSV ファイルから複数の範囲を手動で追加するには、 **[インポート]** を選択し、ファイルを選択します。

    > [!NOTE]
    > CSV ファイルからインポートした範囲によって、既存の範囲設定が上書きされます。

6. **[保存]** を選択します。

## <a name="configure-dns-servers-for-reverse-lookup-resolution"></a>逆引き参照の解決のために DNS サーバーを構成する

デバイス エンリッチメントを強化するために、複数の DNS サーバーが逆引き参照を実行するように構成できます。 ネットワーク サブネットで検出された IP アドアレスと関連付けられたホスト名または FQDN を解決できます。 たとえば、センサーが IP アドレスを検出した場合、ホスト名を解決するために複数の DNS サーバーにクエリを実行することがあります。

すべての CIDR 形式がサポートされています。

ホスト名は、デバイス インベントリ、デバイス マップ、およびレポートに表示されます。

逆引き参照解決スケジュールは、12 時間ごとなど、特定の時間間隔でスケジュール設定できます。 または、特定の時刻をスケジュール設定することもできます。

DNS サーバーを定義するには:

1. **[システム設定]** を選択し、 **[DNS 設定]** を選択します。

2. **[DNS サーバーの追加]** を選択します。

    :::image type="content" source="media/how-to-enrich-asset-information/dns-reverse-lookup-configuration-screen.png" alt-text="[DNS サーバーの追加] の選択を示すスクリーンショット。":::

3. **[Schedule reverse DNS lookup]\(逆引き DNS 参照のスケジュール設定\)** フィールドで、次のいずれかを選択します。

    - 間隔 (1 時間単位)。
  
    - 特定の時刻。 ヨーロッパの書式設定を使用します。 たとえば、**14:30** を使用し、**2:30 PM** は使用しません。

4. **[DNS サーバー アドレス]** フィールドに、DNS IP アドレスを入力します。

5. **[DNS Server Port]\(DNS サーバー ポート\)** フィールドに、DNS ポートを入力します。

6. ネットワーク IP アドレスをデバイスの FQDN に解決します。 **[Number of Labels]\(ラベル数\)** フィールドに、表示するドメイン ラベルの数を追加します。 最大 30 文字が左から右に表示されます。

7. **[サブネット]** フィールドに、DNS サーバーに対してクエリを実行するサブネットを入力します。

8. 逆引き参照を開始する場合は **[有効化]** トグルを選択します。

### <a name="test-the-dns-configuration"></a>DNS 構成をテストする 

テスト デバイスを使用して、定義した設定が適切に機能することを確認します。

1. **[DNS の参照]** トグルを有効にします。

2. **[Test]** を選択します。

3. **[DNS reverse lookup test for server]\(サーバーの DNS 逆引き参照テスト\)** ダイアログ ボックスの **[Lookup Address]\(アドレスの参照\)** にアドレスを入力します。

    :::image type="content" source="media/how-to-enrich-asset-information/dns-reverse-lookup-test-screen.png" alt-text="[Lookup Address]\(アドレスの参照\) 領域を示すスクリーンショット。":::

4. **[Test]** を選択します。

## <a name="configure-windows-endpoint-monitoring"></a>Windows エンドポイント監視を構成する

Windows エンドポイント監視機能を使用して、Windows システムを選択的にプローブするように Microsoft Defender for IoT を構成できます。 これにより、Service Pack レベルなど、デバイスに関して焦点を絞った正確な情報が得られます。

特定の範囲とホストのプローブを構成して、必要な頻度でのみ実行されるように構成できます。 選択的プローブを実行するには Windows Management Instrumentation (WMI) を使用します。これは、Windows システムを管理するための Microsoft の標準スクリプト言語です。

> [!NOTE]
> - 一度に実行できるスキャンは 1 つだけです。
> - ドメインまたはローカルの管理者特権を持つユーザーを使用すると、最良の結果を得ることができます。
> - WMI 構成を開始する前に、センサーからスキャンされるサブネットへの送信トラフィック (UDP ポート 135 および 1024 を超えるすべての TCP ポートを使用) を開くファイアウォール規則を構成します。

プローブが完了すると、ログをエクスポートするオプションから、すべてのプローブ試行を含むログ ファイルを入手できます。 ログには、プローブされたすべての IP アドレスが含まれます。 各 IP アドレスについて、ログに成功と失敗の情報が表示されます。 また、エラー コードも含まれます。これは例外から抽出されたフリーの文字列です。 最後のログのスキャンのみがシステムに保持されます。

スケジュールされたスキャンまたは手動スキャンを実行できます。 スキャンが完了すると、CSV ファイルで結果を表示できます。

**前提条件**

センサーからスキャンされるサブネットへの送信トラフィック (UDP ポート 135 および 1024 を超えるすべての TCP ポートを使用) を開くファイアウォール規則を構成します。

自動スキャンを構成するには:

1. サイド メニューで、 **[システム設定]** を選択します。

2. **[Windows Endpoint Monitoring]\(Windows エンドポイント監視\)** :::image type="icon" source="media/how-to-control-what-traffic-is-monitored/windows-endpoint-monitoring-icon-v2.png" border="false"::: を選択します。

    :::image type="content" source="media/how-to-control-what-traffic-is-monitored/windows-endpoint-monitoring-screen-v2.png" alt-text="Windows エンドポイント監視の選択を示すスクリーンショット。":::

3. **[スキャンのスケジュール]** ペインで、次のようにオプションを構成します。

      - **[By fixed intervals (in hours)]\(一定間隔 (時間単位)\)** :スキャンのスケジュールを間隔 (時間単位) で設定します。

      - **[By specific times]\(特定時刻\)** :特定の時刻にスキャンのスケジュールを設定し、 **[Save Scan]\(スキャンの保存\)** を選択します。

    :::image type="content" source="media/how-to-control-what-traffic-is-monitored/schedule-a-scan-screen-v2.png" alt-text="[Save Scan]\(スキャンの保存\) ボタンを示すスクリーンショット。":::

4. スキャン範囲を定義するには、 **[Set scan ranges]\(スキャン範囲の設定\)** を選択します。

5. IP アドレスの範囲を設定し、ユーザーとパスワードを追加します。

    :::image type="content" source="media/how-to-control-what-traffic-is-monitored/edit-scan-range-screen.png" alt-text="ユーザーとパスワードの追加を示すスクリーンショット。":::

6. IP 範囲をスキャンから除外するには、その範囲の横の **[無効化]** を選択します。

7. 範囲を削除するには、その範囲の横の :::image type="icon" source="media/how-to-control-what-traffic-is-monitored/remove-scan-icon.png" border="false"::: を選択します。

8. **[保存]** を選択します。 **[Edit Scan Ranges Configuration]\(スキャン範囲構成の編集\)** ダイアログ ボックスが閉じて、範囲の数が **[Scan Ranges]\(スキャン範囲\)** ペインに表示されます。

手動スキャンを実行するには:

1. サイド メニューで、 **[システム設定]** を選択します。

2. **[Windows Endpoint Monitoring]\(Windows エンドポイント監視\)** :::image type="icon" source="media/how-to-control-what-traffic-is-monitored/windows-endpoint-monitoring-icon-v2.png" border="false"::: を選択します。

    :::image type="content" source="media/how-to-control-what-traffic-is-monitored/windows-endpoint-monitoring-screen-v2.png" alt-text="Windows エンドポイント監視設定画面を示すスクリーンショット。":::

3. **[操作]** ペインで、 **[スキャンの開始]** を選択します。 ステータス バーが **[操作]** ペインに表示され、スキャン プロセスの進行状況を示します。

    :::image type="content" source="media/how-to-control-what-traffic-is-monitored/started-scan-screen-v2.png" alt-text="[スキャンの開始] ボタンを示すスクリーンショット。":::

スキャン結果を表示するには:

1. スキャンが完了したら、 **[操作]** ペインで **[View Scan Results]\(スキャン結果の表示\)** を選択します。 スキャン結果を含む CSV ファイルがコンピューターにダウンロードされます。

## <a name="see-also"></a>関連項目

[デバイス インベントリでのセンサー検出を調査する](how-to-investigate-sensor-detections-in-a-device-inventory.md)
[デバイス マップでのセンサー検出を調査する](how-to-work-with-the-sensor-device-map.md)
