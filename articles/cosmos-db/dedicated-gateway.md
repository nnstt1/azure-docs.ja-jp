---
title: Azure Cosmos DB 専用ゲートウェイ
description: 専用ゲートウェイは、自分の Azure Cosmos DB アカウントのフロントエンドであるコンピューティングです。 専用ゲートウェイに接続すると、要求がルーティングされ、データがキャッシュされます。
author: timsander1
ms.service: cosmos-db
ms.subservice: cosmosdb-sql
ms.topic: conceptual
ms.date: 11/08/2021
ms.author: tisande
ms.openlocfilehash: 2c2681f1d6e9abf66375d8a6a9d0f43683474dcc
ms.sourcegitcommit: 61f87d27e05547f3c22044c6aa42be8f23673256
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/09/2021
ms.locfileid: "132060417"
---
# <a name="azure-cosmos-db-dedicated-gateway---overview-preview"></a>Azure Cosmos DB 専用ゲートウェイ - 概要 (プレビュー)
[!INCLUDE[appliesto-sql-api](includes/appliesto-sql-api.md)]

専用ゲートウェイは、自分の Azure Cosmos DB アカウントのフロントエンドであるサーバーサイド コンピューティングです。 専用ゲートウェイに接続すると、要求のルーティングとデータのキャッシュの両方が行われます。 プロビジョニングされたスループットと同様に、専用ゲートウェイは 1 時間単位で請求されます。

## <a name="overview"></a>概要

専用ゲートウェイをプロビジョニングして、大規模なパフォーマンスを向上させることができます。 専用ゲートウェイをプロビジョニングする最も一般的な理由は、キャッシュ用です。 専用ゲートウェイをプロビジョニングすると、[統合 キャッシュ](integrated-cache.md)が専用ゲートウェイ内に自動的に構成されます。 統合キャッシュにヒットしたポイントの読み取りとクエリでは、どの RU も使用されません。 統合キャッシュを使用して専用ゲートウェイをプロビジョニングすると、Azure Cosmos DB 上で読み取り負荷の高いワークロードを使用して、ワークロードのコストを削減できます。

専用ゲートウェイは、Azure Cosmos DB に構築されます。 [専用ゲートウェイをプロビジョニングする](how-to-configure-integrated-cache.md)場合は、バックエンド パーティションに要求をルーティングするフルマネージド ノードがあります。 専用ゲートウェイを使用して Azure Cosmos DB に接続すると、標準ゲートウェイを使用して Azure Cosmos DB に接続するよりも待機時間が短くなり予測しやすくなります。 専用ゲートウェイと標準ゲートウェイを比較すると、キャッシュ ミスでも待機時間が改善されます。

アプリケーションで専用ゲートウェイを使用するために必要なコード変更は最小限です。 新しい Azure Cosmos DB アカウントと既存の Azure Cosmos DB アカウントの両方で、読み取りパフォーマンスを向上させる専用ゲートウェイをプロビジョニングできます。

> [!NOTE]
> 専用ゲートウェイについてフィードバックがありますか? ご意見をお待ちしています。 ぜひ、Azure Cosmos DB エンジニアリング チーム (cosmoscachefeedback@microsoft.com) まで直接ご意見をお寄せください。

## <a name="connection-modes"></a>接続モード

Azure Cosmos DB アカウントに接続するには、次の 3 通りのやり方があります。

- [直接モード](#connect-to-azure-cosmos-db-using-direct-mode)
- [標準ゲートウェイを使用したゲートウェイ モード](#connect-to-azure-cosmos-db-using-gateway-mode)
- [専用ゲートウェイを使用したゲートウェイ モード](#connect-to-azure-cosmos-db-using-the-dedicated-gateway) (SQL API アカウントでのみ使用可能)

### <a name="connect-to-azure-cosmos-db-using-direct-mode"></a>ダイレクト モードを使用して Azure Cosmos DB に接続する

ダイレクト モードを使用して Azure Cosmos DB に接続すると、アプリケーションは Azure Cosmos DB バックエンドに直接接続します。 多くの物理パーティションがある場合でも、要求ルーティングは完全にクライアント側で処理されます。 ダイレクト モードでは、アプリケーションが Azure Cosmos DB バックエンドと直接通信でき、中間ネットワーク ホップは必要ないため、待機時間が短くなります。

ダイレクト モード接続をグラフィカルに表示します。

:::image type="content" source="./media/dedicated-gateway/direct-mode.png" alt-text="Cosmos DB ダイレクト モードの動作を示す画像" border="false":::

### <a name="connect-to-azure-cosmos-db-using-gateway-mode"></a>ゲートウェイ モードを使用して Azure Cosmos DB に接続する

ゲートウェイ モードを使用して Azure Cosmos DB に接続すると、アプリケーションはまずフロントエンドノードに接続します。これにより、適切なバックエンドノードへの要求のルーティングが処理されます。 ゲートウェイモードには追加のネットワーク ホップが関係しているため、ダイレクト モードと比べて待機時間が若干長くなる場合があります。 

ゲートウェイ モードで Azure Cosmos DB に接続する場合は、次のいずれかのオプションを使用して接続できます。

* **標準ゲートウェイ** - プロビジョニング済みのスループットとストレージを含むバックエンドには、コンテナーごとに専用の容量がありますが、標準ゲートウェイは多くの Azure Cosmos アカウント間で共有されます。 ほとんどのお客様の場合、個々の顧客によって消費されるコンピューティング リソースは少ないため、標準ゲートウェイを共有することが実用的です。
* **専用ゲートウェイ** - このゲートウェイには、バックエンドとゲートウェイの両方に専用の容量があります。 統合キャッシュには、Azure Cosmos アカウントに固有の CPU とメモリが大量に必要なため、専用のゲートウェイが必要です。

### <a name="connect-to-azure-cosmos-db-using-the-dedicated-gateway"></a>ゲートウェイ モードを使用して Azure Cosmos DB に接続する

統合キャッシュを使用するには、専用ゲートウェイを使用して Azure Cosmos DB に接続する必要があります。 専用ゲートウェイには、標準とは異なるエンドポイントがあり、Azure Cosmos DB アカウントで提供されます。 専用ゲートウェイエンドポイントに接続すると、アプリケーションから専用ゲートウェイに要求が送信され、その要求が別のバックエンド ノードにルーティングされます。 可能であれば、統合キャッシュによって結果が提供されます。

専用ゲートウェイでのゲートウェイ モード接続の図:

:::image type="content" source="./media/dedicated-gateway/dedicated-gateway-mode.png" alt-text="Cosmos DB 専用ゲートウェイの仕組みを示す画像" border="false":::
 
## <a name="provisioning-the-dedicated-gateway"></a>専用ゲートウェイのプロビジョニング

専用ゲートウェイ クラスターは、Core (SQL) API アカウントでプロビジョニングできます。 専用ゲートウェイ クラスターには最大 5 つのノードを含め、いつでもノードを追加または削除できます。 アカウント内のすべての専用ゲートウェイ ノードは、 [同じ接続文字列 を共有します](how-to-configure-integrated-cache.md#configuring-the-integrated-cache)。

専用ゲートウェイ ノードは、互いに独立しています。 複数の専用ゲートウェイ ノードをプロビジョニングする場合、任意の 1 つのノードで任意の要求をルーティングできます。 さらに、各ノードには、他のノードとは別の統合キャッシュがあります。 各ノード内のキャッシュされたデータは、その特定のノードから最近[書き込まれたか読み取られた](integrated-cache.md#item-cache) データによって異なります。 つまり、項目またはクエリが 1 つのノードにキャッシュされている場合、必ずしも他のノードにキャッシュされるとは限りません。

開発では、1 つのノードから開始することをお勧めしますが、実稼働環境では、高可用性を確保するために 3 つ以上のノードをプロビジョニングする必要があります。 [統合キャッシュ を使用して専用ゲートウェイ クラスターをプロビジョニングする方法について説明します](how-to-configure-integrated-cache.md)。 複数の専用ゲートウェイ ノードをプロビジョニングすると、専用ゲートウェイ クラスターは、専用ゲートウェイ ノードの 1 つが使用できない場合でも、引き続き要求をルーティングし、キャッシュされたデータを提供できます。

パブリック プレビュー中のため、専用ゲートウェイには利用可能な SLA はありません。 ただし一般に、Azure Cosmos DB の他のアカウントと同等の可用性が期待されます。

専用ゲートウェイは、次の言語で利用できます。

| **Sku 名** | **vCPU** | **[メモリ]**  |
| ------------ | -------- | ----------- |
| **D4s**      | **4**    | **16 GB** |
| **D8s**      | **8**    | **32 GB** |
| **D16s**     | **16**   | **64 GB** |

> [!NOTE]
> 作成後は、専用のゲートウェイノードのサイズを変更することはできません。 ただし、ノードを追加または削除することはできます。

## <a name="dedicated-gateway-in-multi-region-accounts"></a>複数リージョンのアカウントの専用ゲートウェイ

複数リージョンのアカウントで専用のゲートウェイクラスターをプロビジョニングすると、各リージョンに同一の専用ゲートウェイ クラスターがプロビジョニングされます。 たとえば、米国東部と北ヨーロッパの Azure Cosmos DB アカウントについて考えてみます。 このアカウントにおいて、2 つの D8 ノードが含まれる専用のゲートウェイ クラスターをプロビジョニングすると、米国東部に 2 つ、北ヨーロッパに 2 つの合計 4 つの D8 ノードがあることになります。 各リージョンで専用のゲートウェイを明示的に構成する必要はありません。接続文字列は変わりません。 フェールオーバーを実行するためのベストプラクティスも変更されていません。

> [!NOTE]
> 可用性ゾーンが有効になっているアカウントで専用のゲートウェイ クラスターをプロビジョニングすることはできません。

クラスター内のノードと同様に、リージョン間の専用のゲートウェイノードは独立しています。 各リージョンのキャッシュ データは、そのリージョンの最近の読み書き内容によって異なる場合があります。

## <a name="limitations"></a>制限事項

専用ゲートウェイのパブリック プレビューでは、次の制限があります。

- 専用ゲートウェイは、SQL API アカウントでのみサポートされています。
- [IP ファイアウォール](how-to-configure-firewall.md)または[プライベート リンク](how-to-configure-private-endpoints.md)が構成されている Azure Cosmos DB アカウントに専用ゲートウェイをプロビジョニングすることはできません。
- [仮想ネットワーク (VNet)](how-to-configure-vnet-service-endpoint.md) の Azure Cosmos DB アカウントに専用ゲートウェイをプロビジョニングすることはできません
- [可用性ゾーン](high-availability.md#availability-zone-support)を使用する Azure Cosmos DB アカウントに専用ゲートウェイをプロビジョニングすることはできません。
- 専用ゲートウェイ経由でルーティングされるデータ プレーン要求は、[ロールベースのアクセス制御 (RBAC)](how-to-setup-rbac.md) を使用して認証することはできません

## <a name="supported-regions"></a>サポートされているリージョン

専用ゲートウェイは、パブリック プレビュー段階であり、一部の Azure リージョンではまだサポートされません。 パブリック プレビューの間に、新しく容量を追加していく予定です。 専用ゲートウェイが一般提供となった時点では、リージョンの制限を設ける予定はありません。

サポート対象 Azure リージョンの最新の一覧を次に示します。

| **南北アメリカ** | **ヨーロッパおよびアフリカ**  | **アジア太平洋**  |
| ------------ | -------- | ----------- | 
| ブラジル南部      | フランス中部    | オーストラリア中部 |
| カナダ中部  | フランス南部    | オーストラリア中部 2 |
| カナダ東部     | ドイツ北部   | オーストラリア南東部 |
| 米国中部     | ドイツ中西部   | インド中部 |
| 米国東部     | 北ヨーロッパ   | 東アジア |
| 米国東部 2     | スイス北部   | 西日本 |
| 米国中北部     | 英国南部   | 韓国中部 |
| 米国中南部     | 英国西部   | 韓国南部 |
| 米国中西部     | 西ヨーロッパ   | 東南アジア |
| 米国西部     |   | アラブ首長国連邦中部 |
| 米国西部 2     |    | インド西部 |


## <a name="next-steps"></a>次の手順

専用ゲートウェイの使用の詳細については、次の記事を参照してください。

- [統合キャッシュ](integrated-cache.md)
- [統合キャッシュの構成](how-to-configure-integrated-cache.md)
- [統合キャッシュのよくあるご質問](integrated-cache-faq.md)
- Azure Cosmos DB への移行のための容量計画を実行しようとしていますか? 容量計画のために、既存のデータベース クラスターに関する情報を使用できます。
    - 既存のデータベース クラスター内の仮想コアとサーバーの数のみがわかっている場合は、[仮想コア数または仮想 CPU 数を使用した要求ユニットの見積もり](convert-vcore-to-request-unit.md)に関するページを参照してください 
    - 現在のデータベース ワークロードに対する通常の要求レートがわかっている場合は、[Azure Cosmos DB Capacity Planner を使用した要求ユニットの見積もり](estimate-ru-with-capacity-planner.md)に関するページを参照してください