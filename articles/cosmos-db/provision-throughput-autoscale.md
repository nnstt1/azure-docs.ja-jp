---
title: 自動スケーリング モードで Azure Cosmos のコンテナーとデータベースを作成します。
description: 自動スケーリング モードでの Azure Cosmos のデータベースとコンテナーの利点、ユース ケース、およびプロビジョニング方法について説明します。
author: kirillg
ms.author: kirillg
ms.service: cosmos-db
ms.topic: conceptual
ms.date: 05/18/2021
ms.custom: seo-nov-2020
ms.openlocfilehash: 628cba9c515b58e23c984c6dcd34fa35ff63c78a
ms.sourcegitcommit: 03f0db2e8d91219cf88852c1e500ae86552d8249
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/27/2021
ms.locfileid: "123028617"
---
# <a name="create-azure-cosmos-containers-and-databases-with-autoscale-throughput"></a>自動スケーリングのスループットを使用して Azure Cosmos コンテナーとデータベースを作成する
[!INCLUDE[appliesto-all-apis](includes/appliesto-all-apis.md)]

Azure Cosmos DB では、データベースとコンテナーに対して標準 (手動) または自動スケーリングのプロビジョニング スループットを構成できます。 Azure Cosmos DB で自動スケーリング プロビジョニング スループットを使用すると、**お使いのデータベースまたはコンテナーのスループット (RU/秒) を自動的かつ即座にスケーリング** できます。 ワークロードの可用性、待機時間、スループット、またはパフォーマンスに影響を与えずに、使用量に基づいてスループットがスケーリングされます。

自動スケーリングのプロビジョニング スループットは、トラフィック パターンが変動し予測できないミッション クリティカルなワークロードに最適であり、ハイ パフォーマンスとスケーリングに対する SLA を必要とします。 この記事では、自動スケーリングのプロビジョニング スループットの利点とユース ケースについて説明します。

## <a name="benefits-of-autoscale"></a>自動スケールの利点

自動スケーリングのプロビジョニング スループットが構成された Azure Cosmos データベースおよびコンテナーには、次の利点があります。

* **Simple の場合:** 自動スケーリングを利用すると、カスタム スクリプトの作成や手動による容量のスケーリングに伴う RU/秒の管理の複雑さが解消されます。 

* **スケーラブル:** データベースとコンテナーでは、必要に応じて、プロビジョニング スループットが自動的にスケーリングされます。 クライアント接続やアプリケーションは中断されず、また、Azure Cosmos DB SLA への影響はありません。

* **コスト効率:** 自動スケーリングを利用すると、使用されていないときにスケールダウンすることで、RU/秒の使用率とコストの使用状況を最適化できます。 ワークロードで必要とされるリソースに対してのみ、時間単位で料金を支払います。 自動スケーリングの最大 RU/秒 (Tmax) を設定しており、1 か月の全時間数のうち、全 Tmax 量を使用している時間が 66% 以下の場合、自動スケーリングによって節約されます。 詳細については、「[標準 (手動) および自動スケーリングのプロビジョニング スループットから選択する方法](how-to-choose-offer.md)」を参照してください。

* **高可用性:** 自動スケーリングを使用するデータベースおよびコンテナーでは、グローバルに分散されたフォールト トレラントで可用性の高い同一の Azure Cosmos DB バックエンドが使用され、データの持続性と高可用性が保証されます。

## <a name="use-cases-of-autoscale"></a>自動スケーリングのユース ケース

自動スケーリングのユース ケースを以下に示します。

* **変動する予測不可能なワークロード:** ワークロードの使用率が変動したり、急増を予測できなかったりする場合には、自動スケーリングを利用して、使用状況に基づいて自動的にスケールアップおよびスケールダウンすることができます。 例としては、小売の Web サイトで季節性に応じてトラフィック パターンが異なる場合、IOT ワークロードが 1 日のさまざまな時間に急増する場合、基幹業務アプリケーションにおいて 1 か月や 1 年に数回、ピーク時の使用率が見られる場合などがあります。 自動スケーリングを利用すると、ピーク時または平均の容量に対して手動でプロビジョニングする必要がなくなります。 

* **新しいアプリケーション:** 新しいアプリケーションを開発していて、必要なスループット (RU/秒) がわからない場合は、自動スケーリングを利用して簡単に始めることができます。 自動スケーリングのエントリ ポイントである 400 から 4000 RU/秒で開始し、使用状況を監視して、時間の経過と共に適切な RU/秒を判断することができます。

* **使用頻度の低いアプリケーション:** 1 日、1 週間、または 1 か月に何度か、数時間だけ使用されるアプリケーション (小規模なアプリケーション/Web/ブログ サイトなど) がある場合は、自動スケーリングを利用すると、ピーク時の使用率に対応するように容量が調整され、その期間が終了するとスケールダウンされます。 

* **開発およびテストのワークロード:** 業務時間中はご自身やチームで Azure Cosmos データベースおよびコンテナーを使用するが、夜間や週末には必要ない場合には、自動スケーリングを利用すると、使用していないときには最小限までスケールダウンされ、コストを節約できます。 

* **スケジュールされた運用ワークロード/クエリ:** アイドル期間中に実行することを検討しているスケジュールされた一連の要求、操作、またはクエリがある場合には、自動スケーリングを利用して簡単に実行できます。 ワークロードを実行する必要があるときに、スループットが必要な値まで自動的に拡張され、その後、スケールダウンされます。 

これらの問題に対処するカスタム ソリューションを構築する場合、膨大な時間を必要とするだけでなく、アプリケーションの構成やコードが複雑になります。 自動スケーリングを利用すれば、上述したシナリオをすぐに実現でき、容量をカスタムまたは手動でスケーリングする必要がなくなります。 

## <a name="how-autoscale-provisioned-throughput-works"></a>自動スケーリングのプロビジョニング スループットのしくみ

コンテナーとデータベースを自動スケーリングに構成するときは、必要な最大スループット `Tmax` を指定します。 Azure Cosmos DB では、`0.1*Tmax <= T <= Tmax` のように、スループット `T` がスケーリングされます。 たとえば、最大スループットを 20,000 RU/秒に設定すると、スループットは 2000 から 20,000 RU/秒の間でスケーリングされます。 スケーリングは自動的かつ瞬時に行われるため、どの時点でも、プロビジョニングされた `Tmax` まで遅延なく使用できます。 

料金は、1 時間の枠内でシステムがスケーリングされた最大スループット `T` に対して、時間単位で請求されます。

自動スケーリングの最大スループット `Tmax` のエントリ ポイントは 4000 RU/秒で開始され、400 から 4000 RU/秒の間でスケーリングされます。 `Tmax` は 1000 RU/秒の増分で設定でき、値はいつでも変更できます。  

## <a name="enable-autoscale-on-existing-resources"></a>既存のリソースに対して自動スケーリングを有効にする

[Azure portal](how-to-provision-autoscale-throughput.md#enable-autoscale-on-existing-database-or-container)、[CLI](how-to-provision-autoscale-throughput.md#azure-cli)、または [PowerShell](how-to-provision-autoscale-throughput.md#azure-powershell) を使用して、既存のデータベースまたはコンテナーで自動スケーリングを有効にできます。 自動スケーリングと標準 (手動) のプロビジョニング スループット間の切り替えは、いつでも行うことができます。 詳細については、こちらの[ドキュメント](autoscale-faq.yml#how-does-the-migration-between-autoscale-and-standard--manual--provisioned-throughput-work-)を参照してください。

## <a name="throughput-and-storage-limits-for-autoscale"></a><a id="autoscale-limits"></a> 自動スケーリングのスループットとストレージ制限

`Tmax` の値に応じて、データベースまたはコンテナーでは合計 `0.01 * Tmax GB` を保存できます。 このストレージ容量に達すると、アプリケーションに影響を与えることなく、新しいストレージ値に基づいて最大 RU/秒が自動的に増やされます。 

たとえば、50,000 RU/秒の最大 RU/秒で開始した場合 (5000 から 50,000 RU/秒の間でスケーリングされます)、最大で 500 GB のデータを格納できます。 500 GB を超えると (現在、ストレージが 600 GB になっているなど)、新しい最大 RU/秒は 60,000 RU/秒になります (6000 から 60,000 RU/秒の間でスケーリングされます)。

自動スケーリングによるデータベース レベルのスループットを使用する場合は、40 GB のストレージを超えない限り、最初の 25 個のコンテナーによって、自動スケーリングの最大の 4000 RU/秒 (400 から 4000 RU/秒の間でスケーリングされます) を共有できます。 詳細については、こちらの[ドキュメント](autoscale-faq.yml#can-i-change-the-max-ru-s-on-the-database-or-container--)を参照してください。

## <a name="comparison--containers-configured-with-manual-vs-autoscale-throughput"></a>比較 – 手動または自動スケーリングのスループットで構成されたコンテナー
標準 (手動) および自動スケーリングのスループットから選択する方法の詳細については、こちらの[ドキュメント](how-to-choose-offer.md)を参照してください。  

|| 標準 (手動) のスループットを利用したコンテナー  | 自動スケーリングのスループットを利用したコンテナー |
|---------|---------|---------|
| **プロビジョニング スループット (RU/秒)** | 手動でプロビジョニングします。 | ワークロードの使用パターンに基づいて、自動的に瞬時にスケーリングされます。 |
| **要求/操作のレート制限 (429)**  | 使用量がプロビジョニング済みの容量を超えた場合、発生する可能性があります。 | 設定した自動スケーリングのスループットの範囲内で RU/秒を使用する場合は、発生しません。    |
| **容量計画** |  容量計画を行い、必要とされる正確なスループットをプロビジョニングする必要があります。 |    容量計画と容量管理は、システムによって自動的に行われます。 |
| **料金** | [1 時間あたりの標準 (手動) の RU/秒レート](https://azure.microsoft.com/pricing/details/cosmos-db/)を使用して、手動でプロビジョニングされた RU/秒に対して、時間単位で料金を支払います。 | システムによって 1 時間の枠内でスケールアップされた最大 RU/秒に対して、時間単位で料金を支払います。 <br/><br/> 単一の書き込みリージョンのアカウントの場合、[1 時間あたりの自動スケーリングの RU/秒レート](https://azure.microsoft.com/pricing/details/cosmos-db/)を使用して、使用された RU/秒に対して時間単位で料金を支払います。 <br/><br/>書き込みリージョンが複数あるアカウントの場合、自動スケーリングに対する追加料金は発生しません。 同じ [1 時間あたりの複数リージョン書き込み RU/秒レート](https://azure.microsoft.com/pricing/details/cosmos-db/)を使用して、使用されたスループットに対して時間単位で料金を支払います。 |
| **最適なワークロードの種類** |  予測可能で安定したワークロード|   予測不可能で変動するワークロード  |

## <a name="next-steps"></a>次のステップ

* [自動スケーリングに関する FAQ](autoscale-faq.yml) を確認する。
* [手動および自動スケーリングのスループットから選択する](how-to-choose-offer.md)方法を確認する。
* [Azure Cosmos データベースまたはコンテナー上で自動スケーリングのスループットをプロビジョニングする](how-to-provision-autoscale-throughput.md)方法を確認する。
* Azure Cosmos DB での[パーティション分割](partitioning-overview.md)について詳細を確認する。
* Azure Cosmos DB への移行のための容量計画を実行しようとしていますか? 容量計画のために、既存のデータベース クラスターに関する情報を使用できます。
    * 既存のデータベース クラスター内の仮想コアとサーバーの数のみがわかっている場合は、[仮想コアまたは仮想 CPU の数を使用した要求ユニットの見積り](convert-vcore-to-request-unit.md)に関するページを参照してください 
    * 現在のデータベース ワークロードに対する通常の要求レートがわかっている場合は、[Azure Cosmos DB Capacity Planner を使用した要求ユニットの見積もり](estimate-ru-with-capacity-planner.md)に関するページを参照してください


