---
title: Azure Cache for Redis の高可用性
description: Azure Cache for Redis の高可用性の機能とオプションについて学習する
author: curib
ms.service: cache
ms.topic: conceptual
ms.date: 02/08/2021
ms.author: cauribeg
ms.openlocfilehash: 2fb0440ed6946f9595f1c78c5528fdb3c627de0b
ms.sourcegitcommit: c27f71f890ecba96b42d58604c556505897a34f3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/05/2021
ms.locfileid: "129538541"
---
# <a name="high-availability-for-azure-cache-for-redis"></a>Azure Cache for Redis の高可用性

Azure Cache for Redis には高可用性が組み込まれています。  高可用性アーキテクチャを使用して、基礎となる仮想マシン (VM) に計画的および計画外の停電が影響した場合でも、マネージド Redis インスタンスが機能するようにします。 これにより、単一の VM で Redis をホストすることで達成できるものよりもはるかに高い比率が実現されます。

Azure Cache for Redis により、キャッシュ用に "*ノード*" と呼ばれる複数の VM が使用され、高可用性が実装されます。 状況に応じてデータのレプリケーションとフェールオーバーが行われるようにノードは構成されます。 高可用性は、Redis ソフトウェアのパッチ適用などのメンテナンス作業にも役立ちます。 Standard、Premium、および Enterprise レベルで、さまざまな高可用性オプションを使用することができます。

| オプション | 説明 | 可用性 | Standard | Premium | エンタープライズ |
| ------------------- | ------- | ------- | :------: | :---: | :---: |
| [標準のレプリケーション](#standard-replication)| 単一のデータセンターでのデュアルノードのレプリケートされた構成 (自動フェールオーバーあり) | 99.9% ([詳細](https://azure.microsoft.com/support/legal/sla/cache/v1_1/)を参照) |✔|✔|-|
| [ゾーン冗長性](#zone-redundancy) | AZ 間でのマルチノードのレプリケートされた構成 (自動フェールオーバーあり) | 最大 99.99% ([詳細](https://azure.microsoft.com/support/legal/sla/cache/v1_1/)を参照) |-|✔|✔|
| [geo レプリケーション](#geo-replication) | 2 つのリージョンでのリンクされたキャッシュ インスタンス (ユーザー制御のフェールオーバーあり) | 最大 99.999% ([詳細](https://azure.microsoft.com/support/legal/sla/cache/v1_1/)を参照) |-|✔|プレビュー|

## <a name="standard-replication"></a>標準のレプリケーション

Standard または Premium レベルの Azure Cache for Redis は、既定では 1 組の Redis サーバーで実行されます。 2 台のサーバーは専用の VM 上でホストされます。 オープンソースの Redis を使用すれば、1 台のサーバーだけでデータ書き込み要求を処理できます。 このサーバーは "*プライマリ*" ノードで、もう一方は "*レプリカ*" です。 サーバー ノードのプロビジョニング後に、Azure Cache for Redis によってプライマリおよびレプリカ ロールが割り当てられます。 通常、プライマリ ノードは、Redis クライアントからの書き込みと読み取りの要求の処理も担当します。 書き込み操作で、新しいキーとキーの更新をその内部メモリにコミットし、クライアントにすぐに応答します。 操作をレプリカに非同期的に転送します。

:::image type="content" source="media/cache-high-availability/replication.png" alt-text="データ レプリケーションの設定":::

>[!NOTE]
>通常、Redis クライアントは、すべての読み取りおよび書き込み要求について、Redis Cache 内のプライマリ ノードと通信を行います。 レプリカ ノードから読み取るように、特定の Redis クライアントを構成することができます。
>
>

Redis Cache 内のプライマリ ノードが使用できない場合、レプリカは自動的に新しいプライマリになるように自身を昇格させます。 このプロセスは "*フェールオーバー*" と呼ばれます。 レプリカは十分に長い時間待機してから引き継ぎます。その場合、プライマリ ノードは迅速に回復します。 フェールオーバーが発生すると、Azure Cache for Redis によって新しい VM がプロビジョニングされ、それがレプリカ ノードとしてキャッシュに参加させられます。 レプリカによって、キャッシュ データの別のコピーを保持するために、プライマリとの完全なデータ同期が行われます。

プライマリ ノードは、Redis ソフトウェアやオペレーティング システムの更新などの計画されたメンテナンス アクティビティの一部としてサービスを認識しないことがあります。 また、基になるハードウェア、ソフトウェア、またはネットワークでの障害など、計画外のイベントが原因で動作を停止することもあります。 Redis フェールオーバーの種類については、「[Azure Cache for Redis のフェールオーバーと修正プログラムの適用](cache-failover.md)」に詳しく説明されています。 Azure Cache for Redis により、その有効期間中に多くのフェールオーバーが確認されます。 高可用性アーキテクチャの設計によって、キャッシュの内部でのこれらの変更が、そのクライアントに対して可能な限り透過的になります。

また、Premium レベルの場合、Azure Cache for Redis にはより多くのレプリカ ノードが提供されます。 [複数レプリカのキャッシュ](cache-how-to-multi-replicas.md)は、最大 3 つのレプリカ ノードで構成できます。 一般に、レプリカが増えると、プライマリをバックアップするノードがあるため、回復性が向上します。 レプリカが増えても、Azure Cache for Redis インスタンスは、データセンターまたは AZ レベルの停止によって大きな影響を受ける可能性があります。 複数のレプリカを[ゾーン冗長性](#zone-redundancy)と共に使用することで、キャッシュの可用性を向上させることができます。

## <a name="zone-redundancy"></a>ゾーン冗長性

Azure Cache for Redis によって、Premium レベルと Enterprise レベルでのゾーン冗長構成がサポートされます。 [ゾーン冗長キャッシュ](cache-how-to-zone-redundancy.md)を使用すると、同じリージョン内の異なる [Azure Availability Zones](../availability-zones/az-overview.md) にわたってノードを配置できます。 これにより、単一障害点としてデータセンターまたは AZ の停止が除去され、キャッシュの全体的な可用性が向上します。

### <a name="premium-tier"></a>Premium レベル

次の図は、Premium レベルのゾーン冗長の構成を示しています。

:::image type="content" source="media/cache-high-availability/zone-redundancy.png" alt-text="ゾーン冗長性の設定":::

選択した AZ に、ラウンドロビン方式でゾーン冗長キャッシュ内のノードが Azure Cache for Redis によって分散されます。 また、最初にプライマリとして機能するノードが決定されます。

ゾーン冗長キャッシュによって自動フェールオーバーが提供されます。 現在のプライマリ ノードが使用できない場合、レプリカの 1 つに引き継がれます。 新しいプライマリ ノードが異なる AZ に配置されている場合、アプリケーションでのキャッシュ応答時間が長くなる可能性があります。 AZ は地理的に分離されています。 AZ を切り替えると、アプリケーションとキャッシュがホストされている場所の間の物理的な距離が変わります。 この変更は、アプリケーションからキャッシュへのラウンドトリップ ネットワークの待機時間に影響します。 余分な待機時間は、ほとんどのアプリケーションで許容範囲内に収まることが想定されます。 アプリケーションをテストして、ゾーン冗長キャッシュが適切に機能するかどうかを確認することをお勧めします。

### <a name="enterprise-tiers"></a>Enterprise サービス レベル

いずれかの Enterprise レベルのキャッシュは、Redis Enterprise クラスターで実行されます。 クォーラムを形成するには、常に奇数個のサーバー ノードが必要です。 既定では、3 つのノードがあり、それぞれが専用の VM でホストされています。 Enterprise キャッシュには、2 つの同じサイズの *データ ノード* と、それよりも小さな 1 つの *クォーラム ノード* があります。 Enterprise Flash キャッシュには、3 つの同じサイズのデータ ノードがあります。 Enterprise クラスターは、Redis データを内部的にパーティションに分割します。 各パーティションには 1 つの *プライマリ* と、少なくとも 1 つの *レプリカ* があります。 各データ ノードは、1 つまたは複数のパーティションを保持します。 Enterprise クラスターによって、プライマリと任意のパーティションのレプリカが、同じデータ ノードに併置されないことが保証されます。 パーティションは、プライマリから対応するレプリカにデータを非同期的にレプリケートします。

データ ノードが使用できなくなった場合、またはネットワークの分割が発生した場合、「[標準のレプリケーション](#standard-replication)」に記載されているようなフェールオーバーが行われます。 Enterprise クラスターは、クォーラムベースのモデルを使用して、新しいクォーラムに参加する残りのノードを決定します。 また、必要に応じて、これらのノード内のレプリカ パーティションをプライマリに昇格させます。

## <a name="geo-replication"></a>geo レプリケーション

[geo レプリケーション](cache-how-to-geo-replication.md)は 2 つ以上の Azure Cache for Redis インスタンスをリンクするためのメカニズムであり、通常 2 つの Azure リージョンにまたがります。

### <a name="premium-tier"></a>Premium レベル

>[!NOTE]
>Premium レベルの geo レプリケーションは主にディザスター リカバリーのために設計されています。
>
>

キャッシュ データを別のリージョンにバックアップできるように、[geo レプリケーション](cache-how-to-geo-replication.md)を使用して Premium レベルの 2 つのキャッシュ インスタンスを接続できます。 一度リンクすると、一方のインスタンスはプライマリ リンク キャッシュとして、他方はセカンダリ リンク キャッシュとして指定されます。 読み取り要求と書き込み要求を受け入れるのは、プライマリ キャッシュだけです。 プライマリ キャッシュに書き込まれたデータがセカンダリ キャッシュにレプリケートされます。

アプリケーションは、プライマリおよびセカンダリ キャッシュの個別のエンドポイントを経由してキャッシュにアクセスします。 アプリケーションでは、複数の Azure リージョンにデプロイされるときに、すべての書き込み要求をプライマリ キャッシュに送信する必要があります。 読み取りは、プライマリまたはセカンダリ キャッシュのどちらからでも行うことができます。 アプリケーションのコンピューティング インスタンスでは、待機時間を短縮するために、最も近いキャッシュから読み取るのが一般的です。 2 つのキャッシュ インスタンス間のデータ転送は TLS によって保護されます。

geo レプリケーションでは、アプリケーションの他の部分がプライマリ リージョンに残っている場合に、リージョン間のネットワークのラウンドトリップ時間が増えるという懸念があるため、自動フェールオーバーは提供されません。 セカンダリ キャッシュのリンクを解除することによって、フェールオーバーを管理および開始する必要があります。 リンクを解除すると、新しいプライマリ インスタンスになります。

### <a name="enterprise-tiers"></a>Enterprise サービス レベル

>[!NOTE]
>これはプレビューとして利用できます。
>
>

Enterprise レベルは、より高度な geo レプリケーションをサポートしています。 これは[アクティブ geo レプリケーション](cache-how-to-active-geo-replication.md)と呼びます。 Redis Enterprise ソフトウェアでは、競合のないレプリケートされたデータ型を使用して、複数のキャッシュ インスタンスへの書き込みをサポートし、変更のマージや競合の解決を行います。 異なる Azure リージョン内の 2 つ以上の Enterprise レベルのキャッシュ インスタンスを結合して、アクティブ geo レプリケートされたキャッシュを作成できます。 

このようなキャッシュを使用するアプリケーションでは、対応するエンドポイントを経由して、地理的に分散されたキャッシュ インスタンスの読み取りと書き込みを行うことができます。 キャッシュには各コンピューティング インスタンスに最も近いものを使用する必要があります。これにより、待機時間が最も短くなります。 また、アプリケーションでは、キャッシュ インスタンスを監視して、インスタンスのいずれかが使用できなくなった場合に別のリージョンに切り替える必要もあります。 アクティブ geo レプリケーションのしくみについて詳しくは、[アクティブ/アクティブ geo 分散 (CRDT ベース)](https://redislabs.com/redis-enterprise/technology/active-active-geo-distribution/) に関する記事を参照してください。

## <a name="next-steps"></a>次の手順

Azure Cache for Redis の高可用性オプションを構成する方法について学習します。

* [Azure Cache for Redis Premium サービス レベル](cache-overview.md#service-tiers)
* [Azure Cache for Redis にレプリカを追加する](cache-how-to-multi-replicas.md)
* [Azure Cache for Redis のゾーン冗長性を有効にする](cache-how-to-zone-redundancy.md)
* [Azure Cache for Redis の geo レプリケーションを設定する](cache-how-to-geo-replication.md)
