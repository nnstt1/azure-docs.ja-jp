---
title: スキャンとインジェスト
description: この記事では、Azure Purview でのスキャンとインジェストについて説明します。
author: nayenama
ms.author: nayenama
ms.service: purview
ms.subservice: purview-data-map
ms.topic: conceptual
ms.date: 08/18/2021
ms.custom: ignite-fall-2021
ms.openlocfilehash: af12878750c6976a3ce3b459d9cf1ff6b262c112
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2021
ms.locfileid: "131024033"
---
# <a name="scans-and-ingestion-in-azure-purview"></a>Azure Purview でのスキャンとインジェスト

この記事では、Azure Purview のスキャンとインジェストの機能について説明します。 これらの機能では、Purview アカウントをソースに接続して、データ マップとデータ カタログを設定し、Purview からデータの探索と管理を開始できるようにします。

## <a name="scanning"></a>スキャン

Purview アカウントでデータ ソースを[登録](manage-data-sources.md)したら、次の手順ではデータ ソースをスキャンします。 スキャン プロセスでは、データ ソースへの接続を確立して、名前、ファイル サイズ、列など、技術的なメタデータをキャプチャします。 また、構造化データ ソースのスキーマを抽出して、スキーマの分類を適用します。[Purview アカウントが Microsoft 365 セキュリティ/コンプライアンス センター (SCC) に接続されている場合は、秘密度ラベルを適用します](create-sensitivity-label.md)。 スキャン プロセスをトリガーしてすぐに実行したり、定期的に実行したりして、Purview アカウントを最新の状態に保つことができます。

各スキャンには、必要な情報のソースのみをスキャンするために適用できるカスタマイズがあります。

### <a name="choose-an-authentication-method-for-your-scans"></a>スキャンの認証方法を選択する

Purview は既定で保護されています。 パスワードまたはシークレットは Purview に直接保存されないため、ソースの認証方法を選択する必要があります。 Purview アカウントを認証する方法は4つありますが、データソースごとにサポートされていないメソッドもあります。
 - マネージド ID
 - サービス プリンシパル
 - SQL 認証
 - アカウントキーまたは基本認証

マネージド ID を使用すると、個々のデータソースの資格情報を格納および管理する必要がなくなるため、可能な限り、推奨される認証方法です。 これにより、ユーザーとチームがスキャンの認証の設定とトラブルシューティングに費やす時間を大幅に短縮できます。 Purview アカウントのマネージド ID を有効にすると、ID が Azure Active Directory で作成され、アカウントのライフサイクルに関連付けられます。 

### <a name="scope-your-scan"></a>スキャンの範囲を指定する

ソースをスキャンする場合は、データ ソース全体をスキャンするか、スキャンする特定のエンティティ (フォルダー/テーブル) のみを選択できます。 使用可能なオプションは、スキャンするソースによって異なり、1 回限りのスキャンと、スケジュールされたスキャンの両方で定義できます。

たとえば、[Azure SQL Database のスキャンを作成して実行する](register-scan-azure-sql-database.md#creating-the-scan)場合、スキャンするテーブルを選択するか、データベース全体を選択できます。

### <a name="scan-rule-set"></a>スキャン ルール セット

スキャン ルール セットでは、ソースのいずれかに対してスキャンを実行するときに検索する情報の種類を決定します。 使用可能なルールは、スキャンするソースの種類によって異なりますが、スキャンする[ファイルの種類](sources-and-scans.md#file-types-supported-for-scanning)や必要な[分類](supported-classifications.md)の種類などの情報が含まれます。

多くのデータ ソースの種類で既に使用できる[システム スキャン ルールセット](create-a-scan-rule-set.md#system-scan-rule-sets)がありますが、[独自のスキャン ルール セットを作成して](create-a-scan-rule-set.md)、組織に合わせてスキャンを調整することもできます。

### <a name="schedule-your-scan"></a>スキャンをスケジュールする

Purview では、選択した時間に週単位または月単位でスキャンが行われるように選択できます。 週単位のスキャンは、開発中の構造を持つデータソースや頻繁に変更されるデータソースに適している場合があります。 毎月のスキャンは、あまり変更されないデータソースに適しています。 ベストプラクティスとして、スキャンするソースの管理者と協力して、ソースでのコンピューティング要求が少ない時間を特定することをお勧めします。

### <a name="how-scans-detect-deleted-assets"></a>削除されたアセットをスキャンが検出する方法

Azure Purview カタログは、スキャンを実行するときにのみ、データ ストアの状態を認識します。 ファイル、テーブル、またはコンテナーが削除されたかどうかをカタログで認識するためには、前回のスキャン出力を現在のスキャン出力と比較します。 たとえば、前回 Azure Data Lake Storage Gen2 アカウントをスキャンしたときに、*folder1* という名前のフォルダーが含まれていたとします。 同じアカウントを再度スキャンしたところ、*folder1* は存在しません。 そのため、そのフォルダーが削除されたとカタログによって認識されます。

#### <a name="detecting-deleted-files"></a>削除されたファイルを検出する

不足しているファイルを検出するためのロジックは、同じユーザーおよび異なるユーザーによる複数のスキャンで機能します。 たとえば、あるユーザーがフォルダー A、B、C の Data Lake Storage Gen2 データ ストアに対して 1 回限りのスキャンを実行するとします。その後、同じアカウント内の別のユーザーが、同じデータ ストアのフォルダー C、D、E で 1 回限りのスキャンを別に実行します。 フォルダー C は 2 回スキャンされたため、削除の可能性がカタログによってチェックされます。 ただし、フォルダー A、B、D、E はスキャンされたのは 1 回のみであり、カタログによって削除されたアセットがチェックされることはありません。

削除されたファイルをカタログから除外するようにするためには、スキャンを定期的に実行することが重要です。 削除されたアセットは別のスキャンが実行されるまでカタログで検出されないため、スキャン間隔は重要です。 そのため、特定のストアについて 1 か月に 1 回スキャンを実行する場合、そのストア内の削除されたデータ アセットは、1 か月後に次のスキャンを実行するまでカタログで検出できません。

Data Lake Storage Gen2 のような大規模なデータ ストアを列挙する場合、情報を見逃してしまう要因は複数あります (列挙エラーや破棄されたイベントなど)。 ファイルが作成または削除されたことが特定のスキャンによって見逃されてしまうおそれがあります。 そのため、ファイルは削除されたとカタログで確定されない限り、カタログから削除されません。 この方式では、スキャンされたデータ ストアに存在しないファイルがカタログに存在する場合にエラーが発生するおそれがあることを意味します。 場合によっては、特定の削除されたアセットが把握されるまで、データ ストアを 2 回または 3 回スキャンする必要があります。

> [!NOTE]
> 削除対象としてマークされている資産は、スキャンが成功した後に削除されます。 削除されたアセットは、処理されて削除されるまでしばらくの間、引き続きカタログに表示される可能性があります。

## <a name="ingestion"></a>データの取り込み

スキャン プロセスによって識別される技術的なメタデータまたは分類は、その後インジェストに送信されます。 インジェスト プロセスでは、データ マップを設定し、Purview によって管理されます。  インジェストでは、スキャンからの入力を分析して、[リソース セット パターンを適用し](concept-resource-sets.md#how-azure-purview-detects-resource-sets)、使用可能な[データ系列](concept-data-lineage.md)情報を設定してから、データ マップを自動的に読み込みます。 資産/スキーマは、インジェストの完了後にのみ検出またはキュレーションできます。 そのため、スキャンが完了したが、データ マップまたはカタログに資産が表示されていない場合は、インジェスト プロセスが完了するまで待つ必要があります。

## <a name="next-steps"></a>次の手順

詳細またはソースのスキャンに関する具体的な手順については、次のリンクを参照してください。

* リソース セットについては、[リソース セットに関する記事](concept-resource-sets.md)を参照してください。
* [Azure SQL Database の登録とスキャンの方法](register-scan-azure-sql-database.md#creating-the-scan)
* [Azure Purview のデータ系列](catalog-lineage-user-guide.md)
