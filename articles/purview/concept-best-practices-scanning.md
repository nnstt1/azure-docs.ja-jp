---
title: 管理範囲でのデータソースのスキャンに関するベストプラクティス
description: この記事では、Azure 管理範囲でさまざまなデータソースを登録およびスキャンするためのベストプラクティスについて説明します。
author: athenads
ms.author: athenadsouza
ms.service: purview
ms.subservice: purview-data-map
ms.topic: conceptual
ms.date: 10/08/2021
ms.custom: ignite-fall-2021
ms.openlocfilehash: 2313d8b544355dd2bdf5ca528faffbcc17f848e9
ms.sourcegitcommit: 677e8acc9a2e8b842e4aef4472599f9264e989e7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2021
ms.locfileid: "132309663"
---
# <a name="azure-purview-scanning-best-practices"></a>Azure 管理範囲スキャンのベストプラクティス

Azure 管理範囲は、オンプレミス、マルチクラウド、および SaaS のデータソースの自動スキャンをサポートしています。 "Scan" を実行すると、登録されているデータソースからメタデータを取り込むプロセスが呼び出されます。 スキャンとキュレーションの最後にあるメタデータには、データ資産名 (テーブル名/ファイル名)、ファイルサイズ、列、データ系列などの技術メタデータが含まれます。 構造化データソース (リレーショナルデータベース管理システムなど) の場合は、スキーマの詳細もキャプチャされます。 このプロセスでは、構成されているスキャン規則セットに基づいて、スキーマ属性に自動分類ラベルが適用されます。また、Purview アカウントが Microsoft 365 セキュリティ/コンプライアンスセンターに接続されている場合は、機密ラベルが適用されます。

## <a name="intended-audience"></a>対象ユーザー

- データ アーキテクチャ チーム
- データ キュレーター
- データソース管理者
- データ エンジニア

## <a name="why-do-you-need-best-practices-to-manage-data-sources"></a>データソースを管理するためのベストプラクティスが必要なのはなぜですか。

ベストプラクティスを使用すると、コストを最適化し、運用上の優位性を構築し、セキュリティのコンプライアンスとパフォーマンスの効率性を向上させることができます。
の設計に関する考慮事項と推奨事項は、スキャンプロセスに関連する主要な手順に基づいて整理されています。

## <a name="register-source-and-establish-connection"></a>ソースの登録と接続の確立

### <a name="design-considerations"></a>設計上の考慮事項

- 組織の戦略に沿った階層（地理的、ビジネス機能、データソースなど）を定義し、登録するデータソースとスキャンするデータソースをコレクションを使って作成する必要があります。

- 仕様により、同じ管理範囲アカウントに複数回データソースを登録することはできません。 このアーキテクチャは、同じデータソースに異なるアクセス制御を割り当てるリスクを回避するのに役立ちます。

### <a name="design-recommendations"></a>設計の推奨事項

- 同じデータソースのメタデータが複数のチームによって使用されている場合は、親コレクションにデータソースを登録して管理し、それぞれのサブコレクションに対応するスキャンを作成できます。これにより、関連する資産が各子コレクションに表示されます。 親を持たないソースは、マップビューの点線のボックスにグループ化され、矢印は親にリンクしません。

  :::image type="content" source="media/concept-best-practices/scanning-parent-child.png" alt-text="データソースが親コレクションに登録されている Azure 管理範囲を示すスクリーンショット。":::

- 複数のソース (Azure サブスクリプションまたはリソースグループ) を Azure クラウドに登録する必要がある場合は、 **azure の複数** のオプションを使用します。 詳細については、以下のドキュメントを参照してください。
    * [Azure Purview で複数のソースをスキャンする](./register-scan-azure-multiple-sources.md)
    * [データ ソースの準備状況を大規模に確認する](./tutorial-data-sources-readiness.md) 
    * [Azure Purview MSI のデータ ソースへのアクセスを大規模に構成する](./tutorial-msi-configuration.md)
     
- データソースが登録されると、同じソースが異なるチームまたは事業単位で使用されている場合に、同じソースを複数回スキャンできます。

データソースを登録するための階層を定義する方法の詳細については、「[コレクションアーキテクチャに関するベストプラクティス](./concept-best-practices-collections.md)」を参照してください。

## <a name="scanning"></a>スキャン

### <a name="design-considerations"></a>設計上の考慮事項

- データソースが登録されたら、自動およびセキュリティで保護されたメタデータのスキャンと実行を管理するスキャンを設定する必要があります。
- スキャンのセットアップでは、スキャンの名前、スキャンのスコープ、統合ランタイム、スキャントリガーの頻度、スキャン規則セット、およびリソースセットを、スキャンの頻度に従ってデータソースごとに一意に構成します。
- 資格情報を作成する前に、データソースの種類とネットワークの要件を考慮して、シナリオに必要な認証方法と統合ランタイムを決定します。

### <a name="design-recommendations"></a>設計の推奨事項

予期しないコストと再作業を避けるために、スキャンを設定するときに、関連する [コレクション](./how-to-create-and-manage-collections.md)にソースを登録した後に、次の順序を計画して従うことをお勧めします。

1. システムの組み込みの分類規則から分類要件を特定し、必要に応じて、特定の業界、ビジネス、および地域の要件 (既定では利用できません) に基づいて、特定のカスタム分類規則を作成します。
    - 分類されるデータ要素が正規表現パターンを使用して一貫して表現できる場合、またはデータファイルを使用してパターンを生成できる場合は、正規表現メソッドを使用します。 サンプルデータが母集団を反映していることを確認します。
    - Data 要素の値のリストが特定のデータセットに準拠すると予測される場合は、dictionary メソッドを使用します。
    - 詳細については、[カスタム分類規則と分類規則の作成](./create-a-custom-classification-and-classification-rule.md)方法に関するチュートリアルを参照してください。

2. 分類プロセスにより、スキャン期間が長くなり、余分なコストが発生する可能性があります。 そのため、スキャンするデータソースに関連する分類規則のみを選択することをお勧めします。
    - ソースごとにスキャン規則セットを作成し、構成されたシステムおよびカスタム分類規則を含む、関連する分類規則を選択します
    - スキャン規則セットを設定するときは、以下のことを確認してください。
        - スキャンされるデータソースに対してシステムの既定のスキャンルールセットが十分かどうかを確認します。それ以外の場合は、カスタムスキャンルールセットを定義します。
        - カスタムスキャン規則セットにはシステムの既定とカスタムの両方を含めることができるため、スキャンされるデータ資産に関連しないものはオフにできません。
        - 特定の業界、ビジネス、または地域の要件に対して分類するシステムの既定の規則を常に確認する
        - 必要に応じて、不要な分類ラベルを除外するカスタム規則セットを作成します。 例えば、システムのルールセットには、米国だけでなく世界中の一般的な政府コードのパターンが含まれているため、"Belgium Driver's License Number "のような他のタイプのパターンにもデータがマッチする可能性があります。
        - カスタム分類規則を最も重要で関連するラベルに制限して、乱雑にならないようにします (資産にタグ付けされたラベルが多すぎます)。
        - 更新シナリオ: カスタム分類またはスキャン規則セットを変更すると、フルスキャンがトリガーされます。 そのため、再作業やコストのかかるフルスキャンを避けるために、分類とスキャンルールセットを適切に構成することをお勧めします。
        - 多言語データ分類はまだサポートされていません
        - カスタム分類スキャンを作成するときに、パターンルールとしきい値が正しく検証され、誤った分類を防ぐために適切に構成されていることを確認します。
        - Azure 管理範囲は、ストレージアカウントをスキャンするときに、定義済みのパターンのセットを使用して、資産グループがリソースセットを形成するかどうかを判断します。 リソースセットパターンルールを使用すると、リソースセットとしてグループ化される資産と、カタログ内でどのように表示されるかを Azure 管理範囲が検出する方法をカスタマイズまたは上書きできます。詳細については、「 [リソースセットパターンの規則を作成する方法](./how-to-resource-set-pattern-rules.md) 」を参照してください。 
        > [!NOTE]
        > この機能にはコストに関する考慮事項があります。詳細については、 [価格のページ](https://azure.microsoft.com/pricing/details/azure-purview/) を参照してください。

3. 登録されているデータソースのスキャンを設定する
    - **スキャン名**: 既定では、管理範囲は名前付け規則の **スキャン [a-z] [a-z] [a-z]** を使用します。これは、実行したスキャンを特定するときには役に立ちません。 ベストプラクティスとして、わかりやすい名前付け規則を使用することをお勧めします。  インスタンスでは、 _環境ソースの頻度-_ 0200 のようにスキャンに名前を付けることができます。たとえば、1日あたりのスキャンは0200時間で表されます。
    
    - **認証**
        - Azure 管理範囲には、ソース (Azure クラウドまたはオンプレミスまたはサードパーティソース) の種類に応じて、データソースをスキャンするためのさまざまな認証方法が用意されています。 以下の優先順位に従うことをお勧めします。
            - 管理範囲 MSI で管理されている Id (たとえば、Azure Data Lake Gen2 ソースの場合)
            - ユーザー割り当てマネージド ID
            - サービス プリンシパル
            - SQL認証 (たとえば、オンプレミスまたは Azure SQL ソースの場合)
            - アカウントキーまたは基本認証 (たとえば、SAP S/4HANA ソースの場合)
            > [!Note]
            > ストレージ アカウントに対してファイアウォールが有効になっている場合は、スキャンを設定するときに、 [マネージド ID] の認証方法を使用する必要があります。
            > 新しい資格情報を設定するときに、資格情報の名前に使用できるのは、_文字、数字、アンダースコア、ハイフン_ のみです。 

    - **Integration Runtime**
        - 可能な場合は、Azure の自動解決統合ランタイムを使用します。
        - スキャンされるデータソースに対してパブリックエンドポイントが制限されている場合は、自己ホスト型統合ランタイム ("集合 r") を設定し、資格情報を作成する必要があります。 このツールは、お客様のコンピューターでのスキャンの実行をユーザーに許可するために使用されるツールです。 これにより、スキャンが通常は顧客のコンピューターで実行される Azure コンピューティングが置き換えられます。
        - 取り込みにプライベートエンドポイントを使用する場合は、データソースのスキャンに Self-Hosted Integration Runtime を使用する必要があります。
        - [最新バージョンの最新バージョン](https://www.microsoft.com/download/details.aspx?id=39717)がインストールされていることを確認します。
        - "存在しない" r が削除されると、それに依存している実行中のスキャンは失敗します。
      <!--
        - In Azure Purview there is no concept of SHIR HA or Shared SHIR.
        -->
        - 記憶された r を使用している間は、スキャンするデータソースに対してメモリが十分であることを確認してください。 たとえば、"メモリが不足しています" というメッセージが表示できる場合は、
            - 同一の r マシンに十分なメモリがあることを確認します (128 GB を用意することをお勧めします)
            - [スキャン] 設定で、使用可能な最大メモリを適切な値として設定します (たとえば、100)。
            - 詳細については、 [この](./register-scan-sapecc-source.md#create-and-run-scan) ドキュメントの「5. f」を参照してください。

    - **スコープスキャン**
        - スキャンのスコープを設定するときに、詳細レベルまたは親レベルに関連する資産のみを選択します。 これにより、スキャンコストが最適になり、パフォーマンスが向上します。 親が完全または部分的にチェックされている場合、特定の親の下にあるすべての将来のアセットが自動的に選択されます。 次に例を示します。
            - Azure SQL Database または ADLS Gen2 については、一覧内の適切な項目をチェックすることによって、フォルダー、サブフォルダー、コレクション、スキーマなど、データソースの特定の部分にスキャンのスコープを絞ることができます。
            - Oracle、Hive Metastore Database、Teradata ソースの場合、エクスポートされるスキーマの特定の一覧は、セミコロンで区切られた値で指定することも、SQL のような式を使用してスキーマ名パターンを使用して指定することもできます。
            - Google Big query では、エクスポートするデータセットの特定のリストをセミコロンで区切って指定できます。
            - AWS アカウント全体のスキャンを作成する場合は、スキャンする特定のバケットを選択できます。 特定の AWS S3 バケットのスキャンを作成する場合は、スキャンする特定のフォルダーを選択できます。
            - Erwin の場合は、Erwin モデルロケーター文字列のセミコロン区切りのリストを指定することで、スキャンのスコープを指定できます。
            - Cassandra では、エクスポートするキー空間の特定のリストをセミコロンで区切った値を使用して指定することも、SQL のような式を使用してキー空間名パターンを使用して指定することもできます。
            - Looker の場合は、セミコロンで区切られた Looker プロジェクトの一覧を指定することで、スキャンの範囲を指定できます。
            - テナントPower BI、個人用ワークスペースを含めるか除外するかのみを指定できます。
            - 一般に、ワイルドカード (データ レイクなど) に基づいて 'ignore patterns' (サポートされている場合) を使用して、一時、構成ファイル、RDMS システム テーブル、またはバックアップ/STG テーブルを除外することを推奨します
            - ドキュメントや非構造化データをスキャンする場合は、このようなドキュメントの最初の 20 MB がスキャン処理され、スキャン時間が長くなる可能性があるなど、膨大な数のドキュメントをスキャンしないようにしてください。

    - **スキャン ルール セット**
        - スキャン ルール セットを設定する場合は、前に作成した関連するシステム/カスタム スキャン ルール セットを構成してください
        - カスタム ファイルの種類を作成するオプションがあります。また、必要に応じて詳細を入力できます。 現在、Azure Purview では、カスタム区切り記号でサポートされる文字は 1 文字のみです。 実際のデータで ~ などのカスタム区切り記号を使用する場合は、新しいスキャン ルール セットを作成する必要があります

    - **スキャンの種類とスケジュール**
        - スキャン プロセスは、完全スキャンまたは増分スキャンを実行するように構成できます。
        - スキャン プロセスをトリガーしてすぐに実行したり、メタデータを最新の状態に保つために定期的に (毎週または毎月) 実行をスケジュールすることができます。 また、リソース使用量は、スキャンされるデータの量に大きく依存します。
        - ソースでの処理オーバーロードを回避するために、ビジネス以外の時間またはピーク外の時間にスキャンを実行する方法をお勧めします。
        - 初回スキャンはフル スキャンであり、後続のすべてのスキャンは増分スキャンです。 後続のスキャンは、定期的な増分スキャンとしてスケジュールできます。
        - スキャンの頻度は、データ ソースやビジネス要件の変更管理スケジュールと一致している必要があります。 次に例を示します。
            - ソース構造が変更される可能性がある (資産内の新しい資産またはフィールドが毎週追加、変更、または削除される) 場合は、スキャン頻度が同じと同期されている必要があります。
            - 分類/感度ラベルが週単位で最新である (規制上の理由が原因である可能性がある) と予想される場合は、スキャンの頻度を週単位で行う必要があります。
            たとえば、パーティション ファイルがソース データ レイクに毎週追加されている場合は、メタデータに変更が発生しなく (新しい分類シナリオがない場合) 週単位のスキャンではなく、毎月のスキャンをスケジュールできます。
            - 作成された同じ日に実行されるスキャンをスケジュールする場合、開始時刻はスキャン時刻より少なくとも 1 分前である必要があります。
            - スキャンが実行される最大期間は 7 日間です (メモリの問題が原因である可能性があります)。これにより、インジェスト プロセスは除外されます。 7 日後に進行状況が更新されていない場合、スキャンは失敗としてマークされます。 インジェスト (カタログへの) プロセスには現在、そのような制限はありません。

    - **スキャンの取り消し**
        - 現時点では、スキャンをトリガーした後、スキャンの状態が "進行中" 状態から "Queued" に遷移した場合にのみ、スキャンを取り消したり一時停止したりできます。
        - 個々の子スキャンの取り消しはサポートされていません
        <!--
        - <need to add the concept of a parent and child scan
        - To remove any scanned assets from Purview you should remove asset by asset
        -->

    - **削除と更新のシナリオ**
        - スキャンの実行後にフィールド/列、テーブル、またはファイルがソース システムから削除された場合、次にスケジュールされた完全/増分スキャンの後にのみ Purview に反映 (削除) されます。
        - 資産は、資産の名前の下にある削除アイコンを使用して Azure Purview カタログから削除できます (これにより、ソース内のオブジェクトは削除されません)。 ただし、同じソースでフル スキャンを実行すると、カタログに再び表示されます。 代わりに週単位または月単位のスキャンをスケジュールした場合 (増分)、オブジェクトがソースで変更されない限り、削除された資産は選択されません (たとえば、列がテーブルに追加または削除されます)。
        - 説明、資産レベルの分類、用語集の用語、連絡先を資産に追加するなどの資産レベルの更新を行う場合、後続のスキャンでは、資産スキーマが更新されます (後続のスキャン実行でスキャナーによって検出された新しい列と分類)。
        - 説明、列レベルの分類、用語集の用語の追加、データ型または列名の更新など、列レベルの更新を行った場合、後続のスキャンでは資産スキーマは更新されません (後続のスキャンの実行では、スキャナーによって新しい列と分類が検出されません)。

        詳細については、資産の表示、編集、 [削除の方法に関するチュートリアルを参照してください。](./catalog-asset-details.md)

## <a name="next-steps"></a>次のステップ
-  [データ ソースを管理する](./manage-data-sources.md)
