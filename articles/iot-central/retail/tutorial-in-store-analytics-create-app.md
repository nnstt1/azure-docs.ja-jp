---
title: チュートリアル - Azure IoT インストア アナリティクス | Microsoft Docs
description: このチュートリアルでは、IoT Central でインストア アナリティクス小売アプリケーションをデプロイして使用する方法について説明します。
services: iot-central
ms.service: iot-central
ms.subservice: iot-central-retail
ms.topic: tutorial
ms.custom:
- iot-storeAnalytics-checkout
- iot-p0-scenario
ms.author: timlt
author: timlt
ms.date: 08/17/2021
ms.openlocfilehash: 93438e9726dca4fe74da3bbfc9bd06533115e74e
ms.sourcegitcommit: add71a1f7dd82303a1eb3b771af53172726f4144
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/03/2021
ms.locfileid: "123439154"
---
# <a name="tutorial-deploy-and-walk-through-the-in-store-analytics-application-template"></a>チュートリアル: インストア アナリティクス アプリケーション テンプレートをデプロイして調べる

IoT Central の "*インストア アナリティクス*" アプリケーション テンプレートとこの記事のガイダンスを使用して、エンドツーエンドのストア内の分析ソリューションを開発します。

:::image type="content" source="media/tutorial-in-store-analytics-create-app/store-analytics-architecture-frame.png" alt-text="Azure IoT Central のストア アナリティクス。":::

- ゲートウェイ デバイスにテレメトリ データを送信している IoT センサーのセット
- テレメトリと集計された分析情報を IoT Central に送信しているゲートウェイ デバイス
- 操作のために目的の Azure サービスへの継続的データ エクスポート
- データを必要な形式で構造化し、ストレージ サービスに送信できます
- ビジネス アプリケーションを使って、データのクエリを実行し、小売りの活動に役立つ分析情報を生成することができます

ストア内の分析ソリューションで一般的に役立つ主要なコンポーネントについて見ていきましょう。

## <a name="condition-monitoring-sensors"></a>状況監視センサー

IoT ソリューションは、小売店環境内から意味のある信号をキャプチャするセンサーのセットから始まります。 これは、上のアーキテクチャ図の左端にあるさまざまな種類のセンサーによって反映されています。

## <a name="gateway-devices"></a>ゲートウェイ デバイス

多くの IoT センサーでは、未加工の信号を、直接クラウドに、または近くにあるゲートウェイ デバイスにフィードできます。 ゲートウェイ デバイスでは、概要分析情報を IoT Central アプリケーションに送信する前に、エッジでデータの集計が実行されます。 ゲートウェイ デバイスは、必要に応じて、センサー デバイスに対してコマンドと制御操作を中継する役割も担います。 

## <a name="iot-central-application"></a>IoT Central アプリケーション

Azure IoT Central アプリケーションにより、小売店環境内のさまざまな種類の IoT センサーやゲートウェイ デバイスからデータが取り込まれて、意味のある分析情報のセットが生成されます。

また、Azure IoT Central では、ストアオ ペレーターがインフラストラクチャ デバイスをリモートで監視および管理できるように、カスタマイズされたエクスペリエンスが提供されます。

## <a name="data-transform"></a>データの変換

ソリューション内の Azure IoT Central アプリケーションは、一連の Azure PaaS (サービスとしてのプラットフォーム) サービスに対して、未加工または集計済みの分析情報をエクスポートするように構成できます。これらのサービスでは、データの操作を実行し、分析情報を補強してから、ビジネス アプリケーションに渡すことができます。 

## <a name="business-application"></a>ビジネス アプリケーション

IoT データを使用して、小売り環境内に展開されたさまざまな種類のビジネス アプリケーションを強化することができます。 小売店のマネージャーまたはスタッフ メンバーは、これらのアプリケーションを使用して、ビジネス分析情報を視覚化し、意味のあるアクションをリアルタイムで実行できます。 小売りチーム向けのリアルタイム Power BI ダッシュボードを作成する方法については、[こちらのチュートリアル](./tutorial-in-store-analytics-create-app.md)を参照してください。

このチュートリアルでは、以下の内容を学習します。
> [!div class="checklist"]
>
> - Azure IoT Central の **In-store analytics - checkout** テンプレートを使用して小売店アプリケーションを作成する
> - アプリケーションの設定をカスタマイズする
> - IoT デバイス テンプレートを作成およびカスタマイズする
> - デバイスをアプリケーションに接続する
> - 条件を監視するためのルールとアクションを追加する

## <a name="prerequisites"></a>前提条件

- このアプリをデプロイするために必要な前提条件は特にありません。
- 無料価格プランを使用するか、Azure サブスクリプションを使用することができます。

## <a name="create-in-store-analytics-application"></a>ストア内の分析アプリケーションを作成する

次の手順に従ってアプリケーションを作成します。

1. [Azure IoT Central ビルド](https://aka.ms/iotcentral) Web サイトに移動します。 次に、Microsoft 個人アカウントか、職場または学校アカウントを使用してサインインします。 左側のナビゲーションバーから **[ビルド]** を選択し、 **[小売業]** タブを選択します。:::image type="content" source="media/tutorial-in-store-analytics-create-app/iotc-retail-homepage.png" alt-text="コネクテッド ロジスティクス テンプレート":::

1. **[In-store analytics - checkout]\(インストア アナリティクス - チェックアウト\)** で **[アプリの作成]** を選択します。

詳細については、「[IoT Central アプリケーションを作成する](../core/howto-create-iot-central-application.md)」を参照してください。

## <a name="walk-through-the-application"></a>アプリケーションを調べる

以降のセクションでは、アプリケーションの主な機能について見ていきます。

### <a name="customize-application-settings"></a>アプリケーションの設定をカスタマイズする

いくつかの設定を変更して、アプリケーションでのユーザー エクスペリエンスをカスタマイズできます。 このセクションでは、定義済みのアプリケーション テーマを選択します。 必要に応じて、カスタム テーマを作成し、アプリケーション イメージを更新する方法も学習します。 カスタム テーマを使用すると、アプリケーション ブラウザーの色、ブラウザーのアイコン、およびマストヘッドに表示されるアプリケーション ロゴを設定できます。

定義済みのアプリケーション テーマを選択するには:

1. マストヘッドにある **[設定]** を選択します。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/settings-icon.png" alt-text="Azure IoT Central アプリケーションの設定。":::

2. 新しい **[テーマ]** を選択します。

3. **[保存]** を選択します。

定義済みのテーマを使用する代わりに、カスタム テーマを作成することができます。 サンプル イメージのセットを使用してアプリケーションをカスタマイズし、チュートリアルを完了するには、[Contoso サンプル イメージ](https://github.com/Azure-Samples/iot-central-docs-samples/tree/master/retail)をダウンロードします。

カスタム テーマを作成するには:

1. まだ展開されていない場合は、左側のウィンドウを展開します。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/dashboard-expand.png" alt-text="Azure IoT Central の左側のウィンドウ。":::

1. **[管理] > [アプリケーションのカスタマイズ]** を選択します。

1. **[変更]** ボタンを使用して、**アプリケーション ロゴ** としてアップロードするイメージを選択します。 必要に応じて、 **[ロゴの代替テキスト]** の値を指定します。 

1. **[変更]** ボタンを使用して、ブラウザーのタブに表示される **ブラウザー アイコン** イメージを選択します。

1. 必要に応じて、HTML 16 進数のカラー コードを追加して、既定の **[ブラウザーの色]** を置き換えます。 **[ヘッダー]** には、 *#008575* を追加します。  **[アクセント]** には、 *#A1F3EA* を追加します。 

1. **[保存]** を選択します。 

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/select-application-logo.png" alt-text="Azure IoT Central のカスタマイズされたロゴ。":::

    保存した後、アプリケーションによってブラウザーの色、マストヘッド内のロゴ、ブラウザー アイコンが更新されます。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/saved-application-settings.png" alt-text="Azure IoT Central 更新済みアプリケーションの設定。":::

アプリケーション イメージを更新するには:

1. **[管理] > [アプリケーションの設定]** を選択します。

1. **[画像の選択]** ボタンを使用して、アプリケーション イメージとしてアップロードするイメージを選択します。 このイメージは、IoT Central アプリケーション マネージャーの **[マイ アプリ]** ページのアプリケーション タイルに表示されます。

1. **[保存]** を選択します。

1. 必要に応じて、[Azure IoT Central のアプリケーション マネージャー](https://aka.ms/iotcentral) Web サイト上の **[マイ アプリ]** ビューに移動します。 アプリケーション タイルに、更新されたアプリケーション イメージが表示されます。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/customize-application-image.png" alt-text="Azure IoT Central によるアプリケーション イメージのカスタマイズ。":::

### <a name="create-device-templates"></a>デバイス テンプレートを作成する

ご自身やアプリケーション オペレーターがデバイスを構成および管理できるようにするデバイス テンプレートを作成できます。 テンプレートを作成するには、カスタム テンプレートを作成するか、既存のテンプレート ファイルをインポートするか、Azure IoT デバイス カタログからテンプレートをインポートします。 デバイス テンプレートを作成し、カスタマイズしたら、それを使用して実際のデバイスをご自身のアプリケーションに接続します。 必要に応じて、デバイス テンプレートを使用して、テスト用のシミュレートされたデバイスを生成します。

**In-store analytics - checkout** アプリケーション テンプレートには、複数のデバイス用のデバイス テンプレートがあります。  アプリケーションで使用する 3 つのデバイスのうち 2 つにデバイス テンプレートがあります。 RuuviTag デバイス テンプレートは、**In-store analytics - checkout** アプリケーション テンプレートに含まれていません。 このセクションでは、RuuviTag センサー用のデバイス テンプレートをアプリケーションに追加します。

RuuviTag デバイス テンプレートをアプリケーションに追加するには:

1. 左側のウィンドウで **[デバイス テンプレート]** を選択します。

1. **[+ 新規]** を選択して新しいデバイス テンプレートを作成します。

1. Azure IoT デバイス カタログ内で **RuuviTag Multisensor** デバイス テンプレートを探して選択します。 

1. **カスタマイズ** を選択します。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/ruuvitag-device-template.png" alt-text="[Next: Customize]\(次へ: カスタマイズ\) ボタンが強調表示されているスクリーンショット。":::

1. **［作成］** を選択します アプリケーションによって、RuuviTag デバイス テンプレートが追加されます。

1. 左側のウィンドウで **[デバイス テンプレート]** を選択します。 このページには、アプリケーション テンプレートに含まれるすべてのデバイス テンプレートと、追加した RuuviTag デバイス テンプレートが表示されます。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/device-templates-list.png" alt-text="Azure IoT Central RuuviTag センサー デバイス テンプレート。":::

### <a name="customize-device-templates"></a>デバイス テンプレートのカスタマイズ

アプリケーションでデバイス テンプレートをカスタマイズするには、3 つの方法があります。 まず、デバイスの機能を変更して、デバイス内のネイティブ組み込みインターフェイスをカスタマイズします。 たとえば、温度センサーでは、温度インターフェイスの表示名、データ型、測定単位、最小と最大の動作範囲などの詳細を変更できます。 

第 2 に、クラウドのプロパティを追加することでデバイス テンプレートをカスタマイズします。 クラウドのプロパティは、組み込みのデバイス機能の一部ではありません。 クラウドのプロパティは、Azure IoT Central アプリケーションがデバイスに対して作成、格納、関連付けを行うカスタム データです。 クラウド プロパティの例としては、計算値や、一連のデバイスに関連付ける場所などのメタデータがあります。

第 3 に、カスタム ビューを作成することでデバイス テンプレートをカスタマイズします。 ビューでは、デバイスのメトリックや正常性など、デバイスのテレメトリとメタデータをオペレーターが視覚化する手段が提供されます。

ここでは、最初の 2 つの方法を使用して、RuuviTag センサー用のデバイス テンプレートをカスタマイズします。

RuuviTag デバイス テンプレートの組み込みインターフェイスをカスタマイズするには:

1. 左側のウィンドウで **[デバイス テンプレート]** を選択します。 

1. RuuviTag センサー用のテンプレートを選択します。 

1. 左側のウィンドウを非表示にします。 テンプレートの [概要] ビューには、デバイスの機能が表示されます。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/ruuvitag-device-summary-view.png" alt-text="Azure IoT Central RuuviTag デバイス テンプレートの [概要] ビュー。":::

1. RuuviTag デバイス テンプレート メニューの **[カスタマイズ]** を選択します。 

1. 機能の一覧をスクロールし、テレメトリの種類 `humidity` を見つけます。 これは、*humidity* という編集可能な **[表示名]** 値を含む行アイテムです。

以下の手順では、RuuviTag センサーのテレメトリの種類 `humidity` をカスタマイズします。 必要に応じて、他のテレメトリの種類の一部をカスタマイズします。

テレメトリの種類 `humidity` について、次の変更を行います。

1. **[展開]** コントロールを選択して、その行のスキーマ詳細を展開します。

1. **[表示名]** の値を *humidity* から *Relative humidity* などのカスタム値に更新します。

1. **[セマンティックの種類]** オプションを "*なし*" から *Humidity* に変更します。  必要に応じて、展開されたスキーマ ビュー内で humidity のテレメトリの種類のスキーマ値を設定します。 スキーマ設定により、センサーによって追跡されるデータの詳細な検証要件を作成できます。たとえば、特定のインターフェイスに対して、動作範囲の最小値と最大値を設定できます。

1. **[保存]** を選択して変更を保存します。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/ruuvitag-device-template-customize.png" alt-text="[カスタマイズ] 画面が表示され、[保存] ボタンが強調表示されているスクリーンショット。":::

アプリケーションのデバイス テンプレートにクラウド プロパティを追加するには:

1. RuuviTag デバイス テンプレート メニューの **[クラウドのプロパティ]** を選択します。

1. **[クラウド プロパティの追加]** を選択します。 

以下の値を指定して、各デバイスの場所を格納するカスタム プロパティを作成します。

1. **[表示名]** に *Location* という値を入力します。 この値は、プロパティのフレンドリ名である **[名前]** フィールドに自動的にコピーされます。 コピーした値を使用することも、値を変更することもできます。

1. **[スキーマ]** ドロップダウンで "*文字列*" を選択します。 文字列型を使用すると、場所名の文字列を、テンプレートに基づいた任意のデバイスに関連付けることができます。 たとえば、ストア内の領域を各デバイスに関連付けることができます。

1. **[最小の長さ]** を *2* に設定します。 

1. **[Trim Whitespace]\(空白のトリミング\)** を **On** に設定します。

1. **[保存]** を選択して、カスタム クラウド プロパティを保存します。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/ruuvitag-device-template-cloud-property.png" alt-text="Azure IoT Central RuuviTag デバイス テンプレートのカスタマイズ。":::

1. **[発行]** を選択します。 

    デバイス テンプレートを発行すると、アプリケーション オペレーターに表示されるようになります。 テンプレートを発行したら、それを使用して、テスト用のシミュレートされたデバイスを生成したり、実際のデバイスをアプリケーションに接続したりします。 アプリケーションに接続しているデバイスが既にある場合は、カスタマイズされたテンプレートを発行すると、変更がデバイスにプッシュされます。

### <a name="add-devices"></a>デバイスの追加

デバイス テンプレートを作成し、カスタマイズしたら、デバイスを追加します。 

このチュートリアルでは、次の実際のデバイスとシミュレートされたデバイスのセットを使用して、アプリケーションを作成します。

- 実際の Rigado C500 ゲートウェイ
- 2 つの実際の RuuviTag センサー
- シミュレートされた **人感** センサー。 シミュレートされたセンサーはアプリケーション テンプレートに含まれているため、作成する必要はありません。 

> [!NOTE]
> 実際のデバイスがない場合でも、シミュレートされた RuuviTag センサーを作成することによって、このチュートリアルを完了できます。 次に、シミュレートされた RuuviTag を作成する手順を示します。 シミュレートされたゲートウェイを作成する必要はありません。

次の 2 つの記事の手順を完了して、実際の Rigado ゲートウェイと RuuviTag センサーを接続します。 完了したら、このチュートリアルに戻ります。 このチュートリアルではデバイス テンプレートを既に作成しているため、次の一連の指示でもう一度作成する必要はありません。

- Rigado ゲートウェイを接続するには、[Azure IoT Central アプリケーションへの Rigado Cascade 500 の接続](../core/howto-connect-rigado-cascade-500.md)に関する記事を参照してください。
- RuuviTag センサーを接続するには、「[Azure IoT Central アプリケーションへの RuuviTag センサーの接続](../core/howto-connect-ruuvi.md)」を参照してください。 必要に応じて、これらの指示に従って 2 つのシミュレートされたセンサーを作成することもできます。

### <a name="add-rules-and-actions"></a>ルールとアクションの追加

Azure IoT Central アプリケーション内でセンサーを使用して状態を監視することの一環として、特定の条件が満たされたときにアクションを実行するルールを作成できます。 ルールはデバイス テンプレートと 1 つまたは複数のデバイスに関連付けられており、デバイスのテレメトリまたはイベントに基づいて満たす必要がある条件が含まれています。 また、ルールには 1 つ以上のアクションが関連付けられています。 アクションには、メール通知の送信、または他のサービスにデータを送信するための Webhook アクションのトリガーが含まれる場合があります。 **In-store analytics - checkout** アプリケーション テンプレートには、アプリケーションのデバイス用の定義済みルールがいくつか含まれています。

このセクションでは、RuuviTag センサー テレメトリに基づいて最大の相対湿度レベルを確認する新しいルールを作成します。 湿度が最大値を超えた場合に、アプリケーションからメールが送信されるように、ルールにアクションを追加します。 

ルールを作成するには: 

1. 左側のウィンドウを展開します。

1. **[ルール]** を選択します。

1. **[+新規]** を選択します。

1. ルールの名前として *Humidity level* を入力します。 

1. **[スコープ]** で RuuviTag デバイス テンプレートを選択します。 定義したルールは、そのテンプレートに基づくすべてのセンサーに適用されます。 必要に応じて、定義されているセンサーのサブセットのみに規則を適用するフィルターを作成することもできます。 

1. **[テレメトリ]** として `Relative humidity` を選択します。 これは、前の手順でカスタマイズしたデバイス機能です。

1. **[演算子]** として `Is greater than` を選択します。 

1. **[値]** として、環境に対する室内湿度レベルの一般的な上限を入力します。 たとえば、「*65*」と入力します。 RuuviTag の実際のセンサーまたはシミュレートされたセンサーの相対湿度がこの値を超えると発生する条件をルールに設定しました。 環境内の通常の湿度範囲に応じて、値を上下に調整することが必要な場合があります。  

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/rules-add-conditions.png" alt-text="Azure IoT Central でのルール条件の追加。":::

ルールにアクションを追加するには:

1. **[+ Email]\(+ メール\)** を選択します。

1. アクションのわかりやすい **表示名** として「*High humidity notification*」を入力します。 

1. アカウントに関連付けられているメール アドレスを **[送信先]** に入力します。 別のメールを使用する場合、使用するアドレスは、アプリケーションに追加されているユーザーのアドレスである必要があります。 ユーザーは、少なくとも 1 回サインインしてサインアウトする必要もあります。

1. 必要に応じて、メールのテキストに含めるメモを入力します。

1. **[完了]** を選択して、アクションを完了します。

    :::image type="content" source="media/tutorial-in-store-analytics-create-app/rules-add-action.png" alt-text="Azure IoT Central でのルールへのアクションの追加。":::

1. **[保存]** を選択して、新しいルールを保存してアクティブにします。 

    数分以内に、指定したメール アカウントでメールの受信が開始します。 湿度レベルが条件の値を超えたことがセンサーで示されるたびに、アプリケーションによってメールが送信されます。

## <a name="clean-up-resources"></a>リソースをクリーンアップする

[!INCLUDE [iot-central-clean-up-resources](../../../includes/iot-central-clean-up-resources.md)]

## <a name="next-steps"></a>次のステップ

このチュートリアルでは、以下の内容を学習しました。

* Azure IoT Central の **In-store analytics - checkout** テンプレートを使用して小売店アプリケーションを作成する
* アプリケーションの設定をカスタマイズする
* IoT デバイス テンプレートを作成およびカスタマイズする
* デバイスをアプリケーションに接続する
* 条件を監視するためのルールとアクションを追加する

ここでは、Azure IoT Central の条件監視アプリケーションを作成しました。推奨される次の手順は以下のとおりです。

> [!div class="nextstepaction"]
> [ダッシュボードのカスタマイズ](./tutorial-in-store-analytics-customize-dashboard.md)
