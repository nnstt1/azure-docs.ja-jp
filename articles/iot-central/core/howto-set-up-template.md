---
title: Azure IoT Central で新しい IoT デバイスの種類を定義する | Microsoft Docs
description: この記事では、Azure IoT Central アプリケーションで新しい Azure IoT デバイス テンプレートを作成する方法を示します。 種類に対して、テレメトリ、状態、プロパティ、コマンドを定義します。
author: dominicbetts
ms.author: dobett
ms.date: 08/13/2021
ms.topic: how-to
ms.service: iot-central
services: iot-central
ms.custom:
- contperf-fy21q1
- device-developer
ms.openlocfilehash: 59c95633322f279504ded61bbf02a7415b1337b9
ms.sourcegitcommit: 8000045c09d3b091314b4a73db20e99ddc825d91
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/19/2021
ms.locfileid: "122446291"
---
# <a name="define-a-new-iot-device-type-in-your-azure-iot-central-application"></a>Azure IoT Central アプリケーションで新しい IoT デバイスの種類を定義する

デバイス テンプレートは、[Azure IoT Central アプリケーション](concepts-app-templates.md)に接続するデバイスの種類の、特性と動作を定義するブループリントです。

この記事では、IoT Central 内でデバイス テンプレートを作成する方法について説明します。 たとえば、温度などのテレメトリや場所などのプロパティを送信するセンサー用のデバイス テンプレートを作成できます。 オペレーターはこのデバイス テンプレートから、実際のデバイスを作成して接続できます。

次のスクリーンショットは、デバイス テンプレートの例を示しています。

:::image type="content" source="media/howto-set-up-template/device-template.png" alt-text="デバイス テンプレートを示すスクリーンショット。":::

デバイス テンプレートには次のセクションがあります。

- モデル - モデルを使用すると、お使いのデバイスと IoT Central アプリケーションの対話方法を定義できます。 各モデルには一意のモデル ID があり、デバイスの機能がそれぞれ定義されています。 機能はインターフェイスにグループ化されます。 インターフェイスを使用すると、モデル間でコンポーネントを再利用したり、継承を使用して一連の機能を拡張したりできます。
- クラウド プロパティ - IoT Central アプリケーションによって格納されるデバイス情報を定義するには、クラウド プロパティを使用します。 たとえば、クラウド プロパティでは、デバイスが最後に点検されたデータを記録できます。
- カスタマイズ - カスタマイズを使用すると、機能を変更できます。 たとえば、プロパティの最低温度と最高温度の値を指定します。
- ビュー - デバイスからのデータを視覚化するにはビューを、デバイスを管理および制御するにはフォームを使用します。

詳細については、「[デバイス テンプレートとは](concepts-device-templates.md)」を参照してください。

## <a name="create-a-device-template"></a>デバイス テンプレートを作成する

デバイス テンプレートを作成するオプションはいくつかあります。

- IoT Central GUI 内でデバイス テンプレートを設計します。
- [Azure Certified for IoT デバイス カタログ](https://aka.ms/iotdevcat)からデバイス テンプレートをインポートします。 必要に応じて、IoT Central の要件に合わせてデバイス テンプレートをカスタマイズします。
- デバイスが IoT Central に接続するとき、実装しているモデルのモデル ID が送信されるようにします。 IoT Central は、そのモデル ID を使用してモデル リポジトリからモデルを取得し、デバイス テンプレートを作成します。 ご利用の IoT Central アプリケーションに必要なクラウド プロパティ、カスタマイズ、ビューを、デバイス テンプレートに追加します。
- デバイスが IoT Central に接続するときに、デバイスによって送信されるデータから、[デバイス テンプレートの定義が IoT Central によって自動生成](#autogenerate-a-device-template)されるように指定できます。
- [Digital Twins Definition Language (DTDL) V2](https://github.com/Azure/opendigitaltwins-dtdl/blob/master/DTDL/v2/dtdlv2.md) を使用して、デバイス モデルを作成します。 デバイス モデルをお使いの IoT Central アプリケーションに手動でインポートします。 その後、IoT Central アプリケーションが必要とするクラウド プロパティ、カスタマイズ、ビューを追加します。
- また、[REST API](/learn/modules/manage-iot-central-apps-with-rest-api/) または [CLI](howto-manage-iot-central-from-cli.md) を使用して、IoT Central アプリケーションにデバイス テンプレートを追加することもできます。

> [!NOTE]
> それぞれのケースで、デバイス コードは、モデルで定義されている機能を実装する必要があります。 デバイス コードの実装は、デバイス テンプレートのクラウド プロパティ、カスタマイズ、ビューのセクションの影響を受けません。

このセクションでは、デバイス テンプレートをカタログからインポートする方法と、IoT Central GUI を使用してカスタマイズする方法について説明します。 この例で使用しているのは、デバイス カタログの **ESP32-Azure IoT Kit** デバイス テンプレートです。

1. 新しいデバイス テンプレートを追加するには、 **[デバイス テンプレート]** ページで **[+ 新規]** を選択します。
1. **[種類の選択]** ページの **[Use a preconfigured device template]\(構成済みのデバイス テンプレートを使用する\)** セクションで、 **[ESP32-Azure IoT Kit]** タイルが表示されるまで下にスクロールします。
1. **[ESP32-Azure IoT Kit]** タイルを選択し、 **[Next: Review]\(次へ: 確認\)** をクリックします。
1. **[Review]\(レビュー\)** ページで、 **[Create]\(作成\)** を選択します。
作成したテンプレートの名前は **Sensor Controller** です。 このモデルには、**Sensor Controller**、**SensorTemp**、**Device Information interface** などのコンポーネントが含まれています。 コンポーネントによって、ESP32 デバイスの機能が定義されます。 機能には、テレメトリ、プロパティ、コマンドが含まれます。

:::image type="content" source="media/howto-set-up-template/device-template.png" alt-text="Sensor Controller デバイス テンプレートを示すスクリーンショット。":::

## <a name="autogenerate-a-device-template"></a>デバイス テンプレートを自動生成する

デバイス テンプレートにまだ割り当てられていない接続済みデバイスから、デバイス テンプレートを自動的に作成することもできます。 IoT Central は、デバイスから送信されるテレメトリ値とプロパティ値を使用して、デバイス モデルを推測します。

> [!NOTE]
> 現在、このプレビュー機能では、コンポーネントからのテレメトリとプロパティは使用できません。 ルート テレメトリとプロパティからのみ機能を生成できます。

次の手順は、この機能を使用する方法を示しています。

1. お使いのデバイスを IoT Central に接続し、データの送信を開始します。 **[生データ]** ビューにデータが表示されたら、 **[Manage template]\(テンプレートの管理\)** ドロップダウンで **[Auto-create template]\(テンプレートの自動作成\)** を選択します。

    :::image type="content" source="media/howto-set-up-template/infer-model-1.png" alt-text="未割り当てデバイスからの生データを示すスクリーンショット。":::

1. **[データのプレビュー]** ページ上で生データに必要な変更を行い、 **[テンプレートの作成]** を選択します。

    :::image type="content" source="media/howto-set-up-template/infer-model-2.png" alt-text="IoT Central がデバイス テンプレートの生成に使用するデータを編集できる、データのプレビューの変更を示すスクリーンショット。":::

1. **[データのプレビュー]** ページ上に表示されるデータ形式に基づいて、IoT Central によってテンプレートが生成され、そのテンプレートにデバイスが割り当てられます。 **[デバイス テンプレート]** ページ上で、名前の変更や機能の追加など、デバイス テンプレートをさらに変更することができます。

    :::image type="content" source="media/howto-set-up-template/infer-model-3.png" alt-text="自動生成されたデバイス テンプレートの名前を変更する方法を示すスクリーンショット。":::

## <a name="manage-a-device-template"></a>デバイス テンプレートを管理する

テンプレートの名前変更や削除は、テンプレートのエディター ページから行えます。

テンプレートを定義したら、それを発行することができます。 テンプレートを発行するまでは、テンプレートにデバイスを接続することはできず、また **[デバイス]** ページにもテンプレートは表示されません。

デバイス テンプレートの変更およびバージョン管理の詳細については、「[既存のデバイス テンプレートを編集する](howto-edit-device-template.md)」を参照してください。

## <a name="models"></a>モデル

モデルによって、お使いのデバイスと IoT Central アプリケーションの対話方法が定義されます。 機能を追加してモデルをカスタマイズしたり、機能を継承するためのインターフェイスや、他のインターフェイスに基づく新しいコンポーネントを追加したりできます。

デバイス モデルを作成するには、以下の手順を実行できます。

- IoT Central を使用して、最初からカスタム モデルを作成する。
- JSON ファイルから DTDL モデルをインポートする。 デバイス ビルダーが Visual Studio Code を使用して、アプリケーションのデバイス モデルを作成している場合があります。
- デバイス カタログからいずれかのデバイスを選択する。 このオプションでは、製造元がこのデバイスのために発行したデバイス モデルをインポートします。 このようにインポートされたデバイス モデルは、自動的に発行されます。

1. モデル ID を表示するには、モデル内でルート インターフェイスを選択し、 **[ID の編集]** を選択します。

    :::image type="content" source="media/howto-set-up-template/view-id.png" alt-text="デバイス テンプレートのルート インターフェイスのモデル ID を示すスクリーンショット。":::

1. コンポーネント ID を表示するには、モデル内の任意のコンポーネント インターフェイス上で **[ID の編集]** を選択します。

詳細については、「[IoT Plug and Play モデリング ガイド](../../iot-pnp/concepts-modeling-guide.md)」を参照してください。

### <a name="interfaces-and-components"></a>インターフェイスとコンポーネント

お使いのデバイス モデル内のインターフェイスを表示および管理するには:

1. **[デバイス テンプレート]** ページに移動し、作成したデバイス テンプレートを選択します。 インターフェイスは、デバイス テンプレートの **[モデル]** セクション内に一覧表示されます。 次のスクリーンショットは、デバイス テンプレート内の **Sensor Controller** ルート インターフェイスの例です。

    :::image type="content" source="media/howto-set-up-template/device-template.png" alt-text="モデルのルート インターフェイスを示すスクリーンショット"::: 

1. 省略記号を選択して、継承インターフェイスまたはコンポーネントをルート インターフェイスに追加します。 インターフェイスとコンポーネントの詳細については、モデリング ガイド内の「[複数のコンポーネント](../../iot-pnp/concepts-modeling-guide.md#multiple-components)」を参照してください。

    :::image type="content" source="media/howto-set-up-template/add-interface.png" alt-text="インターフェイスまたはコンポーネントを追加する方法":::

1. モデルまたはインターフェイスをエクスポートするには、 **[エクスポート]** を選択します。

1. インターフェイスまたは機能の DTDL を表示または編集するには、 **[Edit DTDL]\(DTDL の編集\)** を選択します。

### <a name="capabilities"></a>機能

機能をインターフェイスまたはコンポーネントに追加するには、 **[+ 機能の追加]** を選択します。 たとえば、 **[Target Temperature]\(目標温度\)** 機能を **SensorTemp** コンポーネントに追加することができます。

:::image type="content" source="media/howto-set-up-template/add-capability.png" alt-text="機能を追加する方法":::

#### <a name="telemetry"></a>テレメトリ

テレメトリは、デバイスから (通常はセンサーから) 送信される値のストリームです。 たとえば、次に示すように、センサーから気温が報告される場合があります。

:::image type="content" source="media/howto-set-up-template/telemetry.png" alt-text="テレメトリを追加する方法":::

テレメトリ機能の構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
| 表示名 | ビューとフォームで使用されるテレメトリ値の表示名。 |
| 名前 | テレメトリ メッセージ内のフィールドの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 このフィールドは英数字である必要があります。 |
| 機能の種類 | テレメトリ。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | テレメトリのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 スキーマは、イベントおよび状態のセマンティックの種類には使用できません。 |
| 重大度 | イベントのセマンティックの種類にのみ使用できます。 重大度は、**エラー**、**情報**、または **警告** です。 |
| 状態の値 | 状態のセマンティックの種類にのみ使用できます。 考えられる状態の値を定義します。それぞれに表示名、名前、列挙型、および値があります。 |
| ユニット | テレメトリ値の単位 (**mph**、 **%** 、または **&deg;C** など)。 |
| 表示単位 | ビューとフォームで使用する表示単位。 |
| 解説 | テレメトリ機能に関するコメント。 |
| 説明 | テレメトリ機能の説明。 |

#### <a name="properties"></a>Properties

プロパティは、特定の時点の値を表します。 IoT Central から、書き込み可能なプロパティを設定できます。
たとえば、デバイスは書き込み可能なプロパティを使用して、次に示すように、オペレーターに目標温度を設定させることができます。

:::image type="content" source="media/howto-set-up-template/property.png" alt-text="プロパティを追加する方法":::

プロパティ機能の構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
| 表示名 | ビューとフォームで使用されるプロパティ値の表示名。 |
| 名前 | プロパティの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 このフィールドは英数字である必要があります。 |
| 機能の種類 | プロパティ。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | プロパティのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 スキーマは、イベントおよび状態のセマンティックの種類には使用できません。 |
| 書き込み可能 | プロパティが書き込み可能でない場合、デバイスはプロパティ値を IoT Central に報告できます。 プロパティが書き込み可能な場合、デバイスはプロパティ値を IoT Central に報告し、IoT Central がプロパティの更新をデバイスに送信できます。
| 重大度 | イベントのセマンティックの種類にのみ使用できます。 重大度は、**エラー**、**情報**、または **警告** です。 |
| 状態の値 | 状態のセマンティックの種類にのみ使用できます。 考えられる状態の値を定義します。それぞれに表示名、名前、列挙型、および値があります。 |
| ユニット | プロパティ値の単位 (**mph**、 **%** 、または **&deg;C** など)。 |
| 表示単位 | ビューとフォームで使用する表示単位。 |
| 解説 | プロパティ機能に関するコメント。 |
| 説明 | プロパティ機能の説明。 |

#### <a name="commands"></a>コマンド

IoT Central からデバイス コマンドを呼び出すことができます。 コマンドは、必要に応じて、デバイスにパラメーターを渡し、デバイスから応答を受け取ります。 たとえば、以下に示すように、10 秒でデバイスを再起動するコマンドを呼び出すことができます。

:::image type="content" source="media/howto-set-up-template/command.png" alt-text="コマンドを追加する方法":::

コマンド機能の構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
| 表示名 | ビューとフォームで使用されるコマンドの表示名。 |
| 名前 | コマンドの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 このフィールドは英数字である必要があります。 |
| 機能の種類 | コマンド。 |
| オフラインの場合にキューに入れる | 有効にした場合、デバイスがオフラインになっていてもコマンドを呼び出すことができます。 有効になっていない場合、コマンドを呼び出すことができるのは、デバイスがオフラインのときに限られます。 |
| 解説 | コマンド機能に関するコメント。 |
| 説明 | コマンド機能の説明。 |
| Request | 有効になっている場合、名前、表示名、スキーマ、単位、および表示単位を含む要求パラメーターの定義。 |
| Response | 有効になっている場合、名前、表示名、スキーマ、単位、および表示単位を含むコマンド応答の定義。 |

デバイスでコマンドを実装する方法の詳細については、[「テレメトリ、プロパティ、およびコマンドペイロード」の「コマンド」および「実行時間の長いコマンド」](concepts-telemetry-properties-commands.md#commands)を参照してください。

#### <a name="offline-commands"></a>オフライン コマンド

デバイス テンプレートでコマンドの **[Queue if offline]\(オフラインの場合にキュー\)** オプションを有効にすることで、デバイスが現在オフラインになっている場合にキュー コマンドを選択できます。

:::image type="content" source="media/howto-set-up-template/offline-commands.png" alt-text="オフライン コマンドを追加する方法":::

このオプションによって、IoT Hub cloud-to-device メッセージが使用され、通知がデバイスに送信されます。 詳細については、[cloud-to-device メッセージの送信](../../iot-hub/iot-hub-devguide-messages-c2d.md)に関する IoT Hub 記事を参照してください。

cloud-to-device メッセージ:

- ご利用のソリューションからデバイスへの一方向通知です。
- 少なくとも 1 回のメッセージ配信が保証されます。 IoT Hub によって cloud-to-device メッセージはデバイス別キューに保持されます。接続とデバイスの障害に対する回復性が保証されます。
- cloud-to-device メッセージを処理するため、メッセージ ハンドラーを実装することがデバイスに求められます。

> [!NOTE]
> このオプションは、IoT Central Web UI でのみ使用できます。 この設定は、デバイス テンプレートからモデルまたはコンポーネントをエクスポートする場合は含まれません。

## <a name="cloud-properties"></a>クラウド プロパティ

クラウド プロパティを使用して、デバイスに関する情報を IoT Central に格納します。 クラウド プロパティがデバイスに送信されることはありません。 たとえば、クラウド プロパティを使用して、デバイスをインストールした顧客の名前、またはデバイスの前回の点検日を格納できます。

:::image type="content" source="media/howto-set-up-template/cloud-properties.png" alt-text="クラウド プロパティを追加する方法"::: 

クラウド プロパティの構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
| 表示名 | ビューとフォームで使用されるクラウド プロパティ値の表示名。 |
| 名前 | クラウド プロパティの名前。 IoT Central によって表示名からこのフィールドの値が生成されますが、必要に応じて独自の値を選択できます。 |
| セマンティックの種類 | テレメトリのセマンティックの種類 (温度、状態、イベントなど)。 セマンティックの種類の選択によって、次のどのフィールドを使用できるかが決まります。 |
| スキーマ | クラウド プロパティのデータ型 (double、string、vector など)。 使用できる選択肢は、セマンティックの種類によって決まります。 |

## <a name="customizations"></a>カスタマイズ

インポートしたコンポーネントを変更したり、機能に IoT Central 固有の機能を追加したりする必要がある場合は、カスタマイズを利用します。 たとえば、以下に示すように、プロパティの表示名と単位を変更できます。

:::image type="content" source="media/howto-set-up-template/customize.png" alt-text="カスタマイズを行う方法":::

カスタマイズの構成設定を次の表に示します。

| フィールド | 説明 |
| ----- | ----------- |
|表示名 | モデルから表示名をオーバーライド。 |
|セマンティックの種類 | モデルからセマンティックの種類をオーバーライド。 |
|単位 | モデルから単位をオーバーライド。 |
|表示単位 | モデルからオーバーライド。 |
|解説 | モデルからオーバーライド。 |
|説明 | モデルからオーバーライド。 |
|Color | IoT Central 固有のオプション。 |
|最小値 | 最小値を設定 - IoT Central 固有のオプション。 |
|最大値 | 最大値を設定 - IoT Central 固有のオプション。 |
|小数点以下の桁数 | IoT Central 固有のオプション。 |
|初期値 | コマンドのみの IoT Central 固有の値 - 既定のパラメーター値。 |

## <a name="views"></a>Views

ビューを使用すると、オペレーターがデバイスを監視および操作できるビューとフォームを定義することができます。 ビューでは、グラフなどの視覚化を使用して、テレメトリ値とプロパティ値が表示されます。

既定のビューを生成すると、重要なデバイス情報をすばやく視覚化することができます。 3 つの既定のビューは次のとおりです。

### <a name="default-views"></a>既定のビュー

- **コマンド**:デバイス コマンドを含むビューを提供し、オペレーターがデバイスにコマンドをディスパッチできるようにします。
- **概要**:デバイス テレメトリを含むビューを提供し、グラフとメトリックを表示します。
- **詳細情報**:デバイス情報を含むビューを提供し、デバイス プロパティを表示します。

**[既定のビューの生成]** を選択すると、デバイス テンプレートの **[ビュー]** セクションにそれらが自動的に追加されます。

### <a name="custom-views"></a>カスタム ビュー

ビューをデバイス テンプレートに追加して、オペレーターがグラフとメトリックを使ってデバイスを視覚化できるようにします。 独自のカスタム ビューをデバイス テンプレートに追加することができます。

デバイス テンプレートにビューを追加するには:

1. デバイス テンプレートにアクセスし、 **[Views]\(ビュー\)** を選択します。
1. **[デバイスの視覚化]** を選択します。
1. **[ビュー名]** にビューの名前を入力します。
1. [タイルの追加] で **[Start with a visual]\(ビジュアルの使用を開始する\)** を選択し、ご自身のタイルのビジュアルの種類を選びます。 次に **[タイルの追加]** を選択し、ビジュアルをキャンバスにドラッグ アンド ドロップします。 タイルを構成するには、歯車アイコンを選択します。

:::image type="content" source="media/howto-set-up-template/start-visual.png" alt-text="ビジュアルの使用を開始する方法"::: 

:::image type="content" source="media/howto-set-up-template/tile.png" alt-text="タイルの構成"::: 

ビューをテストするには、 **[プレビュー デバイスの構成]** を選択します。 この機能により、発行後にオペレーターに対して表示されるビューを確認できます。 この機能は、ビューに正しいデータが表示されているかどうかを検証するために使用します。 次のオプションを選択します。

- プレビュー デバイスなし。
- デバイス テンプレート用に構成した実際のテスト デバイス。
- デバイス ID を使用した、アプリケーション内の既存のデバイス。

### <a name="forms"></a>フォーム

デバイス テンプレートにフォームを追加して、オペレーターがプロパティを表示および設定することによってデバイスを管理できるようにします。 オペレーターが編集できるのは、クラウド プロパティと書き込み可能なデバイス プロパティのみです。 1 つのデバイス テンプレートに対して複数のフォームを持つことができます。

1. **[ビュー]** ノードを選択し、 **[デバイスとクラウドのデータの編集]** タイルを選択して新しいビューを追加します。

1. フォーム名を「**デバイスの管理**」に変更します。

1. **[顧客名]** および **[Last Service Date]\(前回点検日\)** クラウド プロパティと、 **[Target Temperature]\(目標温度\)** プロパティを選択します。 次に、 **[セクションの追加]** を選択します。

1. **[保存]** を選択して新しいフォームを保存します。

:::image type="content" source="media/howto-set-up-template/form.png" alt-text="フォームの構成":::

## <a name="publish-a-device-template"></a>デバイス テンプレートを発行する

デバイス モデルを実装するデバイスを接続する前に、デバイス テンプレートを発行する必要があります。

デバイス テンプレートを発行するには、デバイス テンプレートにアクセスし、 **[Publish]\(発行\)** を選択します。

デバイス テンプレートを発行すると、オペレーターは **[Devices]\(デバイス\)** ページに移動して、デバイス テンプレートを使用する実際のデバイスまたはシミュレートされたデバイスを追加できます。 変更を行っている間は、引き続きデバイス テンプレートを変更して保存できます。 これらの変更をオペレーターにプッシュして、 **[Devices]\(デバイス\)** ページで表示する場合は、毎回、 **[Publish]\(発行\)** を選択する必要があります。

## <a name="next-steps"></a>次のステップ

この後は、[既存のデバイス テンプレートに変更を加える](howto-edit-device-template.md)方法についての記事を読むことをお勧めします。
