---
title: Azure IoT Central アプリケーションでデバイス を作成して実行する | Microsoft Docs
description: Azure IoT Central のジョブを使用すると、プロパティの更新やコマンドの実行などの一括デバイス管理機能を行うことができます。
ms.service: iot-central
services: iot-central
author: dominicbetts
ms.author: dobett
ms.date: 07/08/2021
ms.topic: how-to
ms.openlocfilehash: c24eac9d7446f983bd4dc1e8573d3c831c7ff7fb
ms.sourcegitcommit: 7d63ce88bfe8188b1ae70c3d006a29068d066287
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/22/2021
ms.locfileid: "114442720"
---
# <a name="manage-devices-in-bulk-in-your-azure-iot-central-application"></a>Azure IoT Central アプリケーションでデバイスを一括管理する

Azure IoT Central を使い、接続されている大量のデバイスを、ジョブを通して管理できます。 ジョブを使用すると、デバイスおよびクラウドのプロパティを一括更新してコマンドを実行することができます。 CSV ファイルを使用して、デバイスを一括でインポートおよびエクスポートすることもできます。 この記事では、自分のアプリケーションでジョブを使い始める方法と、インポートとエクスポートの機能の使用方法について説明します。

## <a name="create-and-run-a-job"></a>ジョブの作成と実行

次の例では、ロジスティック ゲートウェイ デバイスのグループに対してライトしきい値を設定するジョブを作成および実行する方法について説明します。 ジョブを作成して実行するには、ジョブ ウィザードを使用します。 後で実行するジョブを保存できます。

1. 左側のペインで、 **[ジョブ]** を選択します。

1. **[+ 新しいジョブ]** を選択します。

1. **[ジョブの構成]** ページで、作成するジョブを識別するための名前と説明を入力します。

1. ジョブを適用するターゲットのデバイス グループを選択します。 ジョブ構成が適用されるデバイスの数は、 **[デバイス グループ]** セクションの下で確認できます。

1. **[ジョブの種類]** として、 **[クラウド プロパティ]** 、 **[プロパティ]** 、または **[コマンド]** を選択します。

    **プロパティ** ジョブを構成するには、プロパティを選択し、その新しい値を設定します。 **コマンド** ジョブを構成するには、実行するコマンドを選択します。 プロパティ ジョブによって、複数のプロパティを設定できます。

    :::image type="content" source="media/howto-manage-devices-in-bulk/configure-job.png" alt-text="Set Light Threshold というプロパティ ジョブを作成するための選択を示すスクリーンショット":::

    **[保存して終了]** を選択し、 **[ジョブ]** ページの保存されているジョブの一覧にジョブを追加 ます。 後から、保存されているジョブの一覧からジョブに戻ることができます。

1. **[次へ]** を選択して、 **[配信オプション]** ページに移動します。 **[配信オプション]** ページでは、このジョブの配信オプションを設定できます。 **[バッチ]** および **[Cancellation threshold]\(キャンセルしきい値\)** 。

    バッチを使用すると、多数のデバイスに対してジョブを分散させることができます。 ジョブは複数のバッチに分割され、各バッチにはデバイスのサブセットが含まれます。 バッチはキューに入れられ、順番に実行されます。

    キャンセルしきい値を使用すると、エラーの数が設定した制限を超えた場合に、ジョブを自動的にキャンセルできます。 しきい値は、ジョブ内のすべてのデバイス、または個々のバッチに適用できます。

    :::image type="content" source="media/howto-manage-devices-in-bulk/job-wizard-delivery-options.png" alt-text="ジョブ ウィザードの [配信オプション] ページのスクリーンショット":::

1. **[次へ]** を選択して、 **[スケジュール]** ページに移動します。 **[スケジュール]** ページでは、今後のジョブを実行するスケジュールを有効にすることができます。

    スケジュールの繰り返しオプションを選択します。 次の頻度で実行するようにジョブを設定できます。

    * 1 回限り
    * 毎日
    * 週単位

    スケジュールされたジョブの開始日時を設定します。 日付と時刻は、デバイスのローカル時刻ではなく、タイム ゾーンに固有のものです。

    定期的なスケジュールを終わらせるには、次のように選択します。

    * **[On this day]\(この日\)** を選択すると、スケジュールの終了日が設定されます。
    * **[After]\(反復回数\)** を選択すると、ジョブを実行する回数が設定されます。

    スケジュールされたジョブは常に、時間の経過と共にデバイス グループのメンバーシップに変化があっても、そのデバイス グループのデバイスに対して実行されます。

    :::image type="content" source="media/howto-manage-devices-in-bulk/job-wizard-schedule.png" alt-text="ジョブ ウィザードのスケジュール オプション ページのスクリーンショット":::

1. **[次へ]** を選択して、 **[レビュー]** ページに移動します。 **[レビュー]** ページには、ジョブ構成の詳細が表示されます。 **[スケジュール]** を選択し、ジョブの日程を計画します。

    :::image type="content" source="media/howto-manage-devices-in-bulk/job-wizard-schedule-review.png" alt-text="スケジュール ジョブ ウィザードの [レビュー] ページのスクリーンショット":::

1. ジョブの詳細ページには、スケジュールされたジョブに関する情報が表示されます。 スケジュールされたジョブが実行されると、ジョブ インスタンスの一覧が表示されます。 スケジュールされたジョブの実行は、**過去 30 日間** のジョブ一覧にも含まれます。

    このページでは、ジョブの **スケジュールを解除** したり、スケジュール済みのジョブを **編集** したりできます。 スケジュール済みジョブの一覧からスケジュール済みジョブに戻ることができます。

    :::image type="content" source="media/howto-manage-devices-in-bulk/job-schedule-details.png" alt-text="スケジュールされたジョブの詳細ページのスクリーンショット":::

1. ジョブ ウィザードで、ジョブの日程を計画せず、直接実行することを選択できます。 次のスクリーンショットからは、すぐに実行する準備ができた、スケジュールのないジョブを確認できます。 **[実行]** を選択してジョブを実行します。

    :::image type="content" source="media/howto-manage-devices-in-bulk/job-wizard-schedule-immediate.png" alt-text="ジョブ ウィザードの [レビュー] ページのスクリーンショット":::

1. ジョブは、*保留中*、*実行中*、*完了* のフェーズを通過します。 ジョブ実行の詳細には、結果メトリック、期間の詳細、デバイス一覧グリッドが含まれています。

    ジョブが完了すると、 **[結果のログ]** を選択して、デバイスやその状態の値など、ジョブの詳細の CSV ファイルをダウンロードすることができます。 この情報は、トラブルシューティングに役立つことがあります。

    :::image type="content" source="media/howto-manage-devices-in-bulk/download-details.png" alt-text="デバイスの状態を示すスクリーンショット":::

1. これで、 **[ジョブ]** ページの **[過去30日間]** の一覧にジョブが表示されるようになります。 このページには、現在実行中のジョブと以前実行または保存したジョブの履歴が表示されます。

    > [!NOTE]
    > 以前に実行したジョブの 30 日間の履歴を表示できます。

## <a name="manage-jobs"></a>ジョブの管理

実行中のジョブを停止するには、ジョブを開いて **[停止]** を選択します。 ジョブが停止されたことを反映するように、ジョブの状態が変更されます。 **[概要]** セクションには、完了、失敗、または保留中のデバイスが表示されます。

:::image type="content" source="media/howto-manage-devices-in-bulk/manage-job.png" alt-text="実行中のジョブと、ジョブを停止するためのボタンを示すスクリーンショット":::

ジョブが停止状態になったら、 **[続行]** を選択してジョブの実行を再開することができます。 ジョブが再び実行されるようになったことを反映して、ジョブの状態が変更されます。 **概要** セクションは、引き続き最新の進行状況で更新されます。

:::image type="content" source="media/howto-manage-devices-in-bulk/stopped-job.png" alt-text="停止されているジョブとジョブを続行するためのボタンを示すスクリーンショット":::

## <a name="copy-a-job"></a>ジョブをコピーする

既存のジョブをコピーするには、実行されたジョブを選択します。 [ジョブの結果] ページまたは [ジョブの詳細] ページで **[コピー]** を選択します。

:::image type="content" source="media/howto-manage-devices-in-bulk/job-details-copy.png" alt-text="[コピー] ボタンを示すスクリーン ショット":::

ジョブ構成のコピーが開き、編集することができます。また **コピー** がジョブ名に追加されます。

## <a name="view-job-status"></a>ジョブの状態を見る

ジョブが作成されたら、 **[状態]** 列は、最新のジョブ ステータス メッセージで更新されます。 可能な *ジョブの状態* の値を次の表に示します。

| ステータス メッセージ       | ステータスの意味                                          |
| -------------------- | ------------------------------------------------------- |
| 完了            | このジョブはすべてのデバイスで実行されました。              |
| 失敗               | このジョブは失敗し、デバイスで完全には実行されませんでした。  |
| 保留中              | このジョブはデバイスでまだ実行が開始されていません。         |
| 実行中              | このジョブはデバイスで現在実行中です。             |
| 停止済み              | ユーザーがこのジョブを手動で停止しました。           |
| Canceled             | このジョブは、 **[配信オプション]** ページで設定されたしきい値を超えたため、キャンセルされました。 |

ステータス メッセージには、ジョブ内のデバイスの概要が続きます。 可能な *デバイスの状態* の値を次の表に示します。

| ステータス メッセージ       | ステータスの意味                                                     |
| -------------------- | ------------------------------------------------------------------ |
| 成功            | ジョブが正常に実行されたデバイスの数。       |
| 失敗               | ジョブの実行が失敗したデバイスの数。       |

ジョブの状態と影響を受けるすべてのデバイスを表示するには、ジョブを開きます。 各デバイス名の隣に、次のステータス メッセージのいずれかが表示されます。

| ステータス メッセージ       | ステータスの意味                                                                |
| -------------------- | ----------------------------------------------------------------------------- |
| 完了            | このデバイスでジョブが実行されました。                                     |
| 失敗               | このデバイスでジョブの実行が失敗しました。 エラー メッセージに詳細情報が表示されます。  |
| 保留中              | このデバイスではジョブがまだ実行されていません。                                   |

ジョブの詳細やデバイスの一覧やその状態の値などを含む CSV ファイルをダウンロードするには、 **[結果のログ]** を選択します。

## <a name="filter-the-device-list"></a>デバイス一覧のフィルター処理

**[ジョブの詳細]** ページでフィルター アイコンを選択すると、デバイスの一覧をフィルター処理できます。 **[デバイス ID]** または **[状態]** フィールドでフィルター処理できます。

:::image type="content" source="media/howto-manage-devices-in-bulk/filter.png" alt-text="デバイス一覧のフィルター処理の選択を示すスクリーンショット。":::

## <a name="customize-columns-in-the-device-list"></a>デバイス一覧の列をカスタマイズする

列のオプション アイコンを選択して、デバイスの一覧に列を追加できます。

:::image type="content" source="media/howto-manage-devices-in-bulk/column-options.png" alt-text="列オプションのアイコンを示すスクリーンショット。":::

**[列のオプション]** ダイアログ ボックスを使用して、デバイスの一覧の列を選択します。 表示する列を選択し、右矢印を選択して、 **[OK]** を選択します。 使用できるすべての列を選択するには、 **[すべて選択]** を選択します。 選択した列が、デバイス一覧に表示されます。

選択した列は、ユーザー セッション全体、またはアプリケーションにアクセスできるユーザー セッション間で保持されます。

## <a name="rerun-jobs"></a>ジョブの再実行

失敗したデバイスを含むジョブは再実行することができます。 **[失敗したら再実行]** を選択します。

:::image type="content" source="media/howto-manage-devices-in-bulk/rerun.png" alt-text="失敗したデバイスでジョブを再実行するためのボタンを示すスクリーンショット。":::

ジョブの名前と説明を入力して、 **[ジョブの再実行]** を選択します。 失敗したデバイスで操作を再試行する新しいジョブが送信されます。

> [!NOTE]
> Azure IoT Central アプリケーションから 5 つより多くのジョブを同時に実行することはできません。
>
> ジョブが完了し、ジョブのデバイス一覧にあるデバイスを削除すると、デバイス エントリでデバイス名に削除済みと表示されます。 削除されたデバイスでは、詳細リンクを利用できません。

## <a name="import-devices"></a>デバイスのインポート

アプリケーションに多数のデバイスを接続する場合は、CSV ファイルからデバイスを一括してインポートできます。 CSV ファイルの例については、[Azure サンプル リポジトリ](https://github.com/Azure-Samples/iot-central-docs-samples/tree/master/bulk-upload-devices)を参照してください。 CSV ファイルには、次の列ヘッダーが含まれている必要があります。

| 列 | 説明 |
| - | - |
| IOTC_DEVICEID | デバイス ID は、このデバイスの接続に使用される一意識別子です。 デバイス ID には、文字、数字、および `-` 文字を含めることができます (スペースなし)。 最大長は 128 文字です。 |
| IOTC_DEVICENAME | 省略可能。 デバイス名は、アプリケーション全体に表示されるフレンドリ名です。 指定しない場合、デバイス ID と同じになります。 最大長は 148 文字です。 |

アプリケーションにデバイスを一括登録する方法:

1. 左側のウィンドウで **[デバイス]** を選択します。

1. 左側のパネルで一括作成するデバイスのデバイス テンプレートを選択します。

    > [!NOTE]
    > まだデバイス テンプレートがない場合は、 **[すべてのデバイス]** からデバイスをインポートし、テンプレートなしでそれらを登録することができます。 デバイスがインポートされた後に、それらをテンプレートに移行できます。

1. **[インポート]** を選択します。

    :::image type="content" source="media/howto-manage-devices-in-bulk/bulk-import-1.png" alt-text="インポート アクションの設定を示すスクリーンショット。":::

1. インポートするデバイス ID の一覧を含む CSV ファイルを選択します。

1. ファイルがアップロードされると、デバイスのインポートが開始されます。 インポートの状態は、[Device Operations]\(デバイスの操作\) パネルで追跡できます。 このパネルはインポートの開始後に自動的に表示されます。または、右上隅のベルのアイコンを使用してアクセスすることもできます。

1. インポートが完了すると、[Device Operations]\(デバイスの操作\) パネルに成功メッセージが表示されます。

    :::image type="content" source="media/howto-manage-devices-in-bulk/bulk-import-2.png" alt-text="インポートの成功を示すスクリーンショット。":::

デバイスのインポート操作が失敗した場合は、[Device Operations]\(デバイスの操作\) パネルにエラー メッセージが表示されます。 すべてのエラーをキャプチャしたログ ファイルが生成されており、ダウンロードできます。

## <a name="export-devices"></a>デバイスのエクスポート

実際のデバイスを IoT Central に接続するには、その接続文字列が必要です。 デバイスの詳細を一括エクスポートして、デバイスの接続文字列を作成するために必要な情報を取得することができます。 エクスポート プロセスでは、選択したすべてのデバイスのデバイス ID、デバイス名、キーを含む CSV ファイルが作成されます。

アプリからデバイスを一括でエクスポートするには:

1. 左側のウィンドウで **[デバイス]** を選択します。

1. 左側のペインで、デバイスをエクスポートするデバイス テンプレートを選択します。

1. エクスポートするデバイスを選択して、 **[エクスポート]** アクションを選択します。

    :::image type="content" source="media/howto-manage-devices-in-bulk/export-1.png" alt-text="エクスポート アクションの設定を示すスクリーンショット。":::

1. エクスポート プロセスが開始します。 状態は、[Device Operations]\(デバイスの操作\) パネルを使用して追跡できます。

1. エクスポートが完了すると、生成されたファイルをダウンロードするリンクと共に成功メッセージが表示されます。

1. **[ファイルのダウンロード]** リンクを選択して、ディスク上のローカル フォルダーにファイルをダウンロードします。

    ![エクスポート - 成功](./media/howto-manage-devices-in-bulk/export-2.png)

1. エクスポートされた CSV ファイルには、デバイス ID、デバイス名、デバイス キー、および X509 証明書拇印の列が含まれています。

    * IOTC_DEVICEID
    * IOTC_DEVICENAME
    * IOTC_SASKEY_PRIMARY
    * IOTC_SASKEY_SECONDARY
    * IOTC_X509THUMBPRINT_PRIMARY
    * IOTC_X509THUMBPRINT_SECONDARY

実際のデバイスを IoT Central アプリケーションに接続する方法の詳細については、「[Azure IoT Central のデバイス接続機能](concepts-get-connected.md)」を参照してください。

## <a name="next-steps"></a>次のステップ

ここでは、Azure IoT Central アプリケーションでデバイスを一括管理する方法について説明しました。お勧めする次のステップは、[デバイス テンプレートを編集](howto-edit-device-template.md)する方法の学習です。
