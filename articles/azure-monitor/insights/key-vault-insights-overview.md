---
title: Key Vault 分析情報でキー コンテナーを監視する | Microsoft Docs
description: この記事では、Key Vault 分析情報について説明します。
services: azure-monitor
ms.topic: conceptual
ms.date: 09/10/2020
ms.openlocfilehash: 0ad400ffcb892c09d6f746c482c9cb78c5627075
ms.sourcegitcommit: 147910fb817d93e0e53a36bb8d476207a2dd9e5e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/18/2021
ms.locfileid: "130131868"
---
# <a name="monitoring-your-key-vault-service-with-key-vault-insights"></a>Key Vault 分析情報を使用したキー コンテナー サービスの監視
Key Vault 分析情報ではキー コンテナーの要求、パフォーマンス、エラー、待機時間の統合ビューにより、キー コンテナーの包括的な監視が提供されます。
この記事では、Key Vault 分析情報のエクスペリエンスをオンボードおよびカスタマイズする方法について説明します。

## <a name="introduction-to-key-vault-insights"></a>Key Vault 分析情報の概要

エクスペリエンスについて見ていく前に、情報が提供および視覚化される方法を理解する必要があります。
-    **大規模な分析観点**: 要求、エラーの内訳、および操作と待機時間の概要に基づいて、パフォーマンスのスナップショット ビューを表示します。
-   **ドリルダウン分析**: 特定のキー コンテナーの詳細な分析を実行します。
-    **カスタマイズ可能**: 表示するメトリックの変更したり、制限に合わせたしきい値の変更または設定、独自のブックとして保存することができます。 ブック内のグラフは、Azure ダッシュボードにピン留めできます。

Key Vault 分析情報では、ログとメトリックを組み合わせて、グローバルな監視ソリューションを提供します。 すべてのユーザーがメトリックベースの監視データにアクセスできますが、ログベースの視覚化を含めた場合、ユーザーは [Azure Key Vault のログ記録を有効](../../key-vault/general/logging.md)にする必要があります。

## <a name="view-from-azure-monitor"></a>Azure Monitor から表示する

Azure Monitor では、ご利用のサブスクリプション内の複数のキー コンテナーの要求、待機時間、エラーの詳細を表示でき、パフォーマンスの問題やスロットリング シナリオを特定するのに役立ちます。

所有するすべてのサブスクリプションのキー コンテナーの使用状況と操作を確認するには、次の手順を実行します。

1. [Azure Portal](https://portal.azure.com/) にサインインします。

2. Azure portal の左側のペインで **[モニター]** を選択し、[分析情報] セクションの **[キー コンテナー]** を選択します。

![複数のグラフを伴う概要エクスペリエンスのスクリーンショット](./media/key-vaults-insights-overview/overview.png)

## <a name="overview-workbook"></a>[概要] ブック

選択したサブスクリプションの [概要] ブックでは、サブスクリプション内でグループ化されているキー コンテナーの対話型キー コンテナー メトリックがテーブルに表示されます。 次のドロップダウン リストから選択するオプションに基づいて、結果をフィルター処理できます。

* [サブスクリプション] - ストレージ アカウントを持つサブスクリプションのみが表示されます。

* [キー コンテナー] - 既定では、最大 5 つのキー コンテナーのみが事前に選択されています。 スコープ セレクターですべてまたは複数のキー コンテナーを選択すると、最大 200 個のキー コンテナーが返されます。 たとえば、選択した 3 つのサブスクリプションに全部で 573 個のキー コンテナーがある場合は、200 個のコンテナーのみが表示されます。

* [時間の範囲] - 既定では、選択結果に応じて過去 24 時間の情報が表示されます。

ドロップダウン リストのカウンター タイルには、サブスクリプション内のキー コンテナーの総数がロールアップされ、選択した数が反映されます。 要求、エラー、待機時間のメトリックを報告するブックの列には、条件に基づいて色分けされたヒートマップがあります。 最も濃い色は最大値で、薄い色は最小値に基づいています。

## <a name="failures-workbook"></a>[エラー] ブック

ページの上部にある **[エラー]** を選択すると、[エラー] タブが開きます。 ここには、API ヒット数、時間の経過に伴う頻度のほか、特定の応答コードの量が表示されます。

![[エラー] ブックのスクリーンショット](./media/key-vaults-insights-overview/failures.png)

ブックの列には、条件に基づく色分け (ヒートマップ) が示され、API ヒット数のメトリックは青色の値で報告されます。 最も濃い色は最大値で、薄い色は最小値に基づいています。

ブックには、成功 (2xx 状態コード)、認証エラー (401/403 状態コード)、スロットリング (429 状態コード)、およびその他のエラー (4xx 状態コード) が表示されます。

各ステータス コードが表す意味について理解を深めるには、[Azure Key Vault の状態と応答コード](../../key-vault/general/authentication-requests-and-responses.md)に関するドキュメントを参照することをお勧めします。

## <a name="view-from-a-key-vault-resource"></a>Key Vault リソースからのビュー

キー コンテナーから直接 Key Vault 分析情報にアクセスするには、次の操作を実行します。

1. Azure portal で [キー コンテナー] を選択します。

2. 一覧からキー コンテナーを選択します。 [監視] セクションで、[分析情報] を選択します。

これらのビューには、Azure Monitor レベルのブックからキー コンテナーのリソース名を選択してアクセスすることもできます。

![キー コンテナー リソースからのビューのスクリーンショット](./media/key-vaults-insights-overview/key-vault-resource-view.png)

キー コンテナーの **[概要]** ブックには、複数のパフォーマンス メトリックが表示され、次の情報をすばやく評価するのに役立ちます。

- 対話型のパフォーマンス グラフ。キー コンテナーのトランザクション、待機時間、および可用性に関連する最も重要な詳細情報が示されます。

- メトリック タイルと状態タイル。サービスの可用性、キー コンテナー リソースに対するトランザクションの合計数、および全体の待機時間が明示されます。

**[エラー]** または **[操作]** の他のタブのいずれかを選択すると、それぞれのブックが開きます。

![[エラー] ビューのスクリーンショット](./media/key-vaults-insights-overview/resource-failures.png)

[エラー] ブックでは、選択された期間内のすべてのキー コンテナー要求の結果が分析され、成功 (2xx)、認証エラー (401/403)、スロットリング (429)、およびその他のエラーに分類されます。

![[操作] ビューのスクリーンショット](./media/key-vaults-insights-overview/operations.png)

[操作] ブックでは、ユーザーは、すべてのトランザクションの詳細を詳しく調べることができ、最上位レベルのタイルを使用して結果の状態でフィルター処理できます。

![すべてのトランザクションの完全な詳細を含む操作ブックを示すスクリーンショット。](./media/key-vaults-insights-overview/info.png)

ユーザーはまた、上部のテーブルで特定のトランザクションの種類に基づいてビューを詳しく調べることもできます。この上部のテーブルに従って下部のテーブルは動的に更新され、ユーザーはこのテーブルのポップアップ コンテキスト ウィンドウで操作の完全な詳細を確認できます。

>[!NOTE]
> このブックを表示するには、診断設定を有効にしている必要があることに注意してください。 診断設定の有効化の詳細については、「[Azure Key Vault のログ記録](../../key-vault/general/logging.md)」をご覧ください。

## <a name="pin-and-export"></a>ピン留めとエクスポート

セクションの右上にある画びょうアイコンを選択すると、メトリックのどのセクションでも Azure ダッシュボードにピン留めできます。

複数サブスクリプションおよびキー コンテナーの [概要] または [エラー] ブックでは、画びょうアイコンの左側にあるダウンロード アイコンを選択すると、結果を Excel 形式でエクスポートできます。

![ピン留めアイコンが選択されているスクリーンショット](./media/key-vaults-insights-overview/pin.png)

## <a name="customize-key-vault-insights"></a>Key Vault 分析情報をカスタマイズする

このセクションでは、データ分析のニーズに合わせてブックを編集してカスタマイズする一般的なシナリオについて説明します。
*  特定のサブスクリプションまたはキー コンテナーが常に選択されるようにブックのスコープを設定する
* グリッドでメトリックを変更する
* 要求のしきい値を変更する
* 色の表示を変更する

カスタマイズを開始するには、上部のツールバーの **[カスタマイズ]** ボタンを選択して編集モードを有効にします。

![[カスタマイズ] ボタンのスクリーンショット](./media/key-vaults-insights-overview/customize.png)

カスタマイズはカスタム ブックに保存されるため、発行されたブックで既定の構成が上書きされることはありません。 ブックは、リソース グループ内の、ユーザー個人の [個人用レポート] セクション、またはリソース グループにアクセスできるユーザーであればだれでもアクセスできる [共有レポート] セクションのいずれかに保存されます。 カスタム ブックを保存した後は、ブック ギャラリーに移動して起動する必要があります。

![ブック ギャラリーのスクリーンショット](./media/key-vaults-insights-overview/gallery.png)

### <a name="specifying-a-subscription-or-key-vault"></a>サブスクリプションまたはキー コンテナーの指定

複数サブスクリプションおよびキー コンテナーの [概要] または [エラー] ブックを、実行のたびに特定のサブスクリプションまたはキー コンテナーを対象とするように構成できます。次の手順を行います。

1. ポータルで **[モニター]** を選択し、左側のペインで **[キー コンテナー]** を選択します。
2. **[概要]** ブックで、コマンド バーから **[編集]** を選択します。
3. **[サブスクリプション]** ドロップダウン リストから、既定として使用するサブスクリプションを 1 つ以上選択します。 1 つのブックで、最大 10 個のサブスクリプションを選択できます。
4. **[キー コンテナー]** ドロップダウン リストから、既定として使用するアカウントを 1 つ以上選択します。 1 つのブックで、最大 200 個のストレージ アカウントを選択できます。
5. コマンド バーから **[名前を付けて保存]** を選択して、カスタマイズしたブックのコピーを保存した後、 **[編集完了]** をクリックして読み取りモードに戻ります。

## <a name="troubleshooting"></a>トラブルシューティング

一般的なトラブルシューティングのガイダンスについては、専用のブックベースの分析情報の[トラブルシューティングに関する記事](troubleshoot-workbooks.md)を参照してください。

このセクションは、Key Vault 分析情報を使用するときに発生する可能性があるいくつかの一般的な問題を診断し、トラブルシューティングするのに役立ちます。 以下のリストを使用して、特定の問題に関連する情報を見つけてください。

### <a name="resolving-performance-issues-or-failures"></a>パフォーマンスの問題またはエラーの解決

Key Vault 分析情報で特定されたキー コンテナー関連の問題のトラブルシューティングについては、[Azure Key Vault のドキュメント](../../key-vault/index.yml)を参照してください。

### <a name="why-can-i-only-see-200-key-vaults"></a>200 個のキー コンテナーしか表示できないのはなぜですか

選択して表示できるキー コンテナーには 200 の制限があります。 選択されているサブスクリプションの数には関係なく、選択されるキー コンテナーの数には 200 の制限があります。

### <a name="why-dont-i-see-all-my-subscriptions-in-the-subscription-picker"></a>サブスクリプション ピッカーに自分のすべてのサブスクリプションが表示されないのはなぜですか

選択したサブスクリプション フィルターから選択されたキー コンテナーを含むサブスクリプションのみが表示されます。このフィルターは、Azure portal ヘッダーの [ディレクトリ + サブスクリプション] で選択されています。

![サブスクリプション フィルターのスクリーンショット](./media/key-vaults-insights-overview/Subscriptions.png)

### <a name="i-want-to-make-changes-or-add-additional-visualizations-to-key-vault-insights-how-do-i-do-so"></a>Key Vault 分析情報に変更を加えたり、視覚化を追加したりするには、どうすればよいですか

変更するには、[編集モード] を選択してブックを変更し、指定したサブスクリプションとリソース グループに関連付けられている新しいブックとして作業内容を保存します。

### <a name="what-is-the-time-grain-once-we-pin-any-part-of-the-workbooks"></a>ブックのある部分をピン留めした後の時間グレインはどれだけですか

[自動] 時間グレインを使用しているので、選択されている時間範囲によって異なります。

### <a name="what-is-the-time-range-when-any-part-of-the-workbook-is-pinned"></a>ブックのある部分をピン留めしたときの時間範囲はどうなりますか

時間範囲は、ダッシュボードの設定によって異なります。

### <a name="what-if-i-want-to-see-other-data-or-make-my-own-visualizations-how-can-i-make-changes-to-the-key-vault-insights"></a>他のデータを表示したり、独自の視覚化を作成したりするにはどうすればよいですか。 Key Vault 分析情報に変更を加えるにはどうすればよいですか

編集モードを使用して既存のブックを編集し、新しい変更をすべて反映した新しいブックとして作業内容を保存できます。

## <a name="next-steps"></a>次のステップ

ブックがサポートするように設計されているシナリオ、新規レポートの作成方法と既存レポートのカスタマイズ方法などについては、「[Azure Monitor ブックを使用した対話型レポートの作成](../visualize/workbooks-overview.md)」で学習してください。
