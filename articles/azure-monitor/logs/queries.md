---
title: Azure Monitor Log Analytics でのクエリの使用
description: クエリの種類や使用可能なサンプル クエリなどを含む、Azure Monitor Log Analytics のログ クエリの概要について説明します。
ms.subservice: logs
ms.topic: article
author: bwren
ms.author: bwren
ms.date: 05/20/2021
ms.openlocfilehash: 004196117512282ee960ed275dd970b472cde918
ms.sourcegitcommit: c2f0d789f971e11205df9b4b4647816da6856f5b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/23/2021
ms.locfileid: "122662319"
---
# <a name="using-queries-in-azure-monitor-log-analytics"></a>Azure Monitor Log Analytics でのクエリの使用
Log Analytics を開くと、既存のログ クエリにアクセスできます。 これらのクエリは、変更せずに実行することも、独自のクエリの出発点として使用することもできます。 使用可能なクエリには、Azure Monitor で提供される例や、組織が保存したクエリなどがあります。 この記事では、使用できるクエリと、それらを発見して使用する方法について説明します。


## <a name="queries-interface"></a>クエリ インターフェイス
Log Analytics の 2 つの異なる場所から使用できるクエリ インターフェイスからクエリを選択します。

### <a name="queries-dialog"></a>クエリ ダイアログ

Log Analytics を開くと、 *[クエリ]* ダイアログ ボックスが自動的に表示されます。 このダイアログ ボックスが自動的に表示されないようにするには、 **[常にクエリを表示する]** スイッチをオフにします。

![クエリ画面](media/queries/query-start.png)


各クエリはカードで表されます。 クエリにすばやく目を通して、必要なものを見つけることができます。 ダイアログからクエリを直接実行できるほか、変更を行うためにそれをクエリ エディターに読み込むこともできます。

画面の右上にある **[クエリ]** をクリックしてアクセスすることもできます。

[![[クエリ] ボタン](media/queries/queries-button.png)](media/queries/queries-button.png#lightbox)

### <a name="query-sidebar"></a>クエリのサイドバー

ダイアログ エクスペリエンスの同じ機能には、Log Analytics の左側のサイドバーにあるクエリ ウィンドウからアクセスできます。 クエリ名にマウス ポインターを合わせると、クエリの説明と追加の機能を表示できます。

[![クエリのサイドバー](media/queries/query-sidebar.png)](media/queries/query-sidebar.png#lightbox)

## <a name="finding-and-filtering-queries"></a>クエリの検索とフィルタリング

このセクションのオプションはダイアログとサイドバー クエリ エクスペリエンスの両方で利用できますが、ユーザー インターフェイスがわずかに異なります。  


### <a name="group-by"></a>グループ化

*[グループ化]* ドロップダウン リストをクリックして、クエリのグループ化を変更します。 グループ化する値はコンテンツのアクティブなテーブルとしても機能します。 画面の左側にあるいずれかの値をクリックすると、クリックした項目の右にクエリ ビューがスクロールします。 組織でタグ付きのクエリ パックを作成している場合、カスタム タグがこの一覧に追加されます。

[![[サンプル クエリ] 画面の [グループ化]](media/queries/example-query-groupby.png)](media/queries/example-query-groupby.png#lightbox)



### <a name="filter"></a>Assert

前に説明した **グループ化** の値に応じてクエリをフィルターすることもできます。 サンプル クエリ ダイアログの上部にフィルターがあります。

[![[サンプル クエリ] 画面のフィルター](media/queries/example-query-filter.png)](media/queries/example-query-filter.png#lightbox)

### <a name="combining-group-by-and-filter"></a>グループ化とフィルターの組み合わせ

フィルターとグループ化の機能は、連携して機能するよう設計されています。 これにより、クエリの並べ替え方の自由度が高まります。 たとえば、複数のリソースがあるリソース グループを使用している場合、特定のリソースの種類にフィルターして、結果のクエリをトピックごとに並べ替えたいことがあります。

## <a name="query-properties"></a>クエリのプロパティ
各クエリには、グループ化と検索に役立つ複数のプロパティがあります。 これらのプロパティは、並べ替えとフィルター処理に使用できます。また、[独自のクエリを保存](save-query.md)する際に、いくつかのプロパティを定義することができます。 プロパティの種類は次のとおりです。

- **リソースの種類** - Azure で定義されたリソース (仮想マシンなど)。 Azure Monitor ログまたは Log Analytics テーブルからリソースの種類への完全なマッピングについては、[Azure Monitor のテーブル参照](/azure/azure-monitor/reference/tables/tables-resourcetype)に関するページをご覧ください。  
- **カテゴリ** - 情報の種類 ("*セキュリティ*" や "*監査*" など) カテゴリは、[テーブル] サイド ペインで定義されているカテゴリと同じです。 カテゴリの完全な一覧については、[Azure Monitor のテーブル参照](/azure/azure-monitor/reference/tables/tables-category)に関するページをご覧ください。  
- **ソリューション** - クエリに関連付けられた Azure Monitor ソリューション
- **トピック** - サンプル クエリのトピック ("*アクティビティ ログ*" または "*アプリ ログ*")。 トピックのプロパティはサンプル クエリに固有ではなく、特定のリソースの種類によっては異なる場合があります。
- - **クエリの種類** - クエリの種類を定義します。 クエリの種類には、サンプル クエリ、クエリ パック クエリ、レガシ クエリなどがあります。
- **ラベル** - [独自のクエリを保存](save-query.md)するときに定義し、割り当てることができるカスタム ラベル。
- **タグ** - [クエリ パックの作成](query-packs.md)時に定義できるカスタム プロパティ。 タグを使用することで、組織はクエリを整理するための独自の分類を作成することができます。

## <a name="favorites"></a>お気に入り
頻繁に使用するクエリは、すばやくアクセスできるようにお気に入りに登録できます。 クエリの横にある星をクリックすると、 **[お気に入り]** に追加できます。 お気に入りに追加したクエリは、クエリ インターフェイスの **[お気に入り]** オプションから表示できます。

## <a name="types-of-queries"></a>クエリの種類
クエリ インターフェイスには、次の種類のクエリが設定されます。

**サンプル クエリ:** サンプル クエリを使用すると、リソースに関する分析情報をすぐに得ることができ、KQL の学習と使用を円滑に開始できるため、Log Analytics の使用を開始するのにかかる時間が短くなります。 Microsoft は、お客様がすぐに活用できるよう設計された 500 超のサンプル クエリを収集、キュレーションしました。また、このサンプル クエリの数は継続的に増加しています。

**クエリ パック:** [クエリ パック](query-packs.md)には、自分で保存したクエリなど、ログ クエリのコレクションが保持されます。 これには、[既定のクエリ パック](query-packs.md#default-query-pack)と、組織がサブスクリプションで作成したその他のクエリ パックが含まれます。

**レガシ クエリ:** 以前にクエリ エクスプローラー エクスペリエンスに保存されたログ クエリで、ワークスペースにインストールされている Azure ソリューションに対してクエリを実行します。 これらは、 **[レガシ クエリ]** の下のクエリ ダイアログ ボックスに表示されます。
>[!TIP]
> レガシ クエリは、Log Analytics ワークスペースでのみ使用できます。

## <a name="effect-of-query-scope"></a>クエリ スコープの影響
Log Analytics を開いたときに利用できるクエリは、現在の[クエリ スコープ](scope.md)によって決まります。

- **ワークスペース** の場合 - クエリ パックのすべてのクエリとクエリの例。 ワークスペース内のレガシ クエリ。
- **1 つのリソース** の場合 - リソースの種類に対するクエリ パックからのクエリとクエリの例。 
- **リソース グループ** の場合 - リソース グループ内のリソースの種類に対するクエリ パックからのクエリとクエリの例。 

> [!TIP]
> スコープ内のリソースが多ければ多いほど、ポータルでクエリ ダイアログのフィルターと表示にかかる時間は長くなります。


## <a name="next-steps"></a>次のステップ

[KQL クエリの概要](get-started-queries.md)

