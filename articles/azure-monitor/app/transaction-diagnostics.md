---
title: Azure Application Insights のトランザクションの診断 | Microsoft Docs
description: Application Insights のエンド ツー エンドのトランザクションの診断
ms.topic: conceptual
ms.date: 01/19/2018
ms.reviewer: sdash
ms.openlocfilehash: 60365079c295e154ff0a38277c9ccdec35157e6e
ms.sourcegitcommit: afb79a35e687a91270973990ff111ef90634f142
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/14/2021
ms.locfileid: "107481397"
---
# <a name="unified-cross-component-transaction-diagnostics"></a>統合されたコンポーネント間のトランザクションの診断

統合診断エクスペリエンスは、Application Insights に監視されるすべてのコンポーネントからのサーバー側テレメトリを単一ビューに関連付けます。 インストルメンテーション キーが個別に設定されたリソースが複数あっても問題ありません。 Application Insights によって基になる関係が検出されるため、トランザクションの速度低下または障害の原因となったアプリケーション コンポーネント、依存関係、または例外を簡単に診断することができます。

## <a name="what-is-a-component"></a>コンポーネントとは

コンポーネントは、分散/マイクロサービス アプリケーションの、個別にデプロイできる部分です。 開発者と運用チームには、これらのアプリケーション コンポーネントによって生成されたテレメトリに対して、コード レベルの可視性またはアクセスがあります。

* コンポーネントは、チームや組織が (コードやテレメトリに) アクセスできない可能性がある SQL や EventHub などの "観察される" 外部依存関係とは異なります。
* コンポーネントは、任意の数のサーバー/ロール/コンテナーのインスタンス上で実行されます。
* コンポーネントは、個別の Application Insights インストルメンテーション キーである場合も (サブスクリプションが異なる場合も)、単一の Application Insights インストルメンテーション キーにレポートするさまざまなロールである場合もあります。 新しいエクスペリエンスでは、その設定方法に関係なく、すべてのコンポーネントの詳細が表示されます。

> [!NOTE]
> * **関連項目のリンクが見つからない場合**: 関連するすべてのテレメトリは、左側の[一番上](#cross-component-transaction-chart)と[一番下](#all-telemetry-with-this-operation-id)のセクションにあります。 

## <a name="transaction-diagnostics-experience"></a>トランザクションの診断エクスペリエンス
このビューには 4 つの重要な部分があります。結果リスト、コンポーネント間のトランザクションのグラフ、この操作に関連するすべてのテレメトリの時系列順の一覧、左側で選択されたテレメトリ項目の詳細ウィンドウです。

![重要な部分](media/transaction-diagnostics/4partsCrossComponent.png)

## <a name="cross-component-transaction-chart"></a>コンポーネント間のトランザクションのグラフ

このグラフでは、タイムラインに要求の継続時間を表す横棒と、コンポーネント間の依存関係が示されます。 また、収集されたすべての例外も、タイムライン上でマークされます。

* グラフの一番上の行はエントリ ポイント、すなわち、このトランザクションで呼び出される最初のコンポーネントに対する受信要求を表します。 継続時間は、トランザクションが完了するまでにかかる合計時間です。
* 外部依存関係の呼び出しは、すべてシンプルな折りたたみ不可の行で表され、アイコンは依存関係の種類を表します。
* その他のコンポーネントの呼び出しは、折りたたみ可能な行で表されます。 各行は、コンポーネントで呼び出される特定の操作に対応します。
* 既定では、選択した要求、依存関係、例外が右側に表示されます。
* 行を選択すると、その[詳細が右側に](#details-of-the-selected-telemetry)表示されます。 

> [!NOTE]
> その他のコンポーネントの呼び出しは 2 つの行で表されます。呼び出しコンポーネントからの送信呼び出し (依存関係) を表す行と、呼び出されたコンポーネントの受信要求に対応する行です。 先頭のアイコンと継続時間バーの個別のスタイルは、これらを区別するのに役立ちます。

## <a name="all-telemetry-with-this-operation-id"></a>この操作 ID のすべてのテレメトリ

このセクションでは、このトランザクションに関連するすべてのテレメトリの時系列順の単純な一覧が表示されます。 トランザクションのグラフに表示されないカスタム イベントとトレースも表示されます。 この一覧をフィルター処理して、特定のコンポーネントまたは呼び出しで生成されたテレメトリのみを表示できます。 この一覧の任意のテレメトリ項目を選択して、対応する[詳細を右側に](#details-of-the-selected-telemetry)表示できます。

![すべてのテレメトリの時系列](media/transaction-diagnostics/allTelemetryDrawerOpened.png)

## <a name="details-of-the-selected-telemetry"></a>選択したテレメトリの詳細

この折りたたみ可能なウィンドウには、トランザクション グラフまたは一覧から選択した項目の詳細が表示されます。 [すべて表示] では、収集されたすべての標準属性が一覧表示されます。 カスタム属性は標準セットの下に個別に一覧表示されます。 スタック トレース ウィンドウの下の [...] をクリックして、トレースをコピーするオプションを表示します。 [Open profiler traces]\(Profiler トレースを開く\) または [デバッグ スナップショットを開く] を選択すると、対応する詳細ウィンドウにコード レベルの診断が表示されます。

![例外の詳細](media/transaction-diagnostics/exceptiondetail.png)

## <a name="search-results"></a>[検索結果]

この折りたたみ可能なウィンドウには、フィルター条件を満たすその他の結果が表示されます。 どの結果をクリックしても、上にある 3 つのセクションでそれぞれの詳細が更新されます。 サンプリングがいずれかのコンポーネントで有効になっている場合でも、すべてのコンポーネントで使用可能な詳細を含む可能性が最も高いサンプルを探そうとしています。 これらは "推奨" サンプルとして表示されます。

![[検索結果]](media/transaction-diagnostics/searchResults.png)

## <a name="profiler-and-snapshot-debugger"></a>Profiler とスナップショット デバッガー

[Application Insights Profiler](./profiler.md) または[スナップショット デバッガー](snapshot-debugger.md)は、パフォーマンスと障害の問題をコード レベルで診断するのに役立ちます。 このエクスペリエンスを使用して、任意のコンポーネントからの Profiler トレースやスナップショットをシングル クリックで表示できます。

Profiler が機能しない場合は、**serviceprofilerhelp\@microsoft.com** までお問い合わせください。

スナップショット デバッガーが機能しない場合は、**snapshothelp\@microsoft.com** までお問い合わせください。

![Profiler の統合](media/transaction-diagnostics/profilerTraces.png)

## <a name="faq"></a>よく寄せられる質問

*グラフに 1 つのコンポーネントしか表示されず、その他のコンポーネントは外部依存関係として表示されるのみで、これらのコンポーネント間で発生したことの詳細が表示されません。*

次の理由が考えられます。

* その他のコンポーネントは Application Insights を使用してインストルメント化されましたか。
* それらには Application Insights SDK の最新の安定バージョンが使用されていますか。
* これらのコンポーネントが個別の Application Insights リソースである場合、必要な[アクセス権](resources-roles-access-control.md)を持っていますか。アクセス権を持っていて、コンポーネントが最新の Application Insights SDK でインストルメント化されている場合は、右上のフィードバック チャネルからお知らせください。

*依存関係の行が重複しています。これは期待される動作ですか?*

現時点では、送信依存関係呼び出しと受信要求は区別して表示されます。 通常、2 つの呼び出しは、ネットワーク ラウンド トリップのために継続時間の値が異なる以外は、まったく同一に見えます。 先頭のアイコンと継続時間バーの個別のスタイルは、これらを区別するのに役立ちます。 このデータの表示方法はわかりにくいですか。 フィードバックをお待ちしております。

*異なるコンポーネント インスタンス間のクロック スキューはどのように処理されますか?*

タイムラインはトランザクションのグラフでクロック スキューに対して調整されます。 詳細ウィンドウか、または Analytics を使用することで、正確なタイムスタンプを確認できます。

*関連項目のクエリのほとんどが、新しいエクスペリエンスからなくなっているのはなぜですか?*

これは仕様です。 コンポーネント全体に渡って、関連項目はすべて左側 (上部と下部セクション) から既に利用可能です。 新しいエクスペリエンスの左側で扱われない関連項目が 2 つあります。このイベントの 5 分前後からのすべてのテレメトリと、ユーザー タイムラインです。

*Application Insights JavaScript SDK を使用しているとき、トランザクション診断エクスペリエンスで、予想よりも多くのイベントが表示されます。トランザクションごとに表示されるイベント数を減らす方法はありますか?*

トランザクション診断エクスペリエンスでは、[1 回の操作](correlation.md#data-model-for-telemetry-correlation)で[操作 ID](data-model-context.md#operation-id) を共有するすべてのテレメトリが表示されます。既定で、Application Insights SDK for JavaScript では、一意のページ ビューごとに新しい操作が作成されます。 シングルページ アプリケーション (SPA) では、1 つのページ ビュー イベントだけが生成され、生成されたすべてのテレメトリに対して 1 つの操作 ID が使用されます。これにより、多くのイベントが同じ操作に関連付けられることがあります。 このようなシナリオでは、自動ルート追跡を使用すると、シングルページ アプリでのナビゲーションのために新しい操作が自動的に作成されます。 [enableAutoRouteTracking](javascript.md#single-page-applications) を有効にして、URL ルートが更新されるたびにページ ビューが生成される (論理ページ ビューが発生する) ようにする必要があります。 操作 ID を手動で更新する場合は、`appInsights.properties.context.telemetryTrace.traceID = Microsoft.ApplicationInsights.Telemetry.Util.generateW3CId()` を呼び出すことによって実行できます。 手動で PageView イベントをトリガーすると、操作 ID もリセットされます。
