---
title: 可用性の標準テスト - Azure Monitor Application Insights
description: Application Insights 内で標準テストを設定して、1 つの要求テストで Web サイトの可用性を確認します。
ms.topic: conceptual
ms.date: 07/13/2021
ms.openlocfilehash: 2a8741d874fdfad8a76465fd8127dfb4752a1a55
ms.sourcegitcommit: 9339c4d47a4c7eb3621b5a31384bb0f504951712
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/14/2021
ms.locfileid: "113799483"
---
# <a name="standard-test"></a>標準テスト

標準テストは単一の要求テストで、[URL ping テスト](monitor-web-app-availability.md)に似ていますが、より高度なものです。 標準テストには、エンドポイントが応答し、パフォーマンスを測定しているかどうかの検証のほか、SSL 証明書の有効性、プロアクティブな有効期間チェック、HTTP 要求動詞 (`GET`、`HEAD`、`POST` など)、カスタム ヘッダー、HTTP 要求に関連付けられたカスタム データなども含まれます。

> [!NOTE]
> 標準テストは現在、パブリック プレビューの段階にあります。 これらのプレビュー バージョンは、サービス レベル アグリーメントなしに提供されます。 特定の機能はサポート対象ではなく、機能が制限されることがあります。

> [!NOTE]
> 現在、プレビュー機能の標準テストに追加料金は発生しません。 プレビュー段階にある機能の価格は、後で発表され、課金が始まる前に通知されます。 通知期間後も標準テストを引き続き使用することを選択した場合は、該当する料金が適用されます。

可用性テストを作成するには、既存の Application insights リソースを使用するか、[Application Insights リソースを作成](create-new-resource.md)する必要があります。

> [!TIP]
> URL ping テストなど、他の可用性テストを現在使用している場合は、他のテストと共に標準テストを追加できます。 他のテストの代わりに標準テストを使用する場合は、標準テストを追加し、ご自身の古いテストを削除します。 

## <a name="create-a-standard-test"></a>標準テストを作成する

標準テストを作成するには: 

1. ご自身の Application Insights リソースに移動し、 **[可用性]** ウィンドウを選択します。
1. **[Add Standard (preview) test]\(標準 (プレビュー) テストの追加\)** を選択します。
    
    :::image type="content" source="./media/availability-standard-test/standard-test.png" alt-text="[標準テストの追加] タブが開いている [可用性] ウィンドウのスクリーンショット。" lightbox="./media/availability-standard-test/standard-test.png":::

1. ご自身のテスト名、URL、その他の設定 (以下の説明) を入力し、 **[作成]** を選択します。


|設定 | 説明 |
|--------|-------------|
|**URL** |  [URL] にはテストする任意の Web ページを指定できますが、パブリック インターネットからアクセス可能である必要があります。 URL にはクエリ文字列を含めることができます。 したがって、たとえば限られた範囲でデータベースを実行できます。 URL が解決されてリダイレクトする場合、それに続いて最大で 10 個リダイレクトを使用できます。|
|**依存する要求の解析**| テストでは、テスト対象の Web ページの一部である画像、スクリプト、スタイル ファイル、およびその他のファイルが要求されます。 記録される応答時間には、これらのファイルの取得にかかる時間が含まれます。 テスト全体のタイムアウト時間内にこれらすべてのリソースを正常にダウンロードできない場合、テストは失敗します。 このオプションがオンになっていない場合、テストからは指定した URL にあるファイルのみが要求されます。 このオプションを有効にすると、より厳密なチェックが行われます。 サイトを手動で参照しているときは気付かないことが原因でテストが失敗する場合があります。 |
|**再試行を有効にする**| テストが失敗した場合に、少し間を置いてテストを再試行します。 エラーは試行が 3 回連続で失敗した場合にのみ報告されます。 その後、後続のテストが通常のテスト間隔で実行されます。 再試行は、次の成功まで一時的に中断されます。 このルールがテスト場所ごとに独立して適用されます。 **このオプションはオンにすることをお勧めします**。 再試行の際に平均でエラーの約 80% がなくなります。|
| **SSL 証明書の検証テスト** | SSL 証明書が正しくインストールされていること、有効であること、信頼できること、ユーザーにエラーが発生しないことを確認するために、ご自身の Web サイト上で、その SSL 証明書を検証できます。 |
| **プロアクティブな有効期間チェック** | これにより、ご自身の SSL 証明書の有効期限が切れる前に設定期間を定義できます。 有効期限が切れると、テストは失敗します。 |
|**テスト間隔**| 各テストの場所からテストを実行する頻度を設定します。 既定の間隔が 5 分で、テストの場所が 5 か所の場合、サイトは平均して毎分テストされます。|
|**テストの場所**|  Web 要求の送信元。サーバーはこの場所から指定の URL に Web 要求を送信します。 Web サイトの問題とネットワークの問題とを確実に区別するために、**テストの場所は 5 か所以上にすることをお勧めします**。 最大 16 個の場所を選択できます。|
| **カスタム ヘッダー** | 操作パラメーターを定義するキーと値のペア。 |
| **HTTP 要求動詞** | ご自身の要求で実行するアクションを示します。 |
| **要求本文** | ご自身の HTTP 要求に関連付けられているカスタム データ。 独自のファイルをアップロードしたり、コンテンツを入力したり、この機能を無効にしたりできます。 |

## <a name="success-criteria"></a>成功の基準

|設定| 説明|
|-------|------------|
| **テストのタイムアウト** |この値を引き下げると、応答が遅い場合に警告されます。 テストは、この期間内にサイトから応答が返されない場合に、エラーとしてカウントされます。 **[従属要求の解析]** をオンにした場合、すべての画像、スタイル ファイル、スクリプト、その他依存するリソースがこの期間内に受信される必要があります。|
| **HTTP 応答** | 成功としてカウントされる、返される状態コード。 200 は、通常の Web ページが返されたことを示すコードです。|
| **コンテンツの一致** | "Welcome!" などの文字列。 それぞれの応答に大文字小文字を区別した完全一致があるかどうかをテストします。 文字列は、(ワイルドカードを含まない) プレーン文字列である必要があります。 ページ コンテンツが変更された場合は、この文字列も更新する必要がある可能性があることに注意してください。 **コンテンツの一致では、英語のみがサポートされています。** |

## <a name="alerts"></a>警告

|設定| 説明|
|-------|------------|
|**準リアルタイム (プレビュー)** | 準リアルタイムのアラートを使用することが推奨されます。 この種類のアラートの構成は、可用性テストの作成後に実行されます。  |
|**アラートの場所のしきい値**|少なくとも 3/5 の場所にすることをお勧めします。 アラートの場所のしきい値とテストの場所の数の最適な関係は、**アラートの場所のしきい値** = **テストの場所の数** - 2 です。テストの場所は、少なくとも 5 か所にします。|

## <a name="location-population-tags"></a>位置情報の作成タグ

Azure Resource Manager を使用して可用性 URL の ping テストをデプロイするときに、次の作成タグを位置情報属性に使用できます。

### <a name="azure-gov"></a>Azure gov

| 表示名   | 作成名     |
|----------------|---------------------|
| USGov バージニア州 | usgov-va-azr        |
| USGov アリゾナ  | usgov-phx-azr       |
| USGov テキサス    | usgov-tx-azr        |
| USDoD 東部     | usgov-ddeast-azr    |
| USDoD 中部  | usgov-ddcentral-azr |

### <a name="azure-china"></a>Azure 中国

| 表示名   | 作成名     |
|----------------|---------------------|
| 中国東部     | mc-cne-azr          |
| 中国東部 2   | mc-cne2-azr         |
| 中国北部    | mc-cnn-azr          |
| 中国北部 2  | mc-cnn2-azr         |

#### <a name="azure"></a>Azure

| 表示名                           | 作成名   |
|----------------------------------------|-------------------|
| オーストラリア東部                         | emea-au-syd-edge  |
| ブラジル南部                           | latam-br-gru-edge |
| 米国中部                             | us-fl-mia-edge    |
| 東アジア                              | apac-hk-hkn-azr   |
| 米国東部                                | us-va-ash-azr     |
| フランス南部 (旧名フランス中部) | emea-ch-zrh-edge  |
| フランス中部                         | emea-fr-pra-edge  |
| 東日本                             | apac-jp-kaw-edge  |
| 北ヨーロッパ                           | emea-gb-db3-azr   |
| 米国中北部                       | us-il-ch1-azr     |
| 米国中南部                       | us-tx-sn1-azr     |
| 東南アジア                         | apac-sg-sin-azr   |
| 英国西部                                | emea-se-sto-edge  |
| 西ヨーロッパ                            | emea-nl-ams-azr   |
| 米国西部                                | us-ca-sjc-azr     |
| 英国南部                               | emea-ru-msa-edge  |

## <a name="see-your-availability-test-results"></a>可用性テストの結果を表示する

可用性テストの結果は、折れ線グラフと散布図の両方で視覚化できます。

数分後に、 **[更新]** を選択すると、テスト結果が表示されます。

:::image type="content" source="./media/monitor-web-app-availability/availability-refresh-002.png" alt-text="スクリーンショットには、[更新] ボタンが強調表示された [可用性] ページが示されています。":::

散布図には、診断テスト手順の詳細が含まれたテスト結果のサンプルが表示されます。 テスト エンジンは、失敗したテストの診断の詳細を格納します。 成功したテストの場合、診断の詳細は実行のサブセットに対して格納されます。 緑色/赤色の点の上にポインターを置くと、テスト、テスト名、および場所が表示されます。

:::image type="content" source="./media/monitor-web-app-availability/availability-scatter-plot-003.png" alt-text="行ビュー。" border="false":::

特定のテスト、場所を選択するか、または期間を短くすると、目的の期間に関するより詳細な結果が表示されます。 Search エクスプローラーを使用してすべての実行の結果を表示するか、または分析クエリを使用してこのデータに対してカスタム レポートを実行します。

## <a name="inspect-and-edit-tests"></a>テストを調べて編集する

テストの編集、一時的な無効化、削除を行うには、テスト名の横の省略記号を選択します。 変更を行った後、すべてのテスト エージェントに構成の変更が反映されるまで、最大 20 分かかる可能性があります。

:::image type="content" source="./media/monitor-web-app-availability/edit.png" alt-text="テスト詳細の表示、Web テストの編集および無効化。" border="false":::

サービスに対するメンテナンスを実行している間、関連付けられた可用性テストまたはアラート ルールを無効にすることもできます。

## <a name="if-you-see-failures"></a>エラーが発生した場合

赤い点を選択します。

:::image type="content" source="./media/monitor-web-app-availability/end-to-end.png" alt-text="[エンドツーエンドのトランザクションの詳細] タブのスクリーンショット。" border="false":::

可用性のテスト結果から、すべてのコンポーネントにわたるトランザクションの詳細を確認できます。 ここで、次のことを行うことができます。

* トラブルシューティング レポートを確認して、テストが失敗する原因を特定しますが、アプリケーションは引き続き利用できます。
* サーバーから受信した応答を調べる。
* 失敗した可用性テストの処理中に収集された、サーバー側の相関関係を持つテレメトリを使用してエラーを診断する。
* 懸案や作業の項目を Git または Azure Boards に記録して問題を追跡する。 バグには、このイベントへのリンクが含まれます。
* Visual Studio で Web テスト結果を開く。

エンドツーエンドのトランザクションの診断エクスペリエンスの詳細については、[トランザクション診断のドキュメント](./transaction-diagnostics.md)を参照してください。

例外の行を選択すると、代理可用性テストが失敗した原因であるサーバー側の例外の詳細が表示されます。 コード レベルの豊富な診断の [デバッグ スナップショット](./snapshot-debugger.md)を取得することもできます。

:::image type="content" source="./media/monitor-web-app-availability/open-instance-4.png" alt-text="サーバー側の診断。":::

生の結果に加えて、[メトリックス エクスプローラー](../essentials/metrics-getting-started.md)に 2 つの重要な可用性メトリックを表示することもできます。

* 可用性:すべてのテスト実行にわたる、成功したテストの割合 (%)。
* テスト期間:すべてのテスト実行にわたる平均のテスト期間。

## <a name="next-steps"></a>次のステップ

* [可用性のアラート](availability-alerts.md)
* [複数ステップ Web テスト](availability-multistep.md)
* [トラブルシューティング](troubleshoot-availability.md)
* [Azure Resource Manager テンプレートの Web テスト](/azure/templates/microsoft.insights/webtests?tabs=json)
