---
title: Azure Monitor に関するベスト プラクティス - アラートと自動アクション
description: Azure Monitor のアラートと自動アクションのデプロイに関する推奨事項。
ms.topic: conceptual
author: bwren
ms.author: bwren
ms.date: 10/18/2021
ms.openlocfilehash: 933c05bc48fedf9502d63acd5f5dc3fa1f4c133f
ms.sourcegitcommit: 92889674b93087ab7d573622e9587d0937233aa2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/19/2021
ms.locfileid: "130181543"
---
# <a name="deploying-azure-monitor---alerts-and-automated-actions"></a>Azure Monitor のデプロイ - アラートと自動アクション
この記事は、[Azure Monitor を構成する際の推奨事項](best-practices.md)に関する記事で紹介されているシナリオの一部です。 監視データで識別された重要なデータやパターンを事前に通知する、Azure Monitor のアラートに関するガイダンスを提供します。 Azure portal でアラートを表示したり、事前通知が送信されるようにしたり、問題の修復を試みる自動アクションが開始されるようにしたりすることができます。 
## <a name="alerting-strategy"></a>アラート戦略
アラート戦略では、さまざまなシナリオに対して作成するアラート ルールの種類、アラートの作成後にそれらを分類および管理する方法、アラートへの対応として実行する自動アクションと通知に関して、組織の標準を定義します。 アラート戦略を定義すると、アラートの重大度やアクション グループなどのアラート ルールの構成を定義する際に役立ちます。

アラート戦略を作成する際に考慮する必要がある要素については、「[適切なアラート戦略](/azure/cloud-adoption-framework/manage/monitor/alerting#successful-alerting-strategy)」を参照してください。


## <a name="alert-rule-types"></a>アラート ルールの種類
Azure Monitor のアラートは、アラート ルール (ご自身で作成する必要があります) によって作成されます。 推奨されるアラート ルールのガイダンスについては、各 Azure サービスの監視に関するドキュメントを参照してください。 既定では、Azure Monitor にはアラート ルールが用意されていません。 

使用するデータの種類によって定義される、複数の種類の警告ルールがあります。 それぞれの機能は異なり、コストが異なります。 従う必要がある基本的な戦略は、必要なロジックが提供される最低コストの警告ルールの種類を使用することです。

- [アクティビティ ログのルール](alerts/activity-log-alerts.md)。 指定した条件と一致する新しいアクティビティ ログ イベントへの応答として、警告を作成します。 これらのアラートにはコストはかからないので、最初にこれらを選択してください。ただし、検出できる条件は限られます。 アクティビティ ログの警告の作成について詳しくは、「[Azure Monitor を使用してアクティビティ ログ アラートを作成、表示、管理する](alerts/alerts-activity-log.md)」を参照してください。
- [メトリックの警告ルール](alerts/alerts-metric-overview.md)。 しきい値を超えた 1 つまたは複数のメトリック値に応答して、警告を作成します。 メトリックの警告はステートフルであり、値がしきい値を下回ると警告は自動的に閉じられ、状態が変化したときにだけ通知が送信されます。 メトリック アラートにはコストがかかりますが、多くの場合、ログ アラートより大幅に低くなります。 メトリックの警告の作成について詳しくは、「[Azure Monitor を使用してメトリック アラートを作成、表示、管理する](alerts/alerts-metric.md)」を参照してください。
- [ログの警告ルール](alerts/alerts-unified-log.md)。 スケジュール クエリの結果が指定した条件と一致した場合に、警告が作成されます。 これらは、警告ルールの中で最も高価なものですが、最も複雑な条件を指定できます。 ログ クエリの警告の作成について詳しくは、「[Azure Monitor を使用してログ アラートを作成、表示、管理する](alerts/alerts-log.md)」を参照してください。
- [アプリケーションの警告](app/monitor-web-app-availability.md)を使用すると、Web アプリケーションのプロアクティブなパフォーマンスと可用性のテストを実行できます。 簡単な ping テストは無料で実行できますが、より複雑なテストにはコストがかかります。 さまざまなテストの説明と作成方法の詳細については、「[任意の Web サイトの可用性を監視する](app/monitor-web-app-availability.md)」を参照してください。

## <a name="alert-severity"></a>アラートの重大度
各アラート ルールでは、それによって作成されるアラートの重大度が、以下の表に基づいて定義されます。 Azure portal 内のアラートはレベル別にグループ化されるため、同様のアラートをまとめて管理し、緊急度が最も高いものを迅速に特定できます。

| Level | 名前 | 説明 |
|:---|:---|:---|
| 重大度 0 | Critical  | サービスまたはアプリケーションの可用性が失われるか、パフォーマンスが大幅に低下します。 即時の対応が必要です。 |
| 重大度 1 | エラー  | アプリケーションまたはサービスの一部の側面のパフォーマンスが低下するか可用性が失われます。 対応が必要ですが、即時ではありません。 |
| 重大度 2 | 警告 | 現時点で可用性やパフォーマンスが失われることはありませんが、解決されないと、より深刻な問題につながるおそれがある問題です。 |
| 重大度 3 | Informational | 問題を示すものではなく、通常のプロセスの正常な完了など、オペレーターが必要とする情報を示します。 |
| 重大度 4 | "詳細" | 有用ではない詳細情報 

各ルールで識別される条件の重大度を評価し、適切なレベルを割り当てる必要があります。 各重大度レベルに割り当てる問題の種類およびそれぞれに対する標準的な対応は、アラート戦略で定義する必要があります。 

## <a name="action-groups"></a>アクション グループ
Azure Monitor のアラートへの自動応答は、[アクション グループ](alerts/action-groups.md)で定義します。 アクション グループは、アラートがトリガーされると起動される、1 つ以上の通知とアクションのコレクションです。 1 つのアクション グループは複数のアラート ルールで使用でき、次の 1 つ以上を含めることができます。

- 通知。 アラートが作成されたことをオペレーターと管理者に通知するメッセージ。
- アクション。 検出された問題の修正を試みる自動化プロセス。 
## <a name="notifications"></a>通知
通知は、アラートが作成されたことを 1 人以上のユーザーに通知するために送信されるメッセージです。 1 つのアクション グループを複数のアラート ルールで使用できるので、同じアラート セットを受け取る複数の異なる管理者とユーザーのセット向けにアクション グループ セットを設計する必要があります。 オペレーターと組織の標準の設定に応じて、次のいずれかの通知の種類を使用します。

- Email
- SMS
- Azure アプリへのプッシュ
- 音声
- 電子メールの Azure Resource Manager のロール

## <a name="actions"></a>アクション
アクションは、アラートに対する自動応答です。 用意されているアクションをそれらがサポートする任意のシナリオで使用できますが、以下のセクションでは、通常それぞれがどのように使用されるかについて説明します。

### <a name="automated-remediation"></a>自動修復
次のアクションを使用して、アラートによって特定された問題の自動修復を試みます。 

- Automation Runbook - Azure Automation で組み込みまたはカスタムの Runbook を開始します。 たとえば、組み込みの Runbook は、仮想マシンの再起動やスケールアップなどの機能を実行する場合に使用できます。
- Azure 関数 - Azure 関数を開始します。


### <a name="itsm-and-on-call-management"></a>ITSM とオンコール管理

- ITSM - [ITSM コネクタ]()を使用して、Azure Monitor からのアラートに基づいて ITSM ツールで作業項目を作成します。 最初にコネクタを構成してから、アラート ルールで **ITSM** アクションを使用します。
- Webhook - PagerDuty や Splunk On-Call などの Webhook をサポートするインシデント管理システムにアラートを送信します。
- Secure Webhook - ITSM と Azure AD Authentication の統合


## <a name="minimizing-alert-activity"></a>アラート アクティビティを最小限に抑える
環境内の重要な情報に関するアラートを作成する場合は、それが必要ではない問題に対して過剰なアラートと通知が作成されないことを確認する必要があります。 次のガイドラインを使用してアラート アクティビティを最小限に抑え、重大な問題を明らかにしつつ、管理者向けに過剰な情報と通知を生成しないようにしてください。 

- ある症状がアラートの適切な候補であるかどうかを判断する際の原則については、「[適切なアラート戦略](/azure/cloud-adoption-framework/manage/monitor/alerting#successful-alerting-strategy)」を参照してください。
- 条件が修正された場合にアラートを解決するには、メトリック アラート ルールの **[Automatically resolve alerts]\(アラートを自動的に解決する\)** オプションを使用します。
- 同じ問題に対して複数のアラートが作成されるのを防ぐ、ログ クエリ アラート ルールの **[アラートを表示しない]** オプションを使用します。
- アラート ルールで適切な重大度レベルを使用して、優先度の高い問題をまとめて分析できるようにします。
- 警告以下の重大度のアラートの場合、即時の対応を必要としないため、通知を制限します。

## <a name="create-alert-rules-at-scale"></a>アラート ルールを大規模に作成する
通常は、重要なすべての Azure アプリケーションとリソースに関する問題についてアラートを生成する必要があるため、大規模にアラート ルールを作成する方法を利用してください。

- Azure Monitor では、同じ Azure リージョンに存在するリソースに対して、1 つのメトリック アラート ルールを使用した、同じ種類の複数リソースの監視がサポートされます。 この機能で現在サポートされている Azure サービスの一覧については、「[Azure Monitor のメトリック アラートによるスケールの監視](alerts/alerts-metric-overview.md#monitoring-at-scale-using-metric-alerts-in-azure-monitor)」を参照してください。
- 複数のリソースをサポートしない Azure サービスのメトリック アラート ルールの場合は、CLI や PowerShell などの自動化ツールを Resource Manager テンプレートと共に利用して、複数のリソースに対して同じアラート ルールを作成します。 サンプルについては、「[Azure Monitor のメトリック アラート ルール用の Resource Manager テンプレート サンプル](alerts/resource-manager-alerts-metric.md)」を参照してください。
- ログ クエリ アラート ルールで、複数のリソースのデータが返されるようにするクエリを記述します。 ルールの **[Split by dimensions]\(ディメンションによる分割\)** 設定を使用して、リソースごとに個別のアラートを作成します。


> [!NOTE]
> 現在パブリック プレビュー段階にあるリソース中心のログ クエリ アラート ルールを使用すると、サブスクリプションまたはリソース グループ内のすべてのリソースをログ クエリ アラートのターゲットとして使用できます。 

## <a name="next-steps"></a>次のステップ

- [Azure Monitor データからアラートと自動アクションを定義する](best-practices-alerts.md)