---
title: Container insights を使用してライブ データを表示する | Microsoft Docs
description: この記事では、Container insights で kubectl を使用せずに、Kubernetes ログ、イベント、およびポッド メトリックをリアルタイム ビューで表示する方法について説明します。
ms.topic: conceptual
ms.date: 03/04/2021
ms.custom: references_regions
ms.openlocfilehash: 9c1cbaf09d8f0b0cfe23f7014c1b5046efc5aab9
ms.sourcegitcommit: 0046757af1da267fc2f0e88617c633524883795f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/13/2021
ms.locfileid: "121739778"
---
# <a name="how-to-view-kubernetes-logs-events-and-pod-metrics-in-real-time"></a>Kubernetes ログ、イベント、ポッド メトリックをリアルタイムで表示する方法

Container insights には、ライブ データ機能が含まれています。これは、Azure Kubernetes Service (AKS) コンテナー ログ (stdout/stderror)、イベント、ポッド メトリックに直接アクセスできるようにする高度な診断機能です。 `kubectl logs -c`、`kubectl get` イベント、および `kubectl top pods` への直接アクセスを公開します。 コンソール ウィンドウには、コンテナー エンジンによって生成されたログ、イベント、およびメトリックが表示され、リアルタイムでの問題のトラブルシューティングに一層役立てることができます。

この記事では、この機能の使用方法について詳しく説明します。

ライブ データ機能の設定またはトラブルシューティングについては、[セットアップ ガイド](container-insights-livedata-setup.md)を参照してください。 この機能は、Kubernetes API に直接アクセスします。認証モデルの詳細については、[こちら](https://kubernetes.io/docs/concepts/overview/kubernetes-api/)を参照してください。

## <a name="view-aks-resource-live-logs"></a>AKS リソース ライブ ログを表示する
次の手順を使用して、AKS リソース ビューから Container insights が使用されている、または使用されていないポッド、デプロイ、およびレプリカ セットのライブ ログを表示します。

1. Azure portal で、AKS クラスター リソース グループを参照し、AKS リソースを選択します。

2. メニューの **[Kubernetes リソース]** セクションで **[ワークロード]** を選択します。

3. それぞれのタブからポッド、デプロイ、レプリカセットを選択します。

4. リソース メニューから **[ライブ ログ]** を選択します。

5. ライブ データの収集を開始するポッドを選択します。

    [![デプロイ ライブ ログ](./media/container-insights-livedata-overview/live-data-deployment.png)](./media/container-insights-livedata-overview/live-data-deployment.png#lightbox)

## <a name="view-logs"></a>ログを表示する

ログ データがコンテナー エンジンによって生成されたときに、 **[ノード]** 、 **[コントローラー]** 、および **[コンテナー]** ビューでこれらをリアルタイムに表示できます。 ログ データを表示するには、次の手順を実行します。

1. Azure portal で、AKS クラスター リソース グループを参照し、AKS リソースを選択します。

2. AKS クラスター ダッシュボードで、左側の **[監視]** の下で、 **[Insights]** を選択します

3. **[ノード]** 、 **[コントローラー]** 、または **[コンテナー]** タブのいずれかを選択します。

4. パフォーマンス グリッドからオブジェクトを選択し、右側にある [プロパティ] ウィンドウで、 **[ライブ データの表示]** オプションを選択します。 AKS クラスターが Azure AD を使用してシングル サインオンで構成されている場合は、そのブラウザー セッションで初めて使用するときに認証が求められます。 ご自身のアカウントを選択し、Azure での認証を完了します。

    >[!NOTE]
    >[プロパティ] ウィンドウの **[分析で表示]** を選択して Log Analytics ワークスペースからデータを表示する場合、ログ検索結果には、存在しなくなった **[ノード]** 、 **[デーモン セット]** 、 **[レプリカ セット]** 、 **[ジョブ]** 、 **[Cron ジョブ]** 、 **[ポッド]** 、および **[コンテナー]** が表示される可能性があります。 ここでは、`kubectl` で使用できないコンテナーのログを検索しようとすると失敗します。 履歴ログ、イベント、およびメトリックの表示の詳細については、[Container insights 機能のログのクエリを実行する方法](container-insights-log-query.md)を参照してください。

正常に認証されると、ライブ データ コンソール ウィンドウがパフォーマンス データ グリッドの下に表示され、このウィンドウで、連続したストリームでログ データを表示できます。 フェッチ状態インジケーターのウィンドウの一番右に緑色のチェック マークが表示される場合は、データを取得できること、およびコンソールへのストリーミングが開始されることを意味します。

![ノード プロパティ ウィンドウのデータの表示オプション](./media/container-insights-livedata-overview/node-properties-pane.png)

ウィンドウ タイトルには、コンテナーがグループ化されているポッドの名前が表示されます。

## <a name="view-events"></a>イベントの表示

コンテナー エンジンによって生成されたリアルタイム イベント データは、container、pod、node、ReplicaSet、DaemonSet、job、CronJob、または Deployment が選択されているときに、 **[ノード]** 、 **[コントローラー]** 、 **[コンテナー]** 、 **[デプロイ]** ビューから表示できます。 イベントを表示するには、次の手順を実行します。

1. Azure portal で、AKS クラスター リソース グループを参照し、AKS リソースを選択します。

2. AKS クラスター ダッシュボードで、左側の **[監視]** の下で、 **[Insights]** を選択します

3. **[ノード]** 、 **[コントローラー]** 、 **[コンテナー]** 、または **[デプロイ]** タブのいずれかを選択します。

4. パフォーマンス グリッドからオブジェクトを選択し、右側にある [プロパティ] ウィンドウで、 **[ライブ データの表示]** オプションを選択します。 AKS クラスターが Azure AD を使用してシングル サインオンで構成されている場合は、そのブラウザー セッションで初めて使用するときに認証が求められます。 ご自身のアカウントを選択し、Azure での認証を完了します。

    >[!NOTE]
    >[プロパティ] ウィンドウの **[分析で表示]** を選択して Log Analytics ワークスペースからデータを表示する場合、ログ検索結果には、存在しなくなった **[ノード]** 、 **[デーモン セット]** 、 **[レプリカ セット]** 、 **[ジョブ]** 、 **[Cron ジョブ]** 、 **[ポッド]** 、および **[コンテナー]** が表示される可能性があります。 ここでは、`kubectl` で使用できないコンテナーのログを検索しようとすると失敗します。 履歴ログ、イベント、およびメトリックの表示の詳細については、[Container insights 機能のログのクエリを実行する方法](container-insights-log-query.md)を参照してください。

正常に認証されると、ライブ データ コンソール ウィンドウがパフォーマンス データ グリッドの下に表示されます。 フェッチ状態インジケーターのウィンドウの一番右に緑色のチェック マークが表示される場合は、データを取得できること、およびコンソールへのストリーミングが開始されることを意味します。

選択したオブジェクトがコンテナーの場合は、ウィンドウの **[イベント]** オプションを選択します。 ノード、ポッド、またはコントローラーを選択した場合は、イベントの表示が自動的に選択されます。

![コントローラーのプロパティ ウィンドウのイベント表示](./media/container-insights-livedata-overview/controller-properties-live-event.png)

ウィンドウのタイトルには、コンテナーがグループ化されているポッドの名前が表示されます。

### <a name="filter-events"></a>イベントのフィルター処理

イベントが表示されているときに、検索バーの右にある **[フィルター]** ピルを使用して結果をさらに制限できます。 選択したリソースに応じて、このピルにより、選択の対象となるポッド、名前空間、またはクラスターが一覧表示されます。

## <a name="view-metrics"></a>メトリックを表示する

メトリック データがコンテナー エンジンによって生成されたときに、 **[ポッド]** が選択されている場合のみ、 **[ノード]** または **[コントローラー]** ビューでこれらをリアルタイムに表示できます。 メトリックを表示するには、次の手順を実行します。

1. Azure portal で、AKS クラスター リソース グループを参照し、AKS リソースを選択します。

2. AKS クラスター ダッシュボードで、左側の **[監視]** の下で、 **[Insights]** を選択します

3. **[ノード]** または **[コントローラー]** タブを選択します。

4. パフォーマンス グリッドから **ポッド** オブジェクトを選択し、右側にある [プロパティ] ウィンドウで、 **[ライブ データの表示]** オプションを選択します。 AKS クラスターが Azure AD を使用してシングル サインオンで構成されている場合は、そのブラウザー セッションで初めて使用するときに認証が求められます。 ご自身のアカウントを選択し、Azure での認証を完了します。

    >[!NOTE]
    >[プロパティ] ウィンドウの **[分析で表示]** を選択して Log Analytics ワークスペースからデータを表示する場合、ログ検索結果には、存在しなくなった **[ノード]** 、 **[デーモン セット]** 、 **[レプリカ セット]** 、 **[ジョブ]** 、 **[Cron ジョブ]** 、 **[ポッド]** 、および **[コンテナー]** が表示される可能性があります。 ここでは、`kubectl` で使用できないコンテナーのログを検索しようとすると失敗します。 履歴ログ、イベント、およびメトリックの表示の詳細については、[Container insights のログのクエリを実行する方法](container-insights-log-query.md)を参照してください。

正常に認証されると、ライブ データ コンソール ウィンドウがパフォーマンス データ グリッドの下に表示されます。 メトリック データが取得され、2 つのグラフでプレゼンテーションを行うためにコンソールへのストリーミングが開始されます。 ウィンドウ タイトルには、コンテナーがグループ化されているポッドの名前が表示されます。

![ポッド メトリックの表示の例](./media/container-insights-livedata-overview/pod-properties-live-metrics.png)

## <a name="using-live-data-views"></a>ライブ データ ビューの使用
以下のセクションでは、さまざまなライブ データ ビューで使用できる機能について説明します。

### <a name="search"></a>検索
ライブ データ機能には、検索機能が含まれています。 **[検索]** フィールドでは、単語または語句を入力して結果をフィルター処理できます。一致した結果は、すばやく参照できるように強調表示されます。 イベントが表示されているときに、検索バーの右にある **[フィルター]** ピルを使用して結果をさらに制限できます。 選択したリソースに応じて、このピルにより、選択の対象となるポッド、名前空間、またはクラスターが一覧表示されます。

![ライブ データ コンソール ウィンドウのフィルターの例](./media/container-insights-livedata-overview/livedata-pane-filter-example.png)

![デプロイのライブ データ コンソール ウィンドウのフィルターの例](./media/container-insights-livedata-overview/live-data-deployment-search.png)

### <a name="scroll-lock-and-pause"></a>スクロールのロックと一時停止

自動スクロールを中断し、ウィンドウの動作を制御して、読み込まれた新しいデータを手動でスクロールできるようにするには、 **[スクロール]** オプションを使用します。 自動スクロールを再度有効にするには、 **[スクロール]** オプションをもう一度選択します。 **[一時停止]** オプションを選択して、ログまたはイベント データの取得を一時停止することもできます。再開する準備ができたら、 **[プレイ]** を選択するだけです。

![ライブ データ コンソール ウィンドウのライブ ビューの一時停止](./media/container-insights-livedata-overview/livedata-pane-scroll-pause-example.png)

![デプロイのライブ データ コンソール ウィンドウのライブ ビューの一時停止](./media/container-insights-livedata-overview/live-data-deployment-pause.png)



>[!IMPORTANT]
>問題のトラブルシューティングを行うときは、短時間だけ自動スクロールを中断または一時停止することをお勧めします。 これらの要求は、クラスターの Kubernetes API の可用性とスロットリングに影響を与える可能性があります。

>[!IMPORTANT]
>この機能の操作中、データが永続的に保存されることはありません。 セッション中にキャプチャされたすべての情報は、ブラウザーを閉じるかブラウザーから移動すると削除されます。 データは、メトリック機能の 5 分間のウィンドウ内に表示するために残されています。5 分を経過したメトリックはすべて削除されます。 ライブ データでは、適切なメモリ使用量の制限内でクエリがバッファー処理されます。

## <a name="next-steps"></a>次のステップ

- Azure Monitor を使用して、AKS クラスターの他の側面を監視する方法を引き続き学習するには、[Azure Kubernetes Service の正常性の表示](container-insights-analyze.md)に関するページをご覧ください。

- アラートの作成、視覚化の作成、またはクラスターの詳細な分析を行うために、定義済みのクエリや例を確認するには、[Container insights のログのクエリを実行する方法](container-insights-log-query.md)を参照してください。
