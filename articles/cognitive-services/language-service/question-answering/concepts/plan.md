---
title: アプリを計画する - 質問応答
description: 質問応答アプリを計画する方法について学習します。 質問応答がどのように動作し、他の Azure サービスと対話しているか、またいくつかのナレッジ ベースの概念について説明します。
ms.service: cognitive-services
ms.subservice: language-service
author: mrbullwinkle
ms.author: mbullwin
ms.topic: conceptual
ms.date: 11/02/2021
ms.openlocfilehash: 0dbd8e670f652ff598c9b65c07687ab38a097050
ms.sourcegitcommit: 702df701fff4ec6cc39134aa607d023c766adec3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/03/2021
ms.locfileid: "131477886"
---
# <a name="plan-your-question-answering-app"></a>質問応答アプリを計画する

質問応答アプリを計画するには、質問の回答のしくみと他の Azure サービスとの対話方法を理解する必要があります。 また、ナレッジ ベースの概念をしっかりと把握しておく必要もあります。

## <a name="azure-resources"></a>Azure リソース

質問応答を使用して作成された各 [Azure リソース](azure-resources.md#resource-purposes)には、特定の目的があります。 各リソースには、独自の目的、制限、および[価格レベル](azure-resources.md#pricing-tier-considerations)があります。 これらのリソースの機能を理解し、その知識を計画プロセスに使用できるようにすることが重要です。

| リソース | 目的 |
|--|--|
| [言語リソース](azure-resources.md) リソース | 作成、クエリ予測エンドポイントおよびテレメトリ|
| [Cognitive Search](azure-resources.md#azure-cognitive-search-resource) リソース | データ ストレージと検索 |

### <a name="resource-planning"></a>リソースの計画

管理 API と予測 API の両方に対して、質問応答スループットは現在、毎秒 10 トランザクションに制限されています。 サービスの目標を 10 トランザクション/秒にするには、Azure Cognitive Search の S1 (1 つのインスタンス) SKU をお勧めします。

### <a name="language-resource"></a>言語リソース

カスタム質問応答機能が有効になっている単一の言語リソースでは、複数のプロジェクトまたはナレッジ ベースをホストできます。 プロジェクトまたはナレッジ ベースの数は、Cognitive Search 価格レベルのサポートされているインデックスの数量によって決まります。 詳細については、[ナレッジ ベースとのインデックスの関係](azure-resources.md#index-usage)に関するページを参照してください。

### <a name="knowledge-base-size-and-throughput"></a>ナレッジ ベースのサイズとスループット

実際のアプリを作成するときは、ナレッジ ベースのサイズと予想されるクエリ予測要求に十分なリソースを計画します。

ナレッジ ベースのサイズは、次によって制御されます。
* [Cognitive Search リソース](../../../../search/search-limits-quotas-capacity.md)の価格レベルの制限
* [質問応答の制限](./limits.md)

ナレッジ ベースのクエリ予測要求は、Web アプリ プランと Web アプリによって制御されます。 価格レベルを計画する場合は、「[推奨設定](azure-resources.md#recommended-settings)」を参照してください。

### <a name="understand-the-impact-of-resource-selection"></a>リソース選択の影響の概要

適切なリソースの選択とは、ナレッジ ベースがクエリ予測に正常に回答することを意味します。

ナレッジ ベースが正常に機能していない場合、問題は、通常は不適切なリソース管理です。

リソースの選択が不適切な場合は、[変更する必要があるリソース](azure-resources.md#pricing-tier-considerations)を特定するために調査が必要です。

## <a name="project"></a>Project

プロジェクトまたはナレッジ ベースは、その言語リソースに直接関連付けられます。 これには、クエリ予測要求に回答するために使用される質問と回答 (QnA) のペアが保持されます。

### <a name="language-considerations"></a>言語に関する注意点

カスタム質問応答機能が有効になっている同じ言語リソース内に、異なる言語のプロジェクトを設けられるようになりました。 最初のプロジェクトを作成するときに、後続のすべてのプロジェクトに適用される 1 つの言語でプロジェクトまたはナレッジ ベースのリソースを使用するか、プロジェクトが作成されるごとに言語を選択するか選択できます。

### <a name="ingest-data-sources"></a>データ ソースを取り込む

質問応答では、非構造化コンテンツもサポートされています。 非構造化コンテンツを含むファイルをアップロードできます。

現時点では、非構造化コンテンツの URL はサポートされていません。

インジェスト プロセスでは、サポートされているコンテンツの種類がマークダウンに変換されます。 *回答* のそれ以上の編集はすべて、マークダウンを使用して行われます。 ナレッジ ベースを作成した後は、リッチ テキスト作成を使用して、Language Studio ポータルで質問と回答のペアを編集できます。

### <a name="data-format-considerations"></a>データ形式に関する考慮事項

QnA ペアの最終的な形式はマークダウンであるため、マークダウンのサポートを理解することが重要です。

### <a name="bot-personality"></a>ボットのパーソナリティ

[おしゃべり](../how-to/chit-chat.md)を使用して、プロジェクトまたはナレッジ ベースにボットのパーソナリティを追加します。 このパーソナリティは、*Professional* や *Friendly* などの特定の口調で提供される回答を返します。 このおしゃべりは会話のセットとして提供され、追加、編集、および削除を完全に制御できます。

ボットがナレッジ ベースに接続している場合は、ボットのパーソナリティが推奨されます。 他のサービスにも接続している場合でも、ナレッジ ベースでおしゃべりを使用することを選択できますが、ボット サービスがどのように相互作用するかを確認して、それが使用に適したアーキテクチャ設計であるかどうかを確認する必要があります。

### <a name="conversation-flow-with-a-project"></a>プロジェクトを使用した会話フロー

会話フローは、通常は `Hi` や `Hello` などのユーザーからのあいさつで始まります。 ナレッジ ベースは、`Hi, how can I help you` などの一般的な回答で答えることができ、会話を続けるためのフォローアップ プロンプトを選択することもできます。

会話フローは、ユーザーがボットの使用方法を認識し、会話中にボットによって中断されないように、ループを念頭に置いて設計する必要があります。 [フォローアップ プロンプト](../tutorials/guided-conversations.md)は、会話フローを可能にする QnA ペア間のリンクを提供します。

### <a name="authoring-with-collaborators"></a>コラボレーターとの作成

コラボレーターは、ナレッジ ベース アプリケーションの完全な開発スタックを共有する他の開発者であることも、ナレッジ ベースの作成のみに制限されていることもあります。

ナレッジ ベースの作成では、コラボレーターの機能の範囲を制限するために、Azure portal で適用するいくつかのロールベースのアクセス許可をサポートしています。

## <a name="integration-with-client-applications"></a>クライアント アプリケーションとの統合

クライアント アプリケーションとの統合は、予測ランタイム エンドポイントにクエリを送信することで実現します。 クエリは、質問応答の Web アプリ エンドポイントへの SDK または REST ベースの要求と共に、特定のプロジェクトまたはナレッジ ベースに送信されます。

クライアント要求を正しく認証するためには、クライアント アプリケーションが正しい資格情報とナレッジ ベース ID を送信する必要があります。 Azure Bot Service を使用する場合は、Azure portal でボット構成の一部として設定を構成します。

### <a name="conversation-flow-in-a-client-application"></a>クライアント アプリケーションでの会話フロー

Azure ボットなどのクライアント アプリケーションでの会話フローでは、ナレッジ ベースとの対話の前後に機能が必要になる場合があります。

お使いのクライアント アプリケーションは、フォローアップ プロンプトを処理する別の手段を提供するか、おしゃべりを含めることで、会話フローをサポートしていますか。 その場合は、これらを早期に設計し、別のサービスによって、またはナレッジ ベースに送信されたときに、クライアント アプリケーション クエリが正しく処理されるようにします。

### <a name="active-learning-from-a-client-application"></a>クライアント アプリケーションからのアクティブ ラーニング

質問応答では、_アクティブ ラーニング_ を使用して、回答に関する代わりの質問を提案することで、ナレッジ ベースを向上させます。 この[アクティブ ラーニング](../tutorials/active-learning.md)の一部は、クライアント アプリケーションで行う必要があります。 クライアント アプリケーションでは、会話型のプロンプトを通じて、ナレッジ ベースからユーザーにとって役に立たない回答が返されたことを判断し、より適切な回答を判断することができます。 クライアント アプリケーションは、予測品質を向上させるために、ナレッジ ベースにその情報を返信する必要があります。

### <a name="providing-a-default-answer"></a>既定の回答の提供

ナレッジ ベースは、回答が見つからない場合は _既定の回答_ を返します。 この回答は、 **[設定]** ページで構成できます。

この既定の回答は、Azure ボットの既定の回答とは異なります。 構成設定の一環として、Azure portal で Azure ボットの既定の回答を構成します。 これは、スコアのしきい値が満たされない場合に返されます。

## <a name="prediction"></a>予測

予測は、ナレッジ ベースからの応答であり、回答だけでなく、さらに多くの情報が含まれています。 クエリ予測応答を取得するには、質問応答 API を使用します。

### <a name="prediction-score-fluctuations"></a>予測スコアの変動

スコアは、次のいくつかの要因に基づいて変化することがあります。

* `top` プロパティを使用した応答で要求された回答の数
* 利用できるさまざまな代わりの質問
* メタデータのフィルター処理
* `test` または `production` のプロジェクトまたはナレッジ ベースに送信されるクエリ。

### <a name="analytics-with-azure-monitor"></a>Analytics と Azure Monitor

質問応答で、テレメトリは [Azure Monitor サービス](../../../../azure-monitor/index.yml)を通じて提供されます。 [上位のクエリ](../how-to/analytics.md)を使用して、メトリックを理解します。

## <a name="development-lifecycle"></a>開発ライフサイクル

ナレッジ ベースの開発ライフサイクルは、ナレッジ ベースの編集、テスト、および発行です。

### <a name="knowledge-base-development-of-question-answer-pairs"></a>質問回答ペアのナレッジ ベースの開発

QnA ペアは、クライアント アプリケーションの使用状況に基づいて設計および開発する必要があります。

各ペアには次のものを含めることができます。
* メタデータ - クエリ時に絞り込んで、データのソース、コンテンツ、形式、および目的に関する追加情報を使用して QnA ペアにタグを付けることができます。
* フォローアップ プロンプト - ユーザーが正しい回答を受け取るように、ナレッジ ベースからのパスを決定するために役立ちます。
* 代替の質問 - さまざまな形式の質問からの回答と検索を一致させるために重要です。 [アクティブ ラーニングの提案](../tutorials/active-learning.md)は代わりの質問に変わります。

### <a name="devops-development"></a>DevOps 開発

DevOps パイプラインに挿入するナレッジ ベースを開発するには、バッチ テスト中にナレッジ ベースを分離する必要があります。

ナレッジ ベースは、言語リソースの他のすべてのナレッジ ベースと Cognitive Search インデックスを共有します。 ナレッジ ベースはパーティションによって分離されますが、インデックスを共有すると、発行されたナレッジ ベースと比較したときにスコアの差が生じる可能性があります。

`test` と `production` のナレッジ ベースを _同じスコア_ にするためには、言語リソースを 1 つのナレッジ ベースに分離します。 このアーキテクチャでは、リソースは分離されたバッチ テストの長さまで有効である必要があります。

## <a name="next-steps"></a>次のステップ

* [Azure リソース](./azure-resources.md)
