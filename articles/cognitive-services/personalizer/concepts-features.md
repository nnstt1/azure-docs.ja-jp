---
title: '機能: アクションとコンテキスト - Personalizer'
titleSuffix: Azure Cognitive Services
description: Personalizer では、ランキングでより良い提案を行う目的で、フィーチャー、つまり、アクションとコンテキストに関する情報が利用されます。 フィーチャーは非常に包括的になることがあれば、ある項目に固有となることもあります。
author: jeffmend
ms.author: jeffme
ms.manager: nitinme
ms.service: cognitive-services
ms.subservice: personalizer
ms.topic: conceptual
ms.date: 10/14/2019
ms.openlocfilehash: 8faae773e2ca3e1da51c23967ad6d9ba3fa2c1b7
ms.sourcegitcommit: 702df701fff4ec6cc39134aa607d023c766adec3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/03/2021
ms.locfileid: "131426071"
---
# <a name="features-are-information-about-actions-and-context"></a>フィーチャーはアクションとコンテキストに関する情報です。

Personalizer サービスは、特定のコンテキストでアプリケーションがユーザーに表示する内容を学習することで機能します。

Personalizer では、**現在のコンテキスト** に関する情報である **フィーチャー** を利用し、最良の **アクション** が選択されます。 フィーチャーは、より高いリワードを得る目的でパーソナライズに役立つと思われるあらゆる情報です。 フィーチャーは非常に包括的になることがあれば、ある項目に固有となることもあります。 

**フィーチャー** の例:

* `Sports_Shopper` などの _ユーザーのペルソナ_。 個々のユーザー ID を指定することはできません。 
* _コンテンツ_。動画が `Documentary`、`Movie`、または `TV Series` であるかどうかや、ある品物を店舗で利用できるかどうかなど。
* _現在_ の期間。現在の曜日など。

Personalizer では、アクションとコンテキストに対して送信できるフィーチャーを規定したり、制限したり、修正したりすることはありません。

* あるフィーチャーを一部のアクションに対して送信できても、他のアクションに対しては、それが与えられていなければ送信できません。 たとえば、テレビ シリーズには映画に与えられていない属性が与えられていることがあります。
* 一部のフィーチャーは利用できる時間帯が限られていることがあります。 たとえば、モバイル アプリケーションの場合、Web ページより提供する情報が多いことがあります。 
* 時間の経過と共に、コンテキストやアクションに関するフィーチャーを追加したり、削除したりすることができます。 Personalizer では、利用可能な情報から学習が継続されます。
* コンテキストに対してはフィーチャーが少なくとも 1 つ存在する必要があります。 Personalizer では、空のコンテキストはサポートされていません。 毎回、決まったコンテキストばかり送信する場合、Personalizer は、アクション内のフィーチャーに関してのみ、ランキングのアクションを選択します。
* カテゴリの特徴の場合、指定可能な値を定義する必要はなく、数値の範囲を事前定義する必要はありません。

## <a name="supported-feature-types"></a>サポートされているフィーチャーの種類

Personalizer では、フィーチャーとして文字列、数値、ブールをサポートしています。 ほとんどの場合、いくつかの例外を除いて、アプリケーションには主に文字列フィーチャーが使用されます。

### <a name="how-choice-of-feature-type-affects-machine-learning-in-personalizer"></a>フィーチャーの種類の選択が Personalizer で Machine Learning に及ぼす影響

* **文字列**:文字列型の場合、キーと値のすべての組み合わせがワンホット フィーチャーとして扱われます (たとえば、genre:"ScienceFiction" および genre:"Documentary" により、機械学習モデルの 2 つの新しい入力フィーチャーが作成されます。
* **数値**:数値が、パーソナライズ結果に比例して影響する規模である場合は、数値を使用してください。 これはシナリオに大きく依存します。 店舗体験をパーソナライズする場合のような単純化した例では、2 匹または 3 匹のペットを飼っている人が、1 匹しか飼っていない人の 2 倍または 3 倍、パーソナライズ結果に影響を及ぼすようにしたいので、数値である NumberOfPetsOwned がフィーチャーの候補になります。 数値単位に基づき、意味が線形ではないフィーチャー (年齢、気温、身長など) は、文字列としてエンコードすることをお勧めします。 たとえば、DayOfMonth の場合、"1"、"2"、..."31" の文字列です。 多くのカテゴリがある場合、通常、フィーチャーの品質を向上させるには、範囲を使用します。 たとえば、年齢は "Age":"0-5"、"Age":"6-10" などのようにエンコードできます。
* "false" の値で送信された **ブール** 値は、まったく送信されなかったかのように機能します。

存在しないフィーチャーは要求から除外してください。 null 値を含むフィーチャーの送信は避けてください。モデルをトレーニングするとき、存在するものとして、かつ、値 "null" で処理されます。

## <a name="categorize-features-with-namespaces"></a>名前空間でフィーチャーを分類する

Personalizer では、フィーチャーが名前空間で整理されます。 ユーザーは自分のアプリケーションで、名前空間が使用されているかどうかとそれがどのような名前空間であるかを判断します。 名前空間は、同様のトピックなどのフィーチャーや情報源を同じくするフィーチャーをグループ化する目的で使用されます。

アプリケーションで使用されるフィーチャーの名前空間の例:

* User_Profile_from_CRM
* 時刻
* Mobile_Device_Info
* http_user_agent
* VideoResolution
* UserDeviceInfo
* Weather
* Product_Recommendation_Ratings
* current_time
* NewsArticle_TextAnalytics

有効な JSON キーである限り、自分の命名規則でフィーチャーの名前空間に名前を付けることができます。 名前空間は、フィーチャーを個別のセットに整理したり、類似した名前のフィーチャーを明確にしたりするために使用されます。 名前空間は、フィーチャー名に追加される "接頭辞" と考えることができます。 名前空間を入れ子にすることはできません。


次の JSON では、`user`、`environment`、`device`、および `activity` がフィーチャーの名前空間です。 

> [!Note]
> 現在のところ、フィーチャー名前空間には、UTF-8 ベースであり、異なる文字で始まる名前の使用を強くお勧めします。 たとえば、`user`、`environment`、`device`、および `activity` はそれぞれ、`u`、`e`、`d`、および `a` で始まります。 現在のところ、名前空間の最初の文字が同じ場合、機械学習に使用されるインデックスで競合が発生することがあります。

JSON オブジェクトには、入れ子にした JSON オブジェクトと単純なプロパティ/値を含めることができます。 配列は、配列の項目が数値の場合にのみ含めることができます。 

```JSON
{
    "contextFeatures": [
        { 
            "user": {
                "profileType":"AnonymousUser",
                "latlong": ["47.6,-122.1"]
            }
        },
        {
            "environment": {
                "dayOfMonth": "28",
                "monthOfYear": "8",
                "timeOfDay": "13:00",
                "weather": "sunny"
            }
        },
        {
            "device": {
                "mobile":true,
                "Windows":true
            }
        },
        {
            "activity" : {
                "itemsInCart": 3,
                "cartValue": 250,
                "appliedCoupon": true
            }
        }
    ]
}
```

### <a name="restrictions-in-character-sets-for-namespaces"></a>名前空間での文字セットにおける制限事項

名前空間に名前を付けるために使用する文字列は、いくつかの制限に従う必要があります。 
* Unicode にすることはできません。
* 名前空間の名前には、コード < 256 での印刷可能な記号の一部を使用できます。 
* コード < 32 (印刷不可)、32 (スペース)、58 (コロン)、124 (パイプ)、および126 から 140 での記号は使用できません。
* 先頭にアンダースコア "_" を使用することはできません。使用すると、この機能は無視されます。

## <a name="how-to-make-feature-sets-more-effective-for-personalizer"></a>Personalizer のためにフィーチャー セットをより効果的にする方法

最高のリワードを作り出すアクションを予測する方法が Personalizer で学習されるようにするには、優れたフィーチャー セットが有用です。 

次の推奨項目に従う Personalizer Rank API にフィーチャーを送信することを検討してください。

* 規模ではないフィーチャーには、カテゴリと文字列の型を使用します。 

* パーソナライズを進めるために十分なフィーチャーがあります。 コンテンツの対象を絞り込む必要性が上がるにつれて、必要とされるフィーチャーの数も増えます。

* 多様な *密度* のフィーチャーが十分にあります。 たくさんの項目が 2、3 のバケットにグループ化される場合、フィーチャーは *密度が高く* なります。 たとえば、大量の動画を "長編" (5 分以上) と "短編" (5 分未満) に分類できます。 これは *非常に密度の高い* フィーチャーです。 一方で、同じくらい大量の項目に "タイトル" という属性を与えることができます。その属性に項目間で同じ値が与えられることはほとんどありません。 これは密度が非常に低い、*まばらな* フィーチャーです。  

フィーチャーの密度が高ければ、Personalizer により項目間で推測しながら学習されます。 ただし、フィーチャーがいくつかあり、密度が高すぎる場合、Personalizer では、数少ない選択可能なバケットから、コンテンツの対象がより正確に絞り込まれるように試行されます。

### <a name="improve-feature-sets"></a>フィーチャー セットを改善する 

オフライン評価でユーザーの行動を分析する これにより、過去のデータを見て、ポジティブなリワードに大きく貢献しているフィーチャーと貢献度が低いフィーチャーを比較できます。 どのフィーチャーが役立っているのか判断できます。Personalizer に送信するより良いフィーチャーを見つけ、結果をさらに改善するのは利用者とそのアプリケーション次第となります。

次のセクションでは、Personalizer に送信されるフィーチャーを改善するための一般的な慣例を紹介します。

#### <a name="make-features-more-dense"></a>フィーチャーの密度を高くする

編集してもっと大きくしたり、密度を高くしたり、低くしたりすることでフィーチャーセットを改善できます。

たとえば、タイムスタンプを秒まで下げると、フィーチャーが非常にまばらになります。 これは "朝"、"真昼"、"午後" などに時間帯を分類することで高密度にする (効率的にする) ことができます。

位置情報では、通常、より広範な分類を作成することによってメリットが得られます。 たとえば、緯度:47.67402° N、経度:122.12154 ° W の座標は正確すぎ、モデルは、緯度と経度を明確なディメンションとして学習するように強制されます。 位置情報に基づいて個人用に設定する場合は、より大きなセクターに位置情報をグループ化すると便利です。 そのための簡単な方法として、緯度と経度の数値に対して適切な丸め精度を選択し、緯度と経度を 1 つの文字列にすることで、それらを "区分" へと結合します。 たとえば、幅約数キロメートルのリージョン内の緯度: 47.67402 ° N、経度:122.12154 ° W は、"34.3, 12.1" と表すことができます。


#### <a name="expand-feature-sets-with-extrapolated-information"></a>推定した情報でフィーチャーセットを拡大する

まだ推定されていないが、既に与えられている情報から引き出せる属性を思い付くことでもフィーチャーを増やすことができます。 たとえば、架空の映画リストをパーソナライズするとき、週末と平日で異なる行動をユーザーから引き出せるでしょうか? 時間帯を拡大し、"週末" または "平日" 属性を与えることができます。 国の文化的休日は特定の種類の映画に対する注目を促しますか? たとえば、"ハロウィーン" という属性はそれが関連する箇所で便利です。 多くの人にとって雨が映画の選択に大きな影響を与えるということがあるでしょうか? 天気サービスはそのような情報を時間と場所と共に提供することがあります。それを特別のフィーチャーとして追加できます。 

#### <a name="expand-feature-sets-with-artificial-intelligence-and-cognitive-services"></a>人工知能や認知サービスでフィーチャーセットを拡大する

Artificial Intelligence や、すぐに実行できる Cognitive Services は Personalizer にとって非常に強力な追加機能となります。 

人工知能サービスを利用して項目を事前に処理することで、パーソナライズに関連する可能性がある情報を自動的に抽出できます。

以下に例を示します。

* [Video Indexer](https://azure.microsoft.com/services/media-services/video-indexer/) で映画ファイルを実行し、シーンの要素、テキスト、センチメント、その他さまざまな属性を抽出できます。 そのような属性は密度を高くし、元の項目メタデータにはなかった特性を反映できます。 
* たとえば、画像は物体検出で、顔はセンチメントで実行できます。
* テキストに含まれる情報は、エンティティの抽出、センチメント、Bing ナレッジ グラフによるエンティティの拡大などで強化できます。

他にも次のような [Azure Cognitive Services](https://www.microsoft.com/cognitive-services) を利用できます。

* [Entity Linking](../text-analytics/index.yml)
* [言語サービス](../language-service/index.yml)
* [感情](../face/overview.md)
* [Computer Vision](../computer-vision/overview.md)

## <a name="actions-represent-a-list-of-options"></a>アクションはオプションの一覧を表します

各アクション:

* _イベント_ ID があります。 イベント ID が既にある場合は、それを送信する必要があります。 イベント ID を持っていない場合は送信しないでください。Personalizer によってイベント ID が作成され、Rank 要求の応答で返されます。 ID はユーザーではなく Rank イベントに関連付けられています。 ID を作成する場合は、GUID が最適です。 
* フィーチャーの一覧があります。
* フィーチャーの一覧は大規模 (数百単位) になることがありますが、フィーチャーの効果を評価し、リワードに貢献しないフィーチャーを取り除くことが推奨されます。 
* **アクション** のフィーチャーは、Personalizer によって使用される **コンテキスト** のフィーチャーとの間に相関関係がある場合とない場合があります。
* アクションのフィーチャーは、一部のアクションにのみ存在することがあります。 
* 特定のアクション ID のフィーチャーは 1 日だけ利用できて、その後は利用不可能になることがあります。 

Personalizer の機械学習アルゴリズムは、フィーチャーセットが安定しているときにより効果的に実行されますが、Rank コールは、フィーチャーセットが時間と共に変化する場合、失敗しません。

アクションに順位を付けるとき、50 を超えるアクションを送信しないでください。 毎回同じ 50 のアクションになることもあれば、変わることもあります。 たとえば、eコマース アプリケーションに品物が 10,000 個の製品カタログを用意している場合、レコメンデーションまたはフィルター エンジンを使用し、顧客が気に入りそうな上位 40 品目を決定することがあります。また、Personalizer を使用し、現在のコンテキストに対して生成するリワードが最も大きい (たとえば、ユーザーが買い物かごに追加する) 品目を見つけることがあります。


### <a name="examples-of-actions"></a>アクションの例

Rank API に送信するアクションは、パーソナライズしようとしている内容に依存します。

次に例をいくつか示します。

|目的|アクション|
|--|--|
|ニュース Web サイトで強調表示する記事をパーソナライズします。|各アクションは潜在的にニュース記事です。|
|Web サイトでの広告配置を最適化します。|各アクションはレイアウトか広告のレイアウトを作成するルールになります (たとえば、上に小さい画像、右に大きい画像)。|
|買い物 Web サイトにお勧めの品目を個人的にランク付けして表示します。|各アクションは特定の製品になります。|
|特定の写真に適用するフィルターなど、ユーザー インターフェイス要素を提案します。|各アクションは異なるフィルターになることがあります。|
|チャット ボットの応答を選択し、ユーザーの意図を明確にするか、アクションを提案します。|各アクションは、応答を解釈する方法の選択肢です。|
|検索結果一覧の一番上に表示するものを選択します|各アクションは上位検索結果の 1 つです。|


### <a name="examples-of-features-for-actions"></a>アクションのフィーチャーの例

次は、アクションのフィーチャーの好例です。 これらは各アプリケーションに大きく依存します。

* アクションの特性を持つフィーチャー。 たとえば、それは映画ですか? それともテレビ シリーズですか?
* 過去にユーザーがこのアクションとどのようにやりとりした可能性があるかに関するフィーチャー。 たとえば、この映画は人口統計 A または B の住民が一番多く見ています。再生回数は概して 1 回のみです。
* ユーザーがアクションを *見る* 方法という特性に関するフィーチャー。 たとえば、サムネイルに表示されている映画のポスターには、顔、車、または景色が含まれていますか?

### <a name="load-actions-from-the-client-application"></a>クライアント アプリケーションからアクションを読み込む

アクションのフィーチャーは通常、コンテンツ管理システム、カタログ、推奨システムを情報源とします。 アプリケーションは、関連するデータベースやシステムからアクションに関する情報を読み込む役目を担います。 アクションが変わらない場合、あるいは毎回読み込むことがパフォーマンスに不要な影響を与える場合、この情報をキャッシュするロジックをアプリケーションに追加できます。

### <a name="prevent-actions-from-being-ranked"></a>ランク付けの対象からアクションを外す

ユーザーに見せたくないアクションが存在する場合があります。 アクションが一番上にランクされることを防ぐ最も良い方法は、Rank API のアクション一覧にアクションをそもそも含めないことです。

Rank API コールの結果として生成される _アクション_ をユーザーに見せる場合、ビジネス ロジックの後半でそれを判断することがあります。 そのような場合、_非アクティブ イベント_ を使用してください。

## <a name="json-format-for-actions"></a>アクションの JSON 形式

Rank を呼び出すとき、次から複数のアクションを選択して送信します。

JSON オブジェクトには、入れ子にした JSON オブジェクトと単純なプロパティ/値を含めることができます。 配列は、配列の項目が数値の場合にのみ含めることができます。 

```json
{
    "actions": [
    {
      "id": "pasta",
      "features": [
        {
          "taste": "salty",
          "spiceLevel": "medium",
          "grams": [400,800]
        },
        {
          "nutritionLevel": 5,
          "cuisine": "italian"
        }
      ]
    },
    {
      "id": "ice cream",
      "features": [
        {
          "taste": "sweet",
          "spiceLevel": "none",
          "grams": [150, 300, 450]
        },
        {
          "nutritionalLevel": 2
        }
      ]
    },
    {
      "id": "juice",
      "features": [
        {
          "taste": "sweet",
          "spiceLevel": "none",
          "grams": [300, 600, 900]
        },
        {
          "nutritionLevel": 5
        },
        {
          "drink": true
        }
      ]
    },
    {
      "id": "salad",
      "features": [
        {
          "taste": "salty",
          "spiceLevel": "low",
          "grams": [300, 600]
        },
        {
          "nutritionLevel": 8
        }
      ]
    }
  ]
}
```

## <a name="examples-of-context-information"></a>コンテキスト情報の例

_コンテキスト_ の情報は各アプリケーションとユース ケースに左右されますが、通常、次のような情報が含まれます。

* ユーザーの人口統計情報とプロフィール情報。
* ユーザー エージェントなど、HTTP ヘッダーから抽出された情報、または IP アドレスに基づく地理的逆参照など、HTTP 情報から誘導された情報。
* 曜日、週末または平日、午前または午後、休暇期または労働期など、現在の時間に関する情報。
* 場所、移動、バッテリ レベルなど、モバイル アプリケーションから抽出された情報。
* このユーザーが最も多く視聴している映画のジャンルなど、ユーザーの過去の行動の集計。

アプリケーションは、関連するデータベース、センサー、システムからコンテキストに関する情報を読み込む役目を担います。 コンテキスト情報が変わらない場合、Rank API に送信する前に、この情報をキャッシュするロジックをアプリケーションに追加できます。

## <a name="json-format-for-context"></a>コンテキストの JSON 形式 

コンテキストは、Rank API に送信される JSON オブジェクトとして表現されます。

JSON オブジェクトには、入れ子にした JSON オブジェクトと単純なプロパティ/値を含めることができます。 配列は、配列の項目が数値の場合にのみ含めることができます。 

```JSON
{
    "contextFeatures": [
        { 
            "user": {
                "name":"Doug"
            }
        },
        {
            "state": {
                "timeOfDay": "noon",
                "weather": "sunny"
            }
        },
        {
            "device": {
                "mobile":true,
                "Windows":true,
                "screensize": [1680,1050]
                }
            }
        }
    ]
}
```

## <a name="next-steps"></a>次のステップ

[強化学習](concepts-reinforcement-learning.md)
