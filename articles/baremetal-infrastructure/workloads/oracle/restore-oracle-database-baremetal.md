---
title: Oracle Database を復元する
description: SnapCenter を使用して BareMetal インフラストラクチャ上の Oracle Database を復元する方法について説明します。
ms.topic: how-to
ms.subservice: baremetal-oracle
ms.date: 10/12/2021
ms.openlocfilehash: e4acd2b0c438ebee80571360b540e235ccb2c0f8
ms.sourcegitcommit: 611b35ce0f667913105ab82b23aab05a67e89fb7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/14/2021
ms.locfileid: "130001544"
---
# <a name="restore-oracle-database"></a>Oracle Database を復元する

この記事では、SnapCenter を使用して BareMetal インフラストラクチャ上の Oracle Database を復元する手順について説明します。

BareMetal インフラストラクチャ上の Oracle Database を復元するにはいくつかのオプションがあります。 復元を行う前に、[、Oracle 復元決定マトリックス](oracle-high-availability-recovery.md#choose-your-method-of-recovery)を確認することをお勧めします。 このマトリックスは、回復にかかる時間と失われる可能性があるデータに基づいて、最も適切な復元方法を選択するのに役立ちます。 

通常、目標はデータベースを最後の既知の回復ポイントに復元することなので、データ ボリュームとアーカイブ ログ ボリュームの最新のスナップショットを復元します。 スナップショットの復元は永続的なプロセスです。 

>[!IMPORTANT]
>適切なスナップショットが復元されるように、注意する必要があります。 あるスナップショットから復元すると、他のすべてのスナップショットとその関連データが削除されます。 これには、復元対象に選択したスナップショットより新しいスナップショットも含まれます。 そのため、復元プロセスは控えめに使用することをお勧めします。 どのスナップショットを回復する必要があるか判断に迷う場合は、より新しいスナップショットを最初に使用するようにしてください。

## <a name="restore-database-locally-with-restored-archive-logs"></a>復元されたアーカイブ ログを使用してローカル環境でデータベースを復元する

回復を試みる前に、データベースをオフラインにする必要があります (まだ行っていない場合)。 Oracle Real Application Clusters (RAC) 内のどのノードでもデータベースが実行されていないことを確認したら、始めることができる状態になります。 最初に、アーカイブ ログを復元します。 

1. 使用可能なバックアップを確認します。 SnapCenter の左側のメニューで **[Resources]\(リソース\)** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-database-available-backups.png" alt-text="データベース ビューを示すスクリーンショット。":::

2. 一覧から復元するデータベースを選択します。 データベースには、作成されたリソース グループの一覧と、関連付けられているポリシーが含まれます。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/available-backups-list.png" alt-text="復元に使用可能なバックアップの完全な一覧を示すスクリーンショット。":::

3. その後、プライマリ バックアップの一覧が表示されます。 バックアップは、バックアップ名とその種類 (ログまたはデータ) によって識別されます。 SnapCenter はアーカイブ ログ ボリュームを直接復元するように設計されていないため、ログの復元を最初に処理します。 復元する必要があるアーカイブ ログ ボリュームを特定します。 通常、ほとんどの回復では前回正常起動時のデータファイル バックアップからすべてのアーカイブ ログがロールフォワードされるため、復元するボリュームは最新のバックアップです。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/primary-backups-list.png" alt-text="プライマリ バックアップの一覧を示すスクリーンショット。":::

4. アーカイブ ログ ボリュームを選択すると、バックアップ一覧の右上隅にあるマウント オプションが有効になります。 **[マウント]** を選択します。 [Mount backups]\(バックアップのマウント\) ページで、ドロップダウンからバックアップをマウントするホストを選択します。 任意の RAC ノードを選択できますが、アーカイブ ログとデータファイル回復ホストは同じである必要があります。 後のステップでデータファイルを回復するために使用するため、マウント パスをコピーしておきます。 **[マウント]** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-database-mount-backups.png" alt-text="マウントするバックアップを示すスクリーンショット。":::

5. バックアップ ジョブとは異なり、このページのジョブ ビューアーにはマウント処理の状態は表示されません。 マウントの状態を確認するには、左側のメニューの **[Monitor]\(モニター\)** を選択します。 それにより、実行されたすべてのジョブの状態が強調表示されます。 マウント操作が最初のエントリのはずです。 コピーしたマウント パスに移動して、アーカイブ ログが存在することを確認することもできます。

    そのファイルシステムのマウント先に選択されているホストの /etc/fstab にも、上記のマウント パスでエントリが作成されます。 回復が完了したら、それを削除できます。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-database-mount-output.png" alt-text="マウントの出力を示すスクリーンショット。":::

6. 次に、データファイルとコントロール ファイルを復元します。 前と同様に、左側のメニューから **[Resources]\(リソース\)** を選択し、復元するデータベースを選択します。 復元するデータ バックアップを選択します。 ここでも、通常は最新のバックアップを復元します。 今度は、データ バックアップを選択すると、復元オプションが有効になります。 **[復元]** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-database-selected-data-backup.png" alt-text="復元するデータ バックアップのスクリーンショット。":::

7. **[Restore Scope]\(復元スコープ\)** タブ: 前にログ ファイルをマウントするために選択したのと同じホストを、ドロップダウンから選択します。 **[All Datafiles]\(すべてのデータ ファイル\)** が選択されていることを確認し、 **[Control files]\(コントロール ファイル\)** のチェック ボックスをオンにします。 **[次へ]** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-database-recovery-scope.png" alt-text="データファイルの復元スコープの詳細を示すスクリーンショット。":::

8. **[Recovery Scope]\(回復スコープ\)** タブ: マウントされたログ バックアップからのシステム変更番号 (SCN) が入力されます。 **[Until SCN]\(SCN まで\)** も選択されています。 
 
    SCN は、各バックアップのすべてのバックアップの一覧で確認できます。 **[Specify external archive log files locations]\(外部アーカイブ ログ ファイルの場所を指定する\)** に、前にコピーしたマウント ポイントの場所も入力されます。 現在、複数のアーカイブ ログの復元場所の処理は、このドキュメントでは説明されていません。 **[次へ]** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-database-choose-recovery-scope.png" alt-text="回復スコープのオプションを示すスクリーンショット。":::

9. **[PreOps]** タブ: 現在、復元前プロセスの一部としてのスクリプトは推奨されていません。 **[次へ]** を選択します。

10. [PostOps] タブ: ここでもやはり、復元後プロセスの一部としてのスクリプトはサポートされていません。 **[Open the database or container database in READ-WRITE mode after recovery]\(回復後にデータベースまたはコンテナー データベースを READ-WRITE モードで開く\)** チェック ボックスをオンにします。 **[次へ]** を選択します。

11. **[Notification]\(通知\)** タブ: SMTP サーバーが使用可能で、復元プロセスのメール通知が必要な場合は、メールの設定を入力します。 **[次へ]** を選択します。

12. **[Summary]\(概要\)** タブ: すべての詳細が正しいことを確認します。 **[完了]** を選択します。

13. **[Activity]\(アクティビティ\)** の下部画面で復元ジョブを選択すると、復元の状態を確認できます。 緑色の矢印を選択して各復元サブセクションとその進行状況を開くと、進行状況を確認できます。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-job-details.png" alt-text="復元ジョブの詳細を示すスクリーンショット。":::

    復元が完了すると、すべてのステップがチェック マークに変わります。 **[閉じる]** を選択します。

    作成された単純なデータベース内の削除された行は、復元されたものとして検証されます。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/output-of-restored-files.png" alt-text="復元されたファイルの出力検証を示すスクリーンショット。":::

## <a name="clone-database-locally-or-remotely"></a>ローカル環境またはリモート環境にデータベースを複製する

データベースの複製は復元プロセスと似ています。 データベースの複製操作は、必要な結果に応じて、ローカル環境またはリモート環境のいずれかで使用できます。 ディザスター リカバリー (DR) の場所でのデータベースの複製は、ディザスター リカバリーのフェールオーバー テストや、運用データの QA ステージングなど、いくつかの目的で役に立ちます。 これは、ディザスター リカバリーの場所がテスト、開発、QA などに使用されることを前提としています。

### <a name="create-a-clone"></a>複製を作成する

SnapCenter を使用すると、複製を作成することができ、スナップショットを特定の時点の参照として使用できます。 さらに、ポインターを使用すれば、親ボリュームと複製されたボリュームとの間で、類似したデータ セットをキャプチャできます。 複製されたボリュームは読み取り/書き込み可能であり、書き込みによってのみ拡張されます。 しかし、読み取りは親ボリュームで行われます。 この機能を使用すると、親ボリュームに存在するデータに干渉することなく、ホストで使用できるデータの "複製" セットを作成できます。 

この機能は、ディザスター リカバリー テストで特に役立ちます。 一時ファイル システムは、実際の回復で使用されるのと同じスナップショットに基づいて作成されます。 データを検証し、アプリケーションが期待どおりに動作することを確認した後、ディザスター リカバリーのボリュームやレプリケーションに影響を与えることなく、ディザスター リカバリー テストをシャットダウンできます。

データベースの複製手順は次のとおりです。 

1. SnapCenter で **[Resources]\(リソース\)** を選択し、複製するデータベースを選択します。 複製をローカル環境に作成する場合は、次のステップに進みます。 セカンダリ ロケーションに複製を復元する場合は、[Mirror Copies]\(ミラー コピー\) ボックスの上のバックアップを選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/clone-database-manage-copies.png" alt-text="データベースで管理されているコピーの複製の図。":::

2. 表示されたバックアップの一覧から、適切なデータ バックアップを選択します。 **[複製]** を選択します。

    >[!NOTE]
    >タイムスタンプの複製が必要な場合は、タイムスタンプまたはシステム変更番号 (SCN) より前にデータ バックアップが作成されている必要があります。 

3. **[Name]\(名前\)** タブ: 複製の **SID** の名前を入力します。 データ ログとアーカイブ ログの **[Source Volume]\(複製元ボリューム\)** と **[Destination Volume]\(複製先ボリューム\)** が、Microsoft Operations でディザスター リカバリー マッピング用に提供されたものと一致している必要があります。 **[次へ]** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/provide-clone-database-sid.png" alt-text="データベース SID を入力する場所を示すスクリーンショット。":::

4. **[Locations]\(場所\)** タブ: データファイルの場所、コントロール ファイル、やり直しログには、複製操作によって回復に必要なファイル システムが作成されます。 これらは、そのままにすることをお勧めします。 代替手段を調べることは、このドキュメントの範囲を超えたものになります。 復元の場所に適切なホストが選択されていることを確認します。 **[次へ]** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/clone-database-select-host.png" alt-text="複製するホストの選択方法を示すスクリーンショット。":::

5. **[Credentials]\(資格情報\)** タブ: 資格情報と Oracle ホーム設定の値は、既存の運用場所から取得されます。 セカンダリ ロケーションの値がプライマリ ロケーションとは異なることがわかっている場合を除き、これらはそのままにすることをお勧めします。 **[次へ]** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/clone-database-credentials.png" alt-text="複製のデータベース資格情報の入力に関するスクリーンショット。":::

6. **[PreOps]** タブ: 現在、回復前スクリプトはサポートされていません。 **[次へ]** を選択します。

7. **[PostOps]** タブ: データベースを特定の時刻または SCN までだけ回復する場合は、適切なラジオ ボタンを選択し、タイムスタンプまたは SCN を追加します。 データベースは SnapCenter によってその時点に達するまで回復されます。 それ以外の場合は、 **[Until Cancel]\(キャンセルまで\)** をそのまま選択しておきます。 **[次へ]** を選択します。

8. **[Notification]\(通知\)** タブ: 複製完了の通知メールを受け取る場合は、必要な SMTP 情報を入力します。 **[次へ]** を選択します。

9. **[Summary]\(概要\)** タブ: 適切な **[Clone SID]\(複製 SID\)** が入力され、正しいホストが選択されていることを確認します。 下にスクロールして、適切な回復スコープが入力されていることを確認します。 **[完了]** を選択します。

10. 画面下部のアクティブなポップアップに、複製ジョブが表示されます。 ジョブの詳細を表示するには、複製アクティビティを選択します。 アクティビティが完了すると、[Job Details]\(ジョブの詳細\) ページの表示がすべて緑色のチェック マークになり、完了時刻が示されます。 通常、複製には 7 から 10 分くらいかかります。

11. ジョブが完了したら、複製のターゲットとして使用されたホストに切り替え、cat /etc/fstab を使用してマウント ポイントを確認します。 この確認により、複製ウィザードで一覧表示されたデータベースの適切なマウント ポイントが存在することが保証されます。 ウィザードで入力したデータベース SID も強調表示されます。 次の例では、SID はホスト上のマウント ポイントによって指定されたとおり dbsc4 になっています。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/clone-database-switch-to-target-host.png" alt-text="ターゲット ホストに切り替えるコマンドのスクリーンショット。":::

12. ホストで、「**oraenv**」と入力して **Enter** キーを押します。 新しく作成された SID を入力します。

    データベースが適切に復元されたことの確認は、ユーザーが行う必要があります。 ただし、次の追加の手順は、Oracle 以外のユーザーによって作成されたデータベースに基づいています。 

13. 「**sqlplus / as sysdba**」と入力します。 テーブルは別のユーザーで作成されているため、元の無効なユーザー名とパスワードが自動的に入力されます。 正しいユーザー名とパスワードを入力します。 サインインに成功すると、SQL> コマンド プロンプトが表示されます。

基本的なデータベースのクエリを入力して、適切なデータを受け取ることを確認します。 次の例では、アーカイブ ログを使用してデータベースをロールフォワードしています。 以下では、データ バックアップの作成後に複製テスト エントリが作成されたので、アーカイブ ログが適切に使用されたことを示しています。 つまり、アーカイブ ログがロールフォワードされなかった場合、そのエントリはリストに表示されません。

```sql
SQL> select * from acolvin.t;

COL1
-----------------------------------------
COL2
---------------
first insert
17-DEC-20

log restore
17-DEC-20

clonetest
18-DEC-20

COL1
-----------------------------------------
COL2
---------------
after first insert
17-DEC-20

next insert
17-DEC-20

final insert
18-DEC-20

COL1
-----------------------------------------
COL2
---------------
BILLY
17-DEC-20

7 rows selected.

```

### <a name="delete-a-clone"></a>クローンを削除する

使い終わった複製は削除することが重要です。 引き続き使用する場合は、複製を分割する必要があります。 複製の親であるスナップショットは、削除することができず、保持カウントの一部としてスキップされます。 使い終わった複製を削除しないと、保持しているスナップショットにより過剰なストレージが使用される可能性があります。 

複製を分割すると、既存のボリュームとスナップショットから新しいボリュームにデータがコピーされます。 このプロセスにより、複製と親スナップショットの間の関係が切り離されるため、保有数に達した時点でスナップショットを削除できます。 保持数に既に達している場合、スナップショットは次のスナップショットの時点で削除されます。 ただし、分割された複製でもストレージ コストが発生します。

複製が作成されると、そのデータベースのリソース タブには、ローカルとリモート両方の環境の複製が一覧表示されます。 複製を削除するには:

1. **[リソース]** タブ: 削除する複製が含まれるボックスを選択します。

2. [Secondary Mirror Clone(s)]\(セカンダリ ミラー複製\) ページに複製が表示されます。 この例の複製はセカンダリ ロケーションにあります。 複製一覧の右上隅にある **[Delete]\(削除\)** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/delete-clone-secondary-mirror-clones.png" alt-text="セカンダリ ミラー複製のスクリーンショット。":::

3. 実行する前に、SQLPLUS を終了したことを確認します。 **[OK]** を選択します。

4. ジョブの進行状況を表示するには、左側のメニューで **[Jobs]\(ジョブ\)** を選択します。 複製が削除されると、緑色のチェック マークが表示されます。

5. 複製が削除されたら、複製プロセスの一部として使用されたアーカイブ ログのマウントを解除すると便利な場合もあります (該当する場合)。 適切なバックアップの一覧 (複製を作成したときからのもの) に戻り、バックアップの一覧を、バックアップがマウントされているかどうかで並べ替えることができます。 並べ替えアルゴリズムは完全ではなく、常にすべての項目がまとめて並べ替えられるとは限りませんが、通常は正しい方向に並べ替えられます。 次のボリュームは、以前にマウントされています。 **[unmount]\(マウント解除\)** を選択します。

    :::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/delete-clone-unmount-backup.png" alt-text="バックアップの一覧を示すスクリーンショット。":::

6. **[OK]** を選択します。 左側のメニューの **[Monitor]\(監視\)** を選択することで、マウント解除ジョブの状態を確認できます。 バックアップがマウント解除されると、緑色のチェック マークが表示されます。

### <a name="split-a-clone"></a>複製を分割する

複製を分割すると、親ボリュームのコピーが作成されます。 その複製の作成に使用されたスナップショットが作成された時点までの親ボリュームのすべてのデータがレプリケートされます。 これにより、複製ボリュームから親ボリュームが分離され、複製ボリュームの作成に使用されたスナップショットに対するホールドが解除されます。 その後は、保持ポリシーの一部としてスナップショットを削除できます。

複製を分割すると、運用環境またはディザスター リカバリー環境にデータを設定するのに役立ちます。 それにより、新しいボリュームが親ボリュームから独立して機能するようにできます。

>[!NOTE]
>分割複製プロセスを元に戻したり、取り消したりすることはできません。

複製を分割するには:

1. 既に複製が格納されているデータベースを選択します。

2. 複製の場所を選択すると、[Secondary Mirror Clone(s)]\(セカンダリ ミラー クローン\) ページの一覧に表示されます。

3. 複製の一覧のすぐ上にある **[Clone Split]\(複製の分割\)** を選択します。 SnapCenter では、分割プロセスの一環としていかなる変更もできないので、次のページには、行われる変更だけが表示されます。 **[スタート]** を選択します。

    >[!NOTE]
    >コピーする必要があるデータの量、ストレージでのデータベースのレイアウト、ストレージのアクティビティ レベルによっては、分割プロセスにかなりの時間がかかることがあります。

プロセスが完了すると、分割された複製はバックアップの一覧から削除されます。 その複製に関連付けられていたスナップショットは、SnapCenter での通常の保持プランの一部として、自由に削除されるようになります。

## <a name="restore-database-remotely-after-disaster-recovery-event"></a>ディザスター リカバリー イベント後にデータベースをリモートで復元する

現在、SnapCenter はフェールオーバー プロセスを自動化するように設計されていません。 ディザスター リカバリー イベントが発生した場合、セカンダリ ロケーションでデータベースを復元するには、Microsoft Operations または REST 回復スクリプトが必要です。 REST 回復スクリプトの実行プロセスの詳細については、このドキュメントでは説明していません。

## <a name="restart-all-rac-nodes-after-restore"></a>復元後にすべての RAC ノードを再起動する

SnapCenter でデータベースを復元した後は、次に示すように、データベースの復元時に選択した RAC ノードで、それだけがアクティブになります。 この例では、任意の RAC ノードを選択して復元を行うことができることを示すため、データベースを bn6sc2 に復元しました。

:::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-database-example-output-rac-node.png" alt-text="データベースが bn6sc2 に復元されたことを示すスクリーンショット。":::

残りの RAC ノードを起動するには、_srvctl start database_ コマンドを使用します。 コマンドが完了したら、すべての RAC ノードが参加している状態を確認します。

:::image type="content" source="media/netapp-snapcenter-integration-oracle-baremetal/restore-database-srvctl-start-database-command.png" alt-text="残りの RAC ノードを再起動するための srvctl start database コマンドを示すスクリーンショット。":::

## <a name="unmount-log-archive-volume"></a>ログ アーカイブ ボリュームのマウントを解除する

データベースを複製または復元した後は、ログ アーカイブ ボリュームをマウント解除する必要があります。このボリュームは、データベースの復元にのみ使用され、その後は使用されません。 

1. **[Resources]\(リソース\)** タブで、ローカルまたはリモートの一覧を選択して、データベースの適切なバックアップ一覧を選択します。

2. 適切なバックアップの一覧を選択したら、バックアップがマウントされているかどうかを基にして並べ替えます。 並べ替えアルゴリズムは完全ではなく、常にすべての項目がまとめて並べ替えられるとは限りませんが、使用できる結果が得られます。 
 
3. 以前にマウントした目的のボリュームを見つけたら、 **[unmount]\(マウント解除\)** を選択します。 **[OK]** を選択します。

4. 左側のメニューの **[Monitor]\(監視\)** を選択することで、マウント解除ジョブの状態を確認できます。 ボリュームがマウント解除されると、緑色のチェック マークが表示されます。

>[!NOTE]
>マウント解除を選択すると、マウントされているホストの /etc/fstab からエントリが削除されます。 また、マウントを解除すると、保護ポリシーで設定されている保持ポリシーの一部として、必要に応じてバックアップを削除できるようになります。

## <a name="next-steps"></a>次のステップ

BareMetal での Oracle の高可用性とディザスター リカバリーの詳細を確認します。

> [!div class="nextstepaction"]
> [BareMetal の Oracle の高可用性とディザスター リカバリー](concepts-oracle-high-availability.md)
