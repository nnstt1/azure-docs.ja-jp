---
title: トラブルシューティング ガイド - Azure DNS
description: このラーニング パスでは、Azure DNS に関する一般的な問題のトラブルシューティングを開始します
services: dns
author: rohinkoul
ms.service: dns
ms.topic: troubleshooting
ms.date: 11/10/2021
ms.author: rohink
ms.openlocfilehash: bc003c640e51b855f446878aa0b5829b2d2c09c5
ms.sourcegitcommit: e1037fa0082931f3f0039b9a2761861b632e986d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/12/2021
ms.locfileid: "132400359"
---
# <a name="azure-dns-troubleshooting-guide"></a>Azure DNS トラブルシューティング ガイド

この記事では、Azure DNS についてよく寄せられる質問のトラブルシューティング情報を提供します。

次の手順で問題が解決しない場合は、[コミュニティ サポートの Microsoft Q&A 質問ページ](/answers/topics/azure-virtual-network.html)で検索したり、問題を投稿したりすることもできます。 または、Azure のサポート リクエストを開くことができます。

## <a name="i-cant-create-a-dns-zone"></a>DNS ゾーンを作成できない

一般的な問題を解決するには、次の手順のうち 1 つ以上を試してください。

1.  Azure DNS 監査ログを確認して、失敗の理由を特定します。
2.  各 DNS ゾーン名は、リソース グループ内で一意である必要があります。 つまり、同じ名前の 2 つの DNS ゾーンでリソース グループを共有することはできません。 別のゾーン名 (別のリソース グループ) を使用してみてください。
3.  "サブスクリプション {サブスクリプション ID} のゾーンが最大数に達したか、最大数を超えました" というエラー メッセージが表示される場合があります。 別の Azure サブスクリプションを使用するか、ゾーンのいくつかを削除するか、Azure サポートに連絡してサブスクリプションの上限を引き上げてください。
4.  "ゾーン '{ゾーン名}' は使用できません" というエラー メッセージが表示される場合があります。 このエラーは、Azure DNS で、この DNS ゾーンのネーム サーバーを割り当てることができなかったことを示します。 別のゾーン名を使用してみてください。 または、ドメイン名の所有者である場合は、Azure サポートに連絡して、ネーム サーバーを割り当ててもらうことができます。

### <a name="recommended-articles"></a>推奨される記事

* [DNS ゾーンとレコード](dns-zones-records.md)
* [DNS ゾーンの作成](./dns-getstarted-portal.md)

## <a name="i-cant-create-a-dns-record"></a>DNS レコードを作成できない

一般的な問題を解決するには、次の手順のうち 1 つ以上を試してください。

1.  Azure DNS 監査ログを確認して、失敗の理由を特定します。
2.  レコード セットが既にありますか。  Azure DNS では、レコード *セット* を使用してレコードを管理します。レコード セットは、同じ名前で同じ種類のレコードのコレクションです。 名前と種類が同じであるレコードが既に存在する場合、別のこのようなレコードを追加するには、既存のレコード セットを編集する必要があります。
3.  DNS ゾーンの頂点 (ゾーンの "ルート") にレコードを作成しようとしていますか。 その場合、DNS の規則では、レコード名として ‘@’ 文字を使用します。 また、DNS 標準では、ゾーンの頂点に CNAME レコードを作成することは許可されていないことにも注意してください。
4.  CNAME の競合が発生していませんか。  DNS 標準では、他の種類のレコードと同じ名前の CNAME レコードは許可されていません。 既存の CNAME がある場合、別の種類の同じ名前のレコードの作成は失敗します。  同様に、別の種類の既存のレコードと名前が一致する場合にも、CNAME の作成は失敗します。 その既存のレコードを削除するか、別のレコード名を選択して競合を解決します。
5.  DNS ゾーンで許可されているレコード セット数の上限に達していませんか。 レコード セットの現在の数と最大数は、Azure Portal のゾーンの [プロパティ] に表示されます。 この上限に達している場合、一部のレコード セットを削除するか、Azure サポートに連絡してこのゾーンのレコード セットの上限を引き上げてから、もう一度試してください。 

### <a name="recommended-articles"></a>推奨される記事

* [DNS ゾーンとレコード](dns-zones-records.md)
* [DNS ゾーンの作成](./dns-getstarted-portal.md)

## <a name="i-cant-resolve-my-dns-record"></a>DNS レコードを解決できない

DNS 名前解決は数段階のプロセスであり、多くの理由で失敗する可能性があります。 次の手順を使用すると、Azure DNS でホストされているゾーンで DNS レコードの DNS 解決が失敗した理由を調査できます。

1.  Azure DNS で DNS レコードが正しく構成されていることを確認します。 Azure Portal で DNS レコードを見直して、ゾーン名、レコード名、レコードの種類が正しいことを確認します。
2.  Azure DNS ネーム サーバーで DNS レコードが正しく解決されていることを確認します。
    - DNS クエリをローカル コンピューターから作成した場合、ネーム サーバーの現在の状態を反映していないキャッシュされた結果が表示されることがあります。  また、企業ネットワークでは DNS プロキシ サーバーを使用していることがよくあるため、DNS クエリが特定のネーム サーバーに送信されないことがあります。  これらの問題を回避するには、[digwebinterface](https://digwebinterface.com) などの Web ベースの名前解決サービスを使用します。
    - Azure Portal の表示に従って、DNS ゾーンに対応した適切なネーム サーバーを必ず指定してください。
    - DNS 名が正しいことを確認し (ゾーン名を含む、完全修飾名を指定する必要があります)、レコードの種類が正しいことを確認します
3.  DNS ドメイン名が [Azure DNS ネーム サーバーに適切に委任](dns-domain-delegation.md)されていることを確認します。 [DNS 委任を検証できる多数のサード パーティ Web サイト](https://www.bing.com/search?q=dns+check+tool)があります。 このテストは "*ゾーン*" の委任テストであるため、DNS ゾーン名のみを入力し、完全修飾レコード名は入力しないでください。
4.  上記の手順が完了すると、DNS レコードが正しく解決されるようになります。 これを確認するには、既定のネーム サーバー設定を使用して、[digwebinterface](https://digwebinterface.com) をもう一度使用します。

### <a name="recommended-articles"></a>推奨される記事

* [Azure DNS へのドメインの委任](dns-domain-delegation.md)

## <a name="dns-zone-status-and-unhealthy-delegation-scenarios"></a>DNS ゾーンの状態と異常な委任のシナリオ

DNS ゾーンの状態は、ゾーンの現在の状態を示します。 DNS ゾーンの状態には、 **[不明]** 、 **[使用可能]** 、 **[デグレード]** があります。

### <a name="unknown"></a>Unknown

リソースが新しく作成された場合、これらの新しいリソースの正常性シグナルはすぐには使用できません。 DNS ゾーンの正しい正常性シグナルを取得するのに、最大 24 時間かかります。 それまで DNS ゾーンの正常性は **[不明]** と表示されます。

DNS ゾーンに関する情報をリソース正常性チェックで 6 時間以上受信していない場合、そのゾーンは [不明] とマークされます。 この状態はリソースの状態を明確に示すものではありませんが、トラブルシューティング プロセスにおいて重要なデータ ポイントです。 シグナルが受信され、リソースが想定したとおりに実行されている場合、リソースの状態は数分後に **[使用可能]** に変わります。

次のスクリーンショットは、リソース正常性チェック メッセージの例です。

:::image type="content" source="./media/dns-troubleshoot/unknown-status.png" alt-text="不明状態のスクリーンショット。":::

### <a name="available"></a>利用可能

**[使用可能]**   状態は、リソース正常性チェックで DNS ゾーンに関する委任の問題が検出されなかったことを示します。 この状態は、NS 委任レコードがプライマリ ゾーンで適切に保持されており、子ゾーン用のレコードがプライマリ ゾーンに存在しないことを意味します。 

次のスクリーンショットは、リソース正常性チェック メッセージの例です。

:::image type="content" source="./media/dns-troubleshoot/available-status.png" alt-text="利用可能状態のスクリーンショット。":::

### <a name="degraded"></a>低下しています

**[デグレード]** 状態は、リソース正常性チェックで DNS ゾーンに関する委任の問題が検出されたことを示します。 委任の構成を修正し、状態が **[使用可能]** に変更されるまで 24 時間待ちます。  

次のスクリーンショットは、リソース正常性チェック メッセージの例です。

:::image type="content" source="./media/dns-troubleshoot/degraded-status.png" alt-text="デグレード状態のスクリーンショット。":::

構成を修正してから 24 時間が経過しても、DNS ゾーンが依然としてデグレードである場合は、サポートにお問い合わせください。  

### <a name="configuration-error-scenario"></a>構成エラーのシナリオ

次のシナリオでは、構成エラーによって DNS ゾーンの異常な状態が発生した場合を示します。

**異常な委任**

プライマリ ゾーンには、プライマリ ゾーンから子ゾーンにトラフィックを委任する際に役立つ NS 委任レコードが含まれています。 親ゾーンに NS 委任レコードが存在する場合、DNS サーバーにより、NS 委任レコードの下にあるグルー レコードを除いた他のすべてのレコードがマスクされることになっており、ユーザー クエリに基づいてそれぞれの子ゾーンにトラフィックが送信されます。 NS 委任レコードの下にある子ゾーン (委任されたゾーン) 用の他のレコードが親ゾーンに含まれている場合、ゾーンは異常とマークされ、その状態は **[デグレード]** になります。

**グルー レコードとは** これらは、委任レコードの下にあるレコードで、IP アドレスを使用して委任済みゾーンや子ゾーンにトラフィックを送信するのに役立つものであり、次のように構成されます。

| 設定 | 値 |
| ------- | ----- |
| **ゾーン** | contoso.com |
| **委任レコード** | 子 NS </br> ns1.child.contoso.com |
| **グルー レコード** | ns1.child A 1.1.1.1 |

#### <a name="example-of-an-unhealthy-zone"></a>異常なゾーンの例

次に、NS 委任下にあるレコードを含むゾーンの例を示します。

* ゾーン名: contoso.com

| 名前 | 型 | TTL | 値 |
| ---- | ---- | --- | ----- |
| @ | NS | 3600 | ns1-04.azure-dns.com. |
| @ | SOA | 3600 | "_SOA 値_" |
| * | A | 3600 | 255.255.255.255 |
| **child** | **NS** | **3600** | **ns1-08.azure-dns.com** (NS 委任レコード) |
| _**foo.child**_ | _**A**_ | _**3600**_ | _**10.10.10.10**_ |
| _**txt.child**_ | _**TXT**_ | _**3600**_ | _**"text record"**_ |
| abc.test | A | 3600 | 5.5.5.5 |

前の例で、**child** は NS 委任レコードです。 _**foo.child**_ および _**txt.child**_ レコードは、子ゾーンの **child.contoso.com** にのみ存在すべきレコードです。 これらのレコードが親ゾーンの **contoso.com** から削除されていない場合、不整合が発生するおそれがあります。 これらの不整合が原因となり、ゾーンが異常と見なされ、 **[デグレード]** 状態になる可能性があります。

#### <a name="examples-of-when-a-zone-is-considered-healthy-or-unhealthy"></a>ゾーンが正常または異常と見なされる場合の例

| 例 | Status |
| ------- | ------ |
| NS 委任レコード、グルー レコード、その他のレコードがゾーンに含まれていない。 | **Healthy** |
| NS 委任レコードのみがゾーンに含まれている。 | **Healthy** |
| NS 委任レコードとグルー レコードのみがゾーンに含まれている。 | **Healthy** |
| NS 委任レコードと、子ゾーンに存在すべきである、委任レコードの下にある (グルー レコード以外の) 他のレコードがゾーンに含まれている。 | **異常** |
| NS 委任レコード、グルー レコード、およびその他のレコード (グルー レコード以外) がゾーンに含まれている。 | **異常** |

**この問題の解決方法** - 解決するには、親ゾーンの NS 委任レコードの下にあるグルー レコード以外のすべてのレコードを見つけて削除します。

**異常な委任レコードを見つける方法** - ゾーン内の異常な委任レコードを見つけるためのスクリプトが作成されています。  このスクリプトを実行すると、異常なレコードが報告されます。

1. 「[Azure DNS 内の異常な DNS レコードの検索 - PowerShell スクリプトのサンプル](./scripts/find-unhealthy-dns-records.md)」に記載されているスクリプトを保存します。

2. スクリプト エディターで記述に従ってスクリプトを実行します。  スクリプトは、要件に合わせて編集できます。

**履歴情報** - リソース正常性の [正常性の履歴] セクションで、最大 14 日間の正常性履歴を利用できます。 このセクションには、リソース正常性によって報告されたダウンタイムの発生理由 (入手可能な場合) も含まれます。 現在、Azure では、DNS ゾーン リソースのダウンタイムが 24 時間の細分性で表示されます。

## <a name="how-do-i-specify-the-service-and-protocol-for-an-srv-record"></a>SRV レコードの "サービス" と "プロトコル" を指定するにはどうすればよいですか?

Azure DNS では、DNS レコードをレコード セットとして管理します。レコード セットは、同じ名前で同じ種類のレコードのコレクションです。 SRV レコード セットでは、レコード セット名の一部として "サービス" と "プロトコル" を指定する必要があります。 その他の SRV パラメーター ("優先度"、"重み"、"ポート"、"ターゲット") は、レコード セットのレコードごとに個別に指定します。

SRV レコード名の例 (サービス名が "sip"、プロトコルが "tcp") を次に示します。

- \_sip.\_tcp (レコード セットをゾーンの頂点に作成)
- \_sip.\_tcp.sipservice ("sipservice" という名前のレコード セットを作成)

### <a name="recommended-articles"></a>推奨される記事

* [DNS ゾーンとレコード](dns-zones-records.md)
* [Azure portal を使用した DNS レコード セットとレコードの作成](./dns-getstarted-portal.md)
* [SRV レコード タイプ (Wikipedia)](https://en.wikipedia.org/wiki/SRV_record)

## <a name="next-steps"></a>次のステップ

* [Azure DNS ゾーンとレコード](dns-zones-records.md)について学習します
* Azure DNS の使用を開始する場合は、[DNS ゾーンの作成方法](./dns-getstarted-portal.md)と [DNS レコードの作成方法](./dns-getstarted-portal.md)について確認してください。
* 既存の DNS ゾーンを移行する場合は、[DNS ゾーン ファイルのインポートとエクスポート](dns-import-export.md)の実行方法を確認してください。
