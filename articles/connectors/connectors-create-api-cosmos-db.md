---
title: Azure Cosmos DB への接続
description: Azure Logic Apps を使用して Azure Cosmos DB ドキュメントを処理および作成します。
services: logic-apps
ms.suite: integration
author: jcocchi
ms.author: jucocchi
ms.reviewer: estfan, azla
ms.topic: how-to
ms.date: 11/02/2021
tags: connectors
ms.openlocfilehash: 7a5025e284933284d910412fb2f9771dee43e31d
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2021
ms.locfileid: "131092618"
---
# <a name="process-and-create-azure-cosmos-db-documents-using-azure-logic-apps"></a>Azure Logic Apps を使用したドキュメントの処理と作成 Azure Cosmos DB

Azure Logic Apps のワークフローから、Azure Cosmos DB に接続し、 [Azure Cosmos DB コネクタ](/connectors/documentdb/)を使用してドキュメントを操作できます。 このコネクタは、ワークフローが Azure Cosmos DB 操作に使用できるトリガーとアクションを提供します。 ドキュメントを管理するための自動化されたワークフローを作成できます。 たとえば、アクションには、ドキュメントの作成または更新、読み取り、照会、および削除が含まれます。

[*マネージコネクタ*](managed.md)操作を使用して、**ロジックアプリ (従量課金)** と **logic app (Standard)** の両方のリソースの種類から Azure Cosmos DB に接続できます。 **Logic App (Standard)** の場合、Azure Cosmos DB には [*組み込み*](built-in.md)の操作も用意されています。これは現在プレビュー段階であり、さまざまな機能を提供し、パフォーマンスが向上し、スループットが向上しています。 たとえば、 **Logic App (Standard)** リソースの種類を使用している場合は、組み込みのトリガーを使用して、Azure Cosmos DB コンテナーの変更に応答できます。 ロジックアプリワークフロー内の他のアクションやトリガーと Azure Cosmos DB 操作を組み合わせることで、イベントソーシングや一般的なデータ処理などのシナリオを実現できます。

> [!NOTE]
> 現時点では、マネージコネクタ操作と組み込み操作の両方を使用できるのは、 **ロジックアプリ (Standard)** リソース内のステートフルワークフローだけです。 ステートレスワークフローでは、組み込みの操作のみを使用できます。

## <a name="prerequisites"></a>前提条件

- Azure アカウントとサブスクリプション。 Azure サブスクリプションがない場合は、[無料の Azure アカウントにサインアップ](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)してください。

- [Azure Cosmos DB アカウント](../cosmos-db/sql/create-cosmosdb-resources-portal.md)。

- Azure Cosmos DB アカウントにアクセスするロジックアプリワークフロー。 Azure Cosmos DB トリガーを使用するには、 [**ロジックアプリ (標準)** のリソースの種類を使用してロジックアプリを作成](../logic-apps/create-single-tenant-workflows-azure-portal.md)し、空のワークフローを追加する必要があります。

## <a name="add-azure-cosmos-db-trigger"></a>Azure Cosmos DB トリガーの追加

Azure Logic Apps では、すべてのワークフローは、必ず[トリガー](../logic-apps/logic-apps-overview.md#logic-app-concepts)で開始します。トリガーは、特定のイベントが起こるか特定の条件が満たされたときに発生します。

**Logic App (Standard)** リソースの種類を使用している場合、**項目が作成または変更 (プレビュー) されるときに** 呼び出される組み込みのトリガーは、 [Azure Cosmos DB change feed パターン](../cosmos-db/sql/change-feed-design-patterns.md)に基づいています。 このトリガーは、 **ロジックアプリ (消費)** のリソースの種類では使用できません。

### <a name="consumption"></a>[従量課金プラン](#tab/consumption)

**ロジックアプリ (消費)** のリソースの種類に使用できる Azure Cosmos DB トリガーはありません。

### <a name="standard"></a>[Standard](#tab/standard)

シングルテナント Azure Logic Apps でロジックアプリワークフローに Azure Cosmos DB 組み込みトリガーを追加するには、次の手順に従います。

1. [Azure portal](https://portal.azure.com) で、ロジック アプリ ワークフローをデザイナーで開きます。

1. トリガーを検索するには、次の手順を実行します。

   1. デザイナーで、 **[操作を選択してください]** を選択します。

   1. [ **トリガーの追加** ] ウィンドウが開いたら、[ **操作の選択** ] 検索ボックスの下にある [ **組み込み**] を選択します。

   1. 検索ボックスに「 `Azure Cosmos DB`」と入力します。 [トリガー] ボックスの一覧から、[ **アイテムが作成または変更されたとき (プレビュー)**] という名前のトリガーを選択します。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-trigger-add.png" alt-text="[項目が作成または変更 (プレビュー)] という名前のトリガーを選択した標準のロジックアプリワークフローの Azure portal とデザイナーを示すスクリーンショット。":::

1. 接続の詳細を確認するメッセージが表示されたら、 [Azure Cosmos DB への接続を作成](#connect-to-azure-cosmos-db)します。

1. [ **パラメーター** ] タブで、トリガーに必要な情報を指定します。

   | プロパティ | 必須 | 値 | 説明 |
   |----------|----------|-------|-------------|
   | **データベース Id** | はい | <*データベース名*> | 監視するコンテナーを含むデータベースの名前。 このデータベースには、リースコンテナーも含まれている必要があります。 まだリースコンテナーがない場合は、後の手順でコネクタによって作成されます。 |
   | **監視対象のコンテナー Id** | はい | <*コンテナー名*> | 監視するコンテナーの名前です。 このコンテナーは、指定されたデータベースに既に存在している必要があります。 |
   | **リースコンテナー Id** |  はい | <*リース-コンテナー名*> | 既存のリースコンテナー、または作成する新しいコンテナーの名前。 トリガーは、共通の `leases` 既定の名前として事前に入力します。 |
   | **リースコンテナーの作成** | No | **いいえ** または **はい** | 指定されたデータベースにリースコンテナーが既に存在する場合は、[ **いいえ**] を選択します。 トリガーでこのコンテナーを作成する場合は、[ **はい]** を選択します。 [ **はい**] を選択した場合は、必ず [ **新しいパラメーターの追加** ] の一覧を開き、[ **リースコンテナーのスループット** ] プロパティを選択します。 このコンテナーに対してプロビジョニングする [要求ユニット (ru)](../cosmos-db/request-units.md) の数を入力します。 |
   |||||

   次の図は、トリガーの例を示しています。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-trigger-parameters.png" alt-text="Azure Cosmos DB のトリガーとパラメーターの構成を持つ標準のロジックアプリワークフローのデザイナーを示すスクリーンショット。":::

   > [!Note]
   > トリガーは、Azure Cosmos DB で作成または変更された各項目に対して複数のワークフロー実行を作成するため、このトリガーの動的なコンテンツ出力は常に1つの項目になります。

1. ワークフローに必要なその他のアクションを追加します。

1. デザイナーのツール バーで、 **[保存]** を選択します。

---

## <a name="add-azure-cosmos-db-action"></a>Azure Cosmos DB アクションの追加

Azure Logic Apps では、[アクション](../logic-apps/logic-apps-overview.md#logic-app-concepts)とは、トリガーまたは別のアクションに続くワークフロー内のステップです。 Azure Cosmos DB コネクタは、**ロジックアプリ (従量課金)** と **logic app (Standard)** の両方のリソースの種類に対するアクションを提供します。 各リソースの種類の次の例では、ドキュメントを作成または更新するアクションの使用方法を示しています。

### <a name="consumption"></a>[従量課金プラン](#tab/consumption)

マルチテナント Azure Logic Apps でロジックアプリワークフローに Azure Cosmos DB アクションを追加するには、次の手順に従います。

1. [Azure portal](https://portal.azure.com) で、ワークフローをデザイナーで開きます。

1. ワークフローが空の場合は、任意のトリガーを追加します。

   この例は、「 [**HTTP 要求が受信されたとき** のトリガー](connectors-native-reqres.md#add-request-trigger)」で始まります。

1. Azure Cosmos DB アクションを追加するトリガーまたはアクションで、手順の間に [**新しいステップ**] を選択するか、**アクションを追加** します。

1. デザイナーの検索ボックスに、「`Azure Cosmos DB`」と入力します。 使用する Azure Cosmos DB アクションを選択します。

   この例では、 **作成または更新ドキュメント (V3)** という名前のアクションを使用します。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/consumption-action-add.png" alt-text="使用可能な Azure Cosmos DB アクションを使用した、消費ロジックアプリワークフローのデザイナーを示すスクリーンショット。":::

1. 接続の詳細を確認するメッセージが表示されたら、[今すぐ Azure Cosmos DB アカウントへの接続を作成](#connect-to-azure-cosmos-db)します。

1. アクションに必要な情報を指定します。

   | プロパティ | 必須 | 値 | 説明 |
   |----------|----------|-------|-------------|
   | **Azure Cosmos DB アカウント名** | はい | [**接続設定を使用する] (<*Cosmos*>)** を選択するか、名前を手動で入力します。 | Azure Cosmos DB アカウントのアカウント名。 |
   | **データベース ID** | はい | <*データベース-ID*> | 接続するデータベース。 |
   | **コンテナー ID** | はい | <*コンテナー-ID*> | 照会するコンテナー。 |
   | **Document** | はい | <*JSON-ドキュメント*> | 作成する JSON ドキュメント。 この例では、トリガー出力の要求本文を使用します。 <p><p>**ヒント**: HTTP トリガーの **本文** トークンが、追加する動的なコンテンツの一覧に表示されない場合は、トリガー名の横にある [ **詳細を表示**] を選択します。 <p><p>**注**: 本文が整形式の JSON であることを確認してください。少なくとも、 `id` ドキュメントのプロパティとパーティションキーのプロパティが含まれていることを確認してください。 指定した `id` およびパーティションキーを持つドキュメントが既に存在する場合は、ドキュメントが更新されます。 そうでない場合は、新しいドキュメントが作成されます。 |
   |||||

   次の図は、アクションの例を示しています。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/consumption-create-action.png" alt-text="Azure Cosmos DB &quot;ドキュメントの作成または更新 (V3)&quot; アクションとパラメーターの構成を使用した、消費ロジックアプリのワークフローのデザイナーを示すスクリーンショット。":::

1. 必要に応じて、その他のアクション設定を構成します。

1. デザイナーのツール バーで、 **[保存]** を選択します。

1. ロジックアプリをテストして、ワークフローが指定されたコンテナーにドキュメントを作成できることを確認します。

### <a name="standard"></a>[Standard](#tab/standard)

シングルテナント Azure Logic Apps でロジックアプリワークフローに Azure Cosmos DB アクションを追加するには、次の手順に従います。

1. [Azure portal](https://portal.azure.com) で、ワークフローをデザイナーで開きます。

1. ワークフローが空の場合は、任意のトリガーを追加します。

   この例では、" [**HTTP 要求が受信されたとき**" トリガー](connectors-native-reqres.md#add-request-trigger)を使用して、作成する項目を表す基本的なスキーマ定義を使用します。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-http-trigger.png" alt-text="&quot;HTTP 要求が受信されたとき&quot; トリガーとパラメーターの構成を使用して、標準のロジックアプリワークフローの Azure portal とデザイナーを示すスクリーンショット。":::

1. Azure Cosmos DB アクションを追加するトリガーまたはアクションの下で、[**新しいステップの挿入**] () を選択し **+** >**アクションを追加** します。

1. デザイナーで、 **[操作の追加]** が選択されていることを確認してください。 表示される [**アクションの追加**] ウィンドウで、[**操作の選択**] 検索ボックスの下にある [**組み込み**] を選択して **Azure Cosmos DB** アクションを検索します。

   > [!NOTE]
   > ステートフルワークフローを使用している場合は、[ **Azure** ] タブで *マネージコネクタ* アクションを使用することもできますが、必要な *組み込みの* アクションが使用できない場合にのみ使用してください。

1. 検索ボックスに「 `Azure Cosmos DB`」と入力します。 使用する Azure Cosmos DB アクションを選択します。

   この例では、 **Create または update item (preview)** という名前のアクションを使用して、新しい項目を作成するか、既存の項目を更新します。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-action-add.png" alt-text="標準のロジックアプリワークフローのデザイナーを示すスクリーンショットと、使用可能な Azure Cosmos DB アクション。":::

1. 接続の詳細を確認するメッセージが表示されたら、[今すぐ Azure Cosmos DB アカウントへの接続を作成](#connect-to-azure-cosmos-db)します。

1. アクションに必要な情報を指定します。

   | プロパティ | 必須 | 値 | 説明 |
   |----------|----------|-------|-------------|
   | **データベース Id** | はい | <*データベース-ID*> | 接続するデータベース。 |
   | **コンテナー Id** | はい | <*コンテナー-ID*> | 照会するコンテナー。 |
   | **Item** | はい | <*JSON-ドキュメント*> | 作成する JSON ドキュメント。 この例では、トリガー出力の要求本文を使用します。 <p><p>**ヒント**: HTTP トリガーの **本文** トークンが、追加する動的なコンテンツの一覧に表示されない場合は、トリガー名の横にある [ **詳細を表示**] を選択します。 <p><p>**注**: 本文が整形式の JSON であることを確認してください。少なくとも、 `id` ドキュメントのプロパティとパーティションキーのプロパティが含まれていることを確認してください。 指定した `id` およびパーティションキーを持つドキュメントが既に存在する場合は、ドキュメントが更新されます。 そうでない場合は、新しいドキュメントが作成されます。 | 
   | **パーティション キー** | はい | <*パーティションキー*> | 作成するドキュメントのパーティションキー値。 このプロパティが表示されない場合は、[ **新しいパラメーター** リストの追加] を開き、[ **パーティションキー**] を選択します。 <p><p>**重要**: このプロパティは、アスタリスク (*) で必須としてマークされていませんが、ワークフローが成功するためには実際にはプロパティが必要です。 |
   |||||

   次の図は、アクションの例を示しています。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-create-action.png" alt-text="Azure Cosmos DB ' 項目の作成または更新 ' アクションとパラメーターの構成を持つ標準ロジックアプリワークフローのデザイナーを示すスクリーンショット。":::

1. 必要に応じて、その他のアクション設定を構成します。

1. デザイナーのツール バーで、 **[保存]** を選択します。

1. ロジックアプリをテストして、ワークフローが指定されたコンテナーにドキュメントを作成できることを確認します。

---

## <a name="connect-to-azure-cosmos-db"></a>Azure Cosmos DB への接続

[!INCLUDE [Create connection general intro](../../includes/connectors-create-connection-general-intro.md)]

[Azure Cosmos DB トリガー](#add-azure-cosmos-db-trigger)または[Azure Cosmos DB アクション](#add-azure-cosmos-db-action)を構成する前に、データベースアカウントに接続する必要があります。

### <a name="consumption"></a>[従量課金プラン](#tab/consumption)

**ロジックアプリ (従量課金)** ワークフローでは、Azure Cosmos DB 接続には次のプロパティ値が必要です。

| プロパティ | 必須 | 値 | 説明 |
|----------|----------|-------|-------------|
| **接続名** | はい | <*connection-name*> | 接続に使用する名前。 |
| **認証の種類** | はい | <*接続の種類*> | 使用する認証の種類。 この例では、 **アクセスキー** を使用します。 <p><p>-[ **アクセスキー**] を選択した場合は、残りの必須プロパティ値を指定して接続を作成します。 <p><p>-[ **Azure AD 統合**] を選択した場合は、他のプロパティ値は必要ありませんが、 [Azure AD 認証と Cosmos DB コネクタ](/connectors/documentdb/#azure-ad-authentication-and-cosmos-db-connector)の手順に従って接続を構成する必要があります。  |
| **Cosmos DB アカウントへのアクセスキー** | はい | <*アクセスキー*> | この接続に使用する Azure Cosmos DB アカウントのアクセスキー。 この値は、読み取り/書き込みキーまたは読み取り専用キーのいずれかです。 <p><p>**注**: キーを検索するには、[Azure Cosmos DB アカウント] ページにアクセスします。 ナビゲーション メニューの [キー] の下の **[設定** キー] を **選択します**。 使用可能なキー値のいずれかをコピーします。 |
| **アカウント Id** | はい | <*アカウント-ID*> | この接続に使用する Azure Cosmos DB アカウントの名前。 |
|||||

次の図は、接続の例を示しています。

:::image type="content" source="./media/connectors-create-api-cosmos-db/consumption-connection-configure.png" alt-text="使用量ロジックアプリワークフローの Azure Cosmos DB 接続構成の例を示すスクリーンショット。":::

> [!NOTE]
> 接続を作成した後、代わりに使用する別の既存の Azure Cosmos DB 接続がある場合、または別の新しい接続を作成する場合は、トリガーまたはアクションの詳細エディターで [接続の変更] を選択します。

### <a name="standard"></a>[Standard](#tab/standard)

**ロジックアプリ (標準)** ワークフローでは、Azure Cosmos DB 接続には次のプロパティ値が必要です。

| プロパティ | 必須 | 値 | 説明 |
|----------|----------|-------|-------------|
| **接続名** | はい | <*connection-name*> | 接続に使用する名前。 |
| **接続文字列** | はい | <*接続文字列*> | Azure Cosmos接続に使用する DB 接続文字列を指定します。 <p><p>**注**: 接続文字列を見つけるには、Azure Cosmos DB アカウント ページに移動します。 ナビゲーション メニューの [キー] の下の **[設定** キー] を **選択します**。 使用可能な接続文字列の値のいずれかをコピーします。 |
|||||

次の図は、接続の例を示しています。

:::image type="content" source="./media/connectors-create-api-cosmos-db/standard-connection-configure.png" alt-text="Standard ロジック アプリ ワークフローの Azure Cosmos DB 接続構成の例を示すスクリーンショット。":::

> [!NOTE]
> 接続を作成した後、代わりに使用する別の既存の Azure Cosmos DB 接続がある場合、または別の新しい接続を作成する場合は、トリガーまたはアクションの詳細エディターで [接続の変更] を選択します。

---

## <a name="connector-reference"></a>コネクタのレファレンス

トリガー、アクション、制限など、Azure Cosmos *DB* マネージド コネクタの操作に関するリファレンス情報については、コネクタのリファレンス ページ[を参照してください](/connectors/documentdb/)。

Azure Cosmos DB 組み込み操作に対応 *する参照ページが存在* しません。 代わりに、次の表で詳細を確認してください。

| Type | 名前 | パラメーター |
|------|------|------------|
| トリガー | 項目が作成または変更されたとき | - **データベース ID:** 必須。 監視対象コンテナーとリース コンテナーを持つデータベースの名前。 <br>- **監視対象のコンテナー ID:** 必須。 監視対象のコンテナーの名前。 <br>- **リース コンテナー ID:** 必須。 リースの格納に使用されるコンテナーの名前。 <br>- **リース コンテナーの作成**: 必須。 true の場合は、リース コンテナーを作成します (まだ存在しない場合)。 <br>- **リース コンテナーのスループット**: 省略可能。 リース コンテナーの作成時に割り当てる要求ユニットの数。 |
| アクション | 項目を作成または更新する | - **データベース ID:** 必須。 データベースの名前。 <br>- **コンテナー ID:** 必須。 コンテナーの名前。 <br>- **項目**: 必須。 作成または更新する項目。 <br>- **パーティション キー**: 必須。 要求された項目のパーティション キー値。 <br>- **Upsert**: 省略可能です。 true の場合は、項目を置き換える (既存の場合)。 それ以外の場合は、項目を作成します。 |
| アクション | 多数の項目を一括で作成または更新する | このアクションは高スループットのシナリオ向けに最適化され、アクションが Azure Cosmos DB コンテナーに作成される項目を送信する前に追加の処理を行います。 多数の項目の場合、この追加の処理により、要求の合計時間が高速化されます。 項目の数が少ない場合、この余分なオーバーヘッドにより、複数の単一の作成項目アクションを使用するよりもパフォーマンスが低下する可能性があります。 <p><p>- **データベース ID:** 必須。 データベースの名前。 <br>- **コンテナー ID:** 必須。 コンテナーの名前。 <br>- **項目**: 必須。 作成または更新する項目の配列。 <br>- **Upsert**: 省略可能です。 true の場合は、項目を置き換える (既存の場合)。 それ以外の場合は、項目を作成します。 |
| アクション | 項目を読み取る | - **データベース ID:** 必須。 データベースの名前。 <br>- **コンテナー ID:** 必須。 コンテナーの名前。 <br>- **項目 ID:** 必須。 要求 `id` された項目の値。 <br>- **パーティション キー**: 必須。 要求された項目のパーティション キー値。 |
| アクション | 項目を削除する | - **データベース ID:** 必須。 データベースの名前。 <br>- **コンテナー ID** 必須。 コンテナーの名前。 <br>- **項目 ID:** 必須。 要求 `id` された項目の値。 <br>- **パーティション キー**: 必須。 要求された項目のパーティション キー値。 |
| アクション | クエリ項目 | - **データベース ID:** 必須。 データベースの名前。 <br>- **コンテナー ID:** 必須。 コンテナーの名前。 <br>- **Sql クエリ**: 必須。 Azure Cosmos DB SQLクエリ テキスト。  <br>- **パーティション キー**: 省略可能。 要求のパーティション キー値 (指定されている場合)。 <br>- **継続トークン**: 省略可能。 Azure Cosmos DB サービスによって指定されたこのクエリの継続トークン (指定されている場合)。 <br>- **最大項目数**: 省略可能。 クエリから返される項目の最大数。 |
||||

## <a name="best-practices-for-azure-cosmos-db-built-in-operations"></a>Azure Cosmos DB 組み込み操作のベスト プラクティス

### <a name="get-iterable-results-from-the-query-items-action-by-using-expressions"></a>式を使用してクエリ項目アクションから iterable の結果を取得する

ロジック アプリ **(Standard)** ワークフローの組み込みクエリ項目アクションからの出力の種類は、変更できないオブジェクトです。 クエリ結果を処理可能なオブジェクトとして取得するには、次の手順に従います。

1. [Azure portal](https://portal.azure.com) で、ワークフローをデザイナーで開きます。

1. ワークフローが空の場合は、任意のトリガーを追加します。

   この例は、[ **[繰り返し]** トリガー](connectors-native-recurrence.md)で始まります。

1. Azure Cosmos DB アクションを追加するトリガーまたはアクションの下で、[**新しいステップの挿入**] () を選択し **+** >**アクションを追加** します。

1. デザイナーで、 **[操作の追加]** が選択されていることを確認してください。 表示される [**アクションの追加**] ウィンドウで、[**操作の選択**] 検索ボックスの下にある [**組み込み**] を選択して **Azure Cosmos DB** アクションを検索します。

1. 検索ボックスに「 `Azure Cosmos DB`」と入力します。 [ **クエリ項目 (プレビュー)** ] アクションを選択します。

1. 接続の詳細を確認するメッセージが表示されたら、 [Azure Cosmos DB アカウントへの接続を作成](#connect-to-azure-cosmos-db)します。

1. アクションに必要な情報を指定します。

   | プロパティ | 必須 | 値 | 説明 |
   |------------|----------|-------|-------------|
   | **データベース Id** | はい | <*データベース-ID*> | 接続するデータベース。 |
   | **コンテナー Id** | はい | <*コンテナー-ID*> | 照会するコンテナー。 |
   | **SQL クエリ** | はい | <*sql クエリ*> | 要求の SQL クエリ。 |
   |||||

   次の図は、アクションの例を示しています。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-query-action.png" alt-text="[クエリ項目] アクションとパラメーターの構成を使用し Azure Cosmos DB て、標準のロジックアプリワークフローのデザイナーを示すスクリーンショット。":::

1. 必要に応じて、その他のアクション設定を構成します。

1. [アクション] の下の [ **新しいステップの挿入** ] () を選択して、 **+****アクション > 追加** します。 表示される [ **アクションの追加** ] ウィンドウで、[ **操作の選択** ] 検索ボックスの下にある [ **組み込み** ] を選択して、 **For each** アクションを検索して追加します。

1. [ **クエリ項目** ] アクションの出力を変換するには、次の手順に従います。

   1. [アクション **の** 詳細] ウィンドウの [ **前の手順から出力を選択** ] ボックス内をクリックして、動的なコンテンツの一覧が表示されるようにします。 [ **式** ] タブを選択して、式エディターを開きます。

   1. [関数] ボックスの一覧で [ **参照元の関数** ] セクションを探し、[式エディター] ボックスに表示される [ **出力 (actionName)** ] 関数を選択します。

   1. [エディター] ボックスで、 `'Query_items'`**出力 (actionName)** 関数のパラメーターとして「」と入力し、 `?['body']?['item']?['results']` クエリ結果を使用して配列にアクセスします。次に、[ **OK]** を選択します。 完全な式は、次の形式に従います。

      `outputs('Query_items')?['body']?['item']?['results']`

      :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-query-configure.png" alt-text="Azure Cosmos DB クエリの結果を処理する ' for each ' アクションを使用して、標準のロジックアプリワークフローの Azure portal とデザイナーを示すスクリーンショット。":::

1. [ **For each** ] ループで、必要なその他のアクションを追加します。

1. デザイナーのツール バーで、 **[保存]** を選択します。

1. ロジックアプリをテストして、予想どおりの出力がワークフローに返されることを確認します。

### <a name="confirm-action-success-by-checking-the-operation-status-code"></a>操作の状態コードを確認して、操作が成功したことを確認します

**ロジックアプリ (標準)** ワークフローで組み込みアクション Azure Cosmos DB を使用する場合は、サービス呼び出しから返されたステータスコードを Azure Cosmos DB サービスに確認する各アクションの後に、ステップを記述する必要があります。 これにより、ワークフローの後続のアクションは、シナリオに基づいて、Azure Cosmos DB サービスが返すさまざまなステータスコードに対応できます。

> [!NOTE]
> 現時点では、他のマネージコネクタアクションや組み込みアクションとは異なり、Azure Cosmos DB アクションから返された状態コードは、Azure Cosmos DB サービスに送信されるサービス呼び出しから返されたステータスコードとは異なります。 アクションの状態コードは動的コンテンツリストで使用でき、サービス呼び出しの状態コードが返され、応答オブジェクトのに入れ子になってい `body` ます。
>
> 次の手順では、応答オブジェクトのを解析する式を使用して、サービス呼び出しの状態コードにアクセスする方法を示し `body` ます。

たとえば、次の手順では、[**項目の読み取り**] アクションを使用するワークフローを作成し、サービス呼び出しから返された状態コードを Azure Cosmos DB サービスに確認する方法を示します。

1. [Azure portal](https://portal.azure.com) で、ワークフローをデザイナーで開きます。

1. ワークフローが空の場合は、任意のトリガーを追加します。

   この例では、" [**HTTP 要求が受信されたとき**" トリガー](connectors-native-reqres.md#)で開始します。このトリガーは、基本スキーマ定義を使用して、読み取るドキュメントを表します。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-http-trigger.png" alt-text="要求トリガーとパラメーターの構成を使用した標準のロジックアプリワークフローのデザイナーを示すスクリーンショット。":::

1. Azure Cosmos DB アクションを追加するトリガーまたはアクションの下で、[**新しいステップの挿入**] () を選択し **+** >**アクションを追加** します。

1. デザイナーで、 **[操作の追加]** が選択されていることを確認してください。 表示される [**アクションの追加**] ウィンドウで、[**操作の選択**] 検索ボックスの下にある [**組み込み**] を選択して **Azure Cosmos DB** アクションを検索します。

1. 検索ボックスに「 `Azure Cosmos DB`」と入力します。 [ **クエリ項目 (プレビュー)** ] アクションを選択します。

1. 接続の詳細を確認するメッセージが表示されたら、 [Azure Cosmos DB アカウントへの接続を作成](#connect-to-azure-cosmos-db)します。

1. アクションに必要な情報を指定します。

   | プロパティ | 必須 | 値 | 説明 |
   |------------|----------|-------|-------------|
   | **データベース Id** | はい | <*データベース-ID*> | 接続するデータベース。 |
   | **コンテナー Id** | はい | <*コンテナー-ID*> | 照会するコンテナー。 |
   | **項目 Id** | はい | <*項目 ID*> | `id`読み取り対象のドキュメントの値。 |
   | **パーティション キー** | はい | <*パーティションキー*> | 読み取るドキュメントのパーティションキーの値。 |
   |||||

   次の図は、アクションの例を示しています。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-read-configure.png" alt-text="[項目の読み取り] アクションとパラメーターの構成を使用し Azure Cosmos DB て、標準のロジックアプリワークフローのデザイナーを示すスクリーンショット。":::

1. 必要に応じて、その他のアクション設定を構成します。

1. [アクション] の下の [ **新しいステップの挿入** ] () を選択して、 **+****アクション > 追加** します。 表示される [ **アクションの追加** ] ウィンドウで、[ **操作の選択** ] 検索ボックスの下にある [ **組み込み** ] を選択して **条件** アクションを検索し、追加します。

1. 条件の左端にある [ **値** ] ボックスをクリックして、動的なコンテンツの一覧が表示されるようにします。 [ **式** ] タブを選択して、式エディターを開きます。

1. [関数] ボックスの一覧で [ **参照元の関数** ] セクションを探し、[式エディター] ボックスに表示される [ **出力 (actionName)** ] 関数を選択します。

   :::image type="content" source="./media/connectors-create-api-cosmos-db/standard-condition-configure.png" alt-text="条件構成を持つ標準のロジックアプリワークフローのデザイナーを示すスクリーンショット。":::

1. [式エディター] ボックスで、 `'Read_an_item'`**出力 (actionName)** 関数のパラメーターとして「」と入力し、[ `?['body']?['statusCode']`**OK]** を選択します。

   この式は、応答オブジェクトのコンテンツを解析することによって、Azure Cosmos DB に対して読み取り操作を実行するサービス呼び出しによって返されるステータスコードにアクセスし `body` ます。 完全な式は、次の形式に従います。

   `outputs('Read_an_item')?['body']?['statusCode']`

   > [!NOTE]
   > Azure Cosmos DB アクションから返された状態コードは、実際に Azure Cosmos DB に送信される呼び出しから返されたステータスコードとは異なります。 アクションの状態コードは動的コンテンツリストで使用でき、サービス呼び出しの状態コードが返され、応答オブジェクトのに入れ子になってい `body` ます。

1. 条件の中央のボックスと右端にある **[値の選択** ] ボックスで、ワークフローに適した値を指定します。 この例では、状態コードがと等しいかどうかが条件によって確認され `OK` ます。

   > [!NOTE]
   > 状態コードは、数字ではなくテキストとして表されます。

1. 条件の **True** パスと **False** パスで、シナリオに適したその他のアクションを追加します。

1. デザイナーのツール バーで、 **[保存]** を選択します。

1. ロジックアプリをテストして、想定した出力がワークフローから返されることを確認します。

## <a name="next-steps"></a>次のステップ

[Azure Logic Apps のコネクタの概要](apis-list.md)
