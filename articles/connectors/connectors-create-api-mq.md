---
title: IBM MQ サーバーへの接続
description: Azure Logic Apps を使用してワークフローからオンプレミスまたは Azure の MQ サーバーに接続します。
services: logic-apps
ms.suite: integration
author: ChristopherHouser
ms.author: chrishou
ms.reviewer: valthom, estfan, logicappspm
ms.topic: article
ms.date: 05/25/2021
tags: connectors
ms.openlocfilehash: e852f0ce1584a0858f9523c1ea055d4f2cd616d2
ms.sourcegitcommit: 58e5d3f4a6cb44607e946f6b931345b6fe237e0e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 05/25/2021
ms.locfileid: "110376257"
---
# <a name="connect-to-an-ibm-mq-server-from-a-workflow-in-azure-logic-apps"></a>Azure Logic Apps のワークフローからの IBM MQ サーバーへの接続

MQ コネクタを使用すると、オンプレミスまたは Azure にある IBM MQ サーバーにロジック アプリのワークフローを接続できます。 その後、MQ サーバーに格納されているメッセージをワークフローで送受信できます。 この記事では、MQ サーバーに接続し MQ アクションをワークフローに追加する方法を示して、MQ コネクタの使用に関する開始ガイドを提供します。 たとえば、まずキューの 1 つのメッセージを参照することから始め、次いでその他のアクションを試してみることができます。

このコネクタには、TCP/IP ネットワーク経由でリモート MQ サーバーと通信する Microsoft MQ クライアントが含まれています。 次の IBM WebSphere MQ バージョンに接続できます。

* MQ 7.5
* MQ 8.0
* MQ 9.0、9.1、および 9.2

<a name="available-operations"></a>

## <a name="available-operations"></a>使用可能な操作

* マルチテナント Azure Logic Apps: **ロジック アプリ (消費)** リソースを作成する場合は、*マネージド* MQ コネクタを使用して MQ サーバーにのみ接続できます。 このコネクタでは、アクションのみが提供され、トリガーは提供されません。

* シングルテナント Azure Logic Apps : シングルテナント ベースのロジック アプリ ワークフローを作成するときに、アクション *のみ* を含むマネージド MQ コネクタ、またはトリガー *と* アクションを含む *組み込みの* MQ 操作のいずれかを使用して MQ サーバーに接続できます。

マネージド コネクタと組み込み操作の違いの詳細については、[「Logic Apps の重要用語」](../logic-apps/logic-apps-overview.md#logic-app-concepts)を参照してください。

#### <a name="managed"></a>[マネージド](#tab/managed)

次の一覧では、MQ で使用できるマネージド操作の一部のみを示します。

* MQ サーバーから削除せずに、1 つのメッセージまたはメッセージの配列を参照します。 メッセージが複数ある場合は、バッチごとに返されるメッセージの最大数を指定できます。 それ以外の場合は、すべてのメッセージが返されます。
* MQ サーバーから 1 つまたは配列のメッセージを削除します。
* 1 つのメッセージまたはメッセージの配列を受信し、MQ サーバーから削除します。
* 1 つのメッセージを MQ サーバーに送信します。

すべてのマネージド コネクタ操作と、プロパティ、制限など、その他の技術情報については、[MQ コネクタの参照ページ](/connectors/mq/) をご確認ください。

#### <a name="built-in"></a>[組み込み](#tab/built-in)

次の一覧では、MQ で使用できる組み込み操作の一部のみを示します。

* キューでメッセージを使用できる場合は、何らかのアクションを実行します。
* 1 つ以上のメッセージがキューから受信 (オートコンプリート) された場合は、何らかのアクションを実行します。
* 1 つ以上のメッセージがキューから受信 (ピークロック) された場合は、何らかのアクションを実行します。
* 1 つのメッセージまたはメッセージの配列をキューから受信します。 メッセージが複数ある場合は、バッチごとに返されるメッセージの最大数および最大バッチ サイズを KB で指定できます。
* 1 つのメッセージまたはメッセージの配列を MQ サーバーに送信します。

これらの組み込みの MQ 操作には、次の機能に加えて、 [シングルテナント Logic Apps サービス](../logic-apps/single-tenant-overview-compare.md)での logic apps のその他すべての機能のメリットも含まれています。

* 転送中のデータのためのトランスポート層セキュリティ (TLS) の暗号化
* 送受信の両方の操作のためのメッセージ エンコーディング
* ロジック アプリで Azure Functions Premium プランを使用する場合の Azure 仮想ネットワーク統合のサポート

---

## <a name="limitations"></a>制限事項

MQ コネクタでは、メッセージの **Format** フィールドが使用されず、文字セットは変換されません。 このコネクタを使用すると、単にメッセージ フィールドに含まれるデータが JSON メッセージに配置され、メッセージが送信されます。

## <a name="prerequisites"></a>前提条件

* Azure アカウントとサブスクリプション。 Azure サブスクリプションがない場合は、[無料の Azure アカウントにサインアップ](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)してください。

* オンプレミスの MQ サーバーを使用している場合は、ご使用のネットワーク内のサーバーに[オンプレミスのデータ ゲートウェイをインストール](../logic-apps/logic-apps-gateway-install.md)します。 MQ コネクタが動作するには、オンプレミスのデータ ゲートウェイを備えるサーバーに .NET Framework 4.6 もインストールする必要があります。

  ゲートウェイをインストールしたら、Azure でデータ ゲートウェイのリソースも作成しなければなりません。 MQ コネクタは、このリソースを使用して MQ サーバーにアクセスします。 詳細については、[データ ゲートウェイ接続の設定に関する記事](../logic-apps/logic-apps-gateway-connection.md)を確認してください。 

  > [!NOTE]
  > 次のシナリオでは、ゲートウェイは必要ありません。
  > 
  > * マネージド コネクタではなく、組み込みの操作を使用します。
  > * MQ サーバーは、Azure で一般公開されているか、使用可能です。

* MQ サーバーにアクセスするロジック アプリ ワークフロー。 ロジック アプリのリソースは、Azure のゲートウェイ リソースと同じ場所にある必要があります。

  MQ コネクタにはトリガーがないため、ワークフローがトリガーで既に開始されているか、最初にワークフローにトリガーを追加する必要があります。 たとえば、[繰り返しトリガー](../connectors/connectors-native-recurrence.md)を使用できます。

  Azure Logic Apps に慣れていない場合は、この [クイックスタートを試して、マルチテナント Logic Apps サービスで実行されるロジックアプリ ワークフロー](../logic-apps/quickstart-create-first-logic-app-workflow.md)の例を作成してください。

<a name="create-connection"></a>

## <a name="create-an-mq-connection"></a>MQ 接続を作成する 

MQ アクションを初めて追加すると、MQ サーバーへの接続を作成するように求められます。

> [!NOTE]
> MQ コネクタは現在、クライアント認証ではなく、サーバー認証のみをサポートしています。 詳細については、「[接続と認証の問題](#connection-problems)」を参照してください。

#### <a name="managed"></a>[マネージド](#tab/managed)

1. オンプレミスの MQ サーバーに接続している場合は、 **[オンプレミス データ ゲートウェイ経由で接続]** を選択します。

1. MQ サーバーの接続情報を指定します。

   | プロパティ | オンプレミスまたは Azure | 説明 |
   |----------|----------------------|-------------|
   | **ゲートウェイ** | オンプレミスのみ | **[Connect via on-premises data gateway (オンプレミス データ ゲートウェイ経由で接続する)]** を選択します。 |
   | **接続名** | 両方 | 接続のために使用する名前 |
   | **[サーバー]** | 両方 | 次のいずれかの値: <p><p>- MQ サーバーのホスト名 <br>- IP アドレスの後に、コロンとポート番号を指定します。 |
   | **キュー マネージャー名** | 両方 | 使用するキュー マネージャー名 |
   | **チャネル名** | 両方 | キュー マネージャーに接続するためのチャネル |
   | **既定のキュー名** | 両方 | キューの既定の名前 |
   | **Connect As** | 両方 | MQ サーバーに接続するためのユーザー名 |
   | **ユーザー名** | 両方 | ユーザー名の資格情報 |
   | **パスワード** | 両方 | お客様のパスワードの資格情報 |
   | **SSL を有効にしますか?** | オンプレミスのみ | トランスポート層セキュリティ (TLS) と Secure Sockets Layer (SSL) |
   | **ゲートウェイ - サブスクリプション** | オンプレミスのみ | Azure におけるお客様のゲートウェイ リソースに関連付ける Azure サブスクリプションを選択します。 |
   | **ゲートウェイ - 接続ゲートウェイ** | オンプレミスのみ | 使用するゲートウェイ リソース |
   ||||

   次に例を示します。

   ![マネージド MQ 接続の詳細を示すスクリーンショット。](media/connectors-create-api-mq/managed-connection-properties.png)

1. 完了したら **[作成]** を選択します。

#### <a name="built-in"></a>[組み込み](#tab/built-in)

1. MQ サーバーの接続情報を指定します。

   | プロパティ | オンプレミスまたは Azure | 説明 |
   |----------|----------------------|-------------|
   | **接続名** | 両方 | 接続のために使用する名前 |
   | **サーバー名** | 両方 | MQ サーバー名または IP アドレス |
   | **ポート番号** | 両方 | ホスト上のキュー マネージャーに接続するための TCP ポート番号 |
   | **チャネル** | 両方 | キュー マネージャーに接続するためのチャネル |
   | **キュー マネージャー名** | 両方 | 使用するキュー マネージャー名 |
   | **既定のキュー名** | 両方 | キューの既定の名前 |
   | **Connect As** | 両方 | MQ サーバーに接続するためのユーザー名 |
   | **ユーザー名** | 両方 | ユーザー名の資格情報 |
   | **パスワード** | 両方 | お客様のパスワードの資格情報 |
   | **TLS を使用する** | 両方 | トランスポート層セキュリティ (TLS) を使用する |
   ||||

   次に例を示します。

   ![組み込み MQ 接続の詳細を示すスクリーンショット。](media/connectors-create-api-mq/built-in-connection-properties.png)

1. 完了したら **[作成]** を選択します。

---

<a name="add-action"></a>

## <a name="add-an-mq-action"></a>MQ アクションを追加する

Azure Logic Apps では、アクションはトリガーまたは別のアクションに従い、ワークフローで何らかの操作を実行します。 次の手順では、 **1 つのメッセージを参照する** など、アクションを追加する一般的な方法について説明します。

1. Logic Apps デザイナーで、まだ開いていない場合は、ワークフローを開きます。

1. トリガーまたは別のアクションで、新しいステップを追加します。

   既存のステップの間にステップを追加するには、矢印の上にマウスを移動します。 表示されるプラス記号 (+) を選択してから、 **[アクションの追加]** を選択します。

1. [操作の選択] 検索ボックスに「`mq`」と入力します。 また、[アクション] 一覧で、**Browse message** \(メッセージを参照\) という名前のアクションを選択します。

1. MQ サーバーへの接続を作成するように求めるメッセージが表示されたら、 [要求された接続情報を指定](#create-connection)します。

1. アクションで、アクションに必要なプロパティ値を指定します。

   その他のプロパティについては、 **[新しいパラメーターの追加]** リストを開き、追加するパラメーターを選択します。

1. 操作が完了したら、デザイナーのツールバーで、 **[保存]** を選択します。

1. ワークフローをテストするには、デザイナーのツール バーの **[実行]** を選択します。

   実行が完了すると、ワークフローの実行履歴とステップの状態がデザイナーに表示されます。

1. (スキップせずに) 実行された各ステップの入力と出力を確認するには、ステップを展開するか選択します。

   * 詳細な入力の詳細を確認するには、 **[Show raw inputs]** \(未加工入力の表示\) を選択します。
   * その他の出力の詳細を確認するには、 **[Show raw outputs]** \(未加工出力の表示\) を選択します。 **[IncludeInfo]** を **true** に設定した場合は、その他の出力が表示されます。

## <a name="troubleshoot-problems"></a>問題のトラブルシューティング

### <a name="failures-with-browse-or-receive-actions"></a>アクションの参照または受信の失敗

空のキューでアクションの参照または受信を実行すると、アクションは次のヘッダーを出力して失敗します。

![MQ の "メッセージなし" エラー](media/connectors-create-api-mq/mq-no-message-error.png)

<a name="connection-problems"></a>

### <a name="connection-and-authentication-problems"></a>接続と認証の問題

ワークフローがオンプレミスの MQ サーバーに接続しようとしているとき、次のエラーが発生することがあります。

`"MQ: Could not Connect the Queue Manager '<queue-manager-name>': The Server was expecting an SSL connection."`

* Azure で直接 MQ コネクタを使用している場合、MQ サーバーは、信頼された[証明機関](https://www.ssl.com/faqs/what-is-a-certificate-authority/)によって発行された証明書を使用する必要があります。

* MQ サーバーでは、TLS 接続に使用する暗号化仕様を定義する必要があります。 ただし、セキュリティ上の目的や、最適なセキュリティ スイートを含めるために、Windows オペレーティング システムは一連のサポートされている暗号仕様を送信します。

  MQ サーバーが実行されているオペレーティング システムは、使用するスイートを選択します。 構成を一致させるには、暗号化の仕様が TLS ネゴシエーションで選択されたオプションと一致するように MQ サーバーのセットアップを変更する必要があります。

  接続しようとすると、MQ サーバーが間違った暗号化仕様を選択したために接続が失敗したことを示すイベント メッセージをログに記録します。 イベント メッセージには、MQ サーバーが一覧から選択した暗号仕様が含まれています。 チャネル構成において、イベント メッセージ内の暗号化仕様に一致するように暗号化使用を更新します。

## <a name="connector-reference"></a>コネクタのレファレンス

マネージド コネクタにおけるすべての操作と、プロパティ、制限など、その他の技術情報については、[MQ コネクタの参照ページ](/connectors/mq/)をご確認ください。

## <a name="next-steps"></a>次のステップ

* 他の[Logic Apps コネクタ](../connectors/apis-list.md)を確認します。
