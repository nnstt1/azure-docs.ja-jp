---
title: アプリケーション開発者向けのカスタム ロールベースのアクセス制御 (RBAC) - Microsoft ID プラットフォーム
description: カスタム RBAC とは何か、そしてアプリケーションへの実装が重要となる理由について説明します。
services: active-directory
author: Chrispine-Chiedo
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 11/15/2021
ms.custom: template-concept
ms.author: cchiedo
ms.reviewer: john.garland, maggie.marxen, ian.bennett, marsma
ms.openlocfilehash: fc1154965b037fbc57dcafa30f08fd951721bf6f
ms.sourcegitcommit: 362359c2a00a6827353395416aae9db492005613
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/15/2021
ms.locfileid: "132486745"
---
# <a name="role-based-access-control-for-application-developers"></a>アプリケーション開発者向けのロールベースのアクセス制御

ロールベースのアクセス制御 (RBAC) を使用すると、特定のユーザーまたはグループに特定のアクセス許可を与えて、アクセスできるリソースや、それらのリソースに対して実行できる操作、およびリソースの管理者に関して規定することができます。 アプリケーションのロールベースのアクセス制御は、[Azure ロールベースのアクセス制御](../../role-based-access-control/overview.md)や、[Azure AD ロールベースのアクセス制御](../roles/custom-overview.md#understand-azure-ad-role-based-access-control)とは異なります。 Azure カスタム ロールと組み込みロールはどちらも Azure RBAC の一部であり、Azure リソースの管理に役立ちます。 Azure AD RBAC では Azure AD リソースを管理できます。 この記事では、アプリケーションに固有のロールベースのアクセス制御について説明します。


## <a name="what-are-roles"></a>ロールとは何か

ロールベースのアクセス制御 (RBAC) は、アプリケーションにおいて承認を実施する一般的なメカニズムです。 RBAC を使用する場合、アプリケーション開発者は個々のユーザーまたはグループを認可する代わりに、ロールを定義します。 その後、管理者はさまざまなユーザーやグループにロールを割り当てて、誰がどのコンテンツや機能にアクセスできるかを制御できます。

RBAC を使用すると、アプリ開発者はリソースを管理して、ユーザーがそれらのリソースで何を実行できるのかを管理できます。 またアプリ開発者は RBAC を使用して、アプリのユーザーがアクセスできる領域を制御することもできます。 管理者は、 *[ユーザー割り当てが必要]* プロパティを使用してアプリにアクセスできるユーザーを制御できますが、アプリ内の特定のユーザーと、アプリ内でユーザーが実行できる操作を考慮する必要があります。

アプリ開発者はまず、Azure AD 管理センターのアプリの登録セクション内でロールの定義を作成する必要があります。 ロールの定義には、そのロールに割り当てられたユーザーに対して返される値が含まれます。 その後、開発者はこの値を使用してアプリケーション ロジックを実装し、ユーザーがアプリケーション内で実行できる操作や実行できない操作を決定できます。

## <a name="options-for-adding-rbac-to-apps"></a>アプリに RBAC を追加するためのオプション

アプリケーションにロールベースのアクセス制御による認可を含める場合、いくつかの考慮事項に対処する必要があります。 次に例を示します。
- アプリケーションの認可のニーズに必要なロールを定義する。 
- 認証されたユーザーに関連するロールを適用、格納、および取得する。 
- 現在のユーザーに割り当てられているロールに基づいて、目的のアプリケーションの動作に影響を与える。 

ロールを定義すると、Microsoft ID プラットフォームによって、認証されたユーザーのロール情報の適用、格納、取得に使用できるさまざまなソリューションがサポートされます。 これらのソリューションには、アプリ ロール、Azure AD グループ、およびユーザー ロール情報に対するカスタム データストアの使用が含まれます。

開発者は、ロールの割り当てをアプリケーションのアクセス許可としてどう解釈するかについて、独自の実装を柔軟に提供できます。 これには、ミドルウェアや、アプリケーションのプラットフォームまたは関連ライブラリによって提供されるその他の機能の活用が含まれる可能性があります。 アプリは通常、ユーザー ロール情報を要求として受け取り、それらの要求に基づいてユーザーのアクセス許可を決定します。

### <a name="app-roles"></a>アプリ ロール

Azure AD では、アプリケーション登録におけるアプリ ロールの宣言をサポートしています。 ユーザーがアプリケーションにサインインすると、Azure AD によって、そのアプリケーション用にユーザーに付与された各ロールごとの[ロール要求](./access-tokens.md#payload-claims)が含められます。 これらの要求を含むトークンを受け取ったアプリケーションは、この情報を使用して、ユーザーに割り当てられているロールに基づいて、ユーザーが実行できるアクセス許可を決定できます。

### <a name="groups"></a>グループ

また開発者は、[Azure AD グループ](../fundamentals/active-directory-manage-groups.md)を使用してアプリケーションに RBAC を実装することもできます。その場合、ユーザーが特定のグループにおけるメンバーシップが、ロール メンバーシップとして解釈されます。 Azure AD グループを使用すると、Azure AD によって、現在の Azure AD テナント内でユーザーが割り当てられているすべてのグループの識別子を含む、[グループ要求](./access-tokens.md#payload-claims)が含められます。 これらの要求を含むトークンを受け取ったアプリケーションは、この情報を使用して、ユーザーに割り当てられているロールに基づいて、ユーザーが実行できるアクセス許可を決定できます。

> [!IMPORTANT]
> グループを扱う場合、開発者は[超過要求](./access-tokens.md#payload-claims)の概念を認識する必要があります。 既定では、ユーザーが超過制限 (SAML トークンの場合は 150、JWT トークンの場合は 200、暗黙的フローを使用する場合は 6) を超える数のメンバーになっている場合、Azure AD はトークンにグループ要求を出力しません。 代わりに、トークンのコンシューマーが Graph API に対してクエリを実行してユーザーのグループ メンバーシップを取得する必要があることを示す、"超過要求" がトークンに含まれます。 超過要求の取り扱いの詳細については、「[アクセス トークン内の要求](./access-tokens.md#claims-in-access-tokens)」を参照してください。 アプリケーションに割り当てられているグループのみを出力することもできますが、[グループ ベースの割り当て](../manage-apps/assign-user-or-group-access-portal.md)には、Azure Active Directory Premium P1 または P2 エディションが必要です。

### <a name="custom-data-store"></a>カスタム データ ストア

Azure AD ディレクトリでのユーザーの割り当てに関する情報は、アプリ ロールとグループの両方で保管されます。 ユーザー ロールの情報を管理するために開発者が使用できるもう 1 つのオプションは、ディレクトリ外部のカスタム データ ストア内に情報を保持することです。 たとえば、SQL Database や Azure Table Storage、または Azure Cosmos DB Table API などです。

カスタム ストレージを使用すると、開発者はユーザーにロールを割り当てる方法と、ロールを表す方法をさらにカスタマイズして制御することが可能になります。 ただし、柔軟性が高まると、より大きな責任も伴います。 たとえば、Azure AD から返されるトークンにこの情報を含めるメカニズムとして、現在利用可能なものはありません。 開発者がカスタム データ ストア内にロール情報を保持する場合は、アプリ側でロールを取得する必要があります。 これは通常、アプリケーションの開発に使用されているプラットフォームで使用できる、ミドルウェアで定義されている機能拡張ポイントを使用して行われます。 さらに開発者は、カスタム データ ストアを適切にセキュリティで保護する責任があります。

[Azure AD B2C カスタム ポリシー](../../active-directory-b2c/custom-policy-overview.md)を使用すると、カスタム データ ストアと対話したり、トークン内にカスタム要求を含めたりすることができます。

## <a name="choosing-an-approach"></a>アプローチの選択

一般に、推奨されるソリューションはアプリ ロールです。 アプリ ロールは RBAC の実装を目的として作られており、最も単純なプログラミング モデルを提供します。 ただし、特定のアプリケーション要件では、別のアプローチの方が適切なソリューションとなる場合があります。

開発者はアプリ ロールを使用して、ユーザーがアプリにサインインできるかどうか、またはアプリが Web API のアクセス トークンを取得できるかどうかを制御できます。 開発者がアプリ自体に認可のパラメーターを記述して制御する必要がある場合は、Azure AD グループよりもアプリ ロールをお勧めします。 たとえば、承認にグループを使用するアプリは、グループ ID と名前の両方が異なる可能性があるため、次のテナントで中断されます。 アプリ ロールを使用するアプリは安全なままです。 実際、アプリ ロールにグループを割り当てることは、同じ理由で SaaS アプリでも一般的です。

アプリ ロールとグループのどちらも認可に使用できますが、両社の間の主要な違いは、どちらが特定のシナリオに最適なソリューションとなるかに影響を与える可能性があります。

|          |アプリ ロール |Azure AD グループ |カスタム データ ストア|
|----------|-----------|------------|-----------------|
|**プログラミング モデル** |**最も簡単です**。 アプリケーションに固有のものであり、アプリの登録で定義されます。 これらはアプリケーションと共に移動します。|**より複雑です**。 グループ ID はテナントによって異なり、超過要求を考慮する必要がある場合があります。 グループはアプリではなく、Azure AD テナントに固有のものです。|**最も複雑です**。 開発者は、ロール情報を格納および取得する手段を実装する必要があります。|
|**ロールの値は、Azure AD テナント間で一定である**|はい  |いいえ |実装によって異なります。|
|**ロールの値は、複数のアプリケーションで使用できる**|いいえ。 各アプリ登録でロールの設定を複製した場合を除きます。|はい |はい |
|**情報がディレクトリ内に格納されている**|はい  |はい |いいえ |
|**情報はトークンを介して配信される**|はい (ロール要求)  |はい (超過が発生した場合、実行時に "*グループ要求*" の取得が必要となる場合があります) |いいえ。 カスタム コードを介して実行時に取得されます。 |
|**有効期間**|ディレクトリのアプリ登録内に存在します。 アプリ登録が削除されると、削除されます。|ディレクトリ内に存在します。 アプリ登録が削除されても、そのまま残ります。 |カスタム データ ストアに存在します。 アプリ登録とは関連付けられていません。|


## <a name="next-steps"></a>次のステップ

- [アプリケーションにアプリ ロールを追加してトークンで受け取る方法](./howto-add-app-roles-in-azure-ad-apps.md)に関するページ。
- [Microsoft ID プラットフォームにアプリケーションを登録する](./quickstart-register-app.md)。
- [Azure の ID 管理とアクセス制御セキュリティのベスト プラクティス](../../security/fundamentals/identity-management-best-practices.md)。