---
title: テスト環境、調整、およびサービスの制限
titleSuffix: Microsoft identity platform
description: Azure Active Directory テスト環境をデプロイし、Microsoft ID プラットフォームと統合されたアプリをテストする際に考慮すべき調整とサービスの制限について説明します。
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 09/17/2021
ms.author: ryanwi
ms.reviewer: arcrowe
ms.openlocfilehash: f0594994593dbb9505ca7fea24a11a5c5bc7a4eb
ms.sourcegitcommit: 692382974e1ac868a2672b67af2d33e593c91d60
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/22/2021
ms.locfileid: "130262795"
---
# <a name="throttling-and-service-limits-to-consider-for-testing"></a>テストのために考慮すべき調整とサービスの制限
開発者は、運用環境にリリースする前にアプリケーションをテストする必要があります。 Microsoft ID プラットフォームで保護されているアプリケーションをテストする場合は、テストに使用する Azure Active Directory (Azure AD) 環境とテナントを設定する必要があります。  

Microsoft ID プラットフォームと統合するアプリケーションには、Azure AD テナントで作成および管理するディレクトリ オブジェクト (アプリの登録、サービス プリンシパル、グループ、ユーザーなど) が必要です。  アプリの動作に影響するすべての運用テナントの設定は、テスト テナントでレプリケートする必要があります。 必要な条件付きアクセス、アクセス許可の付与、要求のマッピング、トークンの有効期間、トークン発行ポリシーを使用して、テスト テナントを設定します。 アプリケーションでは、コンピューティングやストレージなど、テスト環境に追加する必要がある Azure リソースを使用することもあります。 テスト対象のアプリによっては、テスト環境で大量のリソースが必要になる場合があります。

すべてのお客様がサービスを確実に使用できるようにするため、Azure AD およびその他のサービスでは、お客様とテナントごとに作成できるリソースの数が制限されています。 テスト環境を設定し、ディレクトリ オブジェクトと Azure リソースをデプロイするときに、これらのサービスの制限とクォータの一部に達する可能性があります。

Azure AD、Microsoft Graph などの Azure サービスでは、リソースが過剰に利用されるのを防ぐために、サービスへの同時呼び出しの数を制限したり、お客様ごとのコンピューティング負荷の量を制限したりします。 これは調整と呼ばれており、Azure サービスが確実に、サービスを停止せずに使用量と受信要求を処理できるようにします。 調整は、アプリケーション、テナント、またはサービス レベル全体で行うことができます。 調整は一般的に、テナント内またはテナント間でアプリケーションに大量の要求がある場合に発生します。  実行時に、アプリケーションは、ビジネス ロジックの一環として Microsoft Graph を通じて Azure AD ディレクトリ オブジェクトの読み取りまたは更新を行う可能性があります。 たとえば、ユーザー属性を読み取りまたは設定したり、ユーザーの予定表を更新したり、ユーザーの代わりに電子メールを送信したりします。  実行中、アプリケーションは、Azure リソースのデプロイ、アクセス、更新、削除を行う可能性があります。 テスト中、アプリケーションは、リソースやディレクトリ オブジェクトをデプロイするときに、これらの実行時の調整の制限と前述のサービスの制限に達する可能性があります。

## <a name="azure-ad-service-limits-relevant-to-testing"></a>テストに関連する Azure AD サービスの制限
一般的な Azure AD の使用に関する制約とサービスの制限については、[こちら](../enterprise-users/directory-service-limits-restrictions.md)を参照してください。  一般的な Azure サブスクリプションとサービスの制限、クォータ、制約については、[こちら](../../azure-resource-manager/management/azure-subscription-service-limits.md)を参照してください。

次の表に、テスト環境の設定時またはテストの実行時に考慮すべき Azure AD サービスの制限を示します。 

| カテゴリ         | 制限   |
|-------------------|----------------|
| テナント | 1 人のユーザーは、最大で 200 個のディレクトリを作成できます。|
| リソース | <ul><li>Azure Active Directory の Free エディションのユーザーは、既定で 1 つのテナントに最大 50,000 個の Azure AD リソースを作成できます。 検証済みドメインが少なくとも 1 つある場合は、組織の既定の Azure AD サービス クォータは 300,000 個の Azure AD リソースに拡張されます。 内部管理者の引き継ぎを実行し、少なくとも 1 つの確認済みドメインを持つマネージド テナントに組織が変換された後も、セルフサービス サインアップによって作成された組織の Azure AD サービス クォータは、50,000 個の Azure AD リソースのままになります。 このサービス制限は、Azure AD の価格ページに記載されている 500,000 リソースの価格レベル制限とは関係ありません。 既定のクォータを超えるためには、Microsoft サポートに連絡する必要があります。</li><li>管理者以外のユーザーは、最大 250 個の Azure AD リソースを作成できます。 アクティブ リソースと復元可能な削除済みリソースの両方が、このクォータに加算されます。 30 日未満に削除された削除済み Azure AD リソースのみが復元可能です。 復元できなくなった削除済み Azure AD リソースは、30 日間、 4 分の 1 の値でこのクォータに加算されます。 通常の作業で、このクォータを繰り返し超過する可能性のある開発者がいる場合は、無制限の数のアプリ登録を作成できる権限を持ったカスタムロールを作成して割り当てることもできます。</li></ul>|
| アプリケーション| <ul><li>ユーザー、グループ、またはサービス プリンシパルに割り当てることのできるアプリ ロールは 1,500 までです。</li><li>ユーザー名とパスワードの資格情報を構成して所有できるアプリは、1 ユーザーにつき 48 個までです。</li></ul>|
| アプリケーション マニフェスト| アプリケーション マニフェストには、最大で 1200 のエントリを追加できます。 |
| グループ |  <ul><li>管理者以外のユーザーは、Azure AD 組織に最大 250 個のグループを作成できます。 組織内のグループを管理できる Azure AD 管理者であれば、グループを無制限に作成することもできます (Azure AD オブジェクトの上限まで)。 ユーザーの制限を削除するためのロールを割り当てる場合は、ユーザー管理者やグループ管理者など、特権の低い組み込みロールに割り当ててください。</li><li>Azure AD 組織には、最大 5000 個の動的グループを含めることができます。</li><li>1 つの Azure AD 組織 (テナント) には、最大 300 個のロール割り当て可能なグループを作成できます。</li><li>任意の数の Azure AD リソースが 1 つのグループのメンバーになることができます。</li><li>ユーザーは任意の数のグループのメンバーになることができます。</li></ul>|
| Azure AD ロールとアクセス許可 | <ul><li>Azure AD 組織ごとに、最大 30 個の Azure AD カスタム ロールを作成できます。</li><li>テナント スコープで 1 つのプリンシパルに最大 100 個の Azure AD カスタム ロール割り当て。</li><li>テナント以外のスコープ (管理単位、Azure AD オブジェクトなど) で 1 つのプリンシパルに最大 100 個の Azure AD 組み込みロール割り当て。 テナント スコープでの Azure AD 組み込みロール割り当てに制限はありません。</li></ul>|


## <a name="throttling-limits-relevant-to-testing"></a>テストに関連する調整の制限

次のグローバルな Microsoft Graph 調整の制限が適用されます。

| 要求の種類 | すべてのテナントのアプリごと |
|-------------------|----------------|
| 要求の種類 | すべてのテナントのアプリごと |
| Any | 1 秒あたり 2000 要求| 

次の表に、テストの実行時に考慮すべき Azure AD の調整の制限を示します。 調整は、要求の個々のコストを追加することによって機能するトークン バケット アルゴリズムに基づいています。 要求コストの合計は、事前に決定された制限と比較されます。 制限を超える要求だけが調整されます。 要求コストの詳細については、「[ID とアクセス サービスの制限](/graph/throttling#pattern)」を参照してください。 Microsoft Graph に関するその他のサービス固有の制限については、[こちら](/graph/throttling#service-specific-limits)を参照してください。

| 制限の種類 | リソース ユニットのクォータ | 書き込みクォータ |
|-------------------|----------------|----------------|
| アプリケーションとテナントのペア | 10 秒あたり S: 3500、M:5000、L: 8000 | 2 分 30 秒あたり 3000 |
| application | 20 秒あたり 150,000 | 5 分あたり 70,000 |
| tenant | 適用しない | 5 分あたり 18,000 |

アプリケーションとテナントのペアの制限は、テナント要求を実行するユーザーの数によって異なります。 テナントのサイズは次のように定義されます。S - 50 ユーザー未満、M - 50 ～ 500 ユーザー、L - 501 ユーザー以上。

## <a name="what-happens-when-a-throttling-limit-is-exceeded"></a>調整の制限を超えた場合はどうなるか? 
調整の動作は、要求の種類と数によって異なる場合があります。 たとえば、大量の要求が発生している場合は、すべての要求の種類が調整されます。 しきい値の制限は、要求の種類によって異なります。 したがって、書き込みがスロットルされ、読み取りが許可されているシナリオが発生することがあります。

調整の制限を超えると、HTTP 状態コード `429 Too many requests` が返され、要求は失敗します。 応答には `Retry-After` ヘッダー値が含まれます。これは、次の要求を送信する前にアプリケーションの待機 (またはスリープ) が必要な秒数を示します。 要求をやり直してください。  この再試行値が経過する前に要求を送信した場合、要求は処理されず、新しい再試行値が返されます。 429 エラー コードで再び要求が失敗した場合は、引き続き調整が行われます。 それ以降は、推奨されている `Retry-After` 遅延を使用して、成功するまで要求を再試行してください。

## <a name="next-steps"></a>次のステップ
[テスト環境を設定する](test-setup-environment.md)方法について説明します。