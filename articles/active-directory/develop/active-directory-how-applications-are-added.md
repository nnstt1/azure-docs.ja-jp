---
title: アプリを Azure AD に追加する方法と理由
titleSuffix: Microsoft identity platform
description: Azure AD にアプリケーションを追加する意味とその方法
services: active-directory
author: rwike77
manager: CelesteDG
ms.service: active-directory
ms.subservice: develop
ms.topic: conceptual
ms.workload: identity
ms.date: 12/01/2020
ms.author: ryanwi
ms.custom: aaddev
ms.reviewer: lenalepa, sureshja
ms.openlocfilehash: 1abd8f23f54826e283f4e45aac8b4fb35dc0b144
ms.sourcegitcommit: c072eefdba1fc1f582005cdd549218863d1e149e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 06/10/2021
ms.locfileid: "111953651"
---
# <a name="how-and-why-applications-are-added-to-azure-ad"></a>アプリケーションを Azure AD に追加する方法と理由

Azure AD には、2 つの表現のアプリケーションがあります。

* [アプリケーション オブジェクト](app-objects-and-service-principals.md#application-object) - [例外](#notes-and-exceptions)はありますが、アプリケーション オブジェクトはアプリケーションの定義と考えることができます。
* [サービス プリンシパル](app-objects-and-service-principals.md#service-principal-object) - アプリケーションのインスタンスと考えることができます。 一般的に、サービス プリンシパルはアプリケーション オブジェクトを参照し、1 つのアプリケーション オブジェクトは複数のディレクトリの複数のプリンシパルによって参照されます。

## <a name="what-are-application-objects-and-where-do-they-come-from"></a>アプリケーション オブジェクトの概要とその由来

[アプリケーション オブジェクト](app-objects-and-service-principals.md#application-object)は、Azure portal の [[アプリの登録]](https://aka.ms/appregistrations) エクスペリエンスで管理できます。 アプリケーション オブジェクトは、Azure AD に対してアプリケーションについて記述します。アプリケーション オブジェクトはアプリケーションの定義と考えることができます。これにより、サービスは設定に基づいてアプリケーションにトークンを発行する方法を知ることができます。 他のディレクトリ内のサービス プリンシパルをサポートするマルチテナント アプリケーションであっても、アプリケーション オブジェクトはそのホーム ディレクトリにのみ存在します。 アプリケーション オブジェクトには、以下のいずれかが含まれる可能性があります (ここに記載されていない他の情報もあります)。

* 名前、ロゴ、発行元
* リダイレクト URI
* シークレット (アプリケーションの認証に使用される対称キーまたは非対称キー)
* API の依存関係 (OAuth)
* 発行済みの API/リソース/スコープ (OAuth)
* アプリのロール (RBAC)
* SSO のメタデータと構成
* ユーザー プロビジョニングのメタデータと構成
* プロキシのメタデータと構成

アプリケーション オブジェクトは、以下のような複数の経路で作成できます。

* Azure Portal のアプリケーションの登録
* Visual Studio を使用して新しいアプリケーションを作成し、Azure AD 認証を使用するように構成する
* 管理者がアプリ ギャラリーからアプリケーションを追加するとき (これによってサービス プリンシパルも作成されます)
* Microsoft Graph API または PowerShell を使用して新しいアプリケーションを作成する
* Azure でのさまざまな開発者エクスペリエンスや、デベロッパー センターでの API エクスプローラー エクスペリエンスなど、その他多数

## <a name="what-are-service-principals-and-where-do-they-come-from"></a>サービス プリンシパルの概要とその由来

[サービス プリンシパル](app-objects-and-service-principals.md#service-principal-object)は、Azure portal の [[エンタープライズ アプリケーション]](https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/AllApps/menuId/) エクスペリエンスで管理できます。 サービス プリンシパルは、実際には Azure AD に接続するアプリケーションを制御するものであり、ディレクトリ内のアプリケーションのインスタンスと考えることができます。 どのアプリケーションでも、最大で 1 つの ("ホーム" ディレクトリに登録されている) アプリケーション オブジェクトと、アプリケーションが動作する各ディレクトリ内のアプリケーションのインスタンスを表す 1 つ以上のサービス プリンシパル オブジェクトを持つことができます。 

サービス プリンシパルには、以下を含めることができます。

* アプリケーション ID プロパティを使用したアプリケーション オブジェクトへの参照
* ローカル ユーザーとグループ アプリケーション ロールの割り当ての記録
* ローカル ユーザーとアプリケーションに許可された管理アクセス許可の記録
  * 例: 特定のユーザーの電子メールにアクセスするためのアプリケーションに対するアクセス許可
* 条件付きアクセス ポリシーを含むローカル ポリシーの記録
* アプリケーションの代替ローカル設定の記録
  * 要求変換ルール
  * 属性マッピング (ユーザーのプロビジョニング)
  * ディレクトリ固有のアプリ ロール (アプリケーションがカスタム ロールをサポートする場合)
  * ディレクトリ固有の名前またはロゴ

アプリケーション オブジェクトと同様に、サービス プリンシパルも以下のような複数の経路で作成できます。

* ユーザーが Azure AD と統合されたサードパーティ アプリケーションにサインインするとき
  * サインイン中、ユーザーのプロファイルにアプリケーションがアクセスするための許可とその他のアクセス許可を与えるように求められます。 最初のユーザーがそれに同意した時点で、アプリケーションを表すサービス プリンシパルがディレクトリに追加されます。
* ユーザーが [Microsoft 365](https://products.office.com/) などの Microsoft オンライン サービスにサインインするとき
  * Microsoft 365 をサブスクライブするか、または試用を開始すると、Microsoft 365 に関連するすべての機能を提供するために使用されるさまざまなサービスを表す 1 つまたは複数のサービス プリンシパルがディレクトリに作成されます。
  * SharePoint などの一部の Microsoft 365 サービスは、ワークフローを含むコンポーネント間で安全に通信できるように、実行中にサービス プリンシパルを作成します。
* 管理者がアプリ ギャラリーからアプリケーションを追加するとき (これによって基になるアプリケーション オブジェクトも作成されます)
* [Azure AD アプリケーション プロキシ](../app-proxy/application-proxy.md)を使用するアプリケーションを追加する
* シングル サインオンのために、SAML またはパスワードのシングル サインオン (SSO) を使用してアプリを接続する
* Microsoft Graph API または PowerShell でプログラムを使用する

## <a name="how-are-application-objects-and-service-principals-related-to-each-other"></a>アプリケーション オブジェクトとサービス プリンシパルの相互の関係

アプリケーションには、ホーム ディレクトリ内に 1 つのアプリケーション オブジェクトがあり、そのアプリケーション オブジェクトは、アプリケーションが動作する各ディレクトリ (アプリケーションのホーム ディレクトリを含む) 内の 1 つ以上のサービス プリンシパルから参照されます。

![アプリケーション オブジェクトとサービス プリンシパル間のリレーションシップの表示][apps_service_principals_directory]

上の図では、Microsoft はアプリケーションを発行するために使用する 2 つのディレクトリを内部的に保持しています (左側)。

* 1 つはマイクロソフトのアプリ用 (Microsoft サービス ディレクトリ)
* 1 つは事前に統合されたサードパーティのアプリケーション用 (アプリ ギャラリー ディレクトリ)

Azure AD と統合するアプリケーションのパブリッシャー/ベンダーには、発行ディレクトリが必要です (右側の "Some SaaS Directory")。

自分自身を追加するアプリケーション (この図では "**App (yours)** " と示されている) には、次のアプリケーションが含まれます。

* ユーザーが開発したアプリ (Azure AD と統合)
* シングル サインオン用に接続したアプリ
* Azure AD アプリケーション プロキシを使用して発行したアプリ

### <a name="notes-and-exceptions"></a>エラーと例外

* すべてのサービス プリンシパルがアプリケーション オブジェクトを逆参照するわけではありません。 Azure AD が最初に構築された時点では、アプリケーションに提供されるサービスははるかに限定的であり、サービス プリンシパルはアプリケーション ID を確立するのに十分でした。 元のサービス プリンシパルは、Windows Server Active Directory サービス アカウントとよく似ていました。 このため、現在でも、先にアプリケーション オブジェクトを作成せずに、Azure AD PowerShell を使用するなど、異なる経路でサービス プリンシパルを作成できます。 Microsoft Graph API では、サービス プリンシパルを作成する前に、アプリケーション オブジェクトが必要です。
* 現在、このような情報の中にはプログラムによって公開されていないものがあります。 次の情報は UI でのみ使用できます。
  * 要求変換ルール
  * 属性マッピング (ユーザーのプロビジョニング)
* サービス プリンシパル オブジェクトおよびアプリケーション オブジェクトの詳細については、Microsoft Graph API のリファレンス ドキュメントを参照してください。
  * [Application](/graph/api/resources/application)
  * [サービス プリンシパル](/graph/api/resources/serviceprincipal)

## <a name="why-do-applications-integrate-with-azure-ad"></a>アプリケーションを Azure AD と統合する理由

アプリケーションは、次のような Azure AD が提供するサービスを利用するために Azure AD に追加されます。

* アプリケーションの認証と承認
* ユーザーの認証と承認
* フェデレーションまたはパスワードを使用する SSO
* ユーザーのプロビジョニングと同期
* ロール ベースのアクセス制御 - ディレクトリを使用して、アプリケーション内でロールに基づく承認チェックを実行するためのアプリケーション ロールを定義します。
* OAuth 承認サービス (Microsoft 365 や他の Microsoft アプリケーションによって API/リソースへのアクセスを承認するために使用されます)
* アプリケーションの発行とプロキシ。プライベート ネットワークからインターネットにアプリケーションを発行します。
* ディレクトリ スキーマ拡張機能属性 - [サービス プリンシパルとユーザー オブジェクトのスキーマを拡張し](active-directory-schema-extensions.md)、Azure AD で追加データを格納します。 

## <a name="who-has-permission-to-add-applications-to-my-azure-ad-instance"></a>Azure AD インスタンスにアプリケーションを追加する権限のあるユーザー

グローバル管理者のみが実行できるタスクがいくつかありますが (アプリ ギャラリーからアプリケーションを追加する、アプリケーション プロキシを使用するようにアプリケーションを構成するなど)、既定で、ディレクトリ内のすべてのユーザーは、開発中のアプリケーション オブジェクトを登録する権利を持ち、組織のデータを共有し、アクセス権を付与するアプリケーションについて、同意によって決定することができます。 ディレクトリ内で、アプリケーションにサインインし、同意を許可した最初のユーザーの場合、テナントにサービス プリンシパルが作成されます。それ以外の場合、同意の許可情報は既存のサービス プリンシパルに格納されます。

アプリケーションへの登録と同意をユーザーに許可することは、最初は心配かもいれませんが、以下の点に留意してください。


* アプリケーションは、長い間、登録されたりディレクトリに記録されたりしなくても、ユーザー認証に Windows Server Active Directory を利用することができました。 現在では、いくつのアプリケーションがどのような目的でディレクトリを使用しているかを正確に認識できるようになっています。
* これらの責任をユーザーに委ねることで、管理主導のアプリケーション登録と公開プロセスの必要がなくなります。 Active Directory フェデレーション サービス (ADFS) では、開発者に代わって管理者が証明書利用者としてアプリケーションを追加することが必要な場合がありました。 今では開発者がセルフ サービスできます。
* ユーザーがビジネス目的で組織のアカウントを使用してアプリケーションにサインインするのは良いことです。 後でユーザーが組織を離れると、自動的に使用していたアプリケーションのアカウントにアクセスできなくなります。
* どのようなデータがどのアプリケーションと共有されていたのかについての記録を残すのは良いことです。 データはかつてより移動性が高くなっており、誰がどのデータをどのアプリケーションと共有したかについての明確な記録があると便利です。
* Azure AD を OAuth に使用する API 所有者は、そのユーザーがアプリケーションに与えることができるアクセス許可および管理者が同意する必要があるアクセス許可を厳密に決定します。 ユーザーの同意はそのユーザー自身のデータと機能に限定されますが、管理者だけはより大きな範囲とより重要なアクセス許可に同意することができます。
* ユーザーがデータへのアクセスをアプリケーションに追加または許可すると、そのイベントを監査できるので、Azure Portal 内の監査レポートを表示して、アプリケーションがどのようにディレクトリに追加されたかを判断することができます。

それでもディレクトリ内のユーザーが管理者の承認なしにアプリケーションの登録とアプリケーションへのサインインを実行できないようにするには、これらの機能を無効にするように変更できる 2 つの設定があります。

* ユーザーが自分のためにアプリケーションに同意できないようにするには:
  1. Azure Portal で、エンタープライズ アプリケーションの [[ユーザー設定]](https://portal.azure.com/#blade/Microsoft_AAD_IAM/StartboardApplicationsMenuBlade/UserSettings/menuId/) セクションに移動します。
  2. **[ユーザーはアプリが自身の代わりに会社のデータにアクセスすることを許可できます]** を **[いいえ]** に変更します。
     
     > [!NOTE]
     > ユーザーの同意を無効にする場合、ユーザーが新しいアプリケーションを使用する必要があるとき、そのアプリケーションに管理者が同意する必要があります。

* ユーザーが自分のアプリケーションを登録できないようにするには:
  1. Azure Portal で、Azure Active Directory の [[ユーザー設定]](https://portal.azure.com/#blade/Microsoft_AAD_IAM/ActiveDirectoryMenuBlade/UserSettings) セクションに移動します。
  2. **[ユーザーはアプリケーションを登録できる]** を **[いいえ]** に変更します。

> [!NOTE]
> Microsoft は、ユーザーが自分のためにアプリケーションに登録し、アプリケーションに同意することができる既定の構成を使用しています。

<!--Image references-->
[apps_service_principals_directory]:../media/active-directory-how-applications-are-added/HowAppsAreAddedToAAD.jpg