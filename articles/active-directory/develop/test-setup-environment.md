---
title: アプリのテスト環境を設定する
titleSuffix: Microsoft identity platform
description: Microsoft ID プラットフォームと統合されたアプリケーションをテストできるように、Azure Active Directory テスト環境を設定する方法について説明します。  テストに別のテナントが必要かどうか、または実稼働テナントを使用できるかどうかを評価します。
services: active-directory
author: arcrowe
manager: dastrock
ms.service: active-directory
ms.subservice: develop
ms.topic: how-to
ms.workload: identity
ms.date: 09/28/2021
ms.author: arcrowe
ms.reviewer: ''
ms.custom: aaddev
ms.openlocfilehash: e695a7028432b1044c0c1896447d474b2716097f
ms.sourcegitcommit: 87de14fe9fdee75ea64f30ebb516cf7edad0cf87
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/01/2021
ms.locfileid: "129367495"
---
# <a name="set-up-your-applications-azure-ad-test-environment"></a>アプリケーションの Azure AD テスト環境を設定する

開発者は、ソフトウェア開発ライフサイクルを使用し、開発、テスト、および運用環境の間でアプリを移動します。  このプロセスを Microsoft ID プラットフォームで保護されているアプリケーションに使用する場合は、テストに使用する Azure Active Directory (Azure AD) 環境を設定する必要があります。  この環境は、開発ライフサイクルの早期テスト ステージと、長期的で永続的なテスト環境で使用できます。  リソース分離の要件に応じて、組織の Azure AD 実稼働テナント、またはテスト用の完全に別個のテナントを使用できます。  

この記事では、 Microsoft ID プラットフォームと統合されたアプリケーションをテストできるように、Azure AD テスト環境を設定する方法について説明します。  必要な分離レベルと、テスト用の別個のテナントが必要かどうか、または実稼働テナントを使用できるかどうかを評価します。

## <a name="decide-the-level-of-isolation-needed"></a>必要な分離のレベルを決定する
一般に、実稼働テナントをテスト環境として使用する方が簡単でオーバーヘッドが少なくなります。 ただし、これは、テストと実稼働のリソースの間で適切なレベルの分離を実現できる場合にのみ実行可能なオプションです。  高い特権のシナリオでは、分離が特に重要です。

次の場合は、(組織の実稼働テナントではなく) 別個のテナントにテスト環境を設定します。
- テナント全体の一意の設定を必要とする一連のリソースがある。 たとえば、アプリでは、ユーザーに代わってではなく、それ自体としてテナント リソースにアクセスする必要がある場合があります (アプリ専用のアクセス許可を使用します)。  アプリ専用アクセスには、テナント全体に適用される管理者の同意が必要であり、それらのアクセス許可をテナント境界内で安全にスコープを設定するのは困難です。
- テスト リソースへのテナント メンバーによる未承認のアクセスに対するリスク許容度は最小限です。
- 構成の変更は、運用環境に重大な影響を与える可能性があります。
- テナントにテスト ユーザーと関連付けられたテスト データを作成できない。
- テスト用のアプリケーションへの自動サインインを実行する予定であり、実稼働テナントで、ユーザーの操作を必要とする認証方法ポリシーが構成されている。  たとえば、すべてのユーザーに多要素認証が必要な場合は、統合テストのための自動サインインを実行できない場合があります。
- グローバル管理者が特定のテスト リソースを管理またはアクセスできないようにする必要がある。 そのリソースは、別のグローバル管理者がいる別のテナントに分離する必要があります。
- 非運用リソースやワークロードを実稼働テナントに追加すると、そのテナントの[サービスまたは調整の制限を超える](test-throttle-service-limits.md)可能性がある。

これらの条件のいずれも当てはまらない場合は、次の手順に従って、[実稼働テナントにテスト環境を設定します](#set-up-a-test-environment-in-your-production-tenant)。  ただし、いずれかが当てはまる場合は、[別のテナントにテスト環境を設定する](#set-up-a-test-environment-in-a-separate-tenant)必要があります。

## <a name="set-up-a-test-environment-in-a-separate-tenant"></a>別のテナントにテスト環境を設定する
実稼働テナントでテスト アプリを安全に制限できない場合は、開発とテストの目的で別のテナントを作成できます。 

### <a name="get-a-test-tenant"></a>テスト テナントを取得する
まだ専用のテスト テナントがない場合は、Microsoft 365 開発者プログラムを使用して無料で作成することも、自分で手動で作成することもできます。 

#### <a name="join-the-microsoft-365-developer-program-recommended"></a>Microsoft 365 開発者プログラムに参加する (推奨) 
[Microsoft 365 開発者プログラム](https://developer.microsoft.com/microsoft-365/dev-program)は無料であり、テスト ユーザー アカウントとサンプル データ パックをテナントに自動的に追加できます。
1. 画面の **[今すぐ参加]** ボタンをクリックします。
2. 新しい Microsoft アカウントでサインインするか、既に所有している既存の (職場) アカウントを使用します。
3. サインアップ ページで、リージョンを選択し、会社名を入力して、プログラムの使用条件に同意してから、 **[次へ]** をクリックします。
4. **[サブスクリプションの設定]** をクリックします。 新しいテナントを作成するリージョンを指定し、ユーザー名とドメインを作成して、パスワードを入力します。 これにより、新しいテナントとテナントの最初の管理者が作成されます。
5. 新しいテナントの管理者アカウントを保護するために必要なセキュリティ情報を入力します。 これにより、アカウントに多要素認証が設定されます

#### <a name="manually-create-a-tenant"></a>テナントを手動で作成する  
[テナントを手動で作成](quickstart-create-new-tenant.md)できます。これは作成時には空で、テスト データを使用して構成する必要があります。

### <a name="populate-your-tenant-with-users"></a>テナントにユーザーを設定する  
便宜上、自分や開発チームの他のメンバーをテナントのゲスト ユーザーに招待することもできます。  これにより、テスト テナントに別のゲスト オブジェクトが作成されますが、企業アカウントとテスト アカウントの資格情報のセットを 1 つだけ管理すれば済むことを意味します。
1. [Azure portal](https://portal.azure.com) で、 **[Azure Active Directory]** をクリックします。
2. **[Users]** タブに移動します。
3. **[新しいゲスト ユーザー]** をクリック し、仕事用アカウントの電子メール アドレスを招待します。
4. アプリケーションの開発やテストのチームの他のメンバーに対して繰り返します。

テスト テナントでテスト ユーザーを作成することもできます。  Microsoft 365 サンプル パックのいずれかを使用した場合は、テナントにテスト ユーザーが既に存在している可能性があります。  そうではない場合は、テナント管理者として自分で作成できます。
1. [Azure portal](https://portal.azure.com) で、 **[Azure Active Directory]** をクリックします。
2. **[Users]** タブに移動します。
3. **[新しいユーザー]** を クリックし、ディレクトリに新しいテスト ユーザーを作成します。

### <a name="get-an-azure-ad-subscription-optional"></a>Azure AD サブスクリプションを作成する (省略可能)
アプリケーションで Azure AD Premium の機能を完全にテストする場合は、[Premium P1 または Premium P2 ライセンス](https://azure.microsoft.com/pricing/details/active-directory/)のテナントにサインアップする必要があります。

Microsoft 365 開発者プログラムを使用してサインアップした場合、テスト テナントには Azure AD P2 ライセンスが付属しています。  そうでない場合でも、引き続き 1 か月間の [Azure AD Premium の無料試用版](https://azure.microsoft.com/trial/get-started-active-directory/)を有効にできます。

### <a name="create-and-configure-an-app-registration"></a>アプリの登録を作成して構成する
テスト環境で使用するアプリの登録を作成する必要があります。  これは、テスト環境と運用環境の間のセキュリティ分離を維持するために、最終的な運用アプリの登録とは別の登録である必要があります。  アプリケーションの構成方法は、構築するアプリの種類によって異なります。  詳細については、[Web アプリケーションの登録](scenario-web-app-sign-user-app-registration.md)に関するこの記事のように、左側のナビゲーション ウィンドウでアプリのシナリオのアプリ登録手順を確認してください。
   
### <a name="populate-your-tenant-with-policies"></a>テナントにポリシーを設定する
アプリが主に 1 つの組織 (一般にシングル テナントと呼ばれます) によって使用され、その実稼働テナントにアクセスできる場合は、アプリの動作に影響を与える可能性がある実稼働テナントの設定をレプリケートしてみてください。  そうすると、運用時に予期しないエラーが発生する可能性が低くなります。

#### <a name="conditional-access-policies"></a>条件付きアクセス ポリシー 
条件付きアクセス ポリシーをレプリケートすると、運用環境に移行するときに予期しないアクセスのブロックを確実に発生させず、アプリケーションで受信する可能性があるエラーを適切に処理できます。

実稼働テナントの条件付きアクセス ポリシーの表示は、会社の管理者が実行する必要がある場合があります。  
1. 実稼働テナントのアカウントを使用して [Azure portal](https://portal.azure.com) にサインインします
1. **[Azure Active Directory]**  >  **[エンタープライズ アプリケーション]**  >  **[条件付きアクセス]** の順に移動します。
1. テナントのポリシーのリストを表示します。  最初のものをクリックします。
1. **[クラウド アプリまたはアクション]** に移動します。  
1. ポリシーがアプリの選択したグループにのみ適用される場合は、次のポリシーに進みます。  そうではない場合は、運用環境に移行するときにアプリにも適用される可能性があります。  ポリシーをテスト テナントにコピーする必要があります。

新しいタブまたはブラウザー セッションで、[Azure portal](https://portal.azure.com) に移動し、テスト テナントにサインインします。
1. **[Azure Active Directory]**  >  **[エンタープライズ アプリケーション]**  >  **[条件付きアクセス]** の順に移動します。
1. **[新しいポリシー]** をクリックします
1. 前の手順によって識別された実稼働テナント ポリシーから設定をコピーします。

#### <a name="permission-grant-policies"></a>アクセス許可付与ポリシー
アクセス許可付与ポリシーをレプリケートすると、運用環境に移行するときに、管理者の同意を求める予期しないプロンプトが表示されることはありません。 

1. 実稼働テナントのアカウントを使用して [Azure portal](https://portal.azure.com) にサインインします
1. **[Azure Active Directory]** をクリックします。
1. **[エンタープライズ アプリケーション]** に移動します。 
1. 運用テナントで **[Azure Active Directory]**  >  **[エンタープライズ アプリケーション]**  >  **[同意とアクセス許可]**  >  **[ユーザーの同意]** 設定を選択します。  そこで設定をテスト テナントにコピーします。  
    
#### <a name="token-lifetime-policies"></a>トークンの有効期間ポリシー
トークンの有効期間ポリシーをレプリケートすると、アプリケーションに発行されたトークンが、運用環境で予期せず期限切れになることはありません。  
 
トークンの有効期間ポリシーは、現在は PowerShell を使用してのみ管理できます。 運用組織全体に適用されるトークンの有効期間ポリシーを特定する方法については、[構成可能なトークンの有効期間](active-directory-configurable-token-lifetimes.md)に関するページを参照してください。  これらのポリシーをテスト テナントにコピーします。
 
## <a name="set-up-a-test-environment-in-your-production-tenant"></a>実稼働テナントでテスト環境を設定する
実稼働テナントでテスト アプリを安全に制限できる場合は、テスト目的でテナントを設定します。

### <a name="create-and-configure-an-app-registration"></a>アプリの登録を作成して構成する
テスト環境で使用するアプリの登録を作成する必要があります。  これは、テスト環境と運用環境の間のセキュリティ分離を維持するために、最終的な運用アプリの登録とは別の登録である必要があります。  アプリケーションの構成方法は、構築するアプリの種類によって異なります。  詳細については、左側のナビゲーション ウィンドウの[アプリのアプリ登録手順のシナリオ](scenario-web-app-sign-user-app-registration.md)に関するページを確認してください。

### <a name="create-some-test-users"></a>テスト ユーザーを作成する
シナリオのテスト中に使用する、テスト データが関連付けられたテスト ユーザーを作成する必要があります。  この手順は、管理者が実行する必要がある場合があります
1. [Azure portal](https://portal.azure.com) で、 **[Azure Active Directory]** をクリックします。
2. **[Users]** タブに移動します。
3. **[新しいユーザー]** を クリックし、ディレクトリに新しいテスト ユーザーを作成します。

### <a name="add-the-test-users-to-a-group-optional"></a>テスト ユーザーをグループに追加する (省略可能)
便宜上、これらのすべてのユーザーをグループに割り当てることができます。これにより、他の割り当て操作が簡単になります。  
1. [Azure portal](https://portal.azure.com) で、 **[Azure Active Directory]** をクリックします。
2. **[グループ]** に移動します。
3. **[新しいグループ]** をクリックします。
4. グループの種類で **[セキュリティ]** または **[Microsoft 365]** を選択します。
5. グループに名前を付けます。
6. 前の手順で作成したテスト ユーザーを追加します。

### <a name="restrict-your-test-application-to-specific-users"></a>テスト アプリケーションを特定のユーザーに制限する
ユーザー割り当てを使用して、テスト アプリケーションの使用が許可されるテナント内のユーザーを、特定のユーザーまたはグループに制限することができます。  [アプリの登録を使用してアプリを作成](#create-and-configure-an-app-registration)した場合、アプリの表現も **[エンタープライズ アプリケーション]** で作成されています。  **[エンタープライズ アプリケーション]** の設定を使用して、テナントでアプリケーションを使用できるユーザーを制限します。

> [!IMPORTANT]
> アプリが[マルチテナント アプリ](v2-supported-account-types.md)である場合、この操作では他のテナントのユーザーがアプリにサインインして使用できないように制限されません。  ユーザー割り当てが構成されているテナントのユーザーのみが制限されます。 

アプリをテナントの特定のユーザーに制限する方法の詳細については、[一連のユーザーへのアプリの制限](howto-restrict-your-app-to-a-set-of-users.md)に関するページを参照してください。

## <a name="next-steps"></a>次のステップ
 
テスト環境の設定中に発生する可能性のある[調整とサービスの制限](test-throttle-service-limits.md)について説明します。

テスト環境の詳細については、[Azure Active Directory を使用した Azure 環境のセキュリティ保護](https://azure.microsoft.com/resources/securing-azure-environments-with-azure-active-directory/)に関するページを参照してください。
  
