---
title: Azure AD Connect:ADSync サービス アカウント | Microsoft Docs
description: このトピックでは、ADSync サービス アカウントについて説明し、アカウントに関するベスト プラクティスを示します。
services: active-directory
documentationcenter: ''
author: billmath
manager: daveba
editor: ''
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: conceptual
ms.date: 03/17/2021
ms.subservice: hybrid
ms.author: billmath
ms.collection: M365-identity-device-management
ms.openlocfilehash: dfa329999cb7b53835907196ceaa9b02920da149
ms.sourcegitcommit: 4a54c268400b4158b78bb1d37235b79409cb5816
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/28/2021
ms.locfileid: "108124259"
---
# <a name="adsync-service-account"></a>ADSync サービス アカウント
Azure AD Connect は、Active Directory と Azure Active Directory の間の同期を調整するオンプレミス サービスをインストールします。  Microsoft Azure AD Sync 同期サービス (ADSync) は、オンプレミス環境内のサーバー上で実行されます。  サービスの資格情報は、高速インストールでは既定で設定されますが、組織のセキュリティ要件を満たすようにカスタマイズできます。  これらの資格情報は、オンプレミス フォレストまたは Azure Active Directory への接続には使用されません。

ADSync サービス アカウントの選択は重要な計画上の決定であり、Azure AD Connect をインストールする前に行います。  インストール後に資格情報を変更しようとすると、サービスの開始に失敗し、同期データベースへのアクセスが失われ、接続先ディレクトリ (Azure および AD DS) の認証は失敗します。  元の資格情報が復元されるまで、同期は行われません。

同期サービスは、複数のアカウントで実行できます。 これは、仮想サービス アカウント (VSA)、管理されたサービス アカウント (gMSA/sMSA)、または通常のユーザー アカウントで実行できます。 サポートされるオプションは、新規インストールを実行した場合、Azure AD Connect の 2017 年 4 月のリリースと 2021 年 3 月のリリースで変更されています。 Azure AD Connect の以前のリリースからアップグレードする場合は、これらの追加のオプションは利用できません。 


|アカウントの種類|インストール オプション|説明| 
|-----|------|-----|
|Virtual Service Account|高速およびカスタム、2017 年 4 月以降| 仮想サービス アカウントは、ドメイン コントローラーでのインストールを除くすべての高速インストールに使用されます。 カスタム インストールでは、別のオプションが使われていない限り、これが既定のオプションです。| 
|管理されたサービス アカウント|カスタム、2017 年 4 月以降|リモートの SQL Server を使う場合は、グループの管理されたサービス アカウントを使うことをお勧めします。 |
|管理されたサービス アカウント|高速およびカスタム、2021 年 3 月以降|ドメイン コントローラーにインストールされる場合、高速インストールでは、ADSyncMSA_ のプレフィックスが付いたスタンドアロンの管理されたサービス アカウントがインストール時に作成されます。 カスタム インストールでは、別のオプションが使われていない限り、これが既定のオプションです。|
|ユーザー アカウント|高速およびカスタム、2017 年 4 月から 2021 年 3 月|ドメイン コントローラーにインストールされる場合、高速インストールでは、AAD_ のプレフィックスが付いたユーザー アカウントがインストール時に作成されます。 カスタム インストールでは、別のオプションが使われていない限り、これが既定のオプションです。|
|ユーザー アカウント|高速およびカスタム、2017 年 3 月以前|高速インストールでは、AAD_ のプレフィックスが付いたユーザー アカウントがインストール時に作成されます。 カスタム インストールを使用した場合は、別のアカウントを指定できます。| 

>[!IMPORTANT]
> 2017 年 3 月以前のバージョンのビルドで Connect を使用した場合、Windows は、セキュリティ上の理由から暗号化キーを破棄するため、サービス アカウントのパスワードをリセットする必要はありません。 アカウントを他のアカウントに変更するには、Azure AD Connect を再インストールする必要があります。 2017 年 4 月以降のビルドにアップグレードする場合、サービス アカウントのパスワードを変更することはできますが、使用されるアカウントを変更することはできません。 

> [!IMPORTANT]
> サービス アカウントを設定できるのは、初回のインストール時のみです。 インストールが完了した後にサービス アカウントを変更することはできません。 サービス アカウントのパスワードの変更はサポートされています。手順については、[こちら](how-to-connect-sync-change-serviceacct-pass.md)を参照してください。

次の表に、同期サービス アカウントの既定、推奨、サポート対象の各オプションを示します。 

凡例: 

- **太字** は既定のオプションを示し、ほとんどの場合、推奨されるオプションです。 
- *斜体* は既定のオプションではないが、推奨されるオプションを示します。 
- 太字でない部分 - サポートされているオプション 
- ローカル アカウント - サーバー上のローカル ユーザー アカウント 
- ドメイン アカウント - ドメイン ユーザー アカウント 
- sMSA - [スタンドアロンの管理されたサービス アカウント](/previous-versions/windows/it-pro/windows-server-2008-R2-and-2008/dd548356(v=ws.10))
- gMSA - [グループの管理されたサービス アカウント](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831782(v=ws.11)) 

|マシンの種類 |**LocalDB </br> 高速**|**LocalDB/LocalSQL</br> カスタム**|**リモート SQL</br> カスタム**|
|-----|-----|-----|-----|
|**ドメインに参加しているコンピューター**|**VSA**|**VSA**</br> *sMSA*</br> *gMSA*</br> ローカル アカウント</br> ドメイン アカウント| *gMSA* </br>ドメイン アカウント|
|ドメイン コントローラー| **sMSA**|**sMSA** </br>*gMSA*</br> ドメイン アカウント|*gMSA*</br>ドメイン アカウント| 

## <a name="virtual-service-account"></a>Virtual Service Account 

仮想サービス アカウントは、パスワードのない特殊な種類の管理されたローカル アカウントで、Windows によって自動的に管理されます。 

 ![仮想サービス アカウント](media/concept-adsync-service-account/account-1.png)

仮想サービス アカウントは、同期エンジンと SQL が同じサーバー上にあるシナリオで使用するためのものです。 リモートの SQL を使用する場合は、代わりにグループの管理されたサービス アカウントを使用することをお勧めします。 

[Windows データ保護 API (DPAPI)](/previous-versions/ms995355(v=msdn.10)) の問題のため、ドメイン コントローラーで仮想サービス アカウントを使用することはできません。 

## <a name="managed-service-account"></a>管理されたサービス アカウント 

リモートの SQL Server を使う場合は、グループの管理されたサービス アカウントを使うことをお勧めします。 グループの管理されたサービス アカウント用の Active Directory を準備する方法について詳しくは、「[グループの管理されたサービス アカウントの概要](/previous-versions/windows/it-pro/windows-server-2012-R2-and-2012/hh831782(v=ws.11))」をご覧ください。 

このオプションを使用するには、[[必須コンポーネントのインストール]](how-to-connect-install-custom.md#install-required-components) ページで **[既存のサービス アカウントを使用する]** を選択し、 **[管理されたサービス アカウント]** を選択します。 

 ![管理されたサービス アカウント](media/concept-adsync-service-account/account-2.png)

スタンドアロンの管理されたサービス アカウントを使用することもできます。 ただし、これらはローカル コンピューターでのみ使うことができ、既定の仮想サービス アカウントでこれらを使うことにメリットはありません。 

### <a name="auto-generated-standalone-managed-service-account"></a>自動生成されたスタンドアロンの管理されたサービス アカウント 

Azure AD Connect をドメイン コントローラーにインストールする場合、スタンドアロンの管理されたサービス アカウントがインストール ウィザードによって作成されます (カスタム設定で使用するアカウントを指定している場合を除きます)。 アカウントは、先頭に **ADSyncMSA_** が付き、実際の同期サービスがそのアカウントで実行されます。 

このアカウントは、パスワードのない管理されたドメイン アカウントで、Windows によって自動的に管理されます。 

このアカウントは、同期エンジンと SQL がドメイン コントローラー上にあるシナリオで使用するためのものです。 

## <a name="user-account"></a>ユーザー アカウント 

ローカル サービス アカウントはインストール ウィザードで作成します (カスタム設定で使用するアカウントを指定しない限り)。 アカウントは、先頭に AAD_ が付き、実際の同期サービスがそのアカウントで実行されます。 Azure AD Connect をドメイン コントローラーにインストールした場合、アカウントはドメインに作成されます。 次の場合、AAD_ サービス アカウントがドメインに存在する必要があります。 
- SQL Server を実行しているリモート サーバーを使っている 
- 認証が必要なプロキシを使っている 

 ![ユーザー アカウント (user account)](media/concept-adsync-service-account/account-3.png)

アカウントの作成時には、有効期限のない長く複雑なパスワードが設定されます。 

このアカウントを使用して、安全な方法で他のアカウントのパスワードを保存します。 これらの他のアカウントのパスワードは暗号化されて、データベースに格納されます。 暗号化キーの秘密キーは、Windows データ保護 API (DPAPI) を使用する暗号化サービスの秘密キー暗号化によって保護されています。 

完全バージョンの SQL Server を使用した場合、サービス アカウントは、同期エンジン用に作成されたデータベースの DBO になります。 サービスは、他のアクセス許可では意図したように機能しません。 SQL ログインも作成されます。 

アカウントには、ファイル、レジストリ キー、また同期エンジンに関連するその他のオブジェクトへのアクセス許可も付与されます。 


## <a name="next-steps"></a>次のステップ
「 [オンプレミス ID と Azure Active Directory の統合](whatis-hybrid-identity.md)」をご覧ください。