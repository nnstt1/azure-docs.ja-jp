---
title: エンタイトルメント管理のトラブルシューティング - Azure AD
description: Azure Active Directory エンタイトルメント管理をトラブルシューティングする際に確認しておくべき事項について説明します。
services: active-directory
documentationCenter: ''
author: ajburnle
manager: daveba
editor: markwahl-msft
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: troubleshooting
ms.subservice: compliance
ms.date: 12/23/2020
ms.author: ajburnle
ms.reviewer: markwahl-msft
ms.collection: M365-identity-device-management
ms.openlocfilehash: f4dd89dd22345188c05dd607b4a71ea8ef733f73
ms.sourcegitcommit: 2eac9bd319fb8b3a1080518c73ee337123286fa2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/31/2021
ms.locfileid: "123259978"
---
# <a name="troubleshoot-azure-ad-entitlement-management"></a>Azure AD エンタイトルメント管理のトラブルシューティング

この記事では、Azure Active Directory (Azure AD) エンタイトルメント管理 (Preview) をトラブルシューティングする際に確認しておくべき事項について説明します。

## <a name="administration"></a>管理

* エンタイトルメント管理の構成時に、アクセスが拒否されたというメッセージが表示された場合、自分がグローバル管理者であるときは、ディレクトリに [Azure AD Premium P2 (または EMS E5) ライセンス](entitlement-management-overview.md#license-requirements)があることを確認してください。  期限切れの Azure AD Premium P2 サブスクリプションを最近更新した場合、このライセンスの更新が表示されるまでに 8 時間かかることがあります。

* テナントの Azure AD Premium P2 ライセンスの有効期限が切れている場合、新しいアクセス要求を処理したり、アクセス レビューを実行したりすることはできません。  

* アクセス パッケージの作成中または表示中に、アクセスが拒否されたというメッセージが表示された場合、自分がカタログ作成者グループのメンバーであるときは、最初のアクセス パッケージを作成する前に[カタログを作成](entitlement-management-catalog-create.md)する必要があります。

## <a name="resources"></a>リソース

* アプリケーションのロールはアプリケーション自体によって定義され、Azure AD で管理されます。 アプリケーションにリソース ロールがない場合、エンタイトルメント管理によってユーザーが **[既定のアクセス]** ロールに割り当てられます。

    Azure portal には、アプリケーションとして選択できないサービスのサービス プリンシパルも表示される場合があることに注意してください。  特に、**Exchange Online** と **SharePoint Online** はサービスであり、ディレクトリにリソース ロールを持つアプリケーションではないため、アクセス パッケージに含めることができません。  代わりに、グループ ベースのライセンスを使用して、それらのサービスへのアクセスを必要とするユーザーに対して適切なライセンスを確立します。

* 認証に関して個人用の Microsoft アカウント ユーザーをサポートするのみで、ディレクトリ内の組織アカウントをサポートしないアプリケーションは、アプリケーション ロールを持たず、アクセス パッケージ カタログに追加することはできません。

* グループがアクセス パッケージ内のリソースになるためには、そのグループが Azure AD で変更可能である必要があります。  オンプレミスの Active Directory に由来するグループは、その所有者またはメンバー属性を Azure AD で変更できないため、リソースとして割り当てることができません。   Exchange Online で配布グループとして生成されるグループも、Azure AD で変更できません。 

* SharePoint Online のドキュメント ライブラリと個別のドキュメントはリソースとして追加できません。  代わりに、[Azure AD セキュリティ グループ](../fundamentals/active-directory-groups-create-azure-portal.md)を作成し、そのグループとサイト ロールをアクセス パッケージに含め、SharePoint Online でそのグループを使用してドキュメント ライブラリまたはドキュメントへのアクセスを制御します。

* アクセス パッケージで管理するリソースにユーザーが既に割り当てられている場合は、適切なポリシーを使用してユーザーがアクセス パッケージに割り当てられていることを確認します。 たとえば、既にユーザーがいるグループをアクセス パッケージに含めるとよいでしょう。 グループ内のこれらのユーザーが引き続きアクセスを必要とする場合、これらのユーザーは、アクセス パッケージに対する適切なポリシーを持ち、グループへのアクセスが不可能にならないようにする必要があります。 アクセス パッケージを割り当てるには、そのリソースを含むアクセス パッケージを要求するようにユーザーに依頼するか、またはアクセス パッケージにユーザーを直接割り当てます。 詳細については、[アクセス パッケージの要求と承認の設定の変更](entitlement-management-access-package-request-policy.md)に関する記事を参照してください。

* チームのメンバーを削除すると、Microsoft 365 グループからも削除されます。 チームのチャット機能から削除されるタイミングは遅れる場合があります。 詳細については、「[グループ メンバーシップ](/microsoftteams/office-365-groups#group-membership)」を参照してください。


## <a name="access-packages"></a>アクセス パッケージ

* アクセス パッケージまたはポリシーを削除しようとしたときに、アクティブな割り当てがあることを示すエラー メッセージが表示されるのに、割り当てがあるユーザーが表示されない場合は、最近削除されたユーザーに、割り当てがあるかどうかを確認してください。 ユーザーが削除されてから 30 日間は、ユーザー アカウントを復元できます。   

## <a name="external-users"></a>外部ユーザー

* 外部ユーザーがアクセス パッケージへのアクセスを要求する必要がある場合は、アクセス パッケージの **マイ アクセス ポータル リンク** をユーザーが使用していることを確認します。 詳細については、[アクセス パッケージを要求するためのリンクの共有](entitlement-management-access-package-settings.md)に関する記事を参照してください。 外部ユーザーが単に **myaccess.microsoft.com** にアクセスしているだけで、完全なマイ アクセス ポータル リンクを使用していない場合、表示されるのは、そのユーザーの組織内で使用可能なアクセス パッケージであり、貴社組織内で使用可能なアクセス パッケージは表示されません。

* 外部ユーザーがアクセス パッケージへのアクセスを要求できない場合や、リソースにアクセスできない場合は、[外部ユーザーの設定](entitlement-management-external-users.md#settings-for-external-users)を確認してください。

* ディレクトリにまだサインインしていない新規の外部ユーザーが、SharePoint Online サイトを含むアクセス パッケージを受信した場合、このアクセス パッケージは、ユーザーのアカウントが SharePoint Online でプロビジョニングされるまで、配信未完了として表示されます。 共有設定の詳細については、「[SharePoint Online の外部共有設定を確認する](entitlement-management-external-users.md#review-your-sharepoint-online-external-sharing-settings)」を参照してください。

## <a name="requests"></a>Requests

* ユーザーがアクセス パッケージへのアクセスを要求する必要がある場合は、アクセス パッケージの **マイ アクセス ポータル リンク** をユーザーが使用していることを確認します。 詳細については、[アクセス パッケージを要求するためのリンクの共有](entitlement-management-access-package-settings.md)に関する記事を参照してください。

* プライベート モードやシークレット モードに設定されたブラウザーを使用してマイ アクセス ポータルを開くと、サインインの動作に支障が生じる場合があります。 マイ アクセス ポータルにアクセスする際は、ブラウザーのプライベート モードやシークレット モードは使用しないようお勧めします。

* ディレクトリにまだ存在しないユーザーが、アクセス パッケージを要求するためにマイ アクセス ポータルにサインインする場合は、ユーザーが組織の自分のアカウントを使用して認証するようにします。 組織のアカウントとして使用できるのは、リソース ディレクトリ内のアカウント、またはアクセス パッケージのいずれかのポリシーに含まれるディレクトリ内のアカウントです。 ユーザーのアカウントが組織のアカウントでない場合、または認証するディレクトリがポリシーに含まれていない場合は、ユーザーにアクセス パッケージが表示されません。 詳細については、[アクセス パッケージへのアクセスの要求に関するページ](entitlement-management-request-access.md)を参照してください。

* リソース ディレクトリへのサインインがブロックされた場合、ユーザーは、マイ アクセス ポータルでアクセスを要求できなくなります。 ユーザーがアクセスを要求できるようにするには、ユーザーのプロファイルからサインインのブロックを削除する必要があります。 サインインのブロックを削除するには、Azure portal 内で **[Azure Active Directory]** 、 **[ユーザー]** をクリックし、ユーザーをクリックしてから **[プロファイル]** をクリックします。 **[設定]** セクションを編集し、 **[サインインのブロック]** を **[いいえ]** に変更します。 詳細については、「[Azure Active Directory を使用してユーザーのプロファイル情報を追加または更新する](../fundamentals/active-directory-users-profile-azure-portal.md)」を参照してください。  [ID 保護ポリシー](../identity-protection/howto-identity-protection-remediate-unblock.md)が原因でユーザーがブロックされたかどうかも確認できます。

* マイ アクセス ポータルの場合、ユーザーが要求者と承認者を兼ねているときは、 **[承認]** ページにアクセス パッケージの要求が表示されません。 これは、ユーザーが自分の要求を承認できないようにするための動作です。 ユーザーが要求しているアクセス パッケージで、別の承認者がポリシーに基づいて構成されていることを確認します。 詳細については、[アクセス パッケージの要求と承認の設定の変更](entitlement-management-access-package-request-policy.md)に関する記事を参照してください。

### <a name="view-a-requests-delivery-errors"></a>要求の配信エラーを表示する

**必要なロール:** グローバル管理者、ID ガバナンス管理者、ユーザー管理者、カタログ所有者、アクセス パッケージ マネージャー、またはアクセス パッケージ割り当てマネージャー

1. Azure portal で **[Azure Active Directory]** をクリックし、 **[Identity Governance]** をクリックします。

1. 左側のメニューで **[アクセス パッケージ]** をクリックして、アクセス パッケージを開きます。

1. **[要求]** をクリックします。

1. 表示する要求を選択します。

    要求に配信エラーが発生した場合、要求の状態は **[Undelivered]\(未配信)** または **[Partially delivered]\(一部配信済み)** になります。

    配信エラーが発生した場合、配信エラーの数が要求の詳細ペインに表示されます。

1. この数をクリックすると、要求のすべての配信エラーが表示されます。

### <a name="reprocess-a-request"></a>要求を再処理する

アクセス パッケージの再処理要求をトリガーした後にエラーが発生した場合は、システムで要求が再処理されるまで待つ必要があります。 システムでは数時間にわたって再処理が複数回試行されるため、この間に再処理を強制することはできません。 

再処理できるのは、状態が **[Delivery failed]\(配信失敗)** または **[Partially delivered]\(一部配信済み)** であり、完了日が 1 週間以内の要求のみです。 それ以外の場合、**再処理** ボタンは淡色表示されます。

![淡色表示された再処理ボタン](./media/entitlement-management-troubleshoot/cancel-reprocess-grayedout.png)

- 試用期間中にエラーが修正されると、要求の状態が **[Delivering]\(配信中\)** に変わります。 要求は、ユーザーからの追加のアクションなしで再処理されます。

- 試用期間中にエラーが修正されなかった場合、要求の状態は **[Delivery failed]\(配信が失敗しました\)** または **[partially delivered]\(部分的に配信されました\)** である可能性があります。 その場合は **[再処理]** ボタンを使用できます。 要求の再処理には 7 日間かかります。

**必要なロール:** グローバル管理者、ID ガバナンス管理者、ユーザー管理者、カタログ所有者、アクセス パッケージ マネージャー、またはアクセス パッケージ割り当てマネージャー

1. Azure portal で **[Azure Active Directory]** をクリックし、 **[Identity Governance]** をクリックします。

1. 左側のメニューで **[アクセス パッケージ]** をクリックして、アクセス パッケージを開きます。

1. **[要求]** をクリックします。

1. 再処理する要求をクリックします。

1. 要求の詳細ウィンドウで、 **[Reprocess request]\(要求の再処理\)** をクリックします。

    ![失敗した要求を再処理する](./media/entitlement-management-troubleshoot/reprocess-request.png)

### <a name="cancel-a-pending-request"></a>保留中の要求をキャンセルする

キャンセルできるのは、まだ配信されていないか、配信に失敗した保留中の要求のみです。それ以外の場合、**キャンセル** ボタンは淡色表示されます。

**必要なロール:** グローバル管理者、ID ガバナンス管理者、ユーザー管理者、カタログ所有者、アクセス パッケージ マネージャー、またはアクセス パッケージ割り当てマネージャー

1. Azure portal で **[Azure Active Directory]** をクリックし、 **[Identity Governance]** をクリックします。

1. 左側のメニューで **[アクセス パッケージ]** をクリックして、アクセス パッケージを開きます。

1. **[要求]** をクリックします。

1. キャンセルする要求をクリックします。

1. 要求の詳細ウィンドウで、 **[要求のキャンセル]** をクリックします。

## <a name="multiple-policies"></a>複数のポリシー

* エンタイトルメント管理は、最小限の特権のベスト プラクティスを踏襲しています。 該当するポリシーが複数あるアクセス パッケージへのアクセスをユーザーが要求すると、より厳しい (つまり具体的な) ポリシーが汎用的なポリシーよりも確実に優先されるように働き掛けるロジックがエンタイトルメント管理によって含められます。 ポリシーが汎用的である場合、要求元にポリシーが表示されないか、またはより厳しいポリシーが自動的に選択されます。

* たとえば、社内の従業員向けに 2 つのポリシーを含んだアクセス パッケージを考えてみてください。要求元には、その両方のポリシーが当てはまるとします。 1 つ目は、要求元を含む特定のユーザーを対象としたポリシーです。 2 つ目は、要求元が属しているディレクトリ内の全ユーザーを対象としたポリシーです。 このシナリオでは、より厳しい方の 1 つ目のポリシーが要求元に対して自動的に選択されます。 要求元には、2 つ目のポリシーを選択するオプションは提供されません。

* 複数のポリシーが該当する場合、自動的に選択されるポリシー (要求元に表示されるポリシー) は、次の優先順位ロジックに基づいて決定されます。

    | ポリシーの優先度 | Scope |
    | --- | --- |
    | P1 | ディレクトリ内の特定のユーザーとグループ、または接続されている特定の組織 |
    | P2 | ディレクトリ内のすべてのメンバー (ゲストを除く) |
    | P3 | ディレクトリ内のすべてのユーザー (ゲストを含む) または接続されている特定の組織 |
    | P4 | 構成済みで接続されているすべての組織またはすべてのユーザー (接続されているすべての組織 + 新しい外部ユーザー) |
    
    より優先度の高いカテゴリにポリシーが属している場合、それよりも優先度が低いカテゴリは無視されます。 同じ優先度の複数のポリシーが要求元にどのように表示されるかの例については、「[ポリシーの選択](entitlement-management-request-access.md#select-a-policy)」を参照してください。

## <a name="next-steps"></a>次のステップ

- [外部ユーザーのアクセス権の管理](entitlement-management-external-users.md)
- [エンタイトルメント管理でユーザーがアクセス権をどのように取得したかについてのレポートを確認する](entitlement-management-reports.md)
