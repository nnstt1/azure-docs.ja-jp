---
title: テナントでマルチテナント ユーザー管理を使用する一般的な Azure Active Directory
description: ゲスト アカウントを使用して、テナント間でユーザー アクセスを構成できる一般的な Azure Active Directory について説明します
services: active-directory
author: BarbaraSelden
manager: martinco
ms.service: active-directory
ms.workload: identity
ms.subservice: fundamentals
ms.topic: conceptual
ms.date: 09/25/2021
ms.author: baselden
ms.custom: it-pro, seodec18
ms.collection: M365-identity-device-management
ms.openlocfilehash: fde715f688d7e19477894f3239d174d7925edb78
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2021
ms.locfileid: "131059397"
---
# <a name="multi-tenant-user-management-scenarios"></a>マルチテナント ユーザー管理

## <a name="end-user-initiated-scenario"></a>エンドユーザーが開始するシナリオ
エンドユーザーが開始するシナリオでは、リソース テナント管理者は、テナント内のユーザーに特定の機能を委任します。 管理者は、エンド ユーザーがテナント、アプリ、またはリソースにゲスト ユーザーを招待できます。 ホーム テナントのユーザーは、個別に招待またはサインアップされます。

たとえば、プロジェクトの下請負業者と協力するグローバル プロフェッショナル サービス企業の場合です。 請負業者のユーザーは、会社のアプリケーションとドキュメントにアクセスする必要があります。 会社の管理者は、協力者を招待したり、コンバージョナー リソース アクセス用にセルフサービスを構成したりする機能をエンド ユーザーに委任できます。

### <a name="provision-accounts"></a>アカウントをプロビジョニングする

エンド ユーザーがリソース テナント リソースにアクセスする招待を受け取る方法は多数あります。 最も広く使用されている 5 つは次のとおりです。 

* [アプリケーション ベースの招待](../external-identities/o365-external-user.md)。 Microsoft アプリケーションでは、ゲスト ユーザーの招待を有効にできます。 B2B 招待設定は、B2B とAzure AD アプリケーションの両方で構成する必要があります。

* [MyApps]../user-help/my-apps-portal-end-user-access). ユーザーが MyApps を使用してアプリケーションにゲスト ユーザーを招待して割り当てることができます。 ユーザー アカウントには、[[アプリケーションのセルフサービス サインアップ]](../manage-apps/manage-self-service-access.md) で、承認者のアクセス許可が必要です。 グループ所有者の場合は、ゲスト ユーザーをグループに招待できます。

* [エンタイトルメント管理](../governance/entitlement-management-overview.md): 管理者またはリソース所有者は、リソース、許可されている外部組織、ゲスト ユーザーの有効期限、アクセス ポリシーをアクセス パッケージにまとめます。 アクセス パッケージを発行して、ゲスト ユーザーによるリソース アクセスのセルフサービス サインアップを有効にできます。

* [Azure portal](../external-identities/add-users-administrator.md) で[ゲストの招待元ロール](../external-identities/delegate-invitations.md)が与えられたエンド ユーザーは、Azure portal にサインインし、Azure Active Directory のユーザーメニューからゲスト ユーザーを招待することができます。

* [プログラム (PowerShell、Graph API)](../external-identities/customize-invitation-api.md)[ ゲスト招待者ロール](../external-identities/delegate-invitations.md)が与えられたエンド ユーザーは、PowerShell または Graph API を使用してゲスト ユーザーを招待することができます。 

### <a name="redeem-invitations"></a>招待を利用する

リソースにアクセスするアカウントのプロビジョニングの一環として、招待されたユーザーの電子メール アドレスに電子メールの招待が送信されます。 招待されたユーザーは、招待を受け取った場合に次の機能を実行できます。
* 電子メールに含まれているリンクに従って、引き換え URL にアクセスします。
* リソースに直接アクセスしてみてください。 

ユーザーがリソースに直接アクセスしようとすると、Just-In-Time (JIT) の引き換えという名前が付けられます。 各引き換え方法のユーザー エクスペリエンスを次に示します。 

#### <a name="redemption-url"></a>引き換え URL

招待されたユーザーは、電子メールの [[引き換え URL]](../external-identities/redemption-experience.md) にアクセスすることで、招待を承認または拒否できます (必要に応じてゲスト ユーザー アカウントを作成します)。 

#### <a name="just-in-time-redemption"></a>Just-In-Time の引き換え

ユーザーは、次の場合に Just-In-Time 引き換えのためのリソース URL に直接アクセスできます。

* 招待されたユーザーは、既に Azure AD または Microsoft アカウントを持っています  
‎-または-

* [電子メール ワンタイム パスコード](../external-identities/one-time-passcode.md)が有効になっている場合

JIT 引き換え中のいくつかのポイント:

* 管理者がプライバシー条項への同意を抑制していない場合、ユーザーは、リソースにアクセスする前に [プライバシー条項] ページに同意する必要があります。

* PowerShell を使用すると、[PowerShell](/powershell/module/azuread/new-azureadmsinvitation?view=azureadps-2.0&preserve-view=true) を使用して招待するときに電子メールが送信されるかどうかを制御できます。

* [許可リストまたはブロックリスト](../external-identities/allow-deny-list.md)を使用して、特定の組織のゲスト ユーザーへの招待を、許可またはブロックすることができます。

詳細については、「[Azure Active Directory B2B コラボレーションの招待の利用](../external-identities/redemption-experience.md)」を参照してください。

#### <a name="important--enable-one-time-passcode-authentication"></a>重要 - ワンタイム パスコード認証を有効にする 

[電子メールワンタイム パスコード認証](../external-identities/one-time-passcode.md)を有効にすることを強く推奨します。 この機能は、次のような他の方法で認証できないゲスト ユーザーを認証します。

* Azure AD

* Microsoft アカウント (MSA)

* Google フェデレーションを使用した Gmail アカウント

* 直接フェデレーションを介した SAML/WS-Fed IDP からのアカウント

ワンタイム パスコード認証では、Microsoft アカウントを作成する必要はありません。 ゲスト ユーザーは、招待を引き換えるか、共有リソースにアクセスすると、一時的なコードを受け取ることができます。 コードは電子メール アドレスに送信され、コードを入力してサインインを続行します。 

電子メール ワンタイム パスコード認証を有効にしない場合、Microsoft アカウントまたは Just-In-Time の "アンマネージド" Azure AD テナントが作成される場合があります。

>**重要**: この機能が各クラウド環境で一般提供 (GA) されるに応じて、Microsoft はアンマネージド テナントとそのユーザーの作成を非推奨にしています。 

### <a name="manage-accounts"></a>アカウントの管理

リソース テナント管理者は、リソース テナントのゲスト ユーザー アカウントを管理します。 ゲスト ユーザー アカウントは、ホーム テナントの更新された値に基づいては更新されません。 実際、受信した表示属性には、メール アドレスと表示名だけが含まれます。

ゲスト ユーザー オブジェクトに対してさらに多くの属性を構成し、シナリオを容易にできます。 たとえば、アドレス帳に連絡先の詳細を入力したり、エンタイトルメント シナリオに入力したりできます。 例として、次を検討します。

* HiddenFromAddressListsEnabled

* GivenName

* Surname

* タイトル

* 部署

* TelephoneNumber

これらの属性は、グローバル アドレス リスト[にゲストを追加するために設定できます](/microsoft-365/admin/create-groups/manage-guest-access-in-groups?view=o365-worldwide&preserve-view=true)。 その他のシナリオでは、アクセス パッケージの権利とアクセス許可の設定、動的グループ メンバーシップ、SAML 要求など、さまざまな属性が必要になる場合があります。

注: 既定では、招待されたゲスト ユーザーはグローバル アドレス一覧 (GAL) から非表示になります。 ゲスト ユーザー属性を統合 GAL に含めるには、ゲスト ユーザー属性を非表示に設定します。 詳細については、[Microsoft Exchange Online](multi-tenant-common-considerations.md#microsoft-exchange-online) のドキュメントを参照してください。

### <a name="deprovision-accounts"></a>アカウントのプロビジョニング解除

エンドユーザーが開始するシナリオでは、アクセスの決定を分散化します。 ただし、アクセスの決定を分散化すると、ゲスト ユーザーとそれに関連するアクセスについて、いつ削除するかを決定するという課題が生じます。 [[エンタイトルメント管理]](../governance/entitlement-management-overview.md) と [[アクセス レビュー]](../governance/manage-guest-access-with-access-reviews.md) では、既存のゲスト ユーザーとそのリソースへのアクセスを、確認および削除する方法を提供します。 

注: エンタイトルメント管理の外部でユーザーを招待する場合は、ゲスト ユーザーのアクセスを確認および管理するための別のプロセスを作成する必要があります。 たとえば、ゲスト ユーザーが SharePoint Online 経由で直接招待された場合、ゲスト ユーザーはエンタイトルメント管理プロセスに含まれません。

## <a name="scripted-scenario"></a>スクリプト化されたシナリオ

スクリプト化されたシナリオでは、リソース テナント管理者はスクリプト化されたプル プロセスをデプロイして、ゲスト ユーザーの検出とプロビジョニングを自動化します。 これは、スクリプト化されたメカニズムを使用しているお客様には一般的な方法です。

たとえば、競合他社を買収したグローバルな運送会社で使用されます。 各会社には 1 つのテナント Azure AD があります。 ユーザーが招待や引き換えの手順を実行することなく、次の "1 日目" シナリオを機能したいと考えます。 すべてのユーザーが次の機能を実行できる必要があります。 

* プロビジョニングされるすべてのリソースにシングル サインオンを使用する

* 相互に検索し、統合された GAL で他のリソースを見つける

* お互いの存在を確認し、インスタント メッセージを開始することができる

* 動的グループ メンバーシップに基づいてアプリケーションにアクセスする

この場合、各組織のテナントは既存の従業員のホーム テナントであり、他の組織の従業員のリソース テナントです。

### <a name="provision-accounts"></a>アカウントをプロビジョニングする

[Delta Query](/graph/delta-query-overview) を使用すると、テナント管理者はスクリプト化されたプル プロセスをデプロイして、リソース アクセスをサポートする ID の検出とプロビジョニングを自動化できます。 このプロセスでは、ホーム テナントで新しいユーザーが確認され、B2B Graph API を使用して、それらのユーザーがリソース テナント内の招待されたユーザーとしてプロビジョニングされます。 次の図は、コンポーネントを示しています。 
### <a name="multi-tenant-topology"></a>マルチテナント トポロジ

![マルチテナント シナリオ](media\multi-tenant-user-management-scenarios\multi-tenant-scripted-scenario.png)

* 各テナントの管理者は、各テナントの読み取りを許可するために、資格情報と同意を事前に配置します。

* テナント管理者が列挙を自動化し、スコープ付きユーザーをリソース テナントに "プル" できます。

* 招待 API 経由で Graph ユーザーを読み取り、プロビジョニングするための同意されたアクセス許可を持つ MS Graph API を使用します。

* 初期プロビジョニングでは、ソース属性を読み取り、ターゲット ユーザー オブジェクトに適用できます。

### <a name="manage-accounts"></a>アカウントの管理

リソース組織は、リソース テナント内のユーザーのメタデータ属性を更新することで、共有シナリオをサポートするためにプロファイル データを拡張することができます。 ただし、進行中の同期が必要な場合は、同期されたソリューションの方が優れたオプションになる可能性があります。

### <a name="deprovision-accounts"></a>アカウントのプロビジョニング解除

[Delta Query](/graph/delta-query-overview) は、ゲスト ユーザーをプロビジョニング解除する必要があるときにシグナルを送信できます。 [[エンタイトルメント管理]](../governance/entitlement-management-overview.md) と [[アクセス レビュー]](../governance/manage-guest-access-with-access-reviews.md) では、既存のゲスト ユーザーとそのリソースへのアクセスを、確認および削除する方法を提供することができます。 

注: エンタイトルメント管理の外部でユーザーを招待する場合は、ゲスト ユーザーのアクセスを確認および管理するための別のプロセスを作成する必要があります。 たとえば、ゲスト ユーザーが SharePoint Online 経由で直接招待された場合、ゲスト ユーザーはエンタイトルメント管理プロセスに含まれません。

## <a name="automated-scenario"></a>自動化されたシナリオ

最も複雑なパターンは、テナント間での同期共有です。 このパターンにより、ユーザーが開始またはスクリプト化するよりも、より自動化された管理とプロビジョニング解除のシナリオが可能になります。 自動化されたシナリオでは、リソース テナント管理者は ID プロビジョニング システムを使用して、プロビジョニングとプロビジョニング解除のプロセスを自動化します。

たとえば、複数の子会社を持つ多国籍の複合企業が使用されます。 各 テナントには独自の Azure ADがありますが、一緒に動作する必要があります。 テナント間で新しいユーザーを同期するだけでなく、属性の更新を自動的に同期する必要があります。 プロビジョニング解除は自動化する必要があります。 たとえば、従業員が子会社にいなくなった場合は、次の同期中に他のすべてのテナントからアカウントを削除する必要があります。

または、次の拡張シナリオを検討してください。 国防産業基盤 (DIB) の請負業者には、防御ベースの商用ベースの子会社があります。 これらには、競合する規制要件があります。

* 米国の国防ビジネスは、米国ソブリン クラウド テナントに存在します。 たとえば、米国政府 Microsoft 365 GCC High です。

* 商用ビジネスは、パブリックの Azure AD 別のテナントに存在します。 たとえば、グローバル Azure クラウドで 実行されている Azure AD 環境などです。 

 "クロスソブリン クラウド" アーキテクチャにデプロイされた単一の会社のように機能するため、すべてのユーザーが両方のテナントに同期されます。 これにより、両方のテナントで使用できる統合 GAL が有効になります。 また、両方のテナントに自動的に同期されるユーザーには、アプリケーションとコンテンツに対する権利と制限が含まれる場合があります。 次に例を示します。

* 米国の従業員は、両方のテナントに対してユビキタスなアクセス権を持っている可能性があります。

* 米国以外の従業員は、両方のテナントの統合 GAL に表示されますが、GCC High テナント内の保護されたコンテンツにアクセスできません。 

これには、両方のテナントのユーザーを適切なエンタイトルメント ポリシーとデータ保護ポリシーに関連付けながら構成するために、自動同期と ID 管理が必要になります。

### <a name="provision-accounts"></a>アカウントをプロビジョニングする

この高度なデプロイでは、[Microsoft Identity Manager](/microsoft-identity-manager/microsoft-identity-manager-2016) (MIM) を同期エンジンとして使用します。 MIM は、[MS Graph API](/developer.microsoft.com/graph/) と [Exchange Online PowerShell](/powershell/exchange/exchange-online/exchange-online-powershell?view=exchange-ps&preserve-view=true) を呼び出します。 代替の実装には、クラウドでホストされている [Active Directory Synchronization Services](/windows-server/identity/ad-ds/get-started/virtual-dc/active-directory-domain-services-overview) (ADSS) の管理サービスを [Microsoft Consulting Services](/industry/services/consulting) を含め、利用できます。 他の ID 管理オファリングと一から作成できる Microsoft 以外のオファリングも存在します。

これらは複雑なシナリオであり、計画と実行を通じて、パートナー、Microsoft アカウント、その他の利用可能なリソースと協力することをお勧めします。 

注: このドキュメントの範囲を外す考慮事項があります。 たとえば、[オンプレミス アプリケーション の統合](../app-proxy/what-is-application-proxy.md)などです。 

### <a name="choose-the-right-topology"></a>適切なトポロジの選択

ほとんどのお客様は、自動化されたシナリオで 2 つのトポロジのいずれかを使用します。 

* メッシュ トポロジを使用すると、すべてのテナント内のリソースをすべて共有できます。 他のテナントのユーザーは、ゲスト ユーザーとして各リソース テナントに作成されます。

* 1 つのリソース テナント トポロジでは、1 つのテナント (リソース テナント) を使用します。このテナントでは、他の企業のユーザーが外部ゲスト ユーザーです。 

ソリューションを設計する場合は、次の表を使用できます。 次の表に、両方のトポロジを示します。 組織に最適な方法を判断するには、次の点を考慮してください。 

メッシュと単一リソース テナント トポロジの比較

| 考慮事項| メッシュ型トポロジ| 単一リソース テナント |
| - | - |-|
| 各会社には、ユーザー Azure AD リソースを持つ個別のテナントがあります| はい| はい |
| **リソースの場所とコラボレーション**| |  |
| 共有アプリとその他のリソースは、現在のホーム テナントに残ります| はい| いいえ - リソース テナント内のリソースだけが共有されます。 |
| 個々の会社の GAL (Unified GAL) ですべて表示可能| はい| いいえ |
| **リソースのアクセスと管理**| |  |
| すべての企業間で Azure AD に接続されているすべてのアプリケーションを共有できます| はい| いいえ - リソース テナント内のリソースだけが共有されます。 他のテナントに残っているものが、そうではありません。 |
| グローバル リソース管理 ‎| テナント レベルで続行| リソース テナントに統合 |
| ライセンス – Office 365 <br>SharePoint Online、統合 GAL、Teams すべてのサポート ゲストにアクセスできます。ただし、他の Exchange Online シナリオではできません| テナント レベルで続行する| テナント レベルで続行する |
| [Azure AD Premium](../external-identities/external-identities-pricing.md) ライセンス| 最初の 50 K 月間アクティブ ユーザーは無料です (テナントあたり)。| 最初の 50 K 月間アクティブ ユーザーは無料です。 |
| ライセンス – SaaS アプリ| 個々のテナントに残り、テナントごとにユーザーごとのライセンスが必要な場合があります| すべての共有リソースは、単一のリソース テナントに存在します。 必要に応じて、シングル テナントへのライセンスの統合を調査できます。 |

#### <a name="mesh-topology"></a>メッシュ型トポロジ

![メッシュ型トポロジ](media/multi-tenant-user-management-scenarios/mesh.png)

メッシュ トポロジでは、各ホーム テナントのすべてのユーザーが他の各テナントに同期され、リソース テナントになります。 

* これにより、テナント内のすべてのリソースをゲスト ユーザーと共有できます。 

* これにより、各組織は複合企業内のすべてのユーザーを表示できます。 上の図には、4 つの統合された GAL があり、それぞれにホーム ユーザーと他の 3 つのテナントのゲスト ユーザーが含まれています。

このシナリオでの、ユーザーのプロビジョニング、管理、プロビジョニング解除の詳細については、このドキュメントの[一般的な考慮事項](multi-tenant-common-considerations.md#directory-object-considerations)に関するセクションを参照してください。

#### <a name="mesh-topology-for-cross-sovereign-cloud"></a>クロスソブリン クラウドのメッシュ トポロジ

メッシュ トポロジは、クロスソブリン クラウド ソリューションにまたがる DIB 防御請負業者のシナリオなど、2 つのテナントで使用できます。 メッシュ トポロジと同様に、各ホーム テナントのすべてのユーザーが他のテナントに同期され、実質的にはリソース テナントになります。 上の図では、パブリック商用テナント メンバー ユーザーは、ゲスト ユーザー アカウントとして米国ソブリン GCC High テナントに同期されています。 同時に、High メンバー ユーザー GCC ゲスト ユーザー アカウントとして商用に同期されます。

>**注**: この図では、データが格納される場所も示されています。 データの分類とコンプライアンスは、このホワイトペーパーの範囲を外していますが、アプリケーションとコンテンツに権利と制限を含める方法を示しています。 コンテンツには、メンバー ユーザーの "個人データ" が存在する場所が含まれる場合があります。 たとえば、Exchange Online のメールボックスまたは OneDrive for Business に保存されているデータなどです。 コンテンツは、リソース テナントではなく、ホーム テナントにのみ含まれる場合があります。 共有データは、いずれかのテナントに存在する可能性があります。 アクセス制御ポリシーと条件付きアクセス ポリシーを使用して、コンテンツへのアクセスを制限できます。

#### <a name="single-resource-tenant-topology"></a>単一リソース テナント トポロジ

![単一リソース テナント](media/multi-tenant-user-management-scenarios/single-resource-tenant.png)

単一リソース テナント トポロジで、ユーザーとその属性はリソース テナント (上の図では A 社) に同期されます。 

* メンバー組織間で共有されるすべてのリソースは、単一のリソース テナントに属している必要があります。
  * 複数の子会社が同じ SaaS アプリへのサブスクリプションを保有している場合は、それらのサブスクリプションを統合することができます。

* すべての会社のユーザーが表示されるのは、リソース テナント内の GAL だけです。

### <a name="manage-accounts"></a>アカウントの管理

このソリューションでは、ソース テナント ユーザーからリソース テナントのゲスト ユーザーに属性の変更を検出し、同期します。 これらの属性を使用して、承認の決定を行うことができます。 たとえば、動的なグループを使用する場合です。

### <a name="deprovision-accounts"></a>アカウントのプロビジョニング解除

オートメーションは、ソース環境内のオブジェクトの削除を検出し、対象の環境で関連付けられているゲスト ユーザー オブジェクトを削除します。

このシナリオでの、ユーザーのプロビジョニング、管理、プロビジョニング解除の詳細については、このドキュメントの[一般的な考慮事項](multi-tenant-common-considerations.md)に関するセクションを参照してください。

## <a name="next-steps"></a>次の手順
[マルチテナント ユーザー管理の概要](multi-tenant-user-management-introduction.md)

[マルチテナントの一般的な考慮事項](multi-tenant-common-considerations.md)

[マルチテナントの一般的なソリューション](multi-tenant-common-solutions.md)
