---
title: Azure Active Directory サービス アカウントの管理
description: Azure Active Directory でサービス アカウントのライフサイクルを管理するための原則と手順。
services: active-directory
author: BarbaraSelden
manager: daveba
ms.service: active-directory
ms.workload: identity
ms.subservice: fundamentals
ms.topic: conceptual
ms.date: 3/1/2021
ms.author: baselden
ms.reviewer: ajburnle
ms.custom: it-pro, seodec18
ms.collection: M365-identity-device-management
ms.openlocfilehash: 6d3f6163cc8c5f642835562c631d1712f329a788
ms.sourcegitcommit: 677e8acc9a2e8b842e4aef4472599f9264e989e7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2021
ms.locfileid: "132292531"
---
# <a name="governing-azure-ad-service-accounts"></a>Azure AD サービス アカウントの管理

Azure Active Directory (Azure AD) のサービス アカウントには、[マネージド ID](service-accounts-managed-identities.md)、[サービス プリンシパル](service-accounts-principal.md)、サービス アカウントとして用いられるユーザー アカウントの 3 種類があります。 自動的に使用する目的でこれらのサービス アカウントを作成した場合は、Azure と Azure AD のリソースにアクセスするためのアクセス許可がそれらに付与されます。 リソースには、Microsoft 365 サービス、サービスとしてのソフトウェア (SaaS) アプリケーション、カスタム アプリケーション、データベース、人事システムなどがあります。 Azure AD サービス アカウントの管理とは、セキュリティと継続性を確保するために、その作成、アクセス許可、およびライフサイクルを管理するということです。

> [!IMPORTANT] 
> ユーザー アカウントは本質的に安全性が低いため、サービス アカウントとして使用することはお勧めしていません。 これには、Azure AD に同期されるオンプレミスのサービス アカウントも含まれます (サービス プリンシパルに変換されないため)。 代わりに、マネージド ID またはサービス プリンシパルを使用することをお勧めします。 現時点では、サービス プリンシパルで条件付きアクセス ポリシーを使用できませんが、この機能は今後提供される予定です。


## <a name="plan-your-service-account"></a>サービス アカウントの計画

サービス アカウントを作成する前、またはアプリケーションを登録する前に、サービス アカウントの重要な情報を文書化します。 情報を文書化しておくと、アカウントの効果的な監視と管理が容易になります。 次のデータを収集し、一元化された構成管理データベース (CMDB) で追跡することをお勧めします。

| Data| 説明| 詳細 |
| - | - | - |
| 所有者| サービス アカウントの管理と監視について説明責任を負うユーザーまたはグループ。| アカウントを監視し、問題の軽減策を実装するために必要なアクセス許可を持つ所有者をプロビジョニングします。 問題の軽減は、所有者が行うことも、IT への要求を通じて行うこともできます。 |
| 目的| アカウントの使われ方。| サービス アカウントを特定のサービス、アプリケーション、またはスクリプトにマップします。 複数の用途に使用するサービス アカウントを作成しないでください。 |
| アクセス許可 (スコープ)| 予想されるアクセス許可のセット。| アクセスするリソースとそれらのリソースに対するアクセス許可を文書化します。 |
| CMDB リンク| アクセスするリソースと、サービス アカウントが使用されているスクリプトへのリンク。| リソースとスクリプトの所有者を文書化して、変更による必然的なアップストリームとダウンストリームの影響を確実に伝達できるようにします。 |
| リスク評価| アカウントが侵害された場合のリスクとビジネスへの影響。| この情報を使用して、アクセス許可のスコープを絞り込み、アカウント情報にアクセスできるユーザーを判断します。 |
| レビュー期間| 所有者がサービス アカウントを見直すことになっているスケジュール。| これを使用して、レビューの通知とレビューをスケジュールします。 スケジュールされたレビュー期間の経過後、特定の時間までにレビューが実行されなかった場合の対処方法を文書化します。 |
| 有効期間| 予想されるアカウントの最長有効期間。| これを使用して、所有者への通知をスケジュールし、最終的にアカウントを無効にしてから削除します。 可能であれば、資格情報の有効期限を設定します (資格情報を自動的にロール オーバーすることはできません)。 |
| 名前| アカウントの標準化された名前| サービス アカウントの検索、並べ替え、フィルター処理を簡単に行えるように、すべてのサービス アカウントに対して名前付けスキーマを作成します。 |


## <a name="use-the-principle-of-least-privileges"></a>最小特権の原則の使用
サービス アカウントには、そのタスクを実行するために必要なアクセス許可だけを付与してください。 サービス アカウントに高いレベルのアクセス許可 (全体管理者レベルの特権など) が必要となる場合は、その理由を評価し、必要なアクセス許可を減らすよう努めてください。

サービス アカウントの特権については、次の方法をお勧めします。

**アクセス許可**

* サービス アカウントには、組み込みロールを割り当てないでください。 代わりに、[Microsoft Graph の OAuth2 アクセス許可付与モデル](/graph/api/resources/oauth2permissiongrant)を使用してください。

* サービス プリンシパルに特権ロールを割り当てる必要がある場合は、特定の必要な特権を持つ[カスタム ロール](../roles/custom-create.md)を期限付きで割り当てることを検討してください。

* サービス アカウントを、昇格されたアクセス許可を持つグループのメンバーとして含めないでください。 

* [PowerShell を使用して、特権ロールのメンバーを列挙](/powershell/module/azuread/get-azureaddirectoryrolemember)し   
(`Get-AzureADDirectoryRoleMember` など)、"Service Principal" という objectType でフィルター処理します。

   または、  
`Get-AzureADServicePrincipal | % { Get-AzureADServiceAppRoleAssignment -ObjectId $_ }` を使用します

* [OAuth 2.0 スコープを使用](../develop/v2-permissions-and-consent.md)して、サービス アカウントがリソースに対してアクセスできる機能を制限します。
* サービス プリンシパルとマネージド ID は、サインオン ユーザーを偽装している委任されたコンテキスト内で、またはアプリケーション コンテキスト内のサービス アカウントとして、OAuth 2.0 スコープを使用できます。 アプリケーション コンテキストでは、サインオンしているユーザーはいません。

* リソースに対するスコープのサービス アカウントの要求をチェックして、それらが適切であることを確認します。 たとえば、アカウントが Files.ReadWrite.All を要求している場合、実際に必要なのは File.Read.All だけではないかどうかを評価します。 アクセス許可の詳細については、「[Microsoft Graph のアクセス許可のリファレンス](/graph/permissions-reference)」を参照してください。

* リソースへのアクセスが要求されているアプリケーションまたは API の開発者が信頼できることを確認します。

**期間**

* サービス アカウントの資格情報 (クライアント シークレット、証明書) を予想される使用期間に制限します。

* サービス アカウントの使用と目的の定期的なレビューをスケジュールします。 アカウントの有効期限が切れる前に必ずレビューが行われるようにします。

目的、スコープ、必要なアクセス許可について明確に理解できたら、サービス アカウントを作成してください。 

[マネージド ID を作成して使用する](../../app-service/overview-managed-identity.md?tabs=dotnet)

[サービス プリンシパルを作成して使用する](../develop/howto-create-service-principal-portal.md)

可能であれば、マネージド ID を使用してください。 マネージド ID を使用できない場合は、サービス プリンシパルを使用してください。 サービス プリンシパルを使用できない場合は、そのとき初めて Azure AD ユーザーアカウントを使用してください。

 

## <a name="build-a-lifecycle-process"></a>ライフサイクル プロセスの作成

サービス アカウントのライフサイクル管理は、計画に始まり、その完全な削除で終わります。 

計画と作成の部分については、この記事ですでに説明しました。 また、監視、アクセス許可のレビュー、アカウントの継続使用の確認も行う必要がああり、最終的にはアカウントをプロビジョニング解除する必要もあります。

### <a name="monitor-service-accounts"></a>サービス アカウントを監視する

サービス アカウントを予防的に監視して、サービス アカウントの使用パターンが意図したパターンを反映していること、およびサービス アカウントが引き続きアクティブに使用されていることを確認します。

**次のいずれかの方法を使用して、サービス アカウントのサインインを収集および監視します。**

* Azure AD ポータルで Azure AD サインイン ログを使用する。

* Azure AD サインイン ログを [Azure Storage](../../storage/index.yml)、[Azure Event Hubs](../../event-hubs/index.yml)、または [Azure Monitor](../../azure-monitor/logs/data-platform-logs.md) にエクスポートする。


![サービス プリンシパルのサインイン画面を示すスクリーンショット。](./media/securing-service-accounts/service-accounts-govern-azure-1.png)

**サインイン ログで検索するインテリジェンスには以下が含まれます。**

* テナントにサインインしなくなったサービス アカウントはありますか?

* サービス アカウントのサインイン パターンは変化していますか?

Azure AD サインイン ログをエクスポートし、既存のセキュリティ情報イベント管理 (SIEM) ツール (Microsoft Sentinel など) にインポートすることをお勧めします。 SIEM を使用して、アラートとダッシュボードを作成します。

### <a name="review-service-account-permissions"></a>サービス アカウントのアクセス許可をレビューする

付与されているアクセス許可と、サービス アカウントによってアクセスされるスコープを定期的に見直して、それらを減らせるかどうかを確認します。

* [PowerShell](/powershell/module/azuread/get-azureadserviceprincipaloauth2permissiongrant) を使用して、サービス アカウントに同意が付与されているスコープを[チェックして文書化するための自動化を構築](https://gist.github.com/psignoret/41793f8c6211d2df5051d77ca3728c09)します。

* PowerShell を使用して、[既存のサービス プリンシパルの資格情報を見直し](https://github.com/AzureAD/AzureADAssessment)、その有効性をチェックします。

* サービス プリンシパルの資格情報を "期限なし" に設定しないでください。

* 可能であれば、Azure Key Vault に格納されている証明書または資格情報を使用します。

Microsoft の無料の PowerShell サンプルでは、サービス プリンシパルの OAuth2 の付与と資格情報を収集して、コンマ区切り値ファイル (CSV) と Power BI サンプル ダッシュボードに記録し、そのデータを解釈して使用します。 詳細については、[AzureAD/AzureADAssessment: Azure AD テナントの状態と構成を評価するためのツール (github.com)](https://github.com/AzureAD/AzureADAssessment) を参照してください

### <a name="recertify-service-account-use"></a>サービス アカウントの使用を再認定する

サービス アカウントがその所有者とセキュリティまたは IT チームによって定期的に見直されるようにレビュー プロセスを確立します。 

**このプロセスには以下が含まれている必要があります。**

* 各サービス アカウントのレビュー サイクルを決定する方法 (CMDB 内に文書化されている必要があります)。

* レビューを開始する前の、所有者とセキュリティまたは IT チームへの通知。

* レビューが行われなかった場合の警告通知のタイミングと内容。

* 所有者がレビューまたは応答を怠った場合の対処方法についての指示。 たとえば、レビューが完了するまでアカウントを無効にする (ただし、削除しない) こともできます。

* アップストリームとダウンストリームの依存関係を特定し、他のリソース所有者に影響を通知する手順。

**レビューには、以下を認定する所有者とその IT パートナーを含める必要があります。**

* アカウントは引き続き必要です。

* アカウントに付与されているアクセス許可は適切かつ必要なものであり、そうでなければ、変更が要求されます。

* アカウントとその資格情報へのアクセスは制御されます。

* アカウントで使用される資格情報は、アカウントの評価に使われたリスク (資格情報の種類と資格情報の有効期間の両方) について適切です

* アカウントのリスク スコアリングは、最後の再認定以降変更されていません

* アカウントの予想される有効期間と、次回の再認定日に関する最新情報。

### <a name="deprovision-service-accounts"></a>サービス アカウントをプロビジョニング解除する

** 次の状況では、サービス アカウントをプロビジョニング解除してください。****

* サービス アカウントの作成目的であるスクリプトまたはアプリケーションが廃止されている。

* サービス アカウントの使用目的であるスクリプトまたはアプリケーション内の機能 (特定のリソースへのアクセスなど) が廃止されている。


* サービス アカウントが別のサービス アカウントに置き換えられている。

* 資格情報の有効期限が切れているか、アカウントが機能していないため、苦情が報告されない。

**プロビジョニング解除のプロセスには、次のタスクが含まれている必要があります。**

1. 関連するアプリケーションまたはスクリプトがプロビジョニング解除されたら、サービス アカウントによる[サインイン](../reports-monitoring/concept-sign-ins.md)とリソース アクセスを監視します。

   * アカウントがまだアクティブの場合は、それがどのように使用されているかを確認してから、以降の手順を実行します。
 
2. これがマネージド サービス ID である場合は、そのサービス アカウントのサインインを無効にしますが、ディレクトリからは削除しないでください。

3. サービス アカウントに対するロールの割り当てと OAuth2 の同意の付与を取り消します。

4. 定義された期間が経過し、所有者に十分な警告が通知されたら、サービス アカウントをディレクトリから削除します。

## <a name="next-steps"></a>次のステップ
Azure サービス アカウントのセキュリティ保護の詳細については、以下を参照してください。

[Azure サービス アカウントの概要](service-accounts-introduction-azure.md)

[マネージド ID のセキュリティ保護](service-accounts-managed-identities.md)

[サービス プリンシパルのセキュリティ保護](service-accounts-principal.md)




 
