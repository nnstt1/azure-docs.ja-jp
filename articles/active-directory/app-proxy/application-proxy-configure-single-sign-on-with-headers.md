---
title: Azure AD アプリ プロキシを使用したオンプレミスのアプリに対するヘッダーベースのシングル サインオン
description: ヘッダーベースの認証でセキュリティ保護されているオンプレミスのアプリケーションにシングル サインオンを提供する方法を説明します。
services: active-directory
author: kenwith
manager: karenh444
ms.service: active-directory
ms.subservice: app-proxy
ms.workload: identity
ms.topic: conceptual
ms.date: 02/22/2021
ms.author: kenwith
ms.reviewer: ashishj
ms.openlocfilehash: 28f5cbcd124363f3e7a004bd80f254248dd80e95
ms.sourcegitcommit: 01dcf169b71589228d615e3cb49ae284e3e058cc
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/19/2021
ms.locfileid: "130162400"
---
# <a name="header-based-single-sign-on-for-on-premises-apps-with-azure-ad-app-proxy"></a>Azure AD アプリ プロキシを使用したオンプレミスのアプリに対するヘッダーベースのシングル サインオン

Azure Active Directory (Azure AD) アプリケーション プロキシ は、認証のためにヘッダーを使用するアプリケーションに対するシングル サインオン アクセスをサポートしています。 Azure AD で、お使いのアプリケーションに必要なヘッダー値を構成できます。 ヘッダー値は、アプリケーション プロキシを介してアプリケーションに送信されます。 以下に、アプリケーション プロキシを使用したヘッダーベースの認証のためにネイティブ サポートを利用することの利点の一部を示します。  

* **オンプレミスのアプリへのリモート アクセスの提供が簡素化される** - アプリ プロキシを使用すると、既存のリモート アクセス アーキテクチャを簡素化できます。 これらのアプリへの VPN アクセスを置き換えることができます。 オンプレミスの認証用 ID ソリューションへの依存状態も解消できます。 ユーザーは、会社のアプリケーションを使用するためにサインインするときに、何かが違うとは一切気付きません。 ユーザーはいつもどおり、任意のデバイスでどこからでも作業を行うことができます。  

* **アプリに対する追加のソフトウェアや変更がない** - 既存のアプリケーション プロキシ コネクタを使用でき、追加のソフトウェアをインストールする必要はありません。  

* **使用できる属性と変換の範囲が広い** - 使用できるすべてのヘッダー値は、Azure AD によって発行される標準の要求に基づいています。 [SAML または OIDC アプリケーションの要求を構成する](../develop/active-directory-saml-claims-customization.md#attributes)ために使用できる属性と変換はすべて、ヘッダー値としても使用できます。 

## <a name="pre-requisites"></a>前提条件
ヘッダーベースの認証アプリでのシングル サインオンの使用を開始する前に、実際の環境が以下の設定と構成に対応していることを確認してください。
- アプリケーション プロキシを有効にして、サイトのラインがあるコネクタをアプリケーションにインストールする必要があります。 オンプレミス環境を準備し、コネクタのインストールと登録を行い、コネクタをテストする方法については、[アプリケーション プロキシを通したリモート アクセスのためにオンプレス アプリケーションを追加する](application-proxy-add-on-premises-application.md#add-an-on-premises-app-to-azure-ad)ことに関するチュートリアルを参照してください。 

## <a name="supported-capabilities"></a>サポートされる機能

次の表は、アプリケーション プロキシでサポートされるヘッダーベースの認証アプリケーションに必要な一般的な機能を示しています。 

|要件   |説明|
|----------|-----------|
|フェデレーション SSO |事前認証モードでは、すべてのアプリケーションが Azure AD 認証によって保護され、ユーザーはシングル サインオンを使用できるようになります。 |
|リモート アクセス |アプリケーション プロキシを使用すると、アプリへのリモート アクセスが可能になります。 ユーザーは、外部 URL を使用して、インターネットから任意のブラウザーでアプリケーションにアクセスできます。 アプリケーション プロキシは、企業アクセス用途を意図したものではありません。 |
|ヘッダーベースの統合 |アプリケーション プロキシでは、Azure AD との SSO 統合を行ってから、ID またはその他のアプリケーション データが、HTTP ヘッダーとしてアプリケーションに渡されます。 |
|アプリケーション認証 |一般的なポリシーは、アクセスされるアプリケーション、ユーザーのグループ メンバーシップ、その他のポリシーに基づいて指定できます。 Azure AD では、ポリシーは[条件付きアクセス](../conditional-access/overview.md)を使用して実装されます。 アプリケーション認可ポリシーは、最初の認証要求にのみ適用されます。 |
|認証を設定する |ポリシーは、たとえば機密性の高いリソースにアクセスするために、追加の認証を強制するように定義できます。 |
|きめ細かな認可 |URL レベルでのアクセス制御を提供します。 追加されたポリシーは、アクセス対象の URL に基づいて適用できます。 そのアプリ用に構成される内部 URL では、ポリシーの適用対象となるアプリのスコープを定義します。 最もきめ細かなパスに対して構成されているポリシーが適用されます。  |

> [!NOTE] 
> この記事では、アプリケーション プロキシを使用してヘッダーベースの認証アプリケーションを Azure AD に接続することをテーマとしており、これがお勧めのパターンです。 別の方法として、Azure AD と共に PingAccess を使用してヘッダーベースの認証を有効にする統合パターンもあります。 詳細については、「[アプリケーション プロキシと PingAccess を使用したシングル サインオン用のヘッダーベースの認証](application-proxy-ping-access-publishing-guide.md)」を参照してください。

## <a name="how-it-works"></a>しくみ

:::image type="content" source="./media/application-proxy-configure-single-sign-on-with-headers/how-it-works-updated.png" alt-text="ヘッダーベースのシングル サインオンがアプリケーション プロキシと共にどのように動作するか。" lightbox="./media/application-proxy-configure-single-sign-on-with-headers/how-it-works-updated.png":::

1. 管理者は、Azure AD ポータルで、アプリケーションが必要とする属性マッピングをカスタマイズします。 
2. ユーザーがアプリにアクセスすると、アプリケーション プロキシによって、Azure AD によるユーザーの認証が確実に行われます 
3. アプリケーション プロキシのクラウド サービスでは、必要とされる属性が認識されます。 そのためサービスでは、認証時に受信した ID トークンから、対応する要求がフェッチされます。 サービスでは次に、コネクタに対する要求の一部として、値が、必要な HTTP ヘッダーに変換されます。 
4. 要求は、その後コネクタに渡されます。それが次に、バックエンド アプリケーションに渡されます。 
5. アプリケーションでは、ヘッダーを受信し、必要に応じてこれらのヘッダーを使用できます。 

## <a name="publish-the-application-with-application-proxy"></a>アプリケーション プロキシを使用してアプリケーションを発行する

1.  [アプリケーション プロキシを使用してアプリケーションを発行する](application-proxy-add-on-premises-application.md#add-an-on-premises-app-to-azure-ad)ことに関するページで説明されている手順に従って、アプリケーションを発行します。  
    - 内部 URL 値によってアプリケーションのスコープが決まります。 アプリケーションのルート パスで内部 URL 値を構成すると、ルートの下にあるすべてのサブ パスが、同じヘッダー構成とその他のアプリケーション構成を受け取ることになります。 
    - 新しいアプリケーションを作成し、構成したアプリケーションよりもきめ細かなパスに対して、異なるヘッダー構成またはユーザー割り当てを設定します。 新しいアプリケーションでは、必要な特定のパスを含む内部 URL を構成してから、この URL に必要な特定のヘッダーを構成します。 アプリケーション プロキシでは常に、構成設定が、アプリケーション用に設定された最もきめ細かなパスに一致されます。 

2.  **事前認証方法** として  **[Azure Active Directory]**   を選択します。 
3. **[ユーザーとグループ]** に移動し、適切なユーザーとグループを割り当てることで、テスト ユーザーを割り当てます。 
4. ブラウザーを開き、[アプリケーション プロキシ] 設定から  **[外部 URL]**   に移動します。 
5. アプリケーションに接続できることを確認します。 接続できる場合でも、ヘッダーが構成されていないため、まだアプリにはアクセスできません。 

## <a name="configure-single-sign-on"></a>Configure single sign-on 
ヘッダーベースのアプリケーションのシングル サインオンの使用を開始する前に、アプリケーション プロキシ コネクタを事前にインストールし、コネクタが対象アプリケーションにアクセスできるようにする必要があります。 そうなっていない場合は、 [Azure AD アプリケーション プロキシに関するチュートリアル](application-proxy-add-on-premises-application.md) の手順に従ってから、ここに戻ってください。 

1. アプリケーションがエンタープライズ アプリケーションの一覧に表示されたら、それを選択して  **[シングル サインオン]** を選択します。 
2. シングル サインオン モードを **[ヘッダーベース]** に設定します。 
3. 基本構成では、既定値として **[Azure Active Directory]** が選択されます。 
4. [ヘッダー] で、編集の鉛筆を選択して、アプリケーションに送信するヘッダーを構成します。 
5. **[新しいヘッダーの追加]** を選択します。 ヘッダーの **名前** を指定し、 **[属性]** または **[変換]** のいずれかを選択して、ドロップダウンから、アプリケーションで必要なヘッダーを選択します。  
    - 使用可能な属性の一覧の詳細については、[要求のカスタマイズに関するページの「属性」](../develop/active-directory-saml-claims-customization.md#attributes)を参照してください。 
    - 使用可能な変換の一覧の詳細については、[要求のカスタマイズに関するページの「要求の変換」](../develop/active-directory-saml-claims-customization.md#claim-transformations)を参照してください。 
    - **グループ ヘッダー** を追加して、ユーザーが属しているすべてのグループや、ヘッダーとしてアプリケーションに割り当てられているグループを送信することもできます。 グループを値として構成することの詳細については、[アプリケーションに対するグループ要求を構成する](../hybrid/how-to-connect-fed-group-claims.md#add-group-claims-to-tokens-for-saml-applications-using-sso-configuration)ことに関するページを参照してください。 
6. [保存] を選択します。 

## <a name="test-your-app"></a>アプリをテストする 

これらの手順すべてを完了すると、アプリが稼働し、使用可能になっているはずです。 アプリをテストするには: 
1. 新しいブラウザーまたはプライベート ブラウザー ウィンドウを開いて、以前にキャッシュされたヘッダーがクリアされていることを確認します。 次に、[アプリケーション プロキシ] 設定から  **[外部 URL]**   に移動します。
2. サインインには、アプリに割り当てたテスト アカウントを使用します。 SSO を使用してアプリケーションの読み込みとサインインが可能な場合は、正しくできています。 

## <a name="considerations"></a>考慮事項

- アプリケーション プロキシは、オンプレミスまたはプライベート クラウド上のアプリへのリモート アクセスを提供するために使用されます。 アプリケーション プロキシは、企業ネットワークから内部向けに送信されるトラフィックを処理するためには推奨されません。
- ヘッダーベースの認証アプリケーションへのアクセスは、コネクタまたはその他の許可されたヘッダーベースの認証ソリューションからのトラフィックのみに制限する必要があります。 通常、これを行うには、ファイアウォールまたはアプリケーション サーバーの IP 制限を使用し、アプリケーションへのネットワーク アクセスを制限します。

## <a name="next-steps"></a>次のステップ

- [シングル サインオンとは](../manage-apps/what-is-single-sign-on.md)
- [アプリケーション プロキシとは](what-is-application-proxy.md)
- [アプリケーション管理のクイックスタート シリーズ](../manage-apps/view-applications-portal.md)
