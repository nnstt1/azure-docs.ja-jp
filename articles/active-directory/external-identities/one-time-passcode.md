---
title: B2B ゲスト ユーザーのワンタイム パスコード認証 - Azure AD
description: 電子メール ワンタイム パスコードを使用して、Microsoft アカウントを必要とせずに B2B ゲスト ユーザーを認証する方法について説明します。
services: active-directory
ms.service: active-directory
ms.subservice: B2B
ms.topic: how-to
ms.date: 10/26/2021
ms.author: mimart
author: msmimart
manager: CelesteDG
ms.reviewer: mal
ms.custom: it-pro, seo-update-azuread-jan, seoapril2019, contperf-fy21q4-portal
ms.collection: M365-identity-device-management
ms.openlocfilehash: a2778e2e08c416837de78567fde5dbfb61d04804
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2021
ms.locfileid: "131067298"
---
# <a name="email-one-time-passcode-authentication"></a>電子メール ワンタイム パスコード認証

電子メール ワンタイム パスコード機能は、Azure AD、Microsoft アカウント (MSA)、ソーシャル ID プロバイダーなどの他の方法で認証できない場合に、B2B コラボレーション ユーザーを認証する方法です。 B2B ゲスト ユーザーは、招待を引き換えたり、共有リソースにサインインしたりしようとするときに、一時パスコードを要求できます。このパスコードは、ユーザーのメール アドレスに送信されます。 その後、このパスコードを入力してサインインを続けます。

この機能は、Azure portal でいつでも有効にできます。その場合は、テナントの External Identities の設定で電子メール ワンタイム パスコード ID プロバイダーを構成します。 この機能は、有効または無効にするか、2021 年 11 月 1 日以降の自動有効化を待つことができます。

![電子メール ワンタイム パスコードの概要図](media/one-time-passcode/email-otp.png)

> [!IMPORTANT]
>
> - **2021 年 11 月 1 日以降**、既存のすべてのテナントに対して電子メールのワンタイム パスコード機能をオンにし、新しいテナントに対して既定で有効にするように、変更の展開を開始します。 こアカウントとテナントの作成を停止します。の変更の一環として、B2B コラボレーションの招待の引き換え中に、Microsoft は、管理されていない (「バイラル」) Azure AD アカウントとテナントの作成を停止します。 休暇中の中断およびデプロイロックダウンを最小限に抑えるために、大多数のテナントは2022年1月に変更が表示されます。 電子メール ワンタイム パスコード機能を有効にするのは、これによりゲスト ユーザーにシームレスなフォールバック認証方法が提供されるからです。 ただし、この機能が自動的に有効にならないようにする場合は、 [無効にする](one-time-passcode.md#disable-email-one-time-passcode)ことができます。
> - 電子メール ワンタイム パスコード設定は、Azure portal で、 **[外部コラボレーションの設定]** から **[すべての ID プロバイダー]** に移動されました。

> [!NOTE]
> ワンタイム パスコードのユーザーは、テナントのコンテキストを含むリンクを使用してサインインする必要があります (たとえば、`https://myapps.microsoft.com/?tenantid=<tenant id>` や `https://portal.azure.com/<tenant id>`、または検証済みのドメインの場合は `https://myapps.microsoft.com/<verified domain>.onmicrosoft.com`)。 アプリケーションとリソースへの直接リンクも、テナント コンテキストが含まれている限り機能します。 ゲスト ユーザーは現在、テナント コンテキストが含まれていないエンドポイントを使用してサインインできません。 たとえば、`https://myapps.microsoft.com` や `https://portal.azure.com` を使用すると、エラーが発生します。

## <a name="user-experience-for-one-time-passcode-guest-users"></a>ワンタイム パスコードのゲスト ユーザーに対するユーザー エクスペリエンス

電子メール ワンタイム パスコード機能が有効になっている場合、[一定の条件を満たす](#when-does-a-guest-user-get-a-one-time-passcode)新しく招待されたユーザーはワンタイム パスコード認証を使用します。 電子メール ワンタイム パスコードが有効になる前に招待に応じたゲスト ユーザーは、引き続き同じ認証方法を使用します。

ワンタイム パスコード認証では、ゲスト ユーザーは、直接リンクをクリックするか、招待メールを使用して、招待に応じることができます。 どちらの場合も、ブラウザーのメッセージで、ゲスト ユーザーのメール アドレスにコードが送信されることが示されます。 ゲスト ユーザーは、 **[コードの送信]** を選択します。

   ![[コードの送信] ボタンを示すスクリーンショット](media/one-time-passcode/otp-send-code.png)

パスコードがユーザーのメール アドレスに送信されます。 ユーザーは、メールからパスコードを取得し、ブラウザー ウィンドウに入力します。

   ![[コードの入力] ページを示すスクリーンショット](media/one-time-passcode/otp-enter-code.png)

ゲスト ユーザーは認証されて、共有リソースを表示したり、サインインを続行したりできるようになります。

> [!NOTE]
> ワンタイム パスコードの有効期間は 30 分です。 30 分が経過すると、その特定のワンタイム パスコードは無効になり、ユーザーは新しいパスコードを要求する必要があります。 ユーザー セッションは 24 時間後に期限が切れます。 それを過ぎると、ゲスト ユーザーはリソースにアクセスするときに新しいパスコードを受け取ります。 セッションの有効期限により、ゲスト ユーザーが自分の会社を退職したりアクセスを必要としなくなったときに特に、セキュリティが強化されます。

## <a name="when-does-a-guest-user-get-a-one-time-passcode"></a>ゲスト ユーザーがワンタイム パスコードを入手するとき

次の場合、ゲスト ユーザーは、招待に応じたとき、または共有されているリソースへのリンクを使用したときに、ワンタイム パスコードを受け取ります。

- Azure AD アカウントを持っていない
- Microsoft アカウントを持っていない
- 招待元のテナントで、ソーシャル プロバイダー ([Google](google-federation.md) など) や他の ID プロバイダーとのフェデレーションを設定していなかった。

招待するとき、招待されるユーザーにワンタイム パスコード認証が使用されることは示されません。 ただし、ゲスト ユーザーがサインインするとき、他の認証方法を使用できない場合は、ワンタイム パスコード認証がフォールバック メソッドになります。


> [!NOTE]
> ユーザーがワンタイム パスコードを使用した後、MSA、Azure AD アカウント、または他のフェデレーション アカウントを取得した場合、引き続きワンタイム パスコードによる認証が使用されます。 ユーザーの認証方法を更新する場合は、ユーザーの[利用状態をリセットする](reset-redemption-status.md)ことができます。

### <a name="example"></a>例

ゲスト ユーザー teri@gmail.com は、Google フェデレーションが設定されていない Fabrikam に招待されます。 Teri は Microsoft アカウントを持っていません。 認証用のワンタイム パスコードを受け取ります。

## <a name="enable-email-one-time-passcode"></a>電子メールのワンタイム パスコードを有効にする

1. Azure AD の全体管理者として [Azure portal](https://portal.azure.com/) にサインインします。

2. ナビゲーション ペインで、 **[Azure Active Directory]** を選択します。

3. **[外部 ID]**  >  **[すべての ID プロバイダー]** を選択します。

4. **[電子メール ワンタイム パスコート]** を選択して、構成ペインを開きます。

5. **[ゲストの電子メール ワンタイム パスコード]** で、次のいずれかを選択します。

   - **[\<date\> 以降にゲストの電子メール ワンタイム パスコードを自動的に有効にする]** この機能をすぐに有効にせず、2021 年 11 月 1 日の自動有効化日を待つ場合。
   - **[ゲストの電子メール ワンタイム パスコードを今すぐ有効にする]** この機能をすぐに有効にする場合。
   - [はい]/[いいえ] トグルが表示されている場合は、 **[はい]** を選択して機能をすぐに有効にします (この機能が以前に無効にされた場合に、このトグルが表示されます)。

   ![有効にされた電子メール ワンタイム パスコードのトグル](media/one-time-passcode/enable-email-otp-options.png)

5. **[保存]** を選択します。

## <a name="disable-email-one-time-passcode"></a>電子メール ワンタイム パスコードを無効にする

2021 年 11 月 1 日以降、既存のすべてのテナントに対して電子メールのワンタイム パスコード機能をオンにし、新しいテナントに対して既定で有効にするように、変更の展開を開始します。  その時点で、Microsoft では、B2B コラボレーション シナリオ向けのアンマネージド ("バイラル" または "Just-In-Time") Azure AD アカウントおよびテナントを作成することによる招待の利用をサポートしなくなります。 電子メール ワンタイム パスコード機能を有効にするのは、これによりゲスト ユーザーにシームレスなフォールバック認証方法が提供されるからです。 ただし、使用しないことを選択した場合は、この機能を無効にすることもできます。

> [!NOTE]
>
> お使いのテナントで電子メール ワンタイム パスコード機能が有効になっているときに、それを無効にした場合、ワンタイム パスコードを利用していたゲスト ユーザーは全員サインインできなくなります。 別の認証方法を使用してもう一度サインインできるように、[利用状態をリセットする](reset-redemption-status.md)ことができます。

### <a name="to-disable-the-email-one-time-passcode-feature"></a>電子メール ワンタイム パスコードを無効にするには

1. Azure AD の全体管理者として [Azure portal](https://portal.azure.com/) にサインインします。

2. ナビゲーション ペインで、 **[Azure Active Directory]** を選択します。

3. **[外部 ID]**  >  **[すべての ID プロバイダー]** を選択します。

4. **[電子メール ワンタイム パスコード]** を選択し、 **[ゲストの電子メール ワンタイム パスコード]** で、 **[ゲストの電子メール ワンタイム パスコードを無効にする]** を選択します (この機能が以前に有効または無効にされたか、プレビュー中にオプトインされた場合は **[いいえ]** を選択します)。

   ![無効になっている電子メール ワンタイム パスコードのトグル](media/one-time-passcode/disable-email-otp-options.png)

   > [!NOTE]
   > 電子メール ワンタイム パスコード設定は、Azure portal で、 **[外部コラボレーションの設定]** から **[すべての ID プロバイダー]** に移動されました。
   > 電子メール ワンタイム パスコード オプションではなくトグルが表示されている場合は、以前にこの機能のプレビューを有効、無効、またはオプトインしたことを意味します。 **[いいえ]** を選択すると、この機能が無効になります。

5. **[保存]** を選択します。

## <a name="note-for-public-preview-customers"></a>パブリック プレビューの顧客向けのメモ

以前に電子メール ワンタイム パスコードのパブリック プレビューにオプトインしたことがある場合は、2021 年 11 月 1 日という機能の自動有効化の期日が適用されないため、関連するビジネス プロセスは影響を受けません。 また、Azure portal の **[ゲストのメール ワンタイム パスコード]** プロパティの下に、 **[\<date\> 以降、ゲストのメール ワンタイム パスコードが自動的に有効になります]** オプションが表示されません。 代わりに、次の **[はい]** または **[いいえ]** のトグルが表示されます。

![オプトインされている電子メール ワンタイム パスコード](media/one-time-passcode/enable-email-otp-opted-in.png)

ただし、この機能からオプトアウトし、2021 年 11 月 1 日以降にそれが自動的に有効になることを希望する場合は、Microsoft Graph API の [email authentication method configuration リソースの種類](/graph/api/resources/emailauthenticationmethodconfiguration)を使用して、既定の設定に戻すことができます。 既定の設定に戻すと、 **[ゲストの電子メール ワンタイム パスコード]** の下で次のオプションが使用可能になります。

![オプトインされた電子メール ワンタイム パスコードを有効にする](media/one-time-passcode/email-otp-options.png)

- **\<date\> 以降、ゲストのメール ワンタイム パスコードが自動的に有効になります。** (既定値) お使いのテナントで電子メール ワンタイム パスコード機能がまだ有効になっていない場合、2021 年 11 月 1 日以降、自動的に有効になります。 その時点でこの機能が有効になることを希望する場合、これ以上の操作は必要ありません。 この機能を既に有効または無効にしている場合、このオプションは使用できません。

- **[ゲストの電子メール ワンタイム パスコードを今すぐ有効にする]** 。 お使いのテナントに対して電子メール ワンタイム パスコード機能を有効にします。

- **[ゲストの電子メール ワンタイム パスコードを無効にする]** 。 お使いのテナントに対して電子メール ワンタイム パスコード機能を無効にし、2021 年 11 月 1 日以降にこの機能が有効にならないようにします。

## <a name="note-for-azure-us-government-customers"></a>Azure US Government のお客様のための注意事項

Azure US Government クラウドでは、電子メール ワンタイムパスコード機能は既定で無効になっています。 パートナーは、この機能が有効になっていない限りサインインできません。 Azure パブリック クラウドとは異なり、Azure US Government クラウドでは、セルフサービス Azure Active Directory アカウントを使用して招待に応じることはサポートされていません。

 ![無効になっている電子メール ワンタイム パスコード](media/one-time-passcode/enable-email-otp-disabled.png)

Azure US Government クラウドで電子メール ワンタイム パスコード機能を有効にするには:

1. Azure AD の全体管理者として [Azure portal](https://portal.azure.com) にサインインします。
2. ナビゲーション ペインで、 **[Azure Active Directory]** を選択します。
3. **[組織の関係]**  > **[すべての ID プロバイダー]** を選択します。

   > [!NOTE]
   > - **[組織の関係]** が表示されない場合は、上部の検索バーで "外部 ID" を検索します。

4. **[電子メール ワンタイム パスコード]** を選択してから、 **[はい]** を選択します。
5. **[保存]** を選択します。

現在の制限事項の詳細については、「[Azure US Government クラウド](current-limitations.md#azure-us-government-clouds)」を参照してください。

## <a name="frequently-asked-questions"></a>よく寄せられる質問

**電子メール ワンタイム パスコードの設定で [2021 年 10 月以降、ゲストのメール ワンタイム パスコードが自動的に有効になります] がまだ選択されているのはなぜですか?**

展開のスケジュールにより、既定でグローバルに電子メール ワンタイム パスコードが有効になる変更のロールアウトは 2021 年 11 月 1 日に開始されます。 それまでは、電子メール ワンタイム パスコードの設定で [2021 年 10 月以降、ゲストのメール ワンタイム パスコードが自動的に有効になります] が選択されている場合があります。

**電子メールでワンタイムパスコードを有効にした場合、既存のゲストユーザーはどうなりますか。**

既存のユーザーが既に引き換え時点を過ぎているため、電子メールのワンタイムパスコードを有効にしても、既存のゲストユーザーには影響しません。 電子メールのワンタイムパスコードを有効にすると、新しいゲストユーザーがテナントに引き換える将来の引き換えアクティビティにのみ影響します。

**グローバル ロールアウト中のゲストのユーザー エクスペリエンスはどのようなものですか?**

グローバル ロールアウト中、ゲストのユーザー エクスペリエンスは、電子メール ワンタイム パスコードの構成とゲストのシナリオによって異なります。 

ご利用のリージョンに変更がロールアウトされる前、ゲスト側の動作は次のようになります。

- 電子メール ワンタイム パスコードが有効になっている場合:

  - ゲストが既存のアンマネージド Azure AD アカウントを持っている場合、引き続きアンマネージド Azure AD アカウントを使用してサインインします。
  - ゲストが以前にアンマネージド Azure AD アカウントを使用してテナントへの招待に応じた場合、その利用状態をリセットして再招待すると、ゲストは引き続きアンマネージド Azure AD アカウントを使用してサインインします。
  - ゲストが既存のアンマネージド Azure AD アカウントを持っていない場合、電子メール ワンタイム パスコード認証を使用して利用を開始することになります。

- 電子メール ワンタイム パスコードが無効になっている場合:

  - ゲストが既存のアンマネージド Azure AD アカウントを持っている場合、引き続きアンマネージド Azure AD アカウントを使用してサインインします。
  - ゲストが以前にアンマネージド Azure AD アカウントを使用してテナントへの招待に応じた場合、その利用状態をリセットして再招待すると、ゲストは引き続きアンマネージド Azure AD アカウントを使用してサインインします。
  - ゲストが既存の管理されていない Azure AD アカウントがない場合は、管理されていない Azure AD アカウントを使用しますが、直接のアプリケーションリンクを利用している場合は、事前に Azure portal に追加されていないと、サインインエラーが発生する可能性があります。

ご利用のリージョンに変更がロールアウトされた後、ゲスト側の動作は次のようになります。

- 電子メール ワンタイム パスコードが有効になっている場合:

  - ゲストが既存のアンマネージド Azure AD アカウントを持っている場合、引き続きアンマネージド Azure AD アカウントを使用してサインインします。
  - ゲストが以前にアンマネージド Azure AD アカウントを使用してテナントへの招待に応じた場合、その利用状態をリセットして再招待すると、ゲストは引き続きアンマネージド Azure AD アカウントでのサインインします。
  - ゲストがアンマネージド Azure AD アカウントを持っていない場合は、電子メール ワンタイム パスコードを使用して利用を開始し、今後サインインします。

- 電子メール ワンタイム パスコードが無効になっている場合:

  - ゲストが既存のアンマネージド Azure AD アカウントを持っている場合、引き続きアンマネージド Azure AD アカウントを使用してサインインします。
  - ゲストが以前に管理されていないAzureADアカウントを使用してテナントへの招待を引き換えた場合、ゲストの引き換えステータスをリセットして再度招待すると、ゲストはMicrosoftアカウントを使用して引き換えてサインインします。
  - ゲストがアンマネージド Azure AD アカウントを持っていない場合は、Microsoft アカウントを使用して利用を開始し、今後サインインします。

さまざまな利用開始プロセスの詳細については、[B2B コラボレーションの招待の利用](redemption-experience.md)に関するページを参照してください。

**これは、セルフサービス サインアップの [アカウントがない場合は、作成しましょう] オプションがなくなることを意味しますか?**

[External Identities のコンテキストでのセルフサービス サインアップ](self-service-sign-up-overview.md)は、電子メール検証済みユーザーのセルフサービス サインアップと混同しやすいですが、これらは 2 つの異なる機能です。 なくなる機能は、[電子メール検証済みユーザーのセルフサービス サインアップ](../enterprise-users/directory-self-service-signup.md)です。これにより、ゲストはアンマネージド Azure AD アカウントを作成します。 ただし、External Identities のセルフサービス サインアップは引き続き利用可能であり、ゲストは[さまざまな ID プロバイダー](identity-providers.md)を使用して組織にサインアップすることになります。  

**Microsoft では、既存の Microsoft アカウント (MSA) をどのようにすることを勧めていますか?**

ID プロバイダーの設定で Microsoft アカウントを無効にできるようになったら (現時点では利用できません)、Microsoft アカウントを無効にして電子メール ワンタイム パスコードを有効にすることを強くお勧めします。 次に、Microsoft アカウントを使用している既存のゲストの利用状態をリセットします。これにより、ゲストは電子メール ワンタイム パスコード認証の使用に再度切り替え、今後は電子メール ワンタイム パスコードを使用してサインインできるようになります。

**SharePoint および OneDrive と Azure AD B2B との統合は、この変更に含まれますか?**

いいえ。既定で 2021 年 11 月 1 日に開始される電子メール ワンタイム パスコードを有効にするための変更のグローバルなロールアウトに、SharePoint および OneDrive と Azure AD B2B との統合は含まれません。 SharePoint と OneDrive でのコラボレーションに B2B 機能が使用されるように統合を有効にする方法、またはこの統合を無効にする方法については、「[SharePoint および OneDrive と Azure AD B2B との統合](/sharepoint/sharepoint-azureb2b-integration)」を参照してください。
