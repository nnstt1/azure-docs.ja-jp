---
title: Azure AD Multi-Factor Authentication を構成する - Azure Active Directory
description: Azure portal で Azure AD Multi-Factor Authentication の設定を構成する方法について説明します
services: multi-factor-authentication
ms.service: active-directory
ms.subservice: authentication
ms.topic: how-to
ms.date: 08/12/2021
ms.author: justinha
author: justinha
manager: daveba
ms.reviewer: michmcla
ms.collection: M365-identity-device-management
ms.custom: contperf-fy20q4
ms.openlocfilehash: 22dd9bdfc8f26a46c7cd5989851fb748955732fe
ms.sourcegitcommit: 0770a7d91278043a83ccc597af25934854605e8b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/13/2021
ms.locfileid: "124773818"
---
# <a name="configure-azure-ad-multi-factor-authentication-settings"></a>Azure AD Multi-Factor Authentication の設定を構成する

Azure AD Multi-Factor Authentication のエンドユーザー エクスペリエンスをカスタマイズするために、アカウント ロックアウトのしきい値や、不正アクセスのアラートと通知などの設定のオプションを構成できます。 一部の設定は Azure Active Directory (Azure AD) の Azure portal 内に直接ありますが、一部は別の Azure AD Multi-Factor Authentication ポータルにあります。

Azure portal では、次の Azure AD Multi-Factor Authentication 設定を使用できます。

| 特徴量 | 説明 |
| ------- | ----------- |
| [アカウントのロックアウト](#account-lockout) | 連続して拒否された認証試行が多すぎる場合に、Azure AD Multi-Factor Authentication を使用しないようにアカウントを一時的にロックします。 この機能は、認証のために PIN を入力するユーザーにのみ適用されます。 (MFA サーバー) |
| [ユーザーのブロック/ブロック解除](#block-and-unblock-users) | 特定のユーザーが Azure AD Multi-Factor Authentication 要求を受信できないようにブロックします。 ブロックされているユーザーを認証しようとすると、自動的に拒否されます。 ユーザーはブロックされた時間から 90 日間ブロックされたままか、手動でブロック解除されます。 |
| [不正アクセスのアラート](#fraud-alert) | ユーザーが不正な確認要求を通報できるようにする設定を構成します。 |
| [通知](#notifications) | MFA サーバーからのイベントの通知を有効にします。 |
| [OATH トークン](concept-authentication-oath-tokens.md) | クラウドベースの Azure AD MFA 環境で、ユーザーの OATH トークンを管理するために使用されます。 |
| [電話の設定](#phone-call-settings) | クラウド環境とオンプレミス環境の電話と案内メッセージに関連する設定を構成します。 |
| プロバイダー | アカウントに関連付けた可能性がある既存の認証プロバイダーを表示します。 2018 年 9 月 1 日時点では、新しい認証プロバイダーは作成できません |

![Azure portal - Azure AD Multi-Factor Authentication の設定](./media/howto-mfa-mfasettings/multi-factor-authentication-settings-portal.png)

## <a name="account-lockout"></a>アカウントのロックアウト

攻撃の一部としての MFA の試行が繰り返されないようにするために、アカウント ロックアウトの設定では、アカウントが一定の期間ロックアウトされるまでに許可する試行の失敗回数を指定できます。 アカウント ロックアウトの設定は、MFA プロンプトに PIN コードが入力された場合にのみ適用されます。

次の設定を使用できます。

* アカウント ロックアウトをトリガーするまでの MFA の拒否回数
* アカウント ロックアウトのカウンターがリセットされるまでの時間 (分)
* アカウントのブロックが自動的に解除されるまでの時間 (分)

アカウント ロックアウトの設定を構成するには、次の設定を行います。

1. [Azure Portal](https://portal.azure.com) に管理者としてサインインします。
1. **[Azure Active Directory]**  >  **[セキュリティ]**  >  **[MFA]**  >  **[アカウント ロックアウト]** の順に移動します。
1. お使いの環境に必要な値を入力し、 **[保存]** を選択します。

    ![Azure portal のアカウント ロックアウトの設定のスクリーンショット](./media/howto-mfa-mfasettings/account-lockout-settings.png)

## <a name="block-and-unblock-users"></a>ユーザーのブロックおよびブロック解除

ユーザーのデバイスが紛失するか、盗難にあった場合は、関連付けられているアカウントに対する Azure AD Multi-Factor Authentication の試行をブロックできます。 ブロックされているユーザーに対する Azure AD Multi-Factor Authentication の試行は自動的に拒否されます。 ユーザーはブロックされた時間から 90 日間ブロックされ続けます。 その方法を説明するために、[テナントでユーザーをブロックおよびブロック解除する方法](https://www.youtube.com/watch?v=WdeE1On4S1o)に関するビデオを公開しています。

### <a name="block-a-user"></a>ユーザーのブロック

ユーザーをブロックするには、次の手順を実行するか、[この短いビデオ](https://www.youtube.com/watch?v=WdeE1On4S1o&feature=youtu.be)をご覧ください

1. **[Azure Active Directory]**  >  **[セキュリティ]**  >  **[MFA]**  >  **[ユーザーのブロック/ブロック解除]** の順に移動します。
1. **[追加]** を選択してユーザーをブロックします。
1. ブロックされるユーザーのユーザー名を `username@domain.com` のように入力し、 *[理由]* フィールドにコメントを入力します。
1. 準備ができたら、 **[OK]** を選択して、ユーザーをブロックします。

### <a name="unblock-a-user"></a>ユーザーのブロック解除

ユーザーのブロックを解除するには、次の手順を実行します。

1. **[Azure Active Directory]**  >  **[セキュリティ]**  >  **[MFA]**  >  **[ユーザーのブロック/ブロック解除]** の順に移動します。
1. 目的のユーザーの横にある **[アクション]** 列で *[ブロック解除]* を選択します。
1. *[Reason for unblocking]\(ブロック解除の理由)* フィールドにコメントを入力します。
1. 準備ができたら、 **[OK]** を選択して、ユーザーのブロックを解除します。

## <a name="fraud-alert"></a>不正アクセスのアラート

不正アクセスのアラート機能により、ユーザーは自分のリソースへの不正アクセスの試みを通報できます。 不明または疑わしい MFA プロンプトを受け取った場合、ユーザーは Microsoft Authenticator アプリを使用するか、または電話で不正行為の試行を通報できます。

次の不正アクセスのアラート構成オプションを使用できます。

* **不正を通報するユーザーを自動的にブロックする**:ユーザーが不正を通報した場合、そのユーザー アカウントに対する Azure AD MFA の認証試行は、90 日間、または管理者がアカウントのブロックを解除するまでブロックされます。 管理者はサインイン レポートを使用してサインインを確認し、将来の不正アクセスを防止するための適切なアクションを実行できます。 その後、管理者はそのユーザーのアカウントの[ブロックを解除](#unblock-a-user)できます。
* **[Code to report fraud during initial greeting]\(案内メッセージ中に入力する不正アクセス通報コード\)** : ユーザーは、多要素認証を実行する電話を受けた場合、通常、 **#** を押してサインインを確認します。 不正アクセスを通報する場合は、 **#** を押す前にコードを入力します。 このコードは、既定では **0** ですが、カスタマイズすることができます。

   > [!NOTE]
   > Microsoft の既定の音声案内では、不正アクセスのアラートを送信するには **0#** を押すようにユーザーに指示します。 **0** 以外のコードを使用する場合は、ユーザーに適切な指示を行う独自のカスタム音声案内を記録し、アップロードする必要があります。

不正アクセスのアラートを有効にして構成するには、次の手順を実行します。

1. **[Azure Active Directory]**  >  **[セキュリティ]**  >  **[MFA]**  >  **[不正アクセスのアラート]** の順に移動します。
1. *[ユーザーが不正アクセスを通報できるようにする]* 設定を **[オン]** に設定します。
1. *[不正を通報するユーザーを自動的にブロックする]* または *[案内メッセージ後に入力する不正アクセス通報コード]* 設定を必要に応じて構成します。
1. 準備ができたら、 **[保存]** を選択します。

### <a name="view-fraud-reports"></a>不正アクセスの通報を表示する

ユーザーが不正行為を通報すると、そのイベントはサインイン レポート (ユーザーによって拒否されたサインインとして) および監査ログに表示されます。

- サインイン レポートで不正アクセス レポートを確認するには、 **[Azure Active Directory]**  >  **[サインイン]**  >  **[認証の詳細]** の順にクリックします。 不正アクセス レポートは標準 Azure AD サインイン レポートに含まれており、 **[結果の詳細]** に **[MFA denied, Fraud Code Entered]\(MFA が拒否されました。不正なコードが入力されました\)** として表示されます。

- 監査ログで不正アクセス レポートを確認するには、 **[Azure Active Directory]**  >  **[監査ログ]** の順にクリックします。 不正アクセス レポートは、不正アクセス レポートのテナント レベルの設定に基づいて、 **[Fraud reported - user is blocked for MFA]\(不正アクセスが通報されました - ユーザーは MFA に対してブロックされました\)** または **[Fraud reported - no action taken]\(不正アクセスが通報されました - アクションは実行されませんでした\)** のアクティビティの種類の下に表示されます。
 
## <a name="notifications"></a>通知

ユーザーが不正アクセスのアラートを通報するときに、電子メール通知を構成できます。 ユーザーのアカウントの資格情報が漏えいした可能性があるため、通常、これらの通知は、ID 管理者に送信されます。 次の例は、不正アクセスのアラート通知の電子メールの内容を示しています。

![不正アクセスのアラート通知の電子メールの例](./media/howto-mfa-mfasettings/multi-factor-authentication-fraud-alert-email.png)

不正アクセスのアラート通知を構成するには、次の設定を行います。

1. **[Azure Active Directory]**  >  **[セキュリティ]**  >  **[Multi-Factor Authentication]**  >  **[通知]** の順に移動します。
1. 次のボックスに、追加するメール アドレスを入力します。
1. 既存のメール アドレスを削除するには、目的のメール アドレスの横にある **[...]** オプションを選択し、 **[削除]** を選択します。
1. 準備ができたら、 **[保存]** を選択します。

## <a name="oath-tokens"></a>OATH トークン

Azure AD では、30 秒または 60 秒ごとにコードを更新する OATH-TOTP SHA-1 トークンの使用をサポートしています。 顧客は、選択したベンダーからこれらのトークンを購入できます。

OATH TOTP ハードウェア トークンには、通常、トークンで事前にプログラミングされた秘密鍵 (シード) が付属しています。 これらのキーは、次の手順に従って Azure AD に入力する必要があります。 秘密鍵は 128 文字に制限されていて、すべてのトークンと互換性があるとは限りません。 秘密キーに含めることができるのは、文字 *a-z* または *A-Z* と数字 *1-7* のみです。また、*Base32* でエンコードする必要があります。

再シードできるプログラミング可能な OATH TOTP ハードウェア トークンは、ソフトウェア トークンのセットアップ フローで Azure AD に設定することもできます。

OATH ハードウェア トークンはパブリック プレビュー段階でサポートされています。 プレビューの詳細については、「[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)」を参照してください

![OATH トークンの MFA OATH トークン ブレードへのアップロード](media/concept-authentication-methods/mfa-server-oath-tokens-azure-ad.png)

いったんトークンを取得したら、次に示す例のように、UPN、シリアル番号、秘密鍵、間隔、製造元、モデルを含む、コンマ区切り値 (CSV) ファイル形式でアップロードする必要があります。

```csv
upn,serial number,secret key,time interval,manufacturer,model
Helga@contoso.com,1234567,1234567abcdef1234567abcdef,60,Contoso,HardwareKey
```

> [!NOTE]
> CSV ファイルにヘッダー行が含まれていることを確認します。

CSV ファイルとして適切な形式が整ったら、管理者は Azure portal にサインインして、 **[Azure Active Directory] > [セキュリティ] > [MFA] > [OATH トークン]** の順に移動し、作成した CSV ファイルをアップロードできます。

CSV ファイルのサイズによって異なりますが、この処理には数分間かかることがあります。 **[最新の情報に更新]** ボタンを選択して、現在の状態を取得します。 ファイルにエラーがある場合、修正するために、エラーが含まれる CSV ファイルをダウンロードできます。 ダウンロードした CSV ファイル内のフィールド名は、アップロードされたバージョンとは異なります。

すべてのエラーが修正されたら、管理者は各キーをアクティブにすることができます。トークンの **[アクティブ化]** を選択し、トークンに表示されている OTP を入力します。

ユーザーは、最大 5 つの OATH ハードウェア トークンまたはいつでも使用されるように構成された認証アプリケーション (Microsoft Authenticator アプリなど) を組み合わせることもできます。

## <a name="phone-call-settings"></a>電話の設定

ユーザーが MFA プロンプトの電話を受ける場合は、発信者番号や音声案内など、ユーザーのエクスペリエンスを構成できます。

北米では、MFA 発信者番号を構成していない場合、Microsoft からの音声通話は次の番号から発信されます。 スパム フィルターを使用する場合は、必ずこれらの番号を除外してください。

* *+1 (855) 330 8653*

> [!NOTE]
> 公衆電話網経由で Azure AD Multi-Factor Authentication の電話がかけられた場合、発信者番号をサポートしていない通信事業者を通じてルーティングされることがあります。 このため、発信者番号は、Azure AD Multi-Factor Authentication が常にそれを送信しているにもかかわらず保証されません。 このことは、Azure AD Multi-Factor Authentication から提供される電話とテキスト メッセージの両方に当てはまります。 テキスト メッセージが Azure AD Multi-Factor Authentication からのものかどうかを確認する必要がある場合、[SMS メッセージを送る際に使用される SMS ショート コード](multi-factor-authentication-faq.yml#what-sms-short-codes-are-used-for-sending-sms-messages-to-my-users-)に関するページを参照してください。

独自の発信者番号を構成するには、次の手順を実行します。

1. **[Azure Active Directory]**  >  **[セキュリティ]**  >  **[MFA]**  >  **[電話の設定]** の順に移動します。
1. **[MFA 発信者の ID 番号]** をユーザーの電話に表示される番号に設定します。 米国ベースの番号だけを使用できます。
1. 準備ができたら、 **[保存]** を選択します。

### <a name="custom-voice-messages"></a>カスタム音声メッセージ

カスタム音声メッセージ機能を使用すると、Azure AD Multi-Factor Authentication で独自のレコーディングや案内を使用できます。 これらのメッセージは、既定の Microsoft レコーディングに加えて使用するか、その代わりに使用できます。

開始する前に、次の制限に注意してください。

* サポートされているファイルの形式は *.wav* と *.mp3* です。
* ファイル サイズの上限は 1 MB です。
* 認証メッセージは、20 秒より短くする必要があります。 20 秒より長いメッセージの場合は、確認に失敗する可能性があります。 メッセージが終わる前にユーザーが応答せず、確認がタイムアウトになる可能性があります。

### <a name="custom-message-language-behavior"></a>カスタム メッセージ言語の動作

カスタム音声メッセージがユーザーに再生されるときのメッセージの言語は、次の要因によって決まります。

* 現在のユーザーの言語。
  * ユーザーのブラウザーで検出された言語。
  * 他の認証シナリオでは、異なる動作になる可能性があります。
* 使用できるカスタム メッセージの言語。
  * この言語は、カスタム メッセージが追加されるときに管理者が選択します。

たとえば、カスタム メッセージが 1 つのみで、言語がドイツ語の場合は次のようになります。

* ドイツ語で認証されたユーザーには、カスタムのドイツ語のメッセージが聞こえます。
* 英語で認証されたユーザーには、標準の英語メッセージが聞こえます。

### <a name="custom-voice-message-defaults"></a>カスタム音声メッセージの既定値

次のサンプル スクリプトを使用すると、独自のカスタム メッセージを作成できます。 これらのフレーズは、独自のカスタム メッセージを構成しない場合の既定値です。

| メッセージ名 | スクリプト |
| --- | --- |
| 認証成功 | サインインの確認が完了しました。 ご利用いただきありがとうございます。 |
| 内線接続用 | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 シャープを押して、次の操作に進んでください。 |
| 不正アクセス通報の確認 | 不正アクセスが通報されました。 アカウントのブロックを解除するには、お客様の会社の IT ヘルプ デスクにお問い合わせください。 |
| 不正アクセスの案内 (標準) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、シャープを押してください。 この確認を開始した覚えがない場合は、他のユーザーがお客様のアカウントにアクセスしようとしている可能性があります。 不正アクセスを通報するには、0、シャープの順に押してください。 お客様の会社の IT チームに通知され、今後の確認操作がブロックされます。 |
| 不正アクセスの通報    不正アクセスが通報されました。 | アカウントのブロックを解除するには、お客様の会社の IT ヘルプ デスクにお問い合わせください。 |
| アクティブ化 | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、シャープを押してください。 |
| 認証拒否後の再試行 | 確認は拒否されました。 |
| 再試行 (標準) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、シャープを押してください。 |
| 案内 (標準) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、シャープを押してください。 |
| 案内 (PIN) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、PIN を入力してから、シャープを押してください。 |
| 不正アクセスの案内 (PIN) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。  確認を完了するために、PIN を入力してから、シャープを押してください。 この確認を開始した覚えがない場合は、他のユーザーがお客様のアカウントにアクセスしようとしている可能性があります。 不正アクセスを通報するには、0、シャープの順に押してください。 お客様の会社の IT チームに通知され、今後の確認操作がブロックされます。 |
| 再試行 (PIN) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、PIN を入力してから、シャープを押してください。 |
| 内線番号ダイヤル後 | 既にこの内線番号に接続済みの場合は、シャープを押して、次の操作に進んでください。 |
| 認証拒否 | 申し訳ございません。ただ今、サインインすることができません。 後でもう一度やり直してください。 |
| アクティブ化の案内 (標準) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、シャープを押してください。 |
| アクティブ化の再試行 (標準) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、シャープを押してください。 |
| アクティブ化の案内 (PIN) | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 確認を完了するために、PIN を入力してから、シャープを押してください。 |
| 内線番号ダイヤル前 | Microsoft のサインイン確認システムをご利用いただきありがとうございます。 この電話を次の内線番号に転送してください。 |

### <a name="set-up-a-custom-message"></a>カスタム メッセージを設定する

独自のカスタム メッセージを使用するには、次の手順を実行します。

1. **[Azure Active Directory]**  >  **[セキュリティ]**  >  **[MFA]**  >  **[電話の設定]** の順に移動します。
1. **[案内の追加]** を選択します。
1. 案内の **[種類]** を選択します。たとえば、 *[案内 (標準)]* や *[認証成功]* です。
1. 前のセクションの「[カスタム メッセージ言語の動作](#custom-message-language-behavior)」に基づいて、**言語** を選択します。
1. アップロードする *.mp3* または *.wav* サウンド ファイルを参照して、選択します。
1. 準備ができたら、 **[追加]** 、 **[保存]** の順に選択します。

## <a name="mfa-service-settings"></a>MFA サービスの設定

Azure AD Multi-Factor Authentication におけるアプリ パスワード、信頼できる IP、確認オプション、および多要素認証の記憶の設定は、サービス設定で確認できます。 これはどちらかというとレガシ ポータルであり、通常の Azure AD ポータルの一部ではありません。

Azure portal からサービス設定にアクセスするには、 **[Azure Active Directory]**  >  **[セキュリティ]**  >  **[MFA]**  >  **[作業の開始]**  >  **[構成]**  >  **[追加のクラウドベースの MFA 設定]** の順に移動します。 新しいウィンドウまたはタブが開き、追加の "*サービス設定*" のオプションが表示されます。

## <a name="trusted-ips"></a>信頼できる IP

Azure AD Multi-Factor Authentication の "_信頼できる IP_" 機能を使用すると、定義された IP アドレス範囲からサインインするユーザーに対する多要素認証プロンプトがバイパスされます。 オンプレミス環境の信頼できる IP 範囲を設定して、これらの場所のいずれかにユーザーがいるときに、Azure AD Multi-Factor Authentication プロンプトが表示されないようにできます。 Azure AD Multi-Factor Authentication の "_信頼できる IP_" 機能には、Azure AD Premium P1 エディションが必要です。 

> [!NOTE]
> 信頼できる IP には、MFA Server を使用する場合にのみ、プライベート IP 範囲を含めることができます。 クラウドベースの Azure AD Multi-Factor Authentication では、パブリック IP アドレス範囲のみを使用できます。
>
> IPv6 範囲は、[ネームド ロケーション (プレビュー)](../conditional-access/location-condition.md) インターフェイスでのみサポートされています。

組織がオンプレミスのアプリケーションに MFA を提供するために NPS 拡張機能をデプロイしている場合は、認証が試行されるとき、常にソース IP アドレスが NPS サーバーとして表示されます。

| Azure AD テナントの種類 | 信頼できる IP 機能のオプション |
|:--- |:--- |
| マネージド |**Specific range of IP addresses\(特定範囲の IP アドレス\)** : 管理者は、会社のイントラネットからサインインするユーザーの多要素認証をバイパスできる IP アドレスの範囲を指定します。 最大 50 件の信頼できる IP 範囲を構成できます。|
| フェデレーション |**すべてのフェデレーション ユーザー**: 組織の内部からサインインするフェデレーション ユーザーは全員、多要素認証をバイパスできます。 ユーザーは、Active Directory フェデレーション サービス (AD FS) によって発行される要求を使用して認証をバイパスします。<br/>**Specific range of IP addresses\(特定範囲の IP アドレス\)** : 管理者は、会社のイントラネットからサインインするユーザーの多要素認証をバイパスできる IP アドレスの範囲を指定します。 |

信頼できる IP のバイパスは、会社のイントラネット内からのみ機能します。 **[すべてのフェデレーション ユーザー]** オプションを選択した場合、ユーザーが会社のイントラネットの外部からサインインするときは、多要素認証を使用してそのユーザーを認証する必要があります。 ユーザーが AD FS 要求を提示している場合でもプロセスは同じです。

### <a name="end-user-experience-inside-of-corpnet"></a>企業ネットワーク内のエンドユーザー エクスペリエンス

信頼できる IP 機能が無効な場合、ブラウザーのフローでは多要素認証が必要です。 以前のリッチ クライアント アプリケーションではアプリ パスワードが必要です。

信頼できる IP を使用する場合、ブラウザーのフローで多要素認証は不要です。 以前のリッチ クライアント アプリケーションでは、アプリ パスワードは不要です (ユーザーがアプリ パスワードを作成していない場合)。 アプリ パスワードを使用している場合は、引き続きパスワードが必要です。

### <a name="end-user-experience-outside-corpnet"></a>企業ネットワークの外部のエンドユーザー エクスペリエンス

信頼できる IP が定義されているかどうかに関係なく、ブラウザーのフローで多要素認証が必要です。 以前のリッチ クライアント アプリケーションではアプリ パスワードが必要です。

### <a name="enable-named-locations-by-using-conditional-access"></a>条件付きアクセスを使用したネームド ロケーションの有効化

条件付きアクセス規則を利用すると、次の手順を使用してネームド ロケーションを定義できます。

1. Azure portal で、**Azure Active Directory** を検索して選択します。次に、 **[セキュリティ]**  >  **[条件付きアクセス]**  >  **[ネームド ロケーション]** の順に移動します。
1. **[新しい場所]** を選択します。
1. 場所の名前を入力します。
1. **[信頼できる場所としてマークする]** を選択します。
1. お使いの環境の IP 範囲を CIDR 表記で入力します (*40.77.182.32/27* など)。
1. **［作成］** を選択します

### <a name="enable-the-trusted-ips-feature-by-using-conditional-access"></a>条件付きアクセスを使用した信頼できる IP 機能の有効化

条件付きアクセス ポリシーを使用して信頼できる IP を有効にするには、次の手順を実行します。

1. Azure portal で、**Azure Active Directory** を検索して選択します。次に、 **[セキュリティ]**  >   **[条件付きアクセス]**  >  **[ネームド ロケーション]** の順に移動します。
1. **[MFA の信頼できる IP の構成]** を選択します。
1. **[サービス設定]** ページの **[信頼できる IP]** で、次の 2 つのオプションのいずれかを選択します。

   * **[For requests from federated users originating from my intranet]\(イントラネット内のフェデレーション ユーザーから送信された要求\)** : このオプションを選択するには、チェック ボックスをオンにします。 企業ネットワークからサインインするフェデレーション ユーザーは全員、AD FS によって発行されるクレームを使用して、多要素認証をバイパスします。 イントラネットの要求を適切なトラフィックに追加する規則が AD FS にあることを確認します。 規則が存在しない場合は、AD FS で次の規則を作成します。

      `c:[Type== "http://schemas.microsoft.com/ws/2012/01/insidecorporatenetwork"] => issue(claim = c);`

   * **[For requests from a specific range of public IPs]\(特定範囲の IP から送信された要求\)** : このオプションを選択するには、CIDR 表記を使用して、テキスト ボックスに IP アドレスを入力します。
      * xxx.xxx.xxx.1 から xxx.xxx.xxx.254 の範囲の IP アドレスの場合は、**xxx.xxx.xxx.0/24** などの表記を使用します。
      * 単一の IP アドレスの場合は、**xxx.xxx.xxx.xxx/32** などの表記を使用します。
      * 最大で 50 の IP アドレス範囲を入力します。 これらの IP アドレスからサインインしたユーザーは、多要素認証をバイパスします。

1. **[保存]** を選択します。

### <a name="enable-the-trusted-ips-feature-by-using-service-settings"></a>サービス設定を使用した信頼できる IP 機能の有効化

条件付きアクセスポリシーを使用して信頼できる IP を有効にしない場合は、次の手順を使用して、Azure AD Multi-Factor Authentication の *[サービス設定]* を構成できます。

1. Azure portal で、**Azure Active Directory** を検索して選択し、 **[ユーザー]** を選択します。
1. **[Multi-Factor Authentication]** を選択します。
1. [Multi-Factor Authentication] の下で **[サービス設定]** を選択します。
1. **[サービス設定]** ページの **[信頼できる IP]** で、次の 2 つのオプションのいずれか (または両方) を選択します。

   * **[For requests from federated users on my intranet]\(イントラネット内のフェデレーション ユーザーから送信された要求\)** :このオプションを選択するには、チェック ボックスをオンにします。 企業ネットワークからサインインするフェデレーション ユーザーは全員、AD FS によって発行されるクレームを使用して、多要素認証をバイパスします。 イントラネットの要求を適切なトラフィックに追加する規則が AD FS にあることを確認します。 規則が存在しない場合は、AD FS で次の規則を作成します。

      `c:[Type== "http://schemas.microsoft.com/ws/2012/01/insidecorporatenetwork"] => issue(claim = c);`

   * **[For requests from a specified range of IP address subnets]\(特定範囲の IP アドレスのサブネットから送信された要求\)** : このオプションを選択するには、CIDR 表記を使用して、テキスト ボックスに IP アドレスを入力します。
      * xxx.xxx.xxx.1 から xxx.xxx.xxx.254 の範囲の IP アドレスの場合は、**xxx.xxx.xxx.0/24** などの表記を使用します。
      * 単一の IP アドレスの場合は、**xxx.xxx.xxx.xxx/32** などの表記を使用します。
      * 最大で 50 の IP アドレス範囲を入力します。 これらの IP アドレスからサインインしたユーザーは、多要素認証をバイパスします。

1. **[保存]** を選択します。

## <a name="verification-methods"></a>検証方法

サービス設定ポータルでユーザーが使用できる検証方法を選択できます。 ユーザーは、自分のアカウントを Azure AD Multi-Factor Authentication 用に登録するときに、有効になっているオプションから使用する検証方法を選択します。 登録プロセスのガイダンスについては、[アカウントへの多要素認証の設定](https://support.microsoft.com/account-billing/how-to-use-the-microsoft-authenticator-app-9783c865-0308-42fb-a519-8cf666fe0acc)を参照してください。

次の検証方法を使用できます。

| Method | 説明 |
|:--- |:--- |
| 電話の呼び出し |自動音声通話を行います。 ユーザーは、呼び出しに応答し、電話のキーパッドの # を押して認証を行います。 電話番号は、オンプレミスの Active Directory には同期されません。 |
| 電話へのテキスト メッセージ |確認コードを含むテキスト メッセージを送信します。 ユーザーは、この確認コードをサインイン インターフェイスに入力するように求められます。 このプロセスを一方向の SMS といいます。 双方向の SMS は、ユーザーが特定のコードを返信する必要があることを意味します。 双方向の SMS は非推奨となり、2018 年 11 月 14 日以降はサポートされなくなります。 管理者は、以前に双方向の SMS を使用していたユーザーに対して別の方法を有効にする必要があります。|
| モバイル アプリでの通知 |電話または登録されたデバイスにプッシュ通知を送信します。 ユーザーは通知を表示し、 **[確認]** を選択して認証を完了します。 Microsoft Authenticator アプリは、[Windows Phone](https://www.microsoft.com/p/microsoft-authenticator/9nblgggzmcj6)、[Android](https://go.microsoft.com/fwlink/?Linkid=825072)、[IOS](https://go.microsoft.com/fwlink/?Linkid=825073) で利用できます。 |
| モバイル アプリからの確認コードまたはハードウェア トークン |Microsoft Authenticator アプリは、30 秒ごとに新しい OATH 確認コードを生成します。 ユーザーは確認コードをサインイン インターフェイスに入力します。 Microsoft Authenticator アプリは、[Windows Phone](https://www.microsoft.com/p/microsoft-authenticator/9nblgggzmcj6)、[Android](https://go.microsoft.com/fwlink/?Linkid=825072)、[IOS](https://go.microsoft.com/fwlink/?Linkid=825073) で利用できます。 |

詳細については、[Azure AD で使用できる認証方法と検証方法](concept-authentication-methods.md)に関する記事を参照してください。

### <a name="enable-and-disable-verification-methods"></a>検証方法を有効または無効にする

検証方法を有効または無効にするには、次の手順を実行します。

1. Azure portal で、**Azure Active Directory** を検索して選択し、 **[ユーザー]** を選択します。
1. **[Multi-Factor Authentication]** を選択します。
1. [Multi-Factor Authentication] の下で **[サービス設定]** を選択します。
1. **[サービスの設定]** ページの **[検証オプション]** で、ユーザーに提供する方法を選択/選択解除します。
1. **[保存]** をクリックします。

## <a name="remember-multi-factor-authentication"></a>Multi-Factor Authentication の記憶

_[Multi-Factor Authentication を記憶する]_ 機能を使用すると、ユーザーは、Multi-Factor Authentication を使用して正常にデバイスにサインインした後、一定の日数の間、以降の検証をバイパスすることができます。 使いやすさを向上させ、かつユーザーが同じデバイスに対して MFA を実行する必要がある回数を最小限に抑えるには、90 日以上の期間を選択します。

> [!IMPORTANT]
> アカウントまたはデバイスが侵害された場合、信頼済みデバイスに対する Multi-Factor Authentication の記憶はセキュリティに影響する可能性があります。 企業アカウントが侵害された場合や、信頼済みデバイスを紛失したり盗難に遭ったりした場合は、[MFA セッションを取り消す](howto-mfa-userdevicesettings.md)必要があります。
>
> 復元操作により、信頼された状態がすべてのデバイスから失われ、ユーザーは多要素認証を再度実行する必要があります。 [多要素認証設定の管理](https://support.microsoft.com/account-billing/change-your-two-step-verification-method-and-settings-c801d5ad-e0fc-4711-94d5-33ad5d4630f7#turn-on-two-factor-verification-prompts-on-a-trusted-device)に関する記事に記載されているように、各自のデバイスの Multi-Factor Authentication を復元するようユーザーに指示することもできます。

### <a name="how-the-feature-works"></a>機能のしくみ

Multi-Factor Authentication の記憶機能では、ブラウザーでユーザーがサインイン時に **[今後 X 日間はこのメッセージを表示しない]** オプションを選択したときに永続的な Cookie を設定します。 Cookie の有効期限が切れるまでは、同じブラウザーからユーザーが再度 Multi-Factor Authentication を求められることはありません。 そのユーザーが同じデバイスで異なるブラウザーを開くか、Cookie をクリアした場合は、再度、認証が求められます。

ブラウザーではないアプリケーションでは、アプリで先進認証がサポートされているかどうかに関係なく、 **[今後 X 日間はこのメッセージを表示しない]** オプションは表示されません。 これらのアプリでは、新しいアクセス トークンが 1 時間おきに支給される _更新トークン_ が使用されます。 更新トークンの検証時に、前回の多要素認証が設定されている日数内に実行されたことが Azure AD によって確認されます。

この機能を使用すると、Web アプリでの認証回数 (通常は毎回プロンプトが表示される) が減ります。 より短い期間が構成されている場合、この機能では、先進認証クライアントの認証の回数 (通常は 180 日ごとにプロンプトが表示される) が増える場合があります。 条件付きアクセス ポリシーと組み合わされた場合の認証数を増やすこともできます。

> [!IMPORTANT]
> ユーザーが Azure Multi-Factor Authentication Server またはサードパーティの多要素認証ソリューションを介して AD FS の多要素認証を行う場合、 **[Multi-Factor Authentication を記憶する]** 機能は、AD FS の **[サインインしたままにする]** 機能とは互換性がありません。
>
> ユーザーが AD FS の **[サインインしたままにする]** を選択し、さらに Multi-Factor Authentication に対してデバイスを信頼済みとしてマークした場合、**Multi-Factor Authentication を記憶する** 日数が過ぎるとユーザーは自動的に確認されません。 Azure AD によって、新たに多要素認証を行うように要求されても、AD FS によって多要素認証が再実行されるのでなく、元の Multi-Factor Authentication クレームおよび日付を含むトークンが返されます。 **その結果、Azure AD と AD FS との間で本人確認がループ状態に陥ります。**
>
> **Multi-Factor Authentication の記憶** 機能は、B2B ユーザーとは互換性がなく、招待されたテナントにサインインしても B2B ユーザーには表示されません。
>

### <a name="enable-remember-multi-factor-authentication"></a>Multi-Factor Authentication の記憶を有効にする

ユーザーが MFA の状態を記憶し、プロンプトをバイパスするオプションを有効にして構成するには、次の手順を実行します。

1. Azure portal で、**Azure Active Directory** を検索して選択し、 **[ユーザー]** を選択します。
1. **[Multi-Factor Authentication]** を選択します。
1. [Multi-Factor Authentication] の下で **[サービス設定]** を選択します。
1. **[サービス設定]** ページの **[Multi-Factor Authentication を記憶する]** で、 **[信頼済みデバイスでユーザーが多要素認証を記憶できるようにする]** オプションを選択します。
1. 信頼できるデバイスが多要素認証をバイパスできるようにする日数を設定します。 最適なユーザー エクスペリエンスを実現するには、期間を *90* 日以上に延長します。
1. **[保存]** を選択します。

### <a name="mark-a-device-as-trusted"></a>デバイスを信頼済みとマークする

[Multi-Factor Authentication を記憶する] 機能を有効にすると、ユーザーは、サインイン時に **[今後このメッセージを表示しない]** のオプションを選択することで、デバイスを信頼済みとしてマークできます。

## <a name="next-steps"></a>次のステップ

Azure AD Multi-Factor Authentication で使用できる方法の詳細については、「[Azure Active Directory で使用できる認証方法と検証方法](concept-authentication-methods.md)」を参照してください。