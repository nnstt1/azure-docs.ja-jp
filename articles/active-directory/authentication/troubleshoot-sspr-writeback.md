---
title: セルフサービス パスワード リセットの書き戻しをトラブルシューティングする - Azure Active Directory
description: Azure Active Directory でのセルフサービス パスワード リセットの書き戻しに関する一般的な問題をトラブルシューティングする方法と解決手順について説明します。
services: active-directory
ms.service: active-directory
ms.subservice: authentication
ms.topic: troubleshooting
ms.date: 08/25/2021
ms.author: justinha
author: justinha
manager: daveba
ms.reviewer: rhicock
ms.collection: M365-identity-device-management
ms.openlocfilehash: 8bdf8f914aaebff678d0d4e1a30823c18460f3d8
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2021
ms.locfileid: "131018302"
---
# <a name="troubleshoot-self-service-password-reset-writeback-in-azure-active-directory"></a>Azure Active Directory でのセルフサービス パスワード リセットの書き戻しをトラブルシューティングする

Azure Active Directory (Azure AD) のセルフサービス パスワード リセット (SSPR) を使用すると、ユーザーはクラウド内の自分のパスワードをリセットできます。 パスワード ライトバックは、[Azure AD Connect](../hybrid/whatis-hybrid-identity.md) で有効になっている機能で、クラウド内でのパスワード変更を既存のオンプレミスのディレクトリにリアルタイムで書き戻せるようにします。

SSPR の書き戻しで問題が発生した場合は、次のトラブルシューティング手順と一般的なエラーが役立つことがあります。 問題に対する回答が見つからない場合は、[Microsoft のサポート チームがいつでも](#contact-microsoft-support)問題の解決をお手伝いいたします。

## <a name="troubleshoot-connectivity"></a>接続のトラブルシューティング

Azure AD Connect のパスワード ライトバックで問題が発生した場合は、問題の解決に役立つ可能性のある次の手順を確認してください。 サービスを回復するには、次に示す手順に順番に従うことをお勧めします。

* [ネットワーク接続を確認する](#confirm-network-connectivity)
* [Azure AD Connect 同期サービスを再起動する](#restart-the-azure-ad-connect-sync-service)
* [パスワード ライトバック機能を無効にしてから再び有効にする](#disable-and-re-enable-the-password-writeback-feature)
* [最新の Azure AD Connect リリースをインストールする](#install-the-latest-azure-ad-connect-release)
* [パスワード ライトバックのトラブルシューティング](#common-password-writeback-errors)

### <a name="confirm-network-connectivity"></a>ネットワーク接続を確認する

最も一般的な障害点は、ファイアウォールまたはプロキシ ポート、あるいはアイドル タイムアウトが正しく構成されていないことです。

Azure AD Connect バージョン *1.1.443.0* 以降の場合は、次のアドレスへの *送信 HTTPS* アクセスが必要です。

* *\*.passwordreset.microsoftonline.com*
* *\*.servicebus.windows.net*

Azure [GOV エンドポイント](../../azure-government/compare-azure-government-global-azure.md#guidance-for-developers):

* *\*.passwordreset.microsoftonline.us*
* *\*.servicebus.usgovcloudapi.net*

より高い細分性が必要な場合は、[Microsoft Azure データセンターの IP 範囲の一覧](https://www.microsoft.com/download/details.aspx?id=41653)を参照してください。 この一覧は毎週水曜日に更新され、翌週の月曜日に有効になります。

環境内で URL とポートへのアクセスが制限されているかどうかを判断するには、次のコマンドレットを実行します。

```powershell
Test-NetConnection -ComputerName ssprdedicatedsbprodscu.servicebus.windows.net -Port 443
```

または以下を実行します。

```powershell
Invoke-WebRequest -Uri https://ssprdedicatedsbprodscu.servicebus.windows.net -Verbose
```

詳細については、[Azure AD Connect の接続の前提条件](../hybrid/how-to-connect-install-prerequisites.md)に関するページを参照してください。

### <a name="restart-the-azure-ad-connect-sync-service"></a>Azure AD Connect 同期サービスを再起動する

サービスでの接続の問題またはその他の一時的な問題を解決するには、次の手順を完了して Azure AD Connect 同期サービスを再起動します。

1. Azure AD Connect を実行するサーバーの管理者として、 **[開始]** を選択します。
1. 検索フィールドに「*services.msc*」を入力して、 **[入力]** を選択します。
1. *[Microsoft Azure AD Sync]* エントリを検索します。
1. このサービス エントリを右クリックして **[再起動]** を選択し、操作が完了するまで待ちます。

    :::image type="content" source="./media/troubleshoot-sspr-writeback/service-restart.png" alt-text="GUI を使用して Azure AD Sync サービスを再起動する" border="false":::

これらの手順によって Azure AD との接続が再確立され、接続の問題が解決されます。

Azure AD Connect 同期サービスを再起動しても問題が解決されない場合は、次のセクションでパスワード ライトバック機能を無効にしてから再び有効にしてみてください。

### <a name="disable-and-re-enable-the-password-writeback-feature"></a>パスワード ライトバック機能を無効にしてから再び有効にする

引き続き問題をトラブルシューティングするには、次の手順を完了して、パスワード ライトバック機能を無効にしてから再び有効にします。

1. Azure AD Connect を実行するサーバーの管理者として、**Azure AD Connect 構成ウィザード** を開きます。
1. **[Azure AD に接続]** で、Azure AD のグローバル管理者の資格情報を入力します。
1. **[AD DS に接続]** で、オンプレミス Active Directory Domain Services の管理者資格情報を入力します。
1. **[ユーザーを一意に識別]** で、 **[次へ]** を選択します。
1. **[オプション機能]** で、 **[パスワードの書き戻し]** チェック ボックスをオフにします。
1. 他のダイアログ ページは何も変更せずに、 **[構成の準備完了]** ページが表示されるまで **[次へ]** を選択します。
1. **[構成の準備完了] ページ** に *[パスワード ライトバック]* オプションが *[無効]* として表示されることを確認します。 緑色の **[構成]** ボタンを選択して変更をコミットします。
1. **[完了]** で、 **[今すぐ同期]** オプションをオフにし、 **[完了]** を選択してウィザードを閉じます。
1. **Azure AD Connect 構成ウィザード** を再度開きます。
1. 手順 2. ～ 8. を繰り返しますが、今度は **[オプション機能]** ページで *[パスワード ライトバック]* オプションをオンにしてサービスを再び有効にします。

これらの手順によって Azure AD との接続が再確立され、接続の問題が解決されます。

パスワード ライトバック機能を無効にしてから再び有効にしても問題が解決されない場合は、次のセクションで Azure AD Connect を再インストールします。

### <a name="install-the-latest-azure-ad-connect-release"></a>最新の Azure AD Connect リリースをインストールする

Azure AD Connect を再インストールすると、Azure AD とローカルの Active Directory Domain Services 環境の間の構成と接続の問題が解決される場合があります。 この手順は、接続を確認およびトラブルシューティングするために前の手順を試した後にのみ実行することをお勧めします。

> [!WARNING]
> 標準の同期規則をカスタマイズしている場合は、*アップグレードを続行する前にバックアップし、完了後にそれらを手動で再デプロイしてください。*

1. [Microsoft ダウンロード センター](https://go.microsoft.com/fwlink/?LinkId=615771)から最新バージョンの Azure AD Connect をダウンロードします。
1. Azure AD Connect が既にインストールされているため、インプレース アップグレードを実行して Azure AD Connect のインストールを最新バージョンに更新します。

    ダウンロードされたパッケージを実行し、画面の指示に従って Azure AD Connect を更新します。

これらの手順によって Azure AD との接続が再確立され、接続の問題が解決されます。

最新バージョンの Azure AD Connect サーバーをインストールしても問題が解決されない場合は、最新リリースをインストールした後に、最後の手順としてパスワード ライトバックを無効にしてから再び有効にしてみてください。

## <a name="verify-that-azure-ad-connect-has-the-required-permissions"></a>Azure AD Connect に必要なアクセス許可があることを確認する

パスワード ライトバックを実行するには、Azure AD Connect に AD DS の **[パスワードのリセット]** アクセス許可が必要です。 Azure AD Connect に特定のオンプレミスの AD DS ユーザー アカウントに対する必要なアクセス許可があるかどうかを確認するには、**Windows の有効なアクセス許可** 機能を使用します。

1. Azure AD Connect サーバーにサインインし、 **[開始]**  >  **[同期サービス]** の順に選択して、**Synchronization Service Manager** を開始します。
1. **[コネクタ]** タブで、オンプレミスの **[Active Directory Domain Services]** コネクタを選択してから、 **[プロパティ]** を選択します。

    :::image type="content" source="./media/troubleshoot-sspr-writeback/synchronization-service-manager.png" alt-text="プロパティの編集方法を示す Synchronization Service Manager" border="false":::
  
1. ポップアップ ウィンドウで **[Connect to Active Directory Forest]\(Active Directory フォレストに接続\)** を選択し、 **[ユーザー名]** のプロパティをメモします。 このプロパティは、ディレクトリ同期を実行するために、Azure AD Connect によって使用される AD DS アカウントです。

    Azure AD Connect でパスワード ライトバックを実行するために、AD DS アカウントにはパスワードのリセットのアクセス許可が必要です。 このユーザー アカウントに対するアクセス許可は、次の手順で確認します。

    :::image type="content" source="./media/troubleshoot-sspr-writeback/synchronization-service-manager-properties.png" alt-text="同期サービスの Active Directory ユーザー アカウントの検索" border="false":::
  
1. オンプレミスのドメイン コントローラーにサインインし、 **[Active Directory ユーザーとコンピューター]** アプリケーションを起動します。
1. **[表示]** を選択し、 **[高度な機能]** オプションが有効であることを確認します。  

    :::image type="content" source="./media/troubleshoot-sspr-writeback/view-advanced-features.png" alt-text="[Active Directory ユーザーとコンピューター] に [高度な機能] が表示される" border="false":::
  
1. 確認する AD DS ユーザー アカウントを探します。 アカウント名を右クリックし、 **[プロパティ]** を選択します。  
1. ポップアップ ウィンドウで、 **[セキュリティ]** タブに移動し、 **[詳細設定]** を選択します。  
1. **[Advanced Security Settings for Administrator]\(管理者のセキュリティの詳細設定\)** ポップアップ ウィンドウで、 **[有効なアクセス]** タブに移動します。
1. **[ユーザーの選択]** を選択し、Azure AD Connect によって使用される AD DS アカウントを選択してから、 **[有効なアクセス許可の表示]** を選択します。

    :::image type="content" source="./media/troubleshoot-sspr-writeback/view-effective-access.png" alt-text="同期アカウントを示す [有効なアクセス] タブ" border="false":::
  
1. 下にスクロールし、 **[パスワードのリセット]** を探します。 エントリにチェック マークがついている場合は、選択した Active Directory ユーザー アカウントのパスワードをリセットするアクセス許可が AD DS アカウントにあることを意味します。  

    :::image type="content" source="./media/troubleshoot-sspr-writeback/check-permissions.png" alt-text="同期アカウントにパスワードのリセット権限があることの検証" border="false":::

## <a name="common-password-writeback-errors"></a>パスワード ライトバックの一般的なエラー

パスワード ライトバックでは、次のより具体的な問題が発生する可能性があります。 これらのエラーのいずれかが発生した場合は、提案されている解決策を確認し、それによりパスワード ライトバックが正しく機能するかどうかを確認してください。

| エラー | 解決策 |
| --- | --- |
| オンプレミスでパスワード リセット サービスが開始されません。 Azure AD Connect マシンのアプリケーション イベント ログにエラー 6800 が表示されます。 <br> <br> フェデレーション、パススルー認証、またはパスワード ハッシュ同期されたユーザーは、オンボード後に自分のパスワードをリセットできません。 | パスワード ライトバックを有効にすると、同期エンジンはライトバック ライブラリを呼び出し、クラウド オンボード サービスと通信して構成 (オンボード) を実行します。 オンボード中またはパスワード ライトバックの Windows Communication Foundation (WCF) エンドポイントの起動中に発生したエラーは、Azure AD Connect マシンのイベント ログのエラーになります。 <br> <br> Azure AD Sync (ADSync) サービスの再起動時にライトバックが構成された場合は、WCF エンドポイントが起動します。 ただし、エンドポイントの起動に失敗した場合は、イベント 6800 をログに記録して同期サービスを起動させます。 このイベントの存在は、パスワード ライトバックのエンドポイントが起動しなかったことを示します。 このイベント 6800 のイベント ログ詳細では、PasswordResetService コンポーネントで生成されたイベント ログ エントリとともに、エンドポイントが起動できなかった理由が示されます。 パスワード ライトバックがまだ機能していない場合は、これらのイベント ログ エラーを確認し、Azure AD Connect を再起動してみてください。 問題が解決しない場合は、パスワード ライトバックを無効にしてから再び有効にしてみてください。
| パスワード ライトバックを有効にした状態でユーザーがアカウントのロック解除またはパスワードのリセットを試みると操作に失敗します。 <br> <br> また、Azure AD Connect のイベント ログを見ると、ロック解除操作が実行された後に "Synchronization Engine returned an error hr=800700CE, message=The filename or extension is too long (同期エンジンから hr=800700CE エラーと、ファイル名または拡張子が長すぎるというメッセージが返されました)" というイベントが記録されています。 | Azure AD Connect の Active Directory アカウントを探し、そのパスワードを 256 文字以内に収めてリセットします。 次に、 **[開始]** メニューから **[同期サービス]** を開きます。 **[コネクタ]** を表示し、 **[Active Directory Connector]\(Active Directory コネクタ\)** を探します。 これを選択してから、 **[プロパティ]** を選択します。 **[資格情報]** ページを表示して、新しいパスワードを入力します。 **[OK]** を選択してページを閉じます。 |
| Azure AD Connect インストール プロセスの最後の手順で、パスワード ライトバックを構成できなかったことを示すエラーが表示されます。 <br> <br> Azure AD Connect アプリケーションのイベント ログには、エラー 32009 とテキスト "Error getting auth token" (認証トークンの取得エラー) が含まれています。 | このエラーは、次の 2 つの場合に発生します。 <br><ul><li>Azure AD Connect のインストール プロセスの開始時に指定されたグローバル管理者アカウントに対して正しくないパスワードを指定した。</li><li>Azure AD Connect のインストール プロセスの開始時に指定されたグローバル管理者アカウントに対してフェデレーション ユーザーを使用しようとした。</li></ul> この問題を解決するには、インストール プロセスの開始時に指定したグローバル管理者に対してフェデレーション アカウントを使用していないこと、および指定したパスワードが正しいことを確認してください。 |
| Azure AD Connect マシンのイベント ログに、PasswordResetService の実行によってスローされたエラー 32002 が記録されています。 <br> <br> エラーの内容は次のとおりです。"Error Connecting to ServiceBus. The token provider was unable to provide a security token. (ServiceBus への接続中にエラーが発生しました。トークン プロバイダーはセキュリティ トークンを提供できませんでした。)" | ご利用のオンプレミス環境では、クラウドの Azure Service Bus エンドポイントに接続できません。 このエラーは、通常、特定のポートまたは Web のアドレスへの発信接続をブロックするファイアウォール規則が原因で発生します。 詳細については、[接続の前提条件](../hybrid/how-to-connect-install-prerequisites.md)に関する記事をご覧ください。 これらの規則を更新した後、Azure AD Connect サーバーを再起動すると、パスワード ライトバックが再び機能し始めます。 |
| フェデレーション、パススルー認証、またはパスワード ハッシュ同期されたユーザーは、しばらく操作した後に自分のパスワードをリセットできません。 | Azure AD Connect を再起動したときに、まれにパスワード ライトバック サービスの再起動に失敗することがあります。 これらの場合は、まず、パスワード ライトバックがオンプレミスで有効になっているかどうかを確認します。 Azure AD Connect ウィザードまたは PowerShell のどちらかを使用して確認できます。 この機能が有効であると表示されている場合は、この機能を再び有効または無効にしてみてください。 このトラブルシューティング手順が機能しない場合は、Azure AD Connect の完全なアンインストールと再インストールを試してください。 |
| 自分のパスワードのリセットを試みるフェデレーション、パススルー認証、またはパスワード ハッシュ同期されたユーザーには、パスワード送信後にエラーが表示されます。 このエラーは、サービスに問題があったことを示しています。 <br ><br> この問題に加えて、パスワードのリセット操作中に、管理エージェントがオンプレミスのイベント ログでアクセスを拒否されたというエラーが表示されることがあります。 | イベント ログにこのようなエラーが表示された場合は、構成時にウィザードで指定した Active Directory 管理エージェント (ADMA) アカウントに、パスワード ライトバックのために必要なアクセス許可があることを確認します。 <br> <br> このアクセス許可が付与された後、ドメイン コントローラー (DC) の `sdprop` バックグラウンド タスクを介して、アクセス許可が適用されるのに最大 1 時間かかることがあります。 <br> <br> パスワードのリセットが機能するには、パスワードがリセットされるユーザー オブジェクトのセキュリティ記述子に権限を設定する必要があります。 このアクセス許可がユーザー オブジェクトに表示されるまでは、引き続きアクセス拒否メッセージが表示されてパスワードのリセットが失敗します。 |
| 自分のパスワードのリセットを試みるフェデレーション、パススルー認証、またはパスワード ハッシュ同期されたユーザーには、パスワード送信後にエラーが表示されます。 このエラーは、サービスに問題があったことを示しています。 <br> <br> この問題に加えて、パスワードのリセット操作中、Azure AD Connect サービスからのイベント ログに、"Object could not be found (オブジェクトが見つかりませんでした)" というエラーを示すエラーが表示されることがあります。 | このエラーは通常、Azure AD コネクタ スペース内またはリンクされたメタバース (MV) 内のユーザー オブジェクトか、Azure AD コネクタ スペース オブジェクトのいずれかを、同期エンジンが検索できないことを示しています。 <br> <br> この問題をトラブルシューティングするには、Azure AD Connect の現在のインスタンスを介してオンプレミスから Azure AD にユーザーが実際に同期されていることを確認し、コネクタ スペースと MV 内のオブジェクトの状態を検査します。 Active Directory 証明書サービス (AD CS) オブジェクトが "Microsoft.InfromADUserAccountEnabled.xxx" 規則によって MV オブジェクトに接続されていることを確認してください。|
| 自分のパスワードのリセットを試みるフェデレーション、パススルー認証、またはパスワード ハッシュ同期されたユーザーには、パスワード送信後にエラーが表示されます。 このエラーは、サービスに問題があったことを示しています。 <br> <br> この問題に加えて、パスワードのリセット操作中、Azure AD Connect サービスからのイベント ログに、"Multiple matches found (複数の一致が見つかりました)" というエラーが発生したことを示すエラーが表示されることがあります。 | これは、MV オブジェクトが "Microsoft.InfromADUserAccountEnabled.xxx" によって複数の AD CS オブジェクトに接続されていることを同期エンジンが検出したことを示します。 これは、ユーザーが複数のフォレストに有効なアカウントを持っていることを意味します。 このシナリオでは、パスワード ライトバックがサポートされません。 |
| パスワード操作は構成エラーにより失敗しました アプリケーション イベント ログには、Azure AD Connect エラー 6329 と、テキスト "0x8023061f (この管理エージェントではパスワード同期が無効になっているため操作に失敗しました)" が記録されています。 | このエラーは、パスワード ライトバック機能を有効にした後、新しい Active Directory フォレストを追加する (または既存のフォレストを削除して再度追加する) ために、 Azure AD Connect の構成が変更された場合に発生します。 このような最近追加されたフォレスト内のユーザーのパスワード操作は失敗します。 問題を解決するには、フォレスト構成の変更が完了した後に、パスワード ライトバック機能を無効にしてから再び有効にします。
| SSPR_0029: オンプレミス構成でのエラーのため、パスワードをリセットすることができません。 管理者に連絡して、調査するように依頼してください。 | 問題: パスワード ライトバックが必要なすべての手順に従って有効になっていますが、パスワードを変更しようとすると、"SSPR_0029: Your organization hasn’t properly set up the on-premises configuration for password reset" (組織でパスワードのリセットのためのオンプレミスの構成が正しく設定されていません) というメッセージが表示されます。 Azure AD Connect システムのイベント ログを調べると、管理エージェントの資格情報がアクセスを拒否されたことが示されています。考えられる解決方法: Azure AD Connect システムとドメイン コントローラーで RSOP を使用して、[コンピューターの構成] > [Windows の設定] > [セキュリティ設定] > [ローカル ポリシー] > [セキュリティ オプション] の下にある "ネットワーク アクセス - SAM をリモート呼び出しできるクライアントを制限します" ポリシーが有効になっているか調べます。 このポリシーを編集して MSOL_XXXXXXX 管理アカウントを許可されたユーザーとして含めます。 |

## <a name="password-writeback-event-log-error-codes"></a>パスワード ライトバックのイベント ログのエラー コード

パスワード ライトバックに関する問題をトラブルシューティングする場合のベスト プラクティスは、Azure AD Connect マシンでそのアプリケーション イベント ログを検査することです。 このイベント ログには、パスワード ライトバックの 2 つのソースからのイベントが含まれます。 *PasswordResetService* ソースは、パスワード ライトバックの操作に関連した操作と問題を記述します。 *ADSync* ソースは、Active Directory Domain Services 環境でのパスワードの設定に関連した操作と問題を記述します。

### <a name="if-the-source-of-the-event-is-adsync"></a>イベントのソースが ADSync の場合

| コード | 名前またはメッセージ | 説明 |
| --- | --- | --- |
| 6329 | BAIL: MMS(4924) 0x80230619: "A restriction prevents the password from being changed to the current one specified. (制限によりパスワードを現在指定されているパスワードに変更することができません。)" | このイベントは、パスワード ライトバック サービスが、ドメインのパスワードの有効期間、履歴、複雑さ、またはフィルター処理の要件を満たしていないローカル ディレクトリにパスワードを設定しようとした場合に発生します。 <br> <br> パスワードの最小有効期間が残っていて、最近その期間内にパスワードを変更した場合は、そのドメインで指定された期限に達するまで、もう一度パスワードを変更することはできません。 テストのために、最小有効期間は 0 に設定する必要があります。 <br> <br> パスワードの履歴の要件が有効になっている場合は、過去 *N* 回で使用されていないパスワードを選択する必要があります。ここで、*N* はパスワードの履歴の設定です。 最後の *N* 回で使用されているパスワードを選択した場合は、エラーが表示されます。 テストのために、パスワードの履歴は 0 に設定する必要があります。 <br> <br> パスワードの複雑さの要件を指定する場合は、ユーザーがパスワードを変更またはリセットしようとすると、すべての要件が適用されます。 <br> <br> パスワード フィルターが有効になっているときに、ユーザーがフィルター条件を満たしていないパスワードを選択した場合、リセットまたは変更操作は失敗します。 |
| 6329 | MMS(3040): admaexport.cpp(2837): サーバーに LDAP のパスワード ポリシー コントロールが含まれていません。 | この問題は、DC で LDAP_SERVER_POLICY_HINTS_OID コントロール (1.2.840.113556.1.4.2066) が有効になっていない場合に発生します。 パスワード ライトバック機能を使用するのには、コントロールを有効にする必要があります。 これを行うには、DC が Windows Server 2008R2 以降にインストールされている必要があります。 |
| HR 8023042 | 同期エンジンから hr=80230402 エラーと、"同じアンカーに重複するエントリがあるためオブジェクトの取得に失敗しました" というメッセージが返されました。 | このエラーは、複数のドメインで同じユーザー ID を有効にした場合に発生します。 たとえば、アカウントとリソース フォレストを同期したときに、各フォレスト内に同じユーザー ID が存在し、どちらも有効な場合です。 <br> <br> また、一意ではないアンカー属性 (エイリアスや UPN) を使用し、2 人のユーザーがその同じアンカー属性を共有している場合にも、このエラーが発生します。 <br> <br> この問題を解決するには、ドメイン内に重複するユーザーがいないようにして、各ユーザーに一意のアンカー属性を使用します。 |

### <a name="if-the-source-of-the-event-is-passwordresetservice"></a>イベントのソースが PasswordResetService の場合

| コード | 名前またはメッセージ | 説明 |
| --- | --- | --- |
| 31001 | PasswordResetStart | このイベントは、オンプレミスのサービスが、クラウドから送信されたフェデレーション、パススルー認証、またはパスワード ハッシュ同期されたユーザーへのパスワードのリセット要求を検出したことを示します。 このイベントは、すべてのパスワード リセットのライトバック操作における最初のイベントです。 |
| 31002 | PasswordResetSuccess | このイベントは、パスワードのリセット操作中に、ユーザーが新しいパスワードを選択したことを示します。 このパスワードが企業のパスワード要件を満たしていると判断されました。 パスワードがローカルの Active Directory 環境に正常にライトバックされました。 |
| 31003 | PasswordResetFail | このイベントは、ユーザーがパスワードを選択し、そのパスワードが正しくオンプレミス環境に届いたことを示します。 しかし、ローカルの Active Directory 環境でパスワードの設定を試みたときに、エラーが発生しました。 このエラーは次のことが原因で発生する場合があります。 <br><ul><li>ユーザーのパスワードがドメインの有効期間、履歴、複雑さ、またはフィルターの要件を満たしていない。 この問題を解決するには、新しいパスワードを作成します。</li><li>ADMA サービス アカウントに、対象のユーザー アカウントに新しいパスワードを設定するための適切なアクセス許可がない。</li><li>ユーザーのアカウントが、パスワードの設定操作が禁止されている保護されたグループ (ドメインまたはエンタープライズ管理者グループなど) に含まれている。</li></ul>|
| 31004 | OnboardingEventStart | このイベントは、Azure AD Connect でのパスワード ライトバックが有効になっているときに、パスワード ライトバック Web サービスへの組織のオンボードが開始された場合に発生します。 |
| 31005 | OnboardingEventSuccess | このイベントは、オンボード プロセスが成功し、パスワード ライトバック機能を使用する準備が整ったことを示します。 |
| 31006 | ChangePasswordStart | このイベントは、オンプレミスのサービスが、クラウドから送信されたフェデレーション、パススルー認証、またはパスワード ハッシュ同期されたユーザーへのパスワード変更要求を検出したことを示します。 このイベントは、すべてのパスワード変更のライトバック操作における最初のイベントです。 |
| 31007 | ChangePasswordSuccess | このイベントは、ユーザーがパスワードの変更操作中に新しいパスワードを選択したこと、このパスワードが企業のパスワード要件を満たしていると判断されたこと、およびローカルの Active Directory 環境に正常にライトバックされたことを示します。 |
| 31008 | ChangePasswordFail | このイベントは、ユーザーがパスワードを選択し、そのパスワードがオンプレミス環境に正常に届いたものの、ローカルの Active Directory 環境でパスワードを設定しようとしたところエラーが発生したことを示します。 このエラーは次のことが原因で発生する場合があります。 <br><ul><li>ユーザーのパスワードがドメインの有効期間、履歴、複雑さ、またはフィルターの要件を満たしていない。 この問題を解決するには、新しいパスワードを作成します。</li><li>ADMA サービス アカウントに、対象のユーザー アカウントに新しいパスワードを設定するための適切なアクセス許可がない。</li><li>ユーザーのアカウントが、パスワードの設定操作が禁止されている保護されたグループ (ドメインまたはエンタープライズ管理者など) に含まれている。</li></ul> |
| 31009 | ResetUserPasswordByAdminStart | オンプレミスのサービスが、ユーザーに代わって管理者から送信された、フェデレーション、パススルー認証、またはパスワード ハッシュ同期されたユーザーへのパスワードのリセット要求を検出しました。 このイベントは、管理者が開始したパスワードのリセットのライトバック操作における最初のイベントです。 |
| 31010 | ResetUserPasswordByAdminSuccess | 管理者が開始したパスワードのリセット操作中に、管理者が新しいパスワードを選択しました。 このパスワードが企業のパスワード要件を満たしていると判断されました。 パスワードがローカルの Active Directory 環境に正常にライトバックされました。 |
| 31011 | ResetUserPasswordByAdminFail | 管理者がユーザーの代わりにパスワードを選択しました。 パスワードが正常にオンプレミス環境に到着しました。 しかし、ローカルの Active Directory 環境でパスワードの設定を試みたときに、エラーが発生しました。 このエラーは次のことが原因で発生する場合があります。 <br><ul><li>ユーザーのパスワードがドメインの有効期間、履歴、複雑さ、またはフィルターの要件を満たしていない。 この問題を解決するには、新しいパスワードを試します。</li><li>ADMA サービス アカウントに、対象のユーザー アカウントに新しいパスワードを設定するための適切なアクセス許可がない。</li><li>ユーザーのアカウントが、パスワードの設定操作が禁止されている保護されたグループ (ドメインまたはエンタープライズ管理者など) に含まれている。</li></ul>  |
| 31012 | OffboardingEventStart | このイベントは、Azure AD Connect でパスワード ライトバックが無効になっている場合に発生し、組織がパスワード ライトバック Web サービスのオフボードを開始したことを示します。 |
| 31013| OffboardingEventSuccess| このイベントは、オフボード プロセスに成功し、パスワード ライトバック機能が正常に無効になったことを示します。 |
| 31014| OffboardingEventFail| このイベントは、オフボード プロセスが失敗したことを示します。 これは、構成時に指定したクラウドまたはオンプレミスの管理者アカウント上で起こったアクセス許可のエラーが原因である可能性があります。 また、このエラーは、パスワード ライトバックを無効にしているときにフェデレーション クラウド グローバル管理者の使用を試みた場合にも、発生することがあります。 この問題を解決するには、管理者のアクセス許可を確認し、パスワード ライトバック機能を構成する場合にフェデレーション アカウントを使用していないことを確認します。|
| 31015| WriteBackServiceStarted| このイベントは、パスワード ライトバック サービスが正常に開始したことを示します。 クラウドからのパスワード管理要求を受け入れる準備ができています。|
| 31016| WriteBackServiceStopped| このイベントは、パスワード ライトバック サービスが停止したことを示します。 クラウドからのパスワード管理要求はすべて失敗します。|
| 31017| AuthTokenSuccess| このイベントは、オフボードまたはオンボード プロセスを開始するために、Azure AD Connect のセットアップ時に指定されたグローバル管理者の承認トークンを正常に取得したことを示します。|
| 31018| KeyPairCreationSuccess| このイベントは、パスワード暗号化キーが正常に作成されたことを示します。 このキーは、クラウドからのパスワードを暗号化してご利用のオンプレミス環境に送信するために使用されます。|
| 31034| ServiceBusListenerError| このイベントは、テナントの Service Bus リスナーへの接続中にエラーが発生したことを示します。 エラー メッセージに "リモート証明書が無効です" と表示される場合は、「[Azure TLS 証明書の変更](../../security/fundamentals/tls-certificate-changes.md)」で説明されているように、すべての必要なルート CA が Azure AD Connect サーバーに存在していることを確認してください。 |
| 31044| PasswordResetService| このイベントは、パスワード ライトバックが機能していないことを示します。 Service Bus は、冗長性を確保するために 2 つの異なるリレーで要求をリッスンします。 それぞれのリレー接続は、独自のサービス ホストによって管理されます。 どちらかのサービス ホストが実行されていない場合、ライトバック クライアントからエラーが返されます。|
| 32000| UnknownError| このイベントは、パスワード管理操作中に発生した原因不明のエラーを示します。 詳細については、イベントの例外の説明をご覧ください。 問題が発生した場合は、パスワード ライトバックを無効にしてから再び有効にしてみてください。 これで解決されない場合は、サポート リクエストを開いたときに指定される追跡 ID と共にイベント ログのコピーを含めてください。|
| 32001| ServiceError| このイベントは、クラウド パスワード リセット サービスへの接続中にエラーが発生したことを示します。 このエラーは通常、オンプレミスのサービスがパスワード リセット Web サービスに接続できない場合に発生します。|
| 32002| ServiceBusError| このイベントは、テナントの Service Bus インスタンスへの接続中にエラーが発生したことを示します。 これは、オンプレミス環境で発信接続をブロックしている場合に発生する可能性があります。 ファイアウォールで TCP 443 経由の https://ssprdedicatedsbprodncu.servicebus.windows.net への接続が許可されていることを確認してから、やり直してください。 問題が解決しない場合は、パスワード ライトバックを無効にしてから再び有効にしてみてください。|
| 32003| InPutValidationError| このイベントは、Web サービス API に渡された入力が無効だったことを示します。 操作をやり直してください。|
| 32004| DecryptionError| このイベントは、クラウドから受信したパスワードの解読中にエラーが発生したことを示します。 これは、クラウド サービスとオンプレミス環境との間で暗号化の解除キーが一致しないことが原因である可能性があります。 この問題を解決するには、オンプレミス環境でパスワード ライトバックを無効にしてから再び有効にします。|
| 32005| ConfigurationError| オンボード中に、オンプレミスの環境内の構成ファイルにテナント固有の情報を保存します。 このイベントは、このファイルの保存中にエラーが発生した、またはサービスの開始時にファイルの読み取りエラーが発生したことを示します。 この問題を解決するには、この構成ファイルを強制的に書き換えるためにパスワード ライトバックを無効にしてから再び有効にしてみてください。|
| 32007| OnBoardingConfigUpdateError| オンボード中に、クラウドからオンプレミスのパスワードのリセット サービスにデータを送信します。 そのデータは、同期サービスに送信される前にメモリ内のファイルに書き込まれ、ディスク上に安全に保存されます。 このイベントは、メモリ内でのそのデータの書き込みまたは更新に問題があることを示します。 この問題を解決するには、この構成ファイルを強制的に書き換えるためにパスワード ライトバックを無効にしてから再び有効にしてみてください。|
| 32008| ValidationError| このイベントは、パスワード リセット Web サービスから無効な応答を受け取ったことを示します。 この問題を解決するには、パスワード ライトバックを無効にしてから再び有効にしてみてください。|
| 32009| AuthTokenError| このイベントは、Azure AD Connect のセットアップ時に指定されたグローバル管理者アカウントの承認トークンを取得できなかったことを示します。 このエラーは、グローバル管理者アカウントに指定された無効なユーザー名またはパスワードが原因である可能性があります。 また、指定されたグローバル管理者アカウントがフェデレーションされているために発生している可能性もあります。 この問題を解決するには、適切なユーザー名とパスワードを使用して構成を再実行し、管理者が管理 (クラウドのみまたはパスワード同期された) アカウントになっていることを確認します。|
| 32010| CryptoError| このイベントは、パスワード暗号化キーの生成中、またはクラウド サービスから受信するパスワードの暗号化の解除中にエラーが発生したことを示します。 このエラーは、ご利用の環境に問題がある可能性を示しています。 この問題の解決方法の詳細については、イベント ログの詳細を確認します。 また、パスワード ライトバック サービスを無効にしてから再び有効にすると解決できる場合もあります。|
| 32011| OnBoardingServiceError| このイベントは、オンプレミスのサービスが、オンボード プロセスを開始しようとしてパスワード リセット Web サービスと正しく通信できなかったことを示します。 これは、ファイアウォール規則の結果として、またはテナントの認証トークンの取得中に問題が生じた場合に発生することがあります。 この問題を解決するには、TCP 443 と TCP 9350-9354 経由の発信接続、または https://ssprdedicatedsbprodncu.servicebus.windows.net への接続がブロックされていないことを確認します。 また、オンボードに使用している Azure AD 管理者アカウントがフェデレーションされていないことも確認します。|
| 32013| OffBoardingError| このイベントは、オンプレミスのサービスが、オフボード プロセスを開始しようとしてパスワード リセット Web サービスと正しく通信できなかったことを示します。 これは、ファイアウォール規則の結果として、またはテナントの承認トークンの取得中に問題が生じた場合に発生することがあります。 この問題を解決するには、TCP 443 経由の発信接続、または https://ssprdedicatedsbprodncu.servicebus.windows.net への接続がブロックされていないことと、オフボードに使用している Azure Active Directory 管理者アカウントがフェデレーションされていないことを確認します。|
| 32014| ServiceBusWarning| このイベントは、テナントの Service Bus インスタンスへの接続を再試行する必要があったことを示します。 通常の状況ではこれは問題になりませんが、このイベントが何度も表示される場合、特に、それが待機時間の長い接続または低帯域幅の接続である場合は、Service Bus へのネットワーク接続を確認することを検討してください。|
| 32015| ReportServiceHealthError| パスワード ライトバック サービスの正常性を監視するには、パスワード リセット Web サービスに 5 分ごとにハートビート データを送信します。 このイベントは、この正常性情報をクラウド Web サービスに送信するときにエラーが発生したことを示します。 この正常性情報に個人データは含まれず、クラウド内のサービスの状態情報を提供できるように、純粋にハートビートと基本的なサービス統計情報で構成されています。|
| 33001| ADUnKnownError| このイベントは、Active Directory から不明なエラーが返されたことを示します。 Azure AD Connect サーバーのイベント ログで、ADSync ソースからのイベントの詳細を確認します。|
| 33002| ADUserNotFoundError| このイベントは、パスワードをリセットまたは変更しようとするユーザーがオンプレミスのディレクトリに見つからなかったことを示します。 このエラーは、ユーザーがクラウドではなくオンプレミスで削除された場合に発生する可能性があります。 このエラーはまた、同期に問題がある場合にも発生することがあります。同期ログと、最近のいくつかの同期実行に関する詳細情報を確認します。|
| 33003| ADMutliMatchError| パスワードのリセットまたは変更要求がクラウドから送信されると、Azure AD Connect のセットアップ プロセス中に指定されたクラウドのアンカーを使用して、その要求をオンプレミスの環境内のユーザーにリンクする方法を決定します。 このイベントは、オンプレミスのディレクトリ内に同じクラウドのアンカー属性を持つユーザーが 2 人見つかったことを示します。 同期ログと、最近のいくつかの同期実行に関する詳細情報を確認します。|
| 33004| ADPermissionsError| このイベントは、Active Directory 管理エージェント (ADMA) サービス アカウントに、新しいパスワードを設定するための対象のアカウントに対する適切なアクセス許可がないことを示します。 ユーザーのフォレスト内の ADMA アカウントに、フォレスト内のすべてのオブジェクトに対する [パスワードのリセット] アクセス許可があることを確認してください。 アクセス許可を設定する方法の詳細については、「Step 4: Set up the appropriate Active Directory permissions (手順 4: Active Directory の適切なアクセス許可を設定する)」をご覧ください。 このエラーは、ユーザーの属性 AdminCount が 1 に設定されている場合にも発生する可能性があります。|
| 33005| ADUserAccountDisabled| このイベントは、オンプレミスで無効になっていたアカウントのパスワードをリセットまたは変更しようとしたことを示します。 アカウントを有効にして、操作をやり直してください。|
| 33006| ADUserAccountLockedOut| このイベントは、オンプレミスでロックアウトされたアカウントのパスワードをリセットまたは変更しようとしたことを示します。 ロックアウトは、ユーザーが短時間に何回もパスワードを変更またはリセットしようとした場合に発生します。 アカウントのロックを解除して、操作をやり直してください。|
| 33007| ADUserIncorrectPassword| このイベントは、ユーザーがパスワードの変更操作を行うときに、現在のパスワードを正しく指定しなかったことを示します。 現在の正しいパスワードを指定して、やり直してください。|
| 33008| ADPasswordPolicyError| このイベントは、パスワード ライトバック サービスが、ドメインのパスワードの有効期間、履歴、複雑さ、またはフィルター処理の要件を満たしていないローカル ディレクトリにパスワードを設定しようとした場合に発生します。 <br> <br> パスワードの最小有効期間が残っていて、最近その期間内にパスワードを変更した場合は、そのドメインで指定された期限に達するまで、もう一度パスワードを変更することはできません。 テストのために、最小有効期間は 0 に設定する必要があります。 <br> <br> パスワードの履歴の要件が有効になっている場合は、最後の *N* 回で使用されていないパスワードを選択する必要があります。*N* はパスワードの履歴で設定します。 最後の *N* 回で使用されているパスワードを選択した場合は、エラーが表示されます。 テストのために、パスワードの履歴は 0 に設定する必要があります。 <br> <br> パスワードの複雑さの要件を指定する場合は、ユーザーがパスワードを変更またはリセットしようとすると、すべての要件が適用されます。 <br> <br> パスワード フィルターが有効になっているときに、ユーザーがフィルター条件を満たしていないパスワードを選択した場合、リセットまたは変更操作は失敗します。|
| 33009| ADConfigurationError| このイベントは、Active Directory の構成に問題があるため、オンプレミスのディレクトリへのパスワード書き込みエラーが発生したことを示します。 どのエラーが発生したかに関する詳細については、Azure AD Connect マシンのアプリケーション イベント ログに ADSync サービスからのメッセージがないかどうかを確認してください。|

## <a name="azure-ad-forums"></a>Azure AD フォーラム

Azure AD やセルフサービス パスワード リセットに関する一般的な質問がある場合は、[Azure Active Directory に関する Microsoft Q&A 質問ページ](/answers/topics/azure-active-directory.html)でコミュニティに支援を求めることができます。 コミュニティのメンバーには、エンジニア、製品マネージャー、MVP、IT プロフェッショナルなどが含まれます。

## <a name="contact-microsoft-support"></a>Microsoft サポートに問い合わせる

問題に対する回答が見つからない場合は、Microsoft のサポート チームが随時、問題の解決をお手伝いします。

適切なサポートを提供するため、ケースをオープンする際はできるだけ詳しい情報のご提供をお願いいたします。 これらの詳細には、次の内容が含まれています。

* **エラーの一般的な説明**: どのようなエラーですか。 どのような動作が見られましたか。 エラーを再現することはできますか。 できるだけ詳しくお知らせください。
* **ページ**: エラーが表示されたときに、どのページを表示していましたか。 可能な場合はそのページの URL とスクリーンショットをお送りください。
* **サポート コード**: エラーが表示されたときに生成されたサポート コードをお知らせください。
   * このコードを見つけるには、エラーを再現してから、画面の下部にある **サポート コード** のリンクを選択し、生成された GUID をサポート エンジニアに送信します。

    :::image type="content" source="./media/troubleshoot-sspr-writeback/view-support-code.png" alt-text="サポート コードは、Web ブラウザー ウィンドウの右下にあります。":::

  * ページの下部にサポート コードが表示されない場合は、F12 キーを押して SID と CID を検索し、この 2 つの結果をサポート エンジニアに送信します。
* **日付、時刻、タイム ゾーン**: エラーが発生した正確な日付、時刻、"*タイム ゾーン*" をお知らせください。
* **ユーザー ID**: エラーが表示されたユーザーをお知らせください。 たとえば、*user\@contoso.com* です。
   * このユーザーは、フェデレーション ユーザーですか。
   * このユーザーは、パススルー認証ユーザーですか。
   * このユーザーは、パスワード ハッシュ同期ユーザーですか。
   * このユーザーは、クラウド限定ユーザーですか。
* **ライセンス**: ユーザーに Azure AD のライセンスが割り当てられていますか。
* **アプリケーション イベント ログ**: パスワード ライトバックの使用中に、ご利用のオンプレミスのインフラストラクチャでエラーが発生した場合は、Azure AD Connect サーバーからのアプリケーション イベント ログのコピーを圧縮してお送りください。

## <a name="next-steps"></a>次の手順

SSPR の詳細については、「[Azure AD のセルフサービス パスワード リセットのしくみ](concept-sspr-howitworks.md)」または「[Azure Active Directory でのセルフサービス パスワード リセットによる書き戻しのしくみ](concept-sspr-writeback.md)」を参照してください。
