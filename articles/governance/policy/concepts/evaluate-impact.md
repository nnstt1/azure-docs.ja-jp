---
title: 新しい Azure ポリシー定義の影響を評価する
description: Azure 環境に新しいポリシー定義を導入するときの手順について説明します。
ms.date: 08/17/2021
ms.topic: conceptual
ms.openlocfilehash: 25e59423e8102d62130339a39e5dc520e6b7d8c4
ms.sourcegitcommit: 5f659d2a9abb92f178103146b38257c864bc8c31
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/17/2021
ms.locfileid: "122324839"
---
# <a name="evaluate-the-impact-of-a-new-azure-policy-definition"></a>新しい Azure ポリシー定義の影響を評価する

Azure Policy は、Azure リソースをビジネス標準に合わせて管理し、コンプライアンス ニーズに対応するための強力なツールです。 ユーザー、プロセス、またはパイプラインによってリソースが作成または更新されるときに、Azure Policy によって要求が確認されます。 ポリシー定義の効果が [Modify](./effects.md#modify)、[Append](./effects.md#deny)、または [DeployIfNotExists](./effects.md#deployifnotexists) の場合は、ポリシーによって要求が変更されるか、または追加されます。 ポリシー定義の効果が [Audit](./effects.md#audit) または [AuditIfNotExists](./effects.md#auditifnotexists) の場合は、ポリシーによって、新規および更新されたリソースに対してアクティビティ ログ エントリが作成されます。 また、ポリシー定義の効果が [Deny](./effects.md#deny) の場合は、ポリシーによって要求の作成または変更が停止されます。

これらの結果は、ポリシーが正しく定義されていることがわかっている場合にのみ必要です。 ただし、新しいポリシーによって作業が変更されたりブロックされたりする前に、ポリシーが意図したとおりに動作することを検証することが重要です。 検証では、意図したリソースのみが非準拠であると判断され、準拠しているリソースが誤って結果に含まれないことを確認する必要があります ("_擬陽性_" と呼ばれます)。

新しいポリシー定義を検証するには、次の手順を実行することをお勧めします。

- ポリシーを厳密に定義する
- 既存のリソースを監査する
- 新規または更新されたリソース要求を監査する
- ポリシーをリソースに展開する
- 継続的な監視

## <a name="tightly-define-your-policy"></a>ポリシーを厳密に定義する

ビジネス ポリシーがポリシー定義として実装される方法、および Azure リソースと他の Azure サービスとの関係を、理解することが重要です。 このステップでは、[要件を明らかにし](../tutorials/create-custom-policy-definition.md#identify-requirements)、[リソースのプロパティを決定](../tutorials/create-custom-policy-definition.md#determine-resource-properties)します。
ただし、ビジネス ポリシーの狭い定義を超えて視野を広くすることも重要です。 たとえば、ポリシーでは "すべての仮想マシンは ... でなければならない" と指定されていますか。 HDInsight や AKS など、VM を利用する他の Azure サービスについてはどうでしょうか。 ポリシーを定義するときは、このポリシーが他のサービスで使用されているリソースにどのように影響するかを考慮する必要があります。

このため、ポリシー定義は、可能な限り厳密に定義し、準拠を評価する必要があるリソースとプロパティに対象を絞る必要があります。

## <a name="audit-existing-resources"></a>既存のリソースを監査する

新しいポリシー定義で新しいリソースまたは更新されたリソースを管理する前に、テスト リソース グループなど、既存リソースの限られたサブセットがどのように評価されるか確認することをお勧めします。 ポリシー割り当てに対して [適用モード](./assignment-structure.md#enforcement-mode) "_無効_" (DoNotEnforce) を使用して、[効果](./effects.md)がトリガーされたり、アクティビティ ログ エントリが作成されたりしないようにします。

このステップでは、ワークフローに影響を与えずに、既存のリソースに対する新しいポリシーのコンプライアンス結果を評価することができます。 準拠しているリソースが非準拠としてマークされないこと ("_擬陽性_")、非準拠と想定されるすべてのリソースが正しくマークされることを確認します。
リソースの最初のサブセットが想定どおりに検証された後、評価をすべての既存リソースに徐々に拡大します。

この方法で既存のリソースを評価することで、新しいポリシーを完全に実装する前に、非準拠リソースを修復することもできます。 このクリーンアップは、手動で行うことも、ポリシー定義の効果が _DeployIfNotExists_ である場合は [修復タスク](../how-to/remediate-resources.md)で行うこともできます。

## <a name="audit-new-or-updated-resources"></a>新規または更新されたリソースを監査する

既存リソースが新しいポリシー定義によって正しくレポートされることを検証したら、次に、リソースが作成または更新されたときのポリシーの影響を確認します。 ポリシー定義で効果のパラメーター化がサポートされている場合は、[Audit](./effects.md#audit) を使用します。 この構成を使用すると、リソースの作成と更新を監視して、非準拠リソースに対する Azure アクティビティ ログのエントリが新しいポリシー定義によってトリガーされ、既存の作業または要求に影響がないことを確認できます。

ポリシー定義に一致するリソースの更新と新規作成の両方を行って、_Audit_ 効果が想定どおりに正しくトリガーされるのを確認することをお勧めします。 _Audit_ 効果をトリガーする新しいポリシー定義によって影響を受けてはならないリソース要求に注意してください。
このような影響を受けるリソースは _擬陽性_ のもう 1 つの例であり、完全に実装する前にポリシー定義で修正する必要があります。

このテスト ステージでポリシー定義を変更した場合は、既存リソースの監査から検証プロセスをやり直すことをお勧めします。 新規リソースまたは更新リソースの "_擬陽性_" に対してポリシー定義を変更すると、既存のリソースにも影響する可能性があります。

## <a name="deploy-your-policy-to-resources"></a>ポリシーをリソースに展開する

既存リソースと新規または更新リソースの要求の両方で新しいポリシー定義の検証が完了したら、ポリシーの実装プロセスを始めます。 最初は、すべてのリソースのサブセット (リソース グループなど) に対して、新しいポリシー定義のポリシー割り当てを作成することをお勧めします。 初期展開を検証した後、サブスクリプションや管理グループなど、ポリシーの範囲を少しずつ広いレベルに拡大します。 この拡張を実現するには、割り当てを削除してから新しい割り当てを作成する作業を、新しいポリシー定義の対象となるリソースの範囲全体に割り当てられるまで続けます。

ロールアウトの間に、新しいポリシー定義から除外する必要があるリソースが見つかった場合は、次のいずれかの方法で対処します。

- 意図しない影響が経るように、ポリシー定義をより明示的に更新します
- ポリシー割り当ての範囲を変更します (割り当てを削除して新しい割り当てを作成します)
- ポリシー割り当ての除外リストにリソースのグループを追加します

範囲 (レベルまたは除外) の変更を完全に検証し、セキュリティとコンプライアンスの組織に連絡して、カバレッジにギャップがないことを確認する必要があります。

## <a name="monitor-your-policy-and-compliance"></a>ポリシーとコンプライアンスを監視する

ポリシー定義の実装と割り当てが最後のステップではありません。 新しいポリシー定義に対するリソースの[コンプライアンス](../how-to/get-compliance-data.md) レベルを継続的に監視し、非準拠デバイスが識別された場合に対して適切な [Azure Monitor のアラートと通知](../../../azure-monitor/alerts/alerts-overview.md)をセットアップします。 また、ポリシー定義および関連する割り当てを定期的に評価し、ポリシー定義がビジネス ポリシーとコンプライアンス ニーズを満たしていることを検証することもお勧めします。 不要になった場合は、ポリシーを削除する必要があります。 また、基になる Azure リソースが発展し、新しいプロパティと機能が追加されたら、ポリシーを更新する必要もあります。

## <a name="next-steps"></a>次のステップ

- [ポリシー定義の構造](./definition-structure.md)についてさらに学習します。
- [ポリシー割り当ての構造](./assignment-structure.md)についてさらに学習します。
- [プログラムによってポリシーを作成する](../how-to/programmatically-create.md)方法を理解します。
- [コンプライアンス データを取得する](../how-to/get-compliance-data.md)方法を学習します。
- [準拠していないリソースを修復する](../how-to/remediate-resources.md)方法を学習します。
- 「[Azure 管理グループのリソースを整理する](../../management-groups/overview.md)」で、管理グループとは何かを確認します。
