---
title: Microsoft Defender for Cloud における BYOL VMの脆弱性評価
description: Azure 仮想マシンに BYOL 脆弱性評価ソリューションをデプロイして、仮想マシンの保護に役立つ Microsoft Defender for Cloud の推奨事項を取得します。
author: memildin
manager: rkarlin
ms.service: defender-for-cloud
ms.topic: how-to
ms.date: 11/09/2021
ms.author: memildin
ms.openlocfilehash: cf1fb54457fd78cc88d7a91d7ec0d8f1b679b27b
ms.sourcegitcommit: 2ed2d9d6227cf5e7ba9ecf52bf518dff63457a59
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/16/2021
ms.locfileid: "132525577"
---
# <a name="deploy-a-bring-your-own-license-byol-vulnerability-assessment-solution"></a>ライセンス持ち込み (BYOL) 脆弱性評価ソリューションをデプロイする

[!INCLUDE [Banner for top of topics](./includes/banner.md)]

**サーバーに対して Microsoft defender** を有効にした場合は、「 [Integrated Qualys の仮想マシン用の脆弱性スキャナー](./deploy-vulnerability-assessment-vm.md)」で説明されているように、クラウドの組み込みの脆弱性評価ツールとして microsoft defender を使用できます。 このツールは、クラウドの Defender に統合されており、外部ライセンスは必要ありません。すべてがクラウドの Defender 内でシームレスに処理されます。 さらに、統合されたスキャナーは Azure Arc 対応のマシンをサポートしています。

あるいは、[Qualys](https://www.qualys.com/lp/azure) または [Rapid7](https://www.rapid7.com/products/insightvm/) から、プライベートにライセンス供与された独自の脆弱性評価ソリューションをデプロイすることもできます。 これらのパートナー ソリューションの 1 つを、同じサブスクリプションに属する複数の VM (ただし、Azure Arc 対応のマシン以外) にインストールできます。

## <a name="availability"></a>可用性

|側面|詳細|
|----|:----|
|リリース状態:|一般公開 (GA)|
|マシンの種類:|:::image type="icon" source="./media/icons/yes-icon.png"::: Azure 仮想マシン<br>:::image type="icon" source="./media/icons/no-icon.png"::: Azure Arc 対応マシン|
|価格:|Free|
|必要なロールとアクセス許可:|**リソース所有者** は、スキャナーをデプロイできます<br>**セキュリティ閲覧者** は、結果を表示できます|
|クラウド:|:::image type="icon" source="./media/icons/yes-icon.png"::: 商用クラウド<br>:::image type="icon" source="./media/icons/no-icon.png"::: 各国 (Azure Government、Azure China 21Vianet)|
|||


## <a name="deploy-a-byol-solution-from-the-azure-portal"></a>Azure portal からソリューションをデプロイする

BYOL オプションでは、サポートされているサードパーティの脆弱性評価ソリューションが参照されます。 現在、Qualys と Rapid7 の両方のプロバイダーがサポートされています。

サポートされているソリューションは、パートナーの管理プラットフォームに脆弱性データをレポートします。 さらに、このプラットフォームは、クラウドに対して、脆弱性と正常性の監視データを Defender に戻します。 ワークロード保護ダッシュボードで脆弱な VM を特定し、Defender for Cloud から直接、パートナー管理コンソールに切り替え、レポートやその他の情報を入手できます。

1. [Azure portal](https://azure.microsoft.com/features/azure-portal/) から、**Defender for Cloud** を開きます。

1. Defender for Cloud のメニューから、**推奨事項** ページを開きます。

1. **[脆弱性評価ソリューションを仮想マシンで有効にする必要]** 推奨事項を選択します。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png" alt-text="[脆弱性評価ソリューションを仮想マシンで有効にする必要がある]推奨事項ページでマシンをグループ化する" lightbox="./media/deploy-vulnerability-assessment-vm/recommendation-page-machine-groupings.png":::

    VM は、次の 1 つ以上のグループに表示されます。

    * **正常なリソース** - Security Center で、これらの VM で実行されている脆弱性評価ソリューションが検出されました。
    * **異常なリソース** - これらの VM に脆弱性スキャナー拡張機能をデプロイできます。 
    * **適用できないリソース** - これらの VM では、脆弱性スキャナー拡張機能をデプロイできません。

1. 異常なマシンの一覧から、脆弱性評価ソリューションを受信するマシンを選択し、 **[修復]** を選択ます。

    >[!IMPORTANT]
    > 構成によっては、このリストの一部しか表示されない場合があります。 
    >
    > - サードパーティ製の脆弱性スキャナーが構成されていない場合は、デプロイすることができません。
    > - 選択したVMsが Microsoft Defender for server によって保護されていない場合、[Defender for Cloud integrated 脆弱性スキャナー] オプションは使用できません。

    :::image type="content" source="./media/deploy-vulnerability-assessment-vm/recommendation-remediation-options.png" alt-text="[脆弱性評価ソリューションを仮想マシンで有効にする必要がある] 推奨事項ページへの応答時に選択する推奨事項フローの種類のオプション":::

1. 新しい BYOL 構成を設定する場合は、 **[サード パーティの新しい脆弱性スキャナーの構成]** 、関連する拡張機能、 **[続行]** の順に選択して、プロバイダーから詳細を次のように入力します。

    1. **[リソース グループ]** では、 **[既存のものを使用]** を選択します。 後でこのリソース グループを削除すると、BYOL ソリューションは使用できなくなります。
    1. **[場所]** では、そのソリューションが地理的に配置されている場所を選択します。
    1. Qualys の場合は、 **[ライセンスコード]** フィールドに、Qualys から提供されたライセンスを入力します。
    1. Rapid7 の場合は、**Rapid7 構成ファイル** をアップロードします。
    1. **[公開キー]** ボックスに、パートナーから提供された公開キー情報を入力します。
    1. このソリューションのサブスクリプション内で検出されたすべての VM に脆弱性評価エージェントを自動的にインストールするには、 **[自動デプロイ]** を選択します。
    1. **[OK]** を選択します。

1. BYOL ソリューションを既に設定している場合は、 **[サード パーティの構成された脆弱性スキャナーのデプロイ]** 、関連する拡張機能、 **[続行]** の順に選択します。

ターゲットコンピューターに脆弱性評価ソリューションがインストールされると、Defender for Cloud はスキャンを実行して、システムとアプリケーションの脆弱性を検出して特定します。 最初のスキャンが完了するまでに数時間かかる場合があります。 その後は、毎時に実行されます。



## <a name="deploy-a-byol-solution-using-powershell-and-the-rest-api"></a>PowerShell と REST API を使用して BYOL ソリューションをデプロイする

[Qualys](https://www.qualys.com/lp/azure) または [Rapid7](https://www.rapid7.com/products/insightvm/) から、プライベートにライセンス供与された独自の脆弱性評価ソリューションをプログラムでデプロイするには、提供されているスクリプト [PowerShell > 脆弱性ソリューション](https://github.com/Azure/Azure-Security-Center/tree/master/Powershell%20scripts/Vulnerability%20Solution)を使用します。 このスクリプトでは、REST API を使用して、Defender for Cloud に新しいセキュリティソリューションを作成します。 サービス プロバイダーから提供されたライセンスとキー (Qualys または Rapid7) が必要です。

> [!IMPORTANT] 
> ライセンスごとに作成できるソリューションは 1 つだけです。 同じ名前/ライセンス/キーを使用して別のソリューションを作成しようとすると、失敗します。

### <a name="prerequisites"></a>前提条件

以下の PowerShell モジュールが必要です。

- Install-module Az
- Install-module Az.security

### <a name="run-the-script"></a>スクリプトを実行する

スクリプトを実行するには、以下のパラメーターに関連する情報が必要です。

| **パラメーター** | **必須** | **メモ** |
|----|:----:|----|
|**SubscriptionId**|✔|分析するリソースを含む Azure サブスクリプションの subscriptionID。|
|**ResourceGroupName**|✔|リソース グループの名前。 既定値 ("DefaultResourceGroup-xxx") を含む既存のリソース グループを使用します。<br>このソリューションは Azure リソースではないため、リソース グループの下には表示されませんが、アタッチされています。 後でリソース グループを削除すると、BYOL ソリューションは使用できなくなります。|
|**vaSolutionName**|✔|新しいソリューションの名前。|
|**vaType**|✔|Qualys または Rapid7。|
|**licenseCode**|✔|ベンダーから提供されたライセンス文字列。|
|**publicKey**|✔|ベンダーから提供された公開キー。|
|**autoUpdate**|-|この VA ソリューションの自動デプロイを有効 (true) または無効 (false) にします。 有効にすると、サブスクリプションのすべての新しい VM が自動的にソリューションへのリンクを試みます。<br/>(既定値:false)|
||||

構文:

```azurepowershell
.\New-ASCVASolution.ps1 -subscriptionId <Subscription Id> -resourceGroupName <RG Name>
-vaSolutionName <New solution name> -vaType <Qualys / Rapid7> -autoUpdate <true/false>
-licenseCode <License code from vendor> -publicKey <Public Key received from vendor>
```

例 (この例には、有効なライセンスの詳細は含まれていません):

```azurepowershell
.\New-ASCVASolution.ps1 -subscriptionId 'f4cx1b69-dtgb-4ch6-6y6f-ea2e95373d3b' -resourceGroupName 'DefaultResourceGroup-WEU' -vaSolutionName 'QualysVa001' -vaType 'Qualys' -autoUpdate 'false' `
-licenseCode 'eyJjaWQiOiJkZDg5OTYzXe4iMTMzLWM4NTAtODM5FD2mZWM1N2Q3ZGU5MjgiLCJgbTYuOiIyMmM5NDg3MS1lNTVkLTQ1OGItYjhlMC03OTRhMmM3YWM1ZGQiLCJwd3NVcmwiOiJodHRwczovL3FhZ3B1YmxpYy1wMDEuaW50LnF1YWx5cy5jb20vQ2xvdSKJY6VudC8iLCJwd3NQb3J0IjoiNDQzIn0=' `
-publicKey 'MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQCOiOLXjOywMfLZIBGPZLwSocf1Q64GASLK9OHFEmanBl1nkJhZDrZ4YD5lM98fThYbAx1Rde2iYV1ze/wDlX4cIvFAyXuN7HbdkeIlBl6vWXEBZpUU17bOdJOUGolzEzNBhtxi/elEZLghq9Chmah82me/okGMIhJJsCiTtglVQIDAQAB'
```

## <a name="faq---byol-vulnerability-scanner"></a>FAQ - BYOL の脆弱性スキャナー

- [Qualys エージェントをデプロイする場合、どのような通信設定が必要ですか。](#if-i-deploy-a-qualys-agent-what-communications-settings-are-required)
- [BYOL ソリューションを構成するときに、リソース グループを指定する必要があるのはなぜですか。](#why-do-i-have-to-specify-a-resource-group-when-configuring-a-byol-solution)


### <a name="if-i-deploy-a-qualys-agent-what-communications-settings-are-required"></a>Qualys エージェントをデプロイする場合、どのような通信設定が必要ですか。

Qualys Cloud エージェントは、Qualys の SOC と定期的に通信して更新を行い、製品の機能に必要なさまざまな操作を実行するように設計されています。 エージェントが SOC とシームレスに通信できるようにするには、ネットワーク セキュリティを構成し、Qualys SOC CIDR および URL への受信および送信のトラフィックを許可します。

さまざまな地域に複数の Qualys プラットフォームがあります。 SOC CIDR と URL は、Qualys サブスクリプションのホスト プラットフォームによって異なります。 Qualys ホスト プラットフォームを特定するには、このページ https://www.qualys.com/platform-identification/ を参照してください。


### <a name="why-do-i-have-to-specify-a-resource-group-when-configuring-a-byol-solution"></a>BYOL ソリューションを構成するときに、リソース グループを指定する必要があるのはなぜですか。

このソリューションを設定するときは、ソリューションをアタッチするリソース グループを選択する必要があります。 このソリューションは Azure リソースではないため、リソース グループのリソースの一覧には含まれません。 ただし、そのリソース グループにアタッチされてはいます。 後でリソース グループを削除すると、BYOL ソリューションは使用できなくなります。



## <a name="next-steps"></a>次のステップ

> [!div class="nextstepaction"]
> [脆弱性評価ソリューションの結果を修復する](remediate-vulnerability-findings-vm.md)


Defender for Cloud には、次の脆弱性分析も用意されています。

- SQL データベース - 「[脆弱性評価ダッシュボードで脆弱性評価レポートの探索をする](defender-for-sql-on-machines-vulnerability-assessment.md#explore-vulnerability-assessment-reports) 」を参照する
- イメージの Azure Container Registry-[コンテナーレジストリに Microsoft Defender を使用して、イメージの脆弱性をスキャンする](defender-for-container-registries-usage.md)を参照してください。
