---
title: マルチテナント Web アプリケーションのパターン | Microsoft Docs
description: Azure 上でマルチテナント Web アプリケーションを実装する方法を示す、アーキテクチャの概要と設計パターンを紹介します。
services: ''
documentationcenter: .net
author: wadepickett
manager: wpickett
editor: ''
ms.assetid: 4f0281d2-1555-42b0-a99d-1222fade0b0f
ms.service: active-directory
ms.workload: identity
ms.tgt_pltfrm: na
ms.devlang: dotnet
ms.topic: article
ms.date: 06/05/2015
ms.author: wpickett
ms.custom: devx-track-dotnet
ms.openlocfilehash: a65d72835a7a5af2681c5cbf0fd14e36adfb5cbe
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2021
ms.locfileid: "131033040"
---
# <a name="multitenant-applications-in-azure"></a>Azure 上のマルチテナント アプリケーション
マルチテナント アプリケーションは共有リソースであり、"それぞれ異なるテナント内のユーザー" からは独自のアプリケーションであるかのように見えます。 マルチテナント アプリケーションに適した一般的なシナリオは、さまざまなテナントからのアプリケーションのユーザーはすべて、ユーザー エクスペリエンスをカスタマイズしたいと考えているが、基本的なビジネス要件は同じというものです。 大規模なマルチテナント アプリケーションの例は、Microsoft 365、Outlook.com、visualstudio.com です。

アプリケーション プロバイダーの観点から、マルチテナント方式の主なメリットは運用とコストの効率にあります。 アプリケーションの 1 つのバージョンで、多くのテナント/顧客のニーズを満たすことができるため、監視、パフォーマンスのチューニング、ソフトウェアのメンテナンス、データのバックアップなどのシステム管理タスクを統合することが可能です。

次に挙げるのは、プロバイダーの観点から最も重要な目標と要件です。

* **プロビジョニング**:アプリケーション用に新しいテナントをプロビジョニングできる必要があります。  テナントが多数あるマルチテナント アプリケーションでは通常、セルフサービス プロビジョニングを可能にすることで、このプロセスを自動化する必要があります。
* **保守容易性**:複数のテナントによって使用されている間に、アプリケーションをアップグレードしてその他のメンテナンス タスクを実行できる必要があります。
* **監視**:アプリケーションを常時監視してあらゆる問題を特定し、トラブルシューティングできる必要があります。 各テナントによるアプリケーションの使用状況も監視できる必要があります。

適切に実装されたマルチテナント アプリケーションでは、ユーザーに次のようなメリットがあります。

* **分離**:個々のテナントのアクティビティは、他のテナントによるアプリケーションの使用には影響しません。 テナント間で相互のデータにアクセスすることはできません。 各テナントからはアプリケーションを排他的に使用しているように見えます。
* **稼働率**:個々のテナントでは、たいていは SLA に定義されている保証の下で、アプリケーションを常に使用できることを求めています。 同様に、他のテナントの活動がアプリケーションの可用性に影響することはありません。
* **スケーラビリティ**:アプリケーションは個々のテナントのニーズに合わせてスケーリングされます。 他のテナントの存在と活動がアプリケーションのパフォーマンスに影響することはありません。
* **コスト**: マルチテナント方式ではリソースを共有できるため、専用のシングルテナント アプリケーションを実行するよりもコストは低くなります。
* **カスタマイズ性**:個々のテナントに合わせてアプリケーションをさまざまな方法でカスタマイズできます。 機能の追加や削除、色やロゴの変更、独自のコードやスクリプトの追加などが可能です。

要するに、拡張性の高いサービスを提供するために必要な考慮事項が多数ある一方で、多くのマルチテナント アプリケーションに共通する目標と要件もまた、複数あります。 一部の目標と要件はシナリオに固有のものではなく、それらの重要性がシナリオによって変わります。 マルチテナント アプリケーションのプロバイダーには、他にも目標と要件が生じます。テナントのニーズの達成、収益性、課金、複数のサービス レベル、プロビジョニング、保守容易性の監視、自動化などです。

マルチテナント アプリケーションのその他の設計上の考慮事項の詳細については、「 [Hosting a Multi-Tenant Application on Azure (Azure 上のマルチテナント アプリケーションのホスト)][Hosting a Multi-Tenant Application on Azure]」を参照してください。 マルチテナント SaaS (サービスとしてのソフトウェア) データベース アプリケーションの一般的なデータ アーキテクチャ パターンについては、[Azure SQL Database を使用するマルチテナント SaaS アプリケーションの設計パターン](./azure-sql/database/saas-tenancy-app-design-patterns.md)に関する記事を参照してください。 

Azure には、マルチテナント システムの設計時に発生する主要な問題に対処できる、多数の機能が用意されています。

**分離**

* ホスト ヘッダー内の TLS 通信の有無で Web サイト テナントを分割する
* クエリ パラメーター別に Web サイト テナントを分割する。
* worker ロールで Web サービスを実行する。
  * Worker ロールは通常、アプリケーションのバックエンド上でデータを処理します。
  * Web ロールは通常、アプリケーションのフロントエンドとして動作します。

**Storage**

Azure SQL Database や Azure Storage サービスのようなデータ管理。たとえば、大量の非構造化データを保存するためのサービスを提供する Table service、また、大量の非構造化テキストまたはバイナリ データ (ビデオ、オーディオ、画像など) を格納するためのサービスを提供する Blob service などです。

* テナントでの SQL Server ログインごとに、SQL Database 内のマルチテナント データをセキュリティ保護します。
* アプリケーション リソースに Azure テーブルを使用すると、コンテナー レベルのアクセス ポリシーを指定することで、アクセス許可を調整できます。共有のアクセス署名によって保護されたリソース用に新しい URL を発行する必要はありません。
* Azure キューをアプリケーション リソース用に使用する。Azure キューは、テナントの処理を扱うために一般的に使用するだけでなく、プロビジョニングまたは管理に必要な処理を分散させるためにも使用できます。
* Service Bus キューをアプリケーション リソース用に使用して、処理を共有サービスにプッシュする。1 つのキューを使用して、各テナントのサービスの送り側には、データをそのキューにプッシュするアクセス許可 (ACS から発行されるクレームから派生) のみ与え、サービスの受け側には、複数のテナントからのデータをキューからプルするアクセス許可のみ与えることができます。

**接続とセキュリティ サービス**

* Azure Service Bus は、アプリケーション間のメッセージ インフラストラクチャで、拡張性および復元性を向上させるために疎結合方式でメッセージ交換を行います。

**ネットワーク サービス**

Azure には、認証をサポートし、ホステッド アプリケーションの管理性を向上させる、複数のネットワーク サービスが用意されています。 それらのサービスは次のとおりです。

* Azure 仮想ネットワークでは、Azure 上で仮想プライベート ネットワーク (VPN) をプロビジョニングして管理でき、VPN を内部設置型の IT インフラストラクチャにセキュリティで保護された方法で接続することもできます。
* Virtual Network Traffic Manager を使用すると、(同一データセンターで実行されているか、世界各地に点在するデータセンターで実行されているかに関係なく) 複数の Azure ホステッド サービス間で着信トラフィックを負荷分散できます。
* Azure Active Directory (Azure AD) は、クラウド アプリケーションに ID 管理機能およびアクセス制御機能を提供する最新の REST ベースのサービスです。 アプリケーション リソースに Azure AD を使用すると、コードからは認証および承認の機能を除外して、Web アプリケーションおよびサービスにアクセスするユーザーの認証および承認を簡単に行うことができます。
* Azure Service Bus では、分散型およびハイブリッド型アプリケーション用に、セキュリティで保護されたメッセージングおよびデータ フローの機能が用意されています。たとえば、複雑なファイアウォールやセキュリティ インフラストラクチャを使用することなく、Azure ホスト型アプリケーションと内部設置型アプリケーションおよびサービスとのセキュリティで保護された通信が可能です。 Service Bus Relay をアプリケーション リソースに使用して、エンドポイントがテナントに属すように (たとえば、オンプレミスなど、システム外でホストされます)、または、それらをテナント専用にプロビジョニングされたサービスのように (テナント固有の機密データがその間を移動するため) 公開されたサービスアクセスできます。

**リソースのプロビジョニング**

Azure には、アプリケーション用に新しいテナントをプロビジョニングするための、多数の方法が用意されています。 テナントが多数あるマルチテナント アプリケーションでは通常、セルフサービス プロビジョニングを可能にすることで、このプロセスを自動化する必要があります。

* worker ロールを使用すると、テナント リソースごとにプロビジョニングおよびプロビジョニング解除したり (新しいテナントのサインアップやキャンセル時など)、計測用にメトリックを収集したりできます。さらに、一定のスケジュールに従ったスケーリングや、主要業績評価指標のしきい値の超過に応じたスケーリングを管理することもできます。 この同じロールは、ソリューションへの更新とアップグレードのプッシュにも使用できます。
* Azure BLOB を使用すると、新しいテナント用にコンピューティングまたは事前初期化済みのストレージ リソースをプロビジョニングできます。同時に、コンピューティング サービス パッケージ、VHD イメージなどのリソースを保護するための、コンテナー レベルのアクセス ポリシーを設定することもできます。
* テナント用に SQL データベース リソースをプロビジョニングする方法は次のとおりです。

  * スクリプト内の DDL、またはアセンブリ内のリソースとして埋め込まれた DLL。
  * プログラムでデプロイする SQL Server 2008 R2 DAC パッケージ
  * マスター参照データベースからのコピー。
  * データベースのインポートとエクスポートによるファイルからの新しいデータベースのプロビジョニング

<!--links-->

[Hosting a Multi-Tenant Application on Azure]: /previous-versions/msp-n-p/hh534480(v=pandp.10)
[Designing Multitenant Applications on Azure]: https://msdn.microsoft.com/library/windowsazure/hh689716
