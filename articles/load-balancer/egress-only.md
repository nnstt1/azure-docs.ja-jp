---
title: 送信専用のロード バランサーの構成
titleSuffix: Azure Load Balancer
description: この記事では、アウトバウンド NAT を使用して内部ロード バランサーを作成する方法について説明します
author: asudbring
ms.custom: seodec18
ms.service: load-balancer
ms.topic: how-to
ms.date: 08/21/2021
ms.author: allensu
ms.openlocfilehash: f3c93d590036c0e9f16caad6cbfc55f32053d4ba
ms.sourcegitcommit: 692382974e1ac868a2672b67af2d33e593c91d60
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/22/2021
ms.locfileid: "130249554"
---
# <a name="outbound-only-load-balancer-configuration"></a>送信専用のロード バランサーの構成

内部ロード バランサーの背後にある VM のアウトバウンド接続を作成するには、内部および外部の標準ロードバランサーを組み合わせて使用します。 

この構成は、内部ロード バランサー シナリオ用にアウトバウンド NAT を提供し、バックエンド プールの "エグレス専用" セットアップを生成します。

> [!NOTE]
> **Azure Virtual Network NAT** は、運用デプロイでのアウトバウンド接続に推奨される構成です。 **Virtual Network NAT** と **NAT ゲートウェイ** リソースの詳細については、「 **[Azure Virtual Network NAT とは](../virtual-network/nat-gateway/nat-overview.md)** 」を参照してください。
>
> Azure Virtual Network NAT と NAT ゲートウェイを使用してアウトバウンド専用ロード バランサーの構成をデプロイするには、「[チュートリアル: NAT ゲートウェイと内部ロード バランサーを統合する - Azure portal](../virtual-network/nat-gateway/tutorial-nat-gateway-load-balancer-internal-portal.md)」を参照してください。
>
> Azure でのアウトバウンド接続と既定のアウトバウンド アクセスの詳細については、[アウトバウンド接続の送信元ネットワーク アドレス変換 (SNAT)](load-balancer-outbound-connections.md) および[既定のアウトバウンド アクセス](../virtual-network/ip-services/default-outbound-access.md)に関する記事を参照してください。

:::image type="content" source="./media/egress-only/load-balancer-egress-only.png" alt-text="エグレス専用のロード バランサーの構成を示す図" border="true":::

*図:エグレス専用のロード バランサーの構成*

## <a name="prerequisites"></a>前提条件

- アクティブなサブスクリプションが含まれる Azure アカウント。 [無料でアカウントを作成できます](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)。

## <a name="create-virtual-network-and-load-balancers"></a>仮想ネットワークとロード バランサーを作成する

このセクションでは、ロード バランサーおよび仮想マシンのための仮想ネットワークとサブネットを作成します。  次に、ロード バランサーを作成します。

### <a name="create-the-virtual-network"></a>仮想ネットワークの作成

このセクションでは、仮想マシン、ロード バランサー、bastion ホストのための仮想ネットワークとサブネットを作成します。

1. ポータルの上部にある検索ボックスに、「**仮想ネットワーク**」と入力します。 検索結果で、 **[仮想ネットワーク]** を選択します。

2. **[仮想ネットワーク]** で **[+ 作成]** を選択します。

3. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

    | **設定**          | **Value**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **プロジェクトの詳細**  |                                                                 |
    | サブスクリプション     | Azure サブスクリプションを選択します。                                  |
    | リソース グループ   | **[新規作成]** を選択します。 </br> **[名前]** に「**myResourceGroupLB**」と入力します。 </br> **[OK]** を選択します。 |
    | **インスタンスの詳細** |                                                                 |
    | 名前             | 「**myVNet**」と入力します                                    |
    | リージョン           | **[(米国) 米国東部 2]** を選択します。 |

4. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンを選択します。

5. **[IP アドレス]** タブで、次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | IPv4 アドレス空間 | 「**10.1.0.0/16**」と入力します。 |

6. **[サブネット名]** で、 **[default]\(既定\)** という単語を選択します。

7. **[サブネットの編集]** に次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | サブネット名 | 「**myBackendSubnet**」と入力します |
    | サブネットのアドレス範囲 | 「**10.1.0.0/24**」と入力します。 |

8. **[保存]** を選択します。

9. **[セキュリティ]** タブをクリックします。

10. **[BastionHost]** で **[有効にする]** を選択します。 この情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | 要塞名 | 「**myBastionHost**」と入力します |
    | AzureBastionSubnet のアドレス空間 | 「**10.1.1.0/27**」 と入力します |
    | パブリック IP アドレス | **[新規作成]** を選択します。 </br> **[名前]** に「**myBastionIP**」と入力します。 </br> **[OK]** を選択します。 |

11. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンを選択します。

12. **［作成］** を選択します

### <a name="create-internal-load-balancer"></a>内部ロード バランサーを作成する

このセクションでは、内部ロード バランサーを作成します。

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。 検索結果で **[ロード バランサー]** を選択します。

2. **[ロード バランサー]** ページで、 **[作成]** を選択します。

3. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。 

    | 設定                 | 値                                              |
    | ---                     | ---                                                |
    | **プロジェクトの詳細** |   |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | **[myResourceGroupLB]** を選択します。 |
    | **インスタンスの詳細** |   |
    | 名前                   | 「**myInternalLoadBalancer**」と入力します                                   |
    | リージョン         | **[(米国) 米国東部 2]** を選択します。                                        |
    | Type          | **[内部]** を選択します。                                        |
    | SKU           | 既定値 **[標準]** のままにします。 |

4. ページ下部にある **[次へ: フロントエンド IP の構成]** を選択します。

5. **[フロントエンド IP 構成]** で、 **[+ フロントエンド IP の追加]** を選択します。

6. **[名前]** に、「**LoadBalancerFrontend**」と入力します。

7. **[サブネット]** で **[myBackendSubnet]** を選択します。

8. **[割り当て]** で **[動的]** を選択します。

9. **[可用性ゾーン]** で、 **[ゾーン冗長]** を選択します。

    > [!NOTE]
    > [Availability Zones](../availability-zones/az-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json#availability-zones) があるリージョンでは、ゾーンなし (既定のオプション)、特定のゾーン、またはゾーン冗長を選択できます。 この選択は、特定のドメイン障害要件によって異なる場合があります。 Availability Zones がないリージョンでは、このフィールドは表示されません。 </br> 可用性ゾーンの詳細については、[可用性ゾーンの概要](../availability-zones/az-overview.md)に関するページを参照してください。

10. **[追加]** を選択します。

11. ページ下部で **[次へ: バックエンド プール]** を選択します。

12. **[バックエンド プール]** タブで、 **[+ バックエンド プールの追加]** を選択します。

13. **[バックエンド プールの追加]** の **[名前]** に「**myInternalBackendPool**」と入力します。

14. **[バックエンド プールの構成]** には **[NIC]** または **[IP アドレス]** を選択します。

15. **[IP バージョン]** には **[IPv4]** または **[IPv6]** を選択します。

16. **[追加]** を選択します。

17. ページ下部にある青色の **[確認と作成]** ボタンを選択します。

18. **［作成］** を選択します

### <a name="create-public-load-balancer"></a>パブリック ロード バランサーの作成

このセクションでは、パブリック ロード バランサーを作成します。

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。 検索結果で **[ロード バランサー]** を選択します。

2. **[ロード バランサー]** ページで、 **[作成]** を選択します。

3. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。 

    | 設定                 | 値                                              |
    | ---                     | ---                                                |
    | **プロジェクトの詳細** |   |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | **[myResourceGroupLB]** を選択します。 |
    | **インスタンスの詳細** |   |
    | 名前                   | 「**myPublicLoadBalancer**」と入力します                                   |
    | リージョン         | **[(米国) 米国東部 2]** を選択します。                                        |
    | Type          | **[パブリック]** を選択します。                                        |
    | SKU           | 既定値 **[標準]** のままにします。 |
    | レベル          | **[地域]** は既定値のままにします。 |

4. ページ下部にある **[次へ: フロントエンド IP の構成]** を選択します。

5. **[フロントエンド IP 構成]** で、 **[+ フロントエンド IP の追加]** を選択します。

6. **[名前]** に、「**LoadBalancerFrontend**」と入力します。

7. **[IP バージョン]** には **[IPv4]** または **[IPv6]** を選択します。

    > [!NOTE]
    > IPv6 は現在、ルーティングの優先順位およびリージョン間の負荷分散 (グローバル階層) ではサポートされていません。

8. **[IP の種類]** として **[IP アドレス]** を選択します。

    > [!NOTE]
    > IP プレフィックスの詳細については、[Azure パブリック IP アドレス プレフィックス](../virtual-network/ip-services/public-ip-address-prefix.md)に関するページを参照してください。

9. **[パブリック IP アドレス]** で **[新規作成]** を選択します。

10. **[パブリック IP アドレスの追加]** で、 **[名前]** に「**myPublicIP**」と入力します。

11. **[可用性ゾーン]** で、 **[ゾーン冗長]** を選択します。

    > [!NOTE]
    > [Availability Zones](../availability-zones/az-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json#availability-zones) があるリージョンでは、ゾーンなし (既定のオプション)、特定のゾーン、またはゾーン冗長を選択できます。 この選択は、特定のドメイン障害要件によって異なる場合があります。 Availability Zones がないリージョンでは、このフィールドは表示されません。 </br> 可用性ゾーンの詳細については、[可用性ゾーンの概要](../availability-zones/az-overview.md)に関するページを参照してください。

12. **[ルーティングの優先順位]** は、既定値の **[Microsoft ネットワーク]** のままにします。

13. **[OK]** を選択します。

14. **[追加]** を選択します。

15. ページ下部で **[次へ: バックエンド プール]** を選択します。

16. **[バックエンド プール]** タブで、 **[+ バックエンド プールの追加]** を選択します。

17. **[バックエンド プールの追加]** の **[名前]** に「**myPublicBackendPool**」と入力します。

18. **[仮想ネットワーク]** で **myVNet** を選択します。

19. **[バックエンド プールの構成]** には **[NIC]** または **[IP アドレス]** を選択します。

20. **[IP バージョン]** には **[IPv4]** または **[IPv6]** を選択します。

21. **[追加]** を選択します。

22. ページ下部にある青色の **[確認と作成]** ボタンを選択します。

23. **［作成］** を選択します

## <a name="create-virtual-machine"></a>仮想マシンの作成

このセクションでは、仮想マシンを作成します。 作成の間に、内部ロード バランサーのバックエンド プールにそれを追加します。 仮想マシンを作成した後、パブリック ロード バランサーのバックエンド プールに仮想マシンを追加します。

1. ポータルの上部にある検索ボックスに、「**仮想マシン**」と入力します。 検索結果から **[仮想マシン]** を選択します。

2. **[仮想マシン]** で、 **[+ 作成]**  >  **[仮想マシン]** を選択します。
   
3. **[仮想マシンの作成]** の **[基本]** タブに、値を入力するか選択します。

    | 設定 | [値]                                          |
    |-----------------------|----------------------------------|
    | **プロジェクトの詳細** |  |
    | サブスクリプション | Azure サブスクリプションを選択します。 |
    | リソース グループ | **[myResourceGroupLB]** を選択します |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | 「**myVM**」と入力します |
    | リージョン | **[(米国) 米国東部 2]** を選択します。 |
    | 可用性オプション | **[インフラストラクチャ冗長は必要ありません]** を選択します |
    | Image | **[Windows Server 2019 Datacenter - Gen1]** を選択します |
    | Azure Spot インスタンス | 既定値のオフのままにします。 |
    | サイズ | VM サイズを選択するか、既定の設定を使用します |
    | **管理者アカウント** |  |
    | ユーザー名 | ユーザー名を入力します |
    | Password | [パスワード] を入力します |
    | [パスワードの確認入力] | パスワードを再入力します |
    | **受信ポートの規則** |  |
    | パブリック受信ポート | **[なし]** を選択します |

4. **[ネットワーク]** タブまたは **[次へ: ディスク]** を選択してから **[次へ: ネットワーク]** を選択します。
  
5. [ネットワーク] タブで、次を選択または入力します。

    | 設定 | [値] |
    |-|-|
    | **ネットワーク インターフェイス** |  |
    | 仮想ネットワーク | **myVNet** |
    | Subnet | **myBackendSubnet** |
    | パブリック IP | **[なし]** を選択します。 |
    | NIC ネットワーク セキュリティ グループ | **[Advanced] \(詳細設定)** を選択します|
    | ネットワーク セキュリティ グループを構成する | 既定値の **[Basic]** のままにします。 |
    | **負荷分散**  |
    | この仮想マシンを既存の負荷分散ソリューションの後ろに配置しますか? | ボックスを選択します。 |
    | **ロード バランサーの設定** |
    | 負荷分散のオプション | **[Azure load balancing]\(Azure 負荷分散\)** を選択します |
    | ロード バランサーを選択する | **myInternalLoadBalancer** を選択します  |
    | バックエンド プールを選択する | **myInternalBackendPool** を選択します |
   
6. **[Review + create]\(レビュー + 作成\)** を選択します。 
  
7. 設定を確認し、 **[作成]** を選択します。

### <a name="add-vm-to-backend-pool-of-public-load-balancer"></a>パブリック ロード バランサーのバックエンド プールに VM を追加する

このセクションでは、前に作成した仮想マシンを、パブリック ロード バランサーのバックエンド プールに追加します。

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。 検索結果で **[ロード バランサー]** を選択します。

2. **myPublicLoadBalancer** を選択します。

3. **myPublicLoadBalancer** の **[設定]** で、 **[バックエンド プール]** を選択します。

4. **[バックエンド プール]** ページの **[バックエンド プール]** で **myPublicBackendPool** を選択します。

5. **myPublicBackendPool** で、 **[仮想ネットワーク]** の **myVNet** を選択します。

6. **[仮想マシン]** で、青色の **[+ 追加]** ボタンを選択します。

7. **[仮想マシンをバックエンド プールに追加する]** で、**myVM** の横のボックスをオンにします。

8. **[追加]** を選択します。

9. **[保存]** を選択します。
## <a name="test-connectivity-before-outbound-rule"></a>アウトバウンド規則の前の接続のテスト

1. ポータルの上部にある検索ボックスに、「**仮想マシン**」と入力します。 検索結果から **[仮想マシン]** を選択します。

2. **[myVM]** を選択します。

3. **[概要]** ページで **[接続]** 、 **[Bastion]** の順に選択します。

4. VM 作成時に入力したユーザー名とパスワードを入力します。

5. **[接続]** を選択します。

6. Internet Explorer を開きます。

7. アドレス バーに「 **https://whatsmyip.org** 」と入力します。

8. 接続は失敗するはずです。 既定で、標準のパブリック ロード バランサーでは[定義されたアウトバウンド規則を使用しないアウトバウンド トラフィックが許可されません](load-balancer-overview.md#securebydefault)。
 
## <a name="create-a-public-load-balancer-outbound-rule"></a>パブリック ロード バランサーのアウトバウンド規則の作成

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。 検索結果で **[ロード バランサー]** を選択します。

2. **myPublicLoadBalancer** を選択します。

3. **myPublicLoadBalancer** の **[設定]** で、 **[送信規則]** を選択します。

4. **[送信規則]** で **[+ 追加]** を選択します。

5. 次の情報を入力または選択して、アウトバウンド規則を構成します。

    | 設定 | [値] |
    | ------- | ----- |
    | 名前 | 「**myOutboundRule**」と入力します。 |
    | フロントエンド IP アドレス | **[LoadBalancerFrontEnd]** を選択します。|
    | Protocol | 既定値の **[すべて]** をそのまま使用します。 |
    | アイドル タイムアウト (分) | スライダーを **15 分** に移動します。|
    | TCP リセット | **[Enabled]** を選択します。|
    | バックエンド プール | **[myPublicBackendPool]** を選択します。|
    | **ポートの割り当て** |  |
    | ポートの割り当て | **[送信ポートの数を手動で選択する]** を選択します。 |
    | **送信ポート** |  |
    | 選択基準 | **[インスタンスごとのポート]** を選択します。 |
    | インスタンスあたりのポート数 | 「**10000**」と入力します

6. **[追加]** を選択します。

## <a name="test-connectivity-after-outbound-rule"></a>アウトバウンド規則の後の接続のテスト

1. ポータルの上部にある検索ボックスに、「**仮想マシン**」と入力します。 検索結果から **[仮想マシン]** を選択します。

2. **[myVM]** を選択します。

3. **[概要]** ページで **[接続]** 、 **[要塞]** の順に選択します。

4. VM 作成時に入力したユーザー名とパスワードを入力します。

5. **[接続]** を選択します。

6. Internet Explorer を開きます。

7. アドレス バーに「 **https://whatsmyip.org** 」と入力します。

8. 接続は成功するはずです。

9. 表示される IP アドレスは **myPublicLoadBalancer** のフロントエンド IP アドレスであるはずです。

## <a name="clean-up-resources"></a>リソースをクリーンアップする

リソース グループ、ロード バランサー、VM、および関連するすべてのリソースは、不要になったら削除します。 

それを行うには、リソース グループ **[myResourceGroupLB]** を選択してから **[削除]** を選択します。

## <a name="next-steps"></a>次の手順

この記事では、パブリックと内部のロード バランサーの組み合わせで、"エグレス専用" の構成を作成しました。  

この構成により、受信する内部トラフィックをバックエンド プールに負荷分散すると同時に、引き続きパブリック インバウンド接続を防ぐことができます。

Azure Load Balancer と Azure Bastion の詳細については、「[Azure Load Balancer の概要](load-balancer-overview.md)」および「[Azure Bastion とは](../bastion/bastion-overview.md)」を参照してください。