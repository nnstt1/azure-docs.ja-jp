---
title: 'チュートリアル: 既存の仮想マシン スケール セットに Azure Load Balancer を追加する - Azure portal'
description: このチュートリアルでは、Azure portal を使用して既存の仮想マシン スケール セットにロード バランサーを追加する方法について説明します。
author: asudbring
ms.author: allensu
ms.service: load-balancer
ms.topic: tutorial
ms.date: 4/21/2021
ms.custom: template-tutorial
ms.openlocfilehash: cb87efe8402d49463d10e25aa79c50fc3b9b4c6e
ms.sourcegitcommit: bd1a4e4df613ff24e954eb3876aebff533b317ae
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/23/2021
ms.locfileid: "107931043"
---
# <a name="tutorial-add-azure-load-balancer-to-an-existing-virtual-machine-scale-set-using-the-azure-portal"></a>チュートリアル: Azure portal を使用して既存の仮想マシン スケール セットに Azure Load Balancer を追加する

Azure Load Balancer が仮想マシン スケール セットに関連付けられていない場合に必要になることがあります。 

既存の仮想マシン スケール セットが、更新が必要な Azure Load Balancer と共にデプロイされた可能性もあります。

Azure portal を使用して、仮想マシン スケール セットに関連付けられている Azure Load Balancer を追加または更新できます。  

このチュートリアルでは、以下の内容を学習します。

> [!div class="checklist"]
> * 仮想ネットワークの作成
> * アウトバウンド接続用の NAT ゲートウェイを作成する
> * Standard SKU の Azure ロード バランサーを作成する
> * ロード バランサーのない仮想マシン スケール セットを作成する
> * Azure Load Balancer を仮想マシン スケール セットに追加する

## <a name="prerequisites"></a>前提条件

- アクティブなサブスクリプションが含まれる Azure アカウント。 [無料でアカウントを作成する](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)

## <a name="create-a-virtual-network"></a>仮想ネットワークの作成

このセクションでは、スケール セット用の仮想ネットワークと、このチュートリアルで使用するその他のリソースを作成します。

1. [Azure portal](https://portal.azure.com) にサインインします。

2. ポータルの上部にある検索ボックスに、「**仮想ネットワーク**」と入力します。

3. 検索結果で、**[仮想ネットワーク]** を選択します。

4. **[+ 作成]** を選択します。

5. **[仮想ネットワークの作成]** の **[基本]** タブで、次の情報を入力するか選択します。

    | 設定 | 値 |
    | ------- | ------|
    | **プロジェクトの詳細** |   |
    | サブスクリプション | サブスクリプションを選択します。 |
    | Resource group | **[新規作成]** を選択します。 </br> **[名前]** に「**TutorLBVMSS-rg**」と入力します。 </br> **[OK]** を選択します。 |
    | **インスタンスの詳細** |   |
    | 名前 | 「**myVNet**」と入力します。 |
    | リージョン | **[(米国) 米国西部 2]** を選択します。 |

6. **[IP アドレス]** タブを選択するか、ページ下部の **[次へ: IP アドレス]** ボタンを選択します。

7. **[IP アドレス]** タブの **[サブネット名]** で **[default]\(既定\)** を選択します。

8. **[サブネットの編集]** ペインの **[サブネット名]** に「**myBackendSubnet**」と入力します。

9. **[保存]** を選択します。

10. **[セキュリティ]** タブを選択するか、ページ下部にある **[次へ: セキュリティ]** ボタンを選択します。

11. **[セキュリティ]** タブの **[BastionHost]** で **[Enable]\(有効\)** を選択します。

12. 次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | 要塞名 | 「**MyBastionHost**」と入力します。 |
    | AzureBastionSubnet のアドレス空間 | 「**10.1.1.0/27**」と入力します。 |
    | パブリック IP アドレス | **[新規作成]** を選択します。 </br> **[名前]** に「**myBastionIP**」と入力します。 |

13. **[Review + create]\(確認と作成\)** タブを選択するか、ページの下部にある青色の **[Review + create]\(確認と作成\)** ボタンを選択します。

14. **［作成］** を選択します

## <a name="create-nat-gateway"></a>NAT ゲートウェイの作成 

このセクションでは、仮想マシンのアウトバウンド接続に使用する NAT ゲートウェイを作成します。

1. ポータルの上部にある検索ボックスに、「**NAT ゲートウェイ**」と入力します。

2. 検索結果から **[NAT ゲートウェイ]** を選択します。

3. **[+ 作成]** を選択します。

4. **[ネットワーク アドレス変換 (NAT) ゲートウェイを作成します]** の **[基本]** タブで、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | **プロジェクトの詳細** |   |
    | サブスクリプション | サブスクリプションを選択します。 |
    | Resource group | **[TutorLBVMSS-rg]** を選択します。 |
    | **インスタンスの詳細** |   |
    | NAT ゲートウェイ名 | 「**myNATgateway**」と入力します。 |
    | リージョン | **[(米国) 米国西部 2]** を選択します。 |
    | 可用性ゾーン | **[なし]** を選択します。 |
    | アイドル タイムアウト (分) | 「**15**」と入力します。 |

5. **[Outbound IP]\(アウトバウンド IP\)** タブを選択するか、ページの下部にある **[Next: Outbound IP]\(次へ: アウトバウンド IP\)** を選択します。

6. **[Outbound IP]\(アウトバウンド IP\)** タブで、 **[パブリック IP アドレス]** の横にある **[新しいパブリック IP アドレスの作成]** を選択します。

7. **[名前]** に、「**myPublicIP-nat**」と入力します。

8. **[OK]** を選択します。

9. **[サブネット]** タブを選択するか、ページの下部にある **[次へ: サブネット]** ボタンを選択します。

10. **[仮想ネットワーク]** の下のプルダウン メニューで **[myVNet]** を選択します。

11. **[myBackendSubnet]** の横にあるチェック ボックスをオンにします。

12. **[Review + create]\(確認と作成\)** タブを選択するか、ページの下部にある青色の **[Review + create]\(確認と作成\)** ボタンを選択します。

13. **［作成］** を選択します

## <a name="create-load-balancer"></a>ロード バランサーの作成

このセクションでは、仮想マシンのロード バランサーを作成します。

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。

2. 検索結果で **[ロード バランサー]** を選択します。

3. **[+ 作成]** を選択します。

4. **[ロード バランサーの作成]** の **[基本]** タブで、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | **プロジェクトの詳細** |   |
    | サブスクリプション | サブスクリプションを選択します。 |
    | Resource group | **[TutorLBVMSS-rg]** を選択します。 |
    | **インスタンスの詳細** |   |
    | 名前 | 「**myLoadBalancer**」と入力します。 |
    | リージョン | **[(米国) 米国西部 2]** を選択します。 |
    | Type | 既定値の **[パブリック]** のままにします。 |
    | SKU | 規定値である **[標準]** のままにします。 |
    | レベル | 既定値の **[地域]** のままにします。 |
    | **パブリック IP アドレス** |   |
    | パブリック IP アドレス | 既定値の **[Create new]\(新規作成\)** のままにします。 |
    | パブリック IP アドレス名 | 「**myPublicIP-lb**」と入力します。 |
    | 可用性ゾーン | **[ゾーン冗長]** を選択します。 |
    | パブリック IPv6 アドレスを追加する | 既定値の **[いいえ]** のままにします。 |
    | ルーティング設定 | 既定値の **[Microsoft ネットワーク]** のままにします。 |

5. **[Review + create]\(確認と作成\)** タブを選択するか、ページの下部にある青色の **[Review + create]\(確認と作成\)** ボタンを選択します。

6. **［作成］** を選択します

### <a name="configure-load-balancer-settings"></a>ロード バランサーの設定を構成する

このセクションでは、**myLoadBalancer** 用のバックエンドプールを作成します。

**HTTP** と **ポート 80** を監視するための正常性プローブを作成します。 正常性プローブは、バックエンド プール内の仮想マシンの正常性を監視します。 

アウトバウンド SNAT を無効にして、**ポート 80** の負荷分散規則を作成します。 仮想マシンのアウトバウンド接続は、先ほど作成した NAT ゲートウェイによって処理されます。

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。

2. 検索結果で **[ロード バランサー]** を選択します。

3. **[myLoadBalancer]** を選択します。

4. **[myLoadBalancer]** の **[設定]** で、 **[バックエンド プール]** を選択します。

5. **[バックエンド プール]** の **[+ 追加]** を選択します。

6. **[バックエンド プールの追加]** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myBackendPool**」と入力します。 |
    | 仮想ネットワーク | **[myVNet]** を選択します。 |
    | バックエンド プールの構成 | 既定値の **[NIC]** のままにします。 |
    | IP バージョン | 既定値の **[IPv4]** のままにします。 |

7. **[追加]** を選択します。

8. **[正常性プローブ]** を選択します。

9. **[+ 追加]** を選択します。

10. **[正常性プローブの追加]** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myHTTPProbe**」と入力します。 |
    | Protocol | **[HTTP]** を選択します。 |
    | Port | 既定値の **[80]** のままにします。 |
    | パス | 既定値の **[/]** のままにします。 |
    | Interval | 既定値の **5** 秒のままにします。 |
    | 異常のしきい値 | 既定値である **2** 連続エラーのままにします。 |

11. **[追加]** を選択します。

12. **[Load-balancing rules]\(負荷分散規則\)** を選択します。 

13. **[+ 追加]** を選択します。

14. **[負荷分散規則の追加]** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | 名前 | 「**myHTTPRule**」と入力します。 |
    | IP バージョン | 既定値の **[IPv4]** のままにします。 |
    | フロントエンド IP アドレス | **[LoadBalancerFrontEnd]** を選択します。 |
    | Protocol | 既定値の **[TCP]** を選択します。 |
    | Port | 「**80**」と入力します。 |
    | バックエンド ポート | 「**80**」と入力します。 |
    | バックエンド プール | **[myBackendPool]** を選択します。 |
    | 正常性プローブ | **[myHTTPProbe]** を選択します。 |
    | セッション永続化 | 既定値の **[なし]** のままにします。 |
    | アイドル タイムアウト (分) | スライダーを **15** に移動します。 |
    | TCP リセット | **[Enabled]** を選択します。 |
    | フローティング IP | 既定値の **[無効]** のままにします。 |
    | アウトバウンド送信元ネットワーク アドレス変換 (SNAT) | 既定値の **[(推奨) アウトバウンド規則を使用して、バックエンド プールのメンバーがインターネットにアクセスできるようにします。]** のままにします。 |

5. **[追加]** を選択します。

## <a name="create-virtual-machine-scale-set"></a>仮想マシン スケール セットを作成する

このセクションでは、ロード バランサーがない仮想マシン スケール セットを作成します。 後で、Azure portal で、このスケール セットにロード バランサーを追加します。

1. ポータルの上部にある検索ボックスに、「**仮想マシン スケール**」と入力します。

2. 検索結果から **[仮想マシン スケール セット]** を選択します。

3. **[+ 追加]** を選択します。

4. **[仮想マシン スケール セットの作成]** の **[基本]** タブで、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | **プロジェクトの詳細** |   |
    | サブスクリプション | サブスクリプションを選択します。 |
    | Resource group | **[TutorLBVMSS-rg]** を選択します。 |
    | **スケール セットの詳細** |   |
    | 仮想マシン スケール セットの名前 | 「**myVMScaleSet**」と入力します。 |
    | リージョン | **[(米国) 米国西部 2]** を選択します。 |
    | 可用性ゾーン | 既定値の **[なし]** のままにします。 |
    | **オーケストレーション** |   |
    | オーケストレーション モード | 既定値の **[Uniform: optimized for large-scale stateless workloads with identical instances]\(均一: 同一のインスタンスがある大規模なステートレス ワークロードに最適化されています\)** のままにします。 |
    | **インスタンスの詳細** |   |
    | Image | **[Windows Server 2019 Datacenter - Gen1]** を選択します。 |
    | Azure Spot インスタンス | ボックスの既定値のオフのままにします。 |
    | サイズ | サイズを選択します。 |
    | **管理者アカウント** |
    | ユーザー名 | ユーザー名を入力します。 |
    | Password | パスワードを入力します。 |
    | パスワードの確認 | パスワードを確認します。 |

5. **[ネットワーク]** タブを選択します。

6. **[ネットワーク]** タブで、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | **仮想ネットワークの構成** |   |
    | 仮想ネットワーク | **[myVNet]** を選択します。 |

7. **[Review + create]\(確認と作成\)** タブを選択するか、ページの下部にある青色の **[Review + create]\(確認と作成\)** ボタンを選択します。

8. **［作成］** を選択します

## <a name="add-load-balancer-to-scale-set"></a>ロード バランサーをスケール セットに追加する

このセクションでは、Azure portal でスケール セットにアクセスし、ロード バランサーをスケール セットに追加します。

1. ポータルの上部にある検索ボックスに、「**仮想マシン スケール**」と入力します。

2. 検索結果から **[仮想マシン スケール セット]** を選択します。

3. **[myVMScaleSet]** を選択します。

4. **myVMScaleSet** の **[設定]** セクションで、 **[ネットワーク]** を選択します。

5. **myVMScaleSet** の **[ネットワーク]** 設定の **[概要]** ページで、 **[負荷分散]** タブを選択します。

    :::image type="content" source="./media/tutorial-add-lb-existing-scale-set-portal/load-balancing-tab.png" alt-text="[ネットワーク] の [負荷分散] タブを選択する。" border="true":::

6. 青色の **[負荷分散の追加]** ボタンを選択します。

7. **[負荷分散の追加]** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | 負荷分散のオプション | **[Azure Load Balancer]** を選択します。 |
    | ロード バランサーを選択する | **[myLoadBalancer]** を選択します。 |
    | バックエンド プール | **[既存のものを使用]** を選択します。 |
    | バックエンド プールを選択する | **[myBackendPool]** を選択します。 |

8. **[保存]** を選択します。

## <a name="clean-up-resources"></a>リソースをクリーンアップする

このアプリケーションを引き続き使用する予定がなければ、次の手順に従ってロード バランサーと関連リソースを削除します。

1. ポータル上部の [検索] ボックスに「**リソース グループ**」と入力します。

2. 検索結果から **[リソース グループ]** を選択します。

3. **[TutorLBVMSS-rg]** を選択します。

4. **TutorLBVMSS-rg** の概要ページで、 **[リソース グループの削除]** を選択します。

5. **[リソース グループ名を入力してください]** に「**TutorLBVMSS-rg**」と入力します。

6. **[削除]** を選択します。

## <a name="next-steps"></a>次の手順

このチュートリアルでは、次のことを行いました。

* 仮想ネットワークと Azure Bastion ホストを作成しました。
* Azure Standard ロード バランサーを作成しました。
* 仮想マシン スケール セットを作成しました。
* ロード バランサーを仮想マシン スケール セットに追加しました。

次の記事に進んで、リージョン間 Azure ロード バランサーの作成方法を学習してください。
> [!div class="nextstepaction"]
> [リージョン間ロード バランサーを作成する](tutorial-cross-region-portal.md)