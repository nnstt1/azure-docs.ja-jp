---
title: クイック スタート:内部ロード バランサーの作成 - Azure portal
titleSuffix: Azure Load Balancer
description: このクイックスタートでは、Azure portal を使用して内部ロード バランサーを作成する方法について説明します。
services: load-balancer
author: asudbring
ms.service: load-balancer
ms.topic: quickstart
ms.date: 08/09/2021
ms.author: allensu
ms.custom: mvc
ms.openlocfilehash: 9c8f46bf615b0d0c9fe8289057a8244a1d57185d
ms.sourcegitcommit: 0046757af1da267fc2f0e88617c633524883795f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/13/2021
ms.locfileid: "121732790"
---
# <a name="quickstart-create-an-internal-load-balancer-to-load-balance-vms-using-the-azure-portal"></a>クイック スタート:Azure portal を使用して VM の負荷を分散する内部ロード バランサーを作成する

Azure portal を使用して内部ロード バランサーと 3 つの仮想マシンを作成することにより、Azure Load Balancer の使用を開始します。

## <a name="prerequisites"></a>前提条件

- アクティブなサブスクリプションが含まれる Azure アカウント。 [無料でアカウントを作成できます](https://azure.microsoft.com/free/?WT.mc_id=A261C142F)。

## <a name="sign-in-to-azure"></a>Azure へのサインイン

Azure Portal [https://portal.azure.com](https://portal.azure.com) にサインインします。

---

# <a name="standard-sku"></a>[**Standard SKU**](#tab/option-1-create-internal-load-balancer-standard)

>[!NOTE]
>運用環境のワークロードには、Standard SKU ロード バランサーをお勧めします。  SKU の詳細については、「 **[Azure Load Balancer の SKU](skus.md)** 」を参照してください。

内部ロード バランサーを作成すると、仮想ネットワークがロード バランサー用のネットワークとして構成されます。 

仮想ネットワーク内のプライベート IP アドレスは、ロード バランサー用のフロントエンドとして構成されます (既定の名前は **LoadBalancerFrontend**)。 

フロントエンド IP アドレスは、**静的** でも **動的** でもかまいません。

## <a name="create-the-virtual-network"></a>仮想ネットワークの作成

このセクションでは、仮想ネットワークとサブネットを作成します。

1. ポータルの上部にある検索ボックスに、「**仮想ネットワーク**」と入力します。 検索結果で、 **[仮想ネットワーク]** を選択します。

2. **[仮想ネットワーク]** で **[+ 作成]** を選択します。

3. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

    | **設定**          | **Value**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **プロジェクトの詳細**  |                                                                 |
    | サブスクリプション     | Azure サブスクリプションを選択します。                                  |
    | リソース グループ   | **[新規作成]** を選択します。 </br> **[名前]** に「**CreateIntLBQS-rg**」 と入力します。 </br> **[OK]** を選択します。 |
    | **インスタンスの詳細** |                                                                 |
    | 名前             | 「**myVNet**」と入力します                                    |
    | リージョン           | **[(ヨーロッパ) 西ヨーロッパ]** を選択します |

4. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンを選択します。

5. **[IP アドレス]** タブで、次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | IPv4 アドレス空間 | 「**10.1.0.0/16**」と入力します。 |

6. **[サブネット名]** で、 **[default]\(既定\)** という単語を選択します。

7. **[サブネットの編集]** に次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | サブネット名 | 「**myBackendSubnet**」と入力します |
    | サブネットのアドレス範囲 | 「**10.1.0.0/24**」と入力します。 |

8. **[保存]** を選択します。

9. **[セキュリティ]** タブをクリックします。

10. **[BastionHost]** で **[有効にする]** を選択します。 この情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | 要塞名 | 「**myBastionHost**」と入力します |
    | AzureBastionSubnet のアドレス空間 | 「**10.1.1.0/27**」 と入力します |
    | パブリック IP アドレス | **[新規作成]** を選択します。 </br> **[名前]** に「**myBastionIP**」と入力します。 </br> **[OK]** を選択します。 |

11. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンを選択します。

12. **［作成］** を選択します

## <a name="create-nat-gateway"></a>NAT ゲートウェイの作成

このセクションでは、仮想ネットワーク内のリソースの送信インターネット アクセス用の NAT ゲートウェイを作成します。 

1. ポータルの上部にある検索ボックスに、「**NAT ゲートウェイ**」と入力します。 検索結果から **[NAT ゲートウェイ]** を選択します。

2. **[NAT ゲートウェイ]** で、 **[+ 作成]** を選択します。

3. **[ネットワーク アドレス変換 (NAT) ゲートウェイを作成します]** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | **プロジェクトの詳細** |   |
    | サブスクリプション | サブスクリプションを選択します。 |
    | Resource group | **[CreateIntLBQS-rg]** を選択します。 |
    | **インスタンスの詳細** |    |
    | NAT ゲートウェイ名 | 「**myNATgateway**」と入力します。 |
    | 可用性ゾーン | **[なし]** を選択します。 |
    | アイドル タイムアウト (分) | 「**15**」と入力します。 |

4. **[送信 IP]** タブを選択するか、ページの下部にある **[次へ: 送信 IP]** ボタンを選択します。

5. **[送信 IP]** で、 **[パブリック IP アドレス]** の横にある **[新しいパブリック IP アドレスの作成]** を選択します。

6. **[パブリック IP アドレスの追加]** の **[名前]** に「**myNATgatewayIP**」と入力します。

7. **[OK]** を選択します。

8. **[サブネット]** タブを選択するか、ページ下部にある **[次へ: サブネット]** ボタンを選択します。

9. **[サブネット]** タブの **[仮想ネットワーク]** で **[myVNet]** を選択します。

10. **[サブネット名]** で **[myBackendSubnet]** を選択します。

11. ページ下部にある青色の **[確認と作成]** ボタンを選択するか、 **[確認と作成]** タブを選択します。

12. **［作成］** を選択します

## <a name="create-load-balancer"></a><a name="create-load-balancer-resources"></a>ロード バランサーの作成

このセクションでは、仮想マシンの負荷分散を行うロード バランサーを作成します。

ロード バランサーの作成中に、次の構成を行います。

* フロントエンド IP アドレス
* バックエンド プール
* インバウンドの負荷分散規則

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。 検索結果で **[ロード バランサー]** を選択します。

2. **[ロード バランサー]** ページで、 **[作成]** を選択します。

3. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。 

    | 設定                 | 値                                              |
    | ---                     | ---                                                |
    | **プロジェクトの詳細** |   |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | **[CreateIntLBQS-rg]** を選択します。 |
    | **インスタンスの詳細** |   |
    | 名前                   | 「**myLoadBalancer**」と入力します                                   |
    | リージョン         | **[(ヨーロッパ) 西ヨーロッパ]** を選択します。                                        |
    | Type          | **[内部]** を選択します。                                        |
    | SKU           | 既定値 **[標準]** のままにします。 |

    :::image type="content" source="./media/quickstart-load-balancer-standard-internal-portal/create-standard-internal-load-balancer.png" alt-text="Standard ロード バランサーを作成する [基本] タブのスクリーンショット。" border="true":::

4. ページ下部にある **[次へ: フロントエンド IP の構成]** を選択します。

5. **[フロントエンド IP の構成]** で、 **[+ フロントエンド IP の追加]** を選択します。

6. **[名前]** に、「**LoadBalancerFrontend**」と入力します。

7. **[サブネット]** で **[myBackendSubnet]** を選択します。

8. **[割り当て]** で **[動的]** を選択します。

9. **[可用性ゾーン]** で、 **[ゾーン冗長]** を選択します。

    > [!NOTE]
    > [Availability Zones](../availability-zones/az-overview.md?toc=%2fazure%2fvirtual-network%2ftoc.json#availability-zones) があるリージョンでは、ゾーンなし (既定のオプション)、特定のゾーン、またはゾーン冗長を選択できます。 この選択は、特定のドメイン障害要件によって異なる場合があります。 Availability Zones がないリージョンでは、このフィールドは表示されません。 </br> 可用性ゾーンの詳細については、[可用性ゾーンの概要](../availability-zones/az-overview.md)に関するページを参照してください。

10. **[追加]** を選択します。

11. ページ下部で **[次へ: バックエンド プール]** を選択します。

12. **[バックエンド プール]** タブで、 **[+ バックエンド プールの追加]** を選択します。

13. **[バックエンド プールの追加]** の **[名前]** に「**myBackendPool**」と入力します。

14. **[バックエンド プールの構成]** には **[NIC]** または **[IP アドレス]** を選択します。

15. **[IP バージョン]** には **[IPv4]** または **[IPv6]** を選択します。

16. **[追加]** を選択します。

17. ページ下部にある **[次へ: 受信規則]** ボタンを選択します。

18. **[受信規則]** タブの **[負荷分散規則]** で、 **[+ 負荷分散規則の追加]** を選択します。

19. **[負荷分散規則の追加]** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | Name | 「**myHTTPRule**」と入力します。 |
    | IP バージョン | 要件に応じて、 **[IPv4]** または **[IPv6]** を選択します。 |
    | フロントエンド IP アドレス | **[LoadBalancerFrontend]** を選択します。 |
    | Protocol | **[TCP]** を選択します。 |
    | Port | 「**80**」と入力します。 |
    | バックエンド ポート | 「**80**」と入力します。 |
    | バックエンド プール | **[myBackendPool]** を選択します。 |
    | 正常性プローブ | **[新規作成]** を選択します。 </br> **[名前]** に、「**myHealthProbe**」と入力します。 </br> **[プロトコル]** で、 **[HTTP]** を選択します。 </br> 残りの部分は既定値のままにし、 **[OK]** を選択します。 |
    | セッション永続化 | **[なし]** を選択します。 |
    | アイドル タイムアウト (分) | 「**15**」を入力または選択します。 |
    | TCP リセット | **[Enabled]** を選択します。 |
    | フローティング IP | **[無効]** をクリックします。 |

20. **[追加]** を選択します。

21. ページ下部にある青色の **[確認と作成]** ボタンを選択します。

22. **［作成］** を選択します

    > [!NOTE]
    > この例では、送信インターネット アクセスを提供する NAT ゲートウェイを作成しました。 構成の [アウトバウンド規則] タブはバイパスされ、NAT ゲートウェイでは必要ありません。 Azure NAT ゲートウェイの詳細については、「[Virtual Network NAT とは](../virtual-network/nat-gateway/nat-overview.md)」を参照してください。
    > Azure でのアウトバウンド接続の詳細については、[アウトバウンド接続の送信元ネットワーク アドレス変換 (SNAT)](../load-balancer/load-balancer-outbound-connections.md) に関するページを参照してください。

## <a name="create-virtual-machines"></a>仮想マシンを作成する

このセクションでは、3 つの異なるゾーン (**Zone 1**、**Zone 2**、および **Zone 3**) に 3 つの VM (**myVM1**、**myVM2**、および **myVM3**) を作成します。 

これらの VM を、前に作成したロード バランサーのバックエンド プールに追加します。

1. ポータルの上部にある検索ボックスに、「**仮想マシン**」と入力します。 検索結果から **[仮想マシン]** を選択します。

2. **[仮想マシン]** で、 **[+ 作成]**  >  **[仮想マシン]** を選択します。
   
3. **[仮想マシンの作成]** の **[基本]** タブに、値を入力するか選択します。

    | 設定 | 値                                          |
    |-----------------------|----------------------------------|
    | **プロジェクトの詳細** |  |
    | サブスクリプション | Azure サブスクリプションを選択します。 |
    | リソース グループ | **CreateIntLBQS-rg** を選択します |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | 「**myVM1**」と入力します |
    | リージョン | **[(ヨーロッパ) 西ヨーロッパ]** を選択します |
    | 可用性オプション | **[可用性ゾーン]** を選択します |
    | 可用性ゾーン | **[1]** を選択します |
    | Image | **[Windows Server 2019 Datacenter - Gen1]** を選択します |
    | Azure Spot インスタンス | 既定値のオフのままにします。 |
    | サイズ | VM サイズを選択するか、既定の設定を使用します |
    | **管理者アカウント** |  |
    | ユーザー名 | ユーザー名を入力します |
    | Password | [パスワード] を入力します |
    | [パスワードの確認入力] | パスワードを再入力します |
    | **受信ポートの規則** |  |
    | パブリック受信ポート | **[なし]** を選択します |

4. **[ネットワーク]** タブまたは **[次へ: ディスク]** を選択してから **[次へ: ネットワーク]** を選択します。
  
5. [ネットワーク] タブで、次を選択または入力します。

    | 設定 | 値 |
    |-|-|
    | **ネットワーク インターフェイス** |  |
    | 仮想ネットワーク | **myVNet** |
    | Subnet | **myBackendSubnet** |
    | パブリック IP | **[なし]** を選択します。 |
    | NIC ネットワーク セキュリティ グループ | **[Advanced] \(詳細設定)** を選択します|
    | ネットワーク セキュリティ グループを構成する | **[新規作成]** を選択します。 </br> **[ネットワーク セキュリティ グループの作成]** で、 **[名前]** に「**myNSG**」と入力します。 </br> **[受信規則]** で、[ **+ 受信規則の追加]** を選択します。 </br> **[宛先ポート範囲]** で、「**80**」と入力します。 </br> **[優先度]** に「**100**」と入力します。 </br> **[名前]** に「**myNSGRule**」と入力します。 </br> **[追加]** を選択します。 </br> **[OK]** を選択します。 |
    | **負荷分散**  |
    | この仮想マシンを既存の負荷分散ソリューションの後ろに配置しますか? | ボックスを選択します。 |
    | **ロード バランサーの設定** |
    | 負荷分散のオプション | **[Azure load balancing]\(Azure 負荷分散\)** を選択します |
    | ロード バランサーを選択する | **[myLoadBalancer]** を選択します  |
    | バックエンド プールを選択する | **[myBackendPool]** を選択します |
   
6. **[Review + create]\(レビュー + 作成\)** を選択します。 
  
7. 設定を確認し、 **[作成]** を選択します。

8. 手順 1 から 7 に従って、さらに 2 つの VM を作成します。次の値を使用し、他の設定はすべて **myVM1** と同じにします。

    | 設定 | VM 2| VM 3|
    | ------- | ----- |---|
    | 名前 |  **myVM2** |**myVM3**|
    | 可用性ゾーン | **2** |**3**|
    | ネットワーク セキュリティ グループ | 既存の **[myNSG]** を選択します| 既存の **[myNSG]** を選択します|

[!INCLUDE [ephemeral-ip-note.md](../../includes/ephemeral-ip-note.md)]

# <a name="basic-sku"></a>[**Basic SKU**](#tab/option-2-create-load-balancer-basic)

>[!NOTE]
>運用環境のワークロードには、Standard SKU ロード バランサーをお勧めします。  SKU の詳細については、「 **[Azure Load Balancer の SKU](skus.md)** 」を参照してください。

## <a name="create-the-virtual-network"></a>仮想ネットワークの作成

このセクションでは、仮想ネットワークとサブネットを作成します。

1. ポータルの上部にある検索ボックスに、「**仮想ネットワーク**」と入力します。 検索結果で、 **[仮想ネットワーク]** を選択します。

2. **[仮想ネットワーク]** で **[+ 作成]** を選択します。

3. **[仮想ネットワークの作成]** の **[基本]** タブで次の情報を入力または選択します。

    | **設定**          | **Value**                                                           |
    |------------------|-----------------------------------------------------------------|
    | **プロジェクトの詳細**  |                                                                 |
    | サブスクリプション     | Azure サブスクリプションを選択します。                                  |
    | リソース グループ   | **[新規作成]** を選択します。 </br> **[名前]** に「**CreateIntLBQS-rg**」 と入力します。 </br> **[OK]** を選択します。 |
    | **インスタンスの詳細** |                                                                 |
    | 名前             | 「**myVNet**」と入力します                                    |
    | リージョン           | **[(ヨーロッパ) 西ヨーロッパ]** を選択します |

4. **[IP アドレス]** タブを選択するか、ページの下部にある **[Next: IP Addresses]\(次へ: IP アドレス\)** ボタンを選択します。

5. **[IP アドレス]** タブで、次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | IPv4 アドレス空間 | 「**10.1.0.0/16**」と入力します。 |

6. **[サブネット名]** で、 **[default]\(既定\)** という単語を選択します。

7. **[サブネットの編集]** に次の情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | サブネット名 | 「**myBackendSubnet**」と入力します |
    | サブネットのアドレス範囲 | 「**10.1.0.0/27**」と入力します |

8. **[保存]** を選択します。

9. **[セキュリティ]** タブをクリックします。

10. **[BastionHost]** で **[有効にする]** を選択します。 この情報を入力します。

    | 設定            | 値                      |
    |--------------------|----------------------------|
    | 要塞名 | 「**myBastionHost**」と入力します |
    | AzureBastionSubnet のアドレス空間 | 「**10.1.1.0/24**」と入力します |
    | パブリック IP アドレス | **[新規作成]** を選択します。 </br> **[名前]** に「**myBastionIP**」と入力します。 </br> **[OK]** を選択します。 |

11. **[確認と作成]** タブを選択するか、 **[確認と作成]** ボタンを選択します。

12. **［作成］** を選択します

## <a name="create-load-balancer"></a>ロード バランサーの作成

このセクションでは、仮想マシンの負荷分散を行うロード バランサーを作成します。

ロード バランサーの作成中に、次の構成を行います。

* フロントエンド IP アドレス
* バックエンド プール
* インバウンドの負荷分散規則

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。 検索結果で **[ロード バランサー]** を選択します。

2. **[ロード バランサー]** ページで、 **[作成]** を選択します。

3. **[ロード バランサーの作成]** ページの **[基本]** タブで、次の情報を入力または選択します。 

    | 設定                 | 値                                              |
    | ---                     | ---                                                |
    | **プロジェクトの詳細** |   |
    | サブスクリプション               | サブスクリプションを選択します。    |    
    | Resource group         | **[CreateIntLBQS-rg]** を選択します。 |
    | **インスタンスの詳細** |   |
    | 名前                   | 「**myLoadBalancer**」と入力します                                   |
    | リージョン         | **[(ヨーロッパ) 西ヨーロッパ]** を選択します。                                        |
    | Type          | **[内部]** を選択します。                                        |
    | SKU           | **[Basic]** を選択します。 |

    :::image type="content" source="./media/quickstart-load-balancer-standard-internal-portal/create-basic-internal-load-balancer.png" alt-text="Standard ロード バランサーを作成する [基本] タブのスクリーンショット。" border="true":::

4. ページ下部にある **[次へ: フロントエンド IP の構成]** を選択します。

5. **[フロントエンド IP の構成]** で、 **[+ フロントエンド IP の追加]** を選択します。

6. **[名前]** に、「**LoadBalancerFrontend**」と入力します。

7. **[サブネット]** で **[myBackendSubnet]** を選択します。

8. **[割り当て]** で **[動的]** を選択します。

9. **[追加]** を選択します。

10. ページ下部で **[次へ: バックエンド プール]** を選択します。

11. **[バックエンド プール]** タブで、 **[+ バックエンド プールの追加]** を選択します。

12. **[バックエンド プールの追加]** の **[名前]** に「**myBackendPool**」と入力します。

13. **[関連付け先]** で **[仮想マシン]** を選択します。

14. **[IP バージョン]** には **[IPv4]** または **[IPv6]** を選択します。

15. **[追加]** を選択します。

16. ページ下部にある **[次へ: 受信規則]** ボタンを選択します。

17. **[受信規則]** タブの **[負荷分散規則]** で、 **[+ 負荷分散規則の追加]** を選択します。

18. **[負荷分散規則の追加]** で、次の情報を入力または選択します。

    | 設定 | 値 |
    | ------- | ----- |
    | Name | 「**myHTTPRule**」と入力します。 |
    | IP バージョン | 要件に応じて、 **[IPv4]** または **[IPv6]** を選択します。 |
    | フロントエンド IP アドレス | **[LoadBalancerFrontend]** を選択します。 |
    | Protocol | **[TCP]** を選択します。 |
    | Port | 「**80**」と入力します。 |
    | バックエンド ポート | 「**80**」と入力します。 |
    | バックエンド プール | **[myBackendPool]** を選択します。 |
    | 正常性プローブ | **[新規作成]** を選択します。 </br> **[名前]** に、「**myHealthProbe**」と入力します。 </br> **[プロトコル]** で、 **[HTTP]** を選択します。 </br> 残りの部分は既定値のままにし、 **[OK]** を選択します。 |
    | セッション永続化 | **[なし]** を選択します。 |
    | アイドル タイムアウト (分) | 「**15**」を入力または選択します。 |
    | フローティング IP | **[無効]** をクリックします。 |

19. **[追加]** を選択します。

20. ページ下部にある青色の **[確認と作成]** ボタンを選択します。

21. **［作成］** を選択します

    > [!NOTE]
    > この例では、送信インターネット アクセスを提供する NAT ゲートウェイを作成しました。 構成の [アウトバウンド規則] タブはバイパスされ、NAT ゲートウェイでは必要ありません。 Azure NAT ゲートウェイの詳細については、「[Virtual Network NAT とは](../virtual-network/nat-gateway/nat-overview.md)」を参照してください。
    > Azure でのアウトバウンド接続の詳細については、[アウトバウンド接続の送信元ネットワーク アドレス変換 (SNAT)](../load-balancer/load-balancer-outbound-connections.md) に関するページを参照してください。

## <a name="create-virtual-machines"></a>仮想マシンを作成する

このセクションでは、3 つの VM (**myVM1**、**myVM2**、**myVM3**) を作成します。

3 つの VM は **myAvailabilitySet** という名前の可用性セットに追加します。

1. ポータルの上部にある検索ボックスに、「**仮想マシン**」と入力します。 検索結果から **[仮想マシン]** を選択します。

2. **[仮想マシン]** で、 **[+ 作成]**  >  **[仮想マシン]** を選択します。
   
3. **[仮想マシンの作成]** の **[Basic]** タブに、値を入力するか選択します。

    | 設定 | 値                                          |
    |-----------------------|----------------------------------|
    | **プロジェクトの詳細** |  |
    | サブスクリプション | Azure サブスクリプションを選択します。 |
    | リソース グループ | **CreateIntLBQS-rg** を選択します |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | 「**myVM1**」と入力します |
    | リージョン | **[(ヨーロッパ) 西ヨーロッパ]** を選択します |
    | 可用性オプション | **[可用性セット]** を選択します |
    | 可用性セット | **[新規作成]** を選択します。 </br> **[名前]** に「**myAvailabilitySet**」と入力します。 </br> **[OK]** を選択します。 |
    | Image | **Windows Server 2019 Datacenter - Gen1** |
    | Azure Spot インスタンス | 既定値のオフのままにします。 |
    | サイズ | VM サイズを選択するか、既定の設定を使用します |
    | **管理者アカウント** |  |
    | ユーザー名 | ユーザー名を入力します |
    | Password | [パスワード] を入力します |
    | [パスワードの確認入力] | パスワードを再入力します |
    | **受信ポートの規則** |   |
    | パブリック受信ポート | **[なし]** を選択します。 |

4. **[ネットワーク]** タブまたは **[次へ: ディスク]** を選択してから **[次へ: ネットワーク]** を選択します。
  
5. [ネットワーク] タブで、次を選択または入力します。

    | 設定 | 値 |
    |-|-|
    | **ネットワーク インターフェイス** |  |
    | 仮想ネットワーク | **[myVNet]** を選択します |
    | Subnet | **[myBackendSubnet]** を選択します |
    | パブリック IP | **[なし]** を選択します |
    | NIC ネットワーク セキュリティ グループ | **[Advanced] \(詳細設定)** を選択します|
    | ネットワーク セキュリティ グループを構成する | **[新規作成]** を選択します。 </br> **[ネットワーク セキュリティ グループの作成]** で、 **[名前]** に「**myNSG**」と入力します。 </br> **[受信規則]** で、[ **+ 受信規則の追加]** を選択します。 </br> **[宛先ポート範囲]** で、「**80**」と入力します。 </br> **[優先度]** に「**100**」と入力します。 </br> **[名前]** に「**myNSGRule**」と入力します。 </br> **[追加]** を選択します。 </br> **[OK]** を選択します。 |
    | **負荷分散**  |
    | この仮想マシンを既存の負荷分散ソリューションの後ろに配置しますか? | ボックスを選択します。 |
    | **ロード バランサーの設定** |   |
    | 負荷分散のオプション | **[Azure Load Balancer]** を選択します。 |
    | ロード バランサーを選択する | **[myLoadBalancer]** を選択します。 |
    | バックエンド プールを選択する | **[myBackendPool]** を選択します。 |
 
6. **[Review + create]\(レビュー + 作成\)** を選択します。 
  
7. 設定を確認し、 **[作成]** を選択します。

8. 手順 1 から 7 に従って、さらに 2 つの VM を作成します。次の値を使用し、他の設定はすべて **myVM1** と同じにします。

    | 設定 | VM 2 | VM 3 |
    | ------- | ----- |---|
    | 名前 |  **myVM2** |**myVM3**|
    | 可用性セット| **[myAvailabilitySet]** を選択します | **[myAvailabilitySet]** を選択します|
    | ネットワーク セキュリティ グループ | 既存の **[myNSG]** を選択します| 既存の **[myNSG]** を選択します|

[!INCLUDE [ephemeral-ip-note.md](../../includes/ephemeral-ip-note.md)]
---

## <a name="create-test-virtual-machine"></a>テスト用の仮想マシンを作成する

このセクションでは、**myTestVM** という名前の VM を作成します。  この VM を使用して、ロード バランサーの構成をテストします。

1. ポータルの上部にある検索ボックスに、「**仮想マシン**」と入力します。 検索結果から **[仮想マシン]** を選択します。

2. **[仮想マシン]** で、 **[+ 作成]**  >  **[仮想マシン]** を選択します。
   
2. **[仮想マシンの作成]** の **[Basic]** タブに、値を入力するか選択します。

    | 設定 | 値                                          |
    |-----------------------|----------------------------------|
    | **プロジェクトの詳細** |  |
    | サブスクリプション | Azure サブスクリプションを選択します。 |
    | リソース グループ | **CreateIntLBQS-rg** を選択します |
    | **インスタンスの詳細** |  |
    | 仮想マシン名 | 「**myTestVM**」と入力します |
    | リージョン | **[(ヨーロッパ) 西ヨーロッパ]** を選択します |
    | 可用性オプション | **[インフラストラクチャ冗長は必要ありません]** を選択します |
    | Image | **[Windows Server 2019 Datacenter]** を選択します |
    | Azure Spot インスタンス | 既定値の未選択のままにします。 |
    | サイズ | VM サイズを選択するか、既定の設定を使用します |
    | **管理者アカウント** |  |
    | ユーザー名 | ユーザー名を入力します |
    | Password | [パスワード] を入力します |
    | [パスワードの確認入力] | パスワードを再入力します |
    | **受信ポートの規則** |   |
    | パブリック受信ポート | **[なし]** を選択します。 |

3. **[ネットワーク]** タブまたは **[次へ: ディスク]** を選択してから **[次へ: ネットワーク]** を選択します。
  
4. **[ネットワーク]** タブで、次を選択または入力します。

    | 設定 | 値 |
    |-|-|
    | **ネットワーク インターフェイス** |  |
    | 仮想ネットワーク | **myVNet** |
    | Subnet | **myBackendSubnet** |
    | パブリック IP | **[なし]** を選択します。 |
    | NIC ネットワーク セキュリティ グループ | **[Advanced] \(詳細設定)** を選択します |
    | ネットワーク セキュリティ グループを構成する | 前のステップで作成した **MyNSG** を選択します。|
       
5. **[Review + create]\(レビュー + 作成\)** を選択します。 
  
6. 設定を確認し、 **[作成]** を選択します。

## <a name="install-iis"></a>IIS のインストール

1. ポータルの上部にある検索ボックスに、「**仮想マシン**」と入力します。 検索結果から **[仮想マシン]** を選択します。

2. **[myVM1]** を選択します。

3. **[概要]** ページで **[接続]** 、 **[Bastion]** の順に選択します。

4. **[Bastion を使用する]** を選択します。 

5. VM 作成時に入力したユーザー名とパスワードを入力します。

6. **[接続]** を選択します。

7. サーバーのデスクトップで、 **[Windows 管理ツール]**  >  **[Windows PowerShell]**  >  **[Windows PowerShell]** の順に移動します。

8. PowerShell ウィンドウで、次のコマンドを実行して以下の作業を行います。

    * IIS サーバーをインストールします。
    * 既定の iisstart.htm ファイルを削除します。
    * VM の名前が表示された新しい iisstart.htm ファイルを追加します。

   ```powershell
    
    # Install IIS server role
    Install-WindowsFeature -name Web-Server -IncludeManagementTools
    
    # Remove default htm file
    Remove-Item  C:\inetpub\wwwroot\iisstart.htm
    
    # Add a new htm file that displays server name
    Add-Content -Path "C:\inetpub\wwwroot\iisstart.htm" -Value $("Hello World from " + $env:computername)
   ```

9. **myVM1** との Bastion セッションを閉じます。

10. 手順 1 から 9 を繰り返して、IIS と更新済み iisstart.htm ファイルを **myVM2** と **myVM3** にインストールします。

## <a name="test-the-load-balancer"></a>ロード バランサーをテストする

このセクションでは、**myTestVM** に接続し、Web ページを確認して、ロード バランサーをテストします。

1. ポータルの上部にある検索ボックスに、「**ロード バランサー**」と入力します。 検索結果で **[ロード バランサー]** を選択します。

2. **[myLoadBalancer]** を選択します。

3. **myLoadBalancer** の **[概要]** で、 **[プライベート IP アドレス]** の横にあるアドレスを書き留めるか、コピーしておきます。

4. ポータルの上部にある検索ボックスに、「**仮想マシン**」と入力します。 検索結果から **[仮想マシン]** を選択します。

5. **[myTestVM]** を選択します。

6. **[概要]** ページで **[接続]** 、 **[Bastion]** の順に選択します。

7. **[Bastion を使用する]** を選択します。

8. VM 作成時に入力したユーザー名とパスワードを入力します。

9. **myTestVM** で **Internet Explorer** 開きます。

10. 前の手順の IP アドレスをブラウザーのアドレス バーに入力します。 バックエンド サーバー名の 1 つを表示するカスタム ページがブラウザーに表示されます。

    :::image type="content" source="./media/quickstart-load-balancer-standard-internal-portal/load-balancer-test.png" alt-text="想定どおりに、カスタマイズされたページが表示されたブラウザー ウィンドウを示すスクリーンショット。" border="true":::
   
ロード バランサーによって両方の VM 間でトラフィックが分散されていることを確認するには、クライアント マシンから Web ブラウザーを強制的に更新します。

## <a name="clean-up-resources"></a>リソースをクリーンアップする

リソース グループ、ロード バランサー、および関連するすべてのリソースは、不要になったら削除します。 これを行うには、リソースを含むリソース グループ (**CreateIntLBQS-rg**) を選択し、 **[削除]** を選択します。

## <a name="next-steps"></a>次のステップ

このクイック スタートでは次の作業を行います。

* Azure の Standard または Basic の内部ロード バランサーを作成しました
* 3 つの VM をロード バランサーに接続しました。
* ロード バランサー トラフィック規則と正常性プローブを構成し、ロード バランサーをテストしました。 

Azure Load Balancer についてさらに学習するには、次の記事に進んでください。
> [!div class="nextstepaction"]
> [Azure Load Balancer の概要](load-balancer-overview.md)