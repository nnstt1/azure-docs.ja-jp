---
title: Azure Front Door のバックエンドとバックエンド プール | Microsoft Docs
description: この記事では、Front Door 構成におけるバックエンドとバックエンド プールについて説明します。
services: front-door
documentationcenter: ''
author: duongau
ms.service: frontdoor
ms.devlang: na
ms.topic: article
ms.tgt_pltfrm: na
ms.workload: infrastructure-services
ms.date: 09/28/2020
ms.author: duau
ms.openlocfilehash: 68feb1c2df14c3325ae74ef36874e7008bf9d108
ms.sourcegitcommit: 901ea2c2e12c5ed009f642ae8021e27d64d6741e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/12/2021
ms.locfileid: "132371032"
---
# <a name="backends-and-backend-pools-in-azure-front-door"></a>Azure Front Door のバックエンドとバックエンド プール
この記事では、Azure Front Door で Web アプリのデプロイがマップされる方法に関する概念について説明します。 また、アプリケーション バックエンドに関する Front Door 構成で使用されるさまざまな用語についても説明します。

## <a name="backends"></a>バックエンド
バックエンドとは、リージョン内の Web アプリケーションのデプロイを指します。 Front Door は、バックエンド プール内の Azure リソースと Azure 以外のリソースの両方をサポートします。 アプリケーションは、オンプレミスのデータセンターに配置するか、別のクラウド プロバイダーに配置することができます。

Front Door のバックエンドは、クライアントの要求を処理するアプリのホスト名またはパブリック IP を指します。 バックエンドを、データベース層やストレージ層などと混同しないでください。 バックエンドは、アプリケーション バックエンドのパブリック エンドポイントと見なす必要があります。 Front Door バックエンド プールにバックエンドを追加するときは、次のものも追加する必要があります。

- **バックエンド ホストの種類**。 追加するリソースの種類。 Front Door では、アプリ サービス、クラウド サービス、またはストレージからのアプリ バックエンドの自動検出がサポートされています。 Azure または Azure 以外のバックエンドで別のリソースが必要な場合は、**カスタム ホスト** を選択します。

    >[!IMPORTANT]
    >構成中、API は、Front Door 環境からバックエンドにアクセスできないかどうかを検証しません。 Front Door がバックエンドにアクセスできることを確認してください。

- **サブスクリプションとバックエンドのホスト名**。 バックエンド ホストの種類に **カスタム ホスト** を選択していない場合は、UI で適切なサブスクリプションと対応するバックエンド ホスト名を選択することで、バックエンドを選択します。

- **バックエンド ホスト ヘッダー**。 各要求でバックエンドに送信されるホスト ヘッダーの値です。 詳細については、「[バックエンド ホスト ヘッダー](#hostheader)」を参照してください。

- **優先順位**。 すべてのトラフィックにプライマリ サービス バックエンドを使用する場合は、さまざまなバックエンドに優先順位を割り当てます。 さらに、プライマリまたはバックアップのバックエンドが使用できない場合は、バックアップを用意します。 詳細については、[優先順位](front-door-routing-methods.md#priority)に関するセクションを参照してください。

- **重み**。 均等にまたは重み係数に従って一連のバックエンド間でトラフィックを分散するには、さまざまなバックエンドに重みを割り当てます。 詳細については、[重み](front-door-routing-methods.md#weighted)に関するセクションを参照してください。

### <a name="backend-host-header"></a><a name = "hostheader"></a>バックエンド ホスト ヘッダー

Front Door によりバックエンドに転送された要求には、対象のリソースを取得するためにバックエンドで使用されるホスト ヘッダー フィールドが含まれています。 このフィールドの値は通常、ホスト ヘッダーとポートを含むバックエンドの URI から取得します。

たとえば、`www.contoso.com` に対する要求には、ホスト ヘッダー www.contoso.com が含まれます。 Azure portal を使用してバックエンドを構成する場合、このフィールドの既定値はバックエンドのホスト名です。 バックエンドが contoso-westus.azurewebsites.net である場合、Azure portal 内でバックエンド ホスト ヘッダーに自動的に設定される値は contoso-westus.azurewebsites.net です。 ただし、このフィールドを明示的に設定せずに Azure Resource Manager テンプレートまたは別の方法を使用すると、Front Door ではホスト ヘッダーの値として受信ホスト名が送信されます。 www\.contoso.com に対して要求が行われ、バックエンドが空のヘッダー フィールドを持つ contoso-westus.azurewebsites.net である場合、Front Door ではホスト ヘッダーが www\.contoso.com として設定されます。

ほとんどのアプリ バックエンド (Azure Web Apps、Blob Storage、Cloud Services など) では、ホスト ヘッダーがバックエンドのドメインと一致している必要があります。 ただし、バックエンドにルーティングするフロントエンド ホストでは、`www.contoso.net` などの別のホスト名が使用されます。

バックエンドでホスト ヘッダーがバックエンド ホスト名と一致している必要がある場合は、バックエンドのホスト ヘッダーにバックエンドのホスト名が含まれていることを確認します。

#### <a name="configuring-the-backend-host-header-for-the-backend"></a>バックエンドのバックエンドのホスト ヘッダーの構成

[バックエンド プール] セクションでバックエンド用の **[バックエンド ホスト ヘッダー]** フィールドを構成するには:

1. Front Door リソースを開き、構成するバックエンドが含まれているバックエンド プールを選択します。

2. バックエンドを追加するか (まだ追加していない場合)、既存のバックエンドを編集します。

3. [バックエンド ホスト ヘッダー] フィールドをカスタム値を設定するか空白のままにします。 受信要求のホスト名は、ホスト ヘッダー値として使用されます。

## <a name="backend-pools"></a>バックエンド プール
Front Door のバックエンド プールとは、アプリに関する同様のトラフィックを受信するバックエンドのセットを指します。 つまり、同じトラフィックを受信し、想定される動作で応答する世界中のアプリ インスタンスの論理グループになります。 これらのバックエンドは、異なるリージョンにまたがってデプロイされるか、同じリージョン内でデプロイされます。 バックエンドはすべて、アクティブ/アクティブ デプロイ モードで指定するか、アクティブ/パッシブ構成として定義された内容に含めることができます。

バックエンド プールでは、さまざまなバックエンドを正常性プローブで評価する方法を定義します。 また、それらの間でどのように負荷分散が行われるかも定義します。

### <a name="health-probes"></a>正常性プローブ
Front Door では、構成されたバックエンドそれぞれに定期的な HTTP または HTTPS プローブ要求が送信されます。 プローブ要求は、エンドユーザーの要求の負荷を分散するために、各バックエンドの近接性と正常性を判別します。 バックエンド プールの正常性プローブの設定では、アプリ バックエンドの正常性状態をポーリングする方法を定義します。 次の設定は、負荷分散構成で使用できます。

- **パス**:バックエンド プール内のすべてのバックエンドに対するプローブ要求に使用される URL。 たとえば、バックエンドの 1 つが contoso-westus.azurewebsites.net で、そのパスが /probe/test.aspx に設定されている場合、Front Door 環境では、プロトコルが HTTP に設定されていると想定して、正常性プローブ要求が http\://contoso-westus.azurewebsites.net/probe/test.aspx に送信されます。

- **プロトコル**:Front Door からバックエンドへの正常性プローブ要求を HTTP と HTTPS プロトコルのどちらを経由して送信するかを定義します。

- **メソッド**: 正常性プローブの送信に使用される HTTP メソッド。 オプションには、GET または HEAD (既定値) があります。
    > [!NOTE]
    > バックエンドの負荷とコストを抑えるため、Front Door では正常性プローブに HEAD 要求を使用することが推奨されています。

- **間隔 (秒)** :バックエンドに対する正常性プローブの頻度、つまり各 Front Door 環境がプローブを送信する間隔を定義します。

    >[!NOTE]
    >フェールオーバーを高速化するには、間隔をより小さい値に設定してください。 値が小さくなると、バックエンドが受信する正常性プローブのボリュームは大きくなります。 たとえば、間隔が 30 秒に設定されていて、100 個の Front Door POP が世界中に存在する場合、各バックエンドは 1 分あたり約 200 件のプローブ要求を受信します。

詳細については、「[正常性プローブ](front-door-health-probes.md)」を参照してください。

### <a name="load-balancing-settings"></a>負荷分散の設定
バックエンド プールの負荷分散の設定では、正常性プローブの評価方法を定義します。 これらの設定により、バックエンドが正常か異常かが判断されます。 また、バックエンド プール内の異なるバックエンド間でのトラフィックの負荷分散方法も確認されます。 次の設定は、負荷分散構成で使用できます。

- **サンプル サイズ**。 バックエンド正常性評価のために検討が必要な正常性プローブのサンプル数を特定します。

- **成功サンプル サイズ**。 前述のとおり、サンプル サイズ、つまりバックエンドが正常であると見なすために必要な成功サンプルの数を定義します。 たとえば、Front Door の正常性プローブの間隔が 30 秒、サンプル サイズが 5、成功サンプル サイズが 3 だとします。 バックエンドの正常性プローブを評価するたびに、150 秒間 (5 x 30) で最新の 5 つのサンプルを確認します。 バックエンドが正常であると宣言するには、少なくとも 3 つのプローブが成功している必要があります。

- **待機時間感度 (追加の待機時間)** 。 Front Door で待ち時間の測定感度の範囲内にあるバックエンドに要求を送信するか、最も近いバックエンドに要求を転送するかを定義します。

詳細については、[最小限の待ち時間ベースのルーティング方法](front-door-routing-methods.md#latency)に関するセクションを参照してください。

## <a name="next-steps"></a>次のステップ

- [Front Door プロファイルの作成](quickstart-create-front-door.md)
- [Front Door のしくみ](front-door-routing-architecture.md)
