---
title: Azure Front Door Standard または Premium における配信元と配信元グループ
description: この記事では、Azure Front Door 構成における配信元と配信元グループについて説明します。
services: frontdoor
author: duongau
ms.service: frontdoor
ms.topic: conceptual
ms.date: 02/18/2021
ms.author: duau
ms.openlocfilehash: 42c90d009aefb399e7635ec4a7cd09f884f3c51c
ms.sourcegitcommit: beff1803eeb28b60482560eee8967122653bc19c
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/07/2021
ms.locfileid: "113437650"
---
# <a name="origin-and-origin-group-in-azure-front-door-standardpremium-preview"></a>Azure Front Door Standard または Premium (プレビュー) における配信元と配信元グループ

> [!Note]
> このドキュメントは、Azure Front Door Standard/Premium (プレビュー) を対象としています。 Azure Front Door については、 [こちら](../front-door-overview.md)を参照してください。

この記事では、Azure Front Door Standard または Premium での Web アプリケーション デプロイの仕組みの概念について説明します。 また、Azure Front Door Standard または Premium 構成における "*配信元*" と "*配信元グループ*" とは何かについても説明します。

> [!IMPORTANT]
> Azure Front Door Standard/Premium (プレビュー) は現在、パブリック プレビュー段階です。
> このプレビュー バージョンはサービス レベル アグリーメントなしで提供されています。運用環境のワークロードに使用することはお勧めできません。 特定の機能はサポート対象ではなく、機能が制限されることがあります。
> 詳しくは、[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)に関するページをご覧ください。

## <a name="origin"></a>出発地

Azure Front Door Standard または Premium の配信元とは、クライアント要求を処理するアプリケーションのホスト名またはパブリック IP を指します。 Azure Front Door Standard/Premium では、Azure origin および Azure origin 以外の両方が、たとえば、ご自身のアプリケーションがオンプレミスのデータセンター内でホストされているとき、または他のクラウド プロバイダーを使ってホストされているときにサポートされます。 配信元を、データベース層やストレージ層と混同しないでください。 配信元は、アプリケーション バックエンドのエンドポイントと見なす必要があります。 Azure Front Door Standard または Premium の配信元グループに配信元を追加する場合は、次の情報も追加する必要があります。

* **配信元の種類**: 追加するリソースの種類。 Front Door では、App Service、クラウド サービス、または Storage からのアプリケーション バックエンドの自動検出がサポートされています。 Azure または Azure 以外のバックエンドで別のリソースが必要な場合は、**カスタム ホスト** を選択します。

    >[!IMPORTANT]
    >構成中、API では、配信元が Front Door 環境からアクセスできないかどうかは検証されません。 Front Door が配信元にアクセスできることを確認してください。

* **サブスクリプションと配信元ホスト名:** バックエンドのホストの種類として **カスタム ホスト** を選択しなかった場合は、バックエンドを選択します。そのためには、適切なサブスクリプションと、対応するバックエンド ホスト名を選択します。

* **配信元のホスト ヘッダー:** 各要求でバックエンドに送信されるホスト ヘッダーの値。 詳細については、「[配信元のホスト ヘッダー](#hostheader)」を参照してください。

* **優先順位:** すべてのトラフィックにプライマリの配信元を使用する場合は配信元ごとに優先順位を割り当てます。 さらに、プライマリまたはバックアップの配信元が使用できない場合のバックアップを提供します。 詳細については、[優先順位](#priority)に関するセクションを参照してください。

* **重み:** 均等に、または重み係数に従って一連の配信元間にトラフィックを分散するには、配信元ごとに重みを割り当てます。 詳細については、[重み](#weighted)に関するセクションを参照してください。

### <a name="origin-host-header"></a><a name = "hostheader"></a>配信元のホスト ヘッダー

Azure Front Door Standard または Premium によって配信元に転送される要求には、対象のリソースを取得するために発信元で使用されるホスト ヘッダー フィールドが含まれます。 このフィールドの値は通常、ホスト ヘッダーとポートが含まれている配信元の URI から取得します。

たとえば、`www.contoso.com` に対する要求にはホスト ヘッダー`www.contoso.com` が含まれます。 Azure portal を使用して配信元を構成する場合、このフィールドの既定値はバックエンドのホスト名です。 配信元が `contoso-westus.azurewebsites.net` の場合、Azure portal で、配信元ホストのヘッダーに自動的に設定される値は `contoso-westus.azurewebsites.net` になります。 ただし、このフィールドを明示的に設定せずに Azure Resource Manager テンプレートまたは別の方法を使用すると、Front Door ではホスト ヘッダーの値として受信ホスト名が送信されます。 `www.contoso.com` に対して要求が行われ、空のヘッダー フィールドを持つ `contoso-westus.azurewebsites.net` が配信元の場合、ホスト ヘッダーが `www.contoso.com` に設定されます。

ほとんどのアプリ バックエンド (Azure Web Apps、Blob Storage、Cloud Services など) では、ホスト ヘッダーがバックエンドのドメインと一致している必要があります。 ただし、バックエンドにルーティングするフロントエンド ホストでは、`www.contoso.net` などの別のホスト名が使用されます。

配信元でホスト ヘッダーがバックエンドのホスト名と一致している必要がある場合は、バックエンドのホスト ヘッダーにバックエンドのホスト名が含まれていることを確認します。

#### <a name="configuring-the-origin-host-header-for-the-origin"></a>配信元に対する配信元のホスト ヘッダーの構成

配信元グループ セクション内の配信元用に **[origin host header]\(配信元のホスト ヘッダー\)** フィールドを構成するには、次のようにします。

1. お使いのフロント ドア リソースを開き、構成する配信元が含まれている配信元グループを選択します。

2. 配信元を追加していない場合は追加します。または、既存のものを編集します。

3. [origin host header]\(配信元のホスト ヘッダー\) フィールドをカスタム値に設定するか、空白のままにします。 受信要求のホスト名は、ホスト ヘッダー値として使用されます。

## <a name="origin-group"></a>配信元グループ

Azure Front Door Standard または Premium において配信元グループとは、アプリケーションに対して同様のトラフィックを受信する一連の配信元を指します。 つまり、同じトラフィックを受信し、想定された動作で応答する世界中のアプリ インスタンスの論理的なグループです。 これらの配信元は、異なるリージョンにまたがって、または同じリージョン内にデプロイされます。 すべての配信元は、アクティブ/アクティブのデプロイ モードであるか、アクティブ/パッシブ構成として定義されています。

配信元グループでは、正常性プローブによって配信元を評価する方法が定義されています。 また、それらの間でどのように負荷分散が行われるかも定義します。

### <a name="health-probes"></a>正常性プローブ

Azure Front Door Standard または Premium では、構成されている各配信元に定期的な HTTP または HTTPS プローブ要求が送信されます。 プローブ要求では、エンドユーザーの要求を負荷分散するために、各配信元の近接性と正常性が判断されます。 配信元グループの正常性プローブの設定では、アプリ バックエンドの正常性状態をポーリングする方法が定義されています。 次の設定は、負荷分散構成で使用できます。

* **パス**: この配信元グループ内のすべての配信元に対するプローブ要求に使用される URL。 たとえば、配信元の 1 つが `contoso-westus.azurewebsites.net` で、そのパスが /probe/test.aspx に設定されている場合、Front Door 環境では、プロトコルを HTTP と想定して、正常性プローブ要求が `http://contoso-westus.azurewebsites.net/probe/test.aspx` に送信されます。

* **プロトコル**: Front Door から配信元への正常性プローブ要求を HTTP と HTTPS プロトコルのどちらで送信するかを定義します。

* **メソッド**: 正常性プローブの送信に使用される HTTP メソッド。 オプションには、GET または HEAD (既定値) があります。
    > [!NOTE]
    > バックエンドの負荷とコストを抑えるため、Front Door では正常性プローブに HEAD 要求を使用することが推奨されています。

* **間隔 (秒)** :配信元に対する正常性プローブの頻度、つまり各 Front Door 環境でプローブが送信される間隔を定義します。

    >[!NOTE]
    >フェールオーバーを高速化するには、間隔をより小さい値に設定してください。 値が小さくなると、バックエンドが受信する正常性プローブのボリュームは大きくなります。 たとえば、間隔が 30 秒に設定されていて、100 個の Front Door POP が世界中に存在する場合、各バックエンドは 1 分あたり約 200 件のプローブ要求を受信します。

詳細については、「[正常性プローブ](concept-health-probes.md)」を参照してください。

### <a name="load-balancing-settings"></a>負荷分散の設定

配信元グループの負荷分散の設定では、正常性プローブの評価方法が定義されます。 これらの設定により、配信元が正常か異常かが判断されます。 また、配信元グループ内の異なる配信元間でのトラフィックの負荷分散方法も確認されます。 次の設定は、負荷分散構成で使用できます。

* **サンプル サイズ:** 配信元の正常性評価のために検討が必要な正常性プローブのサンプル数を特定します。

* **成功サンプル サイズ:** 前述のとおり、サンプル サイズ、つまり配信元が正常であると見なすために必要な成功サンプルの数を定義します。 たとえば、Front Door の正常性プローブの間隔が 30 秒、サンプル サイズが 5、成功サンプル サイズが 3 だとします。 配信元の正常性プローブを評価するたびに、150 秒間 (5 x 30) で最新の 5 つのサンプルを確認します。 配信元が正常であると宣言するには、少なくとも 3 つのプローブが成功している必要があります。

* **待機時間感度 (追加の待機時間):** Azure Front Door Standard または Premium で、待機時間測定感度範囲内の配信元に要求を送信するか、または最も近いバックエンドに要求を転送するかを定義します。

詳細については、[最小限の待ち時間ベースのルーティング方法](#latency)に関するセクションを参照してください。

## <a name="routing-methods"></a>ルーティング方法

Azure Front Door Standard または Premium では、さまざまなサービス エンドポイントに HTTP または HTTPS トラフィックをルーティングする方法を決定するために、さまざまな種類のトラフィック ルーティング方法がサポートされています。 Front Door に到達するクライアント要求時に、構成されているルーティング方法が適用されて、要求は最適なバックエンド インスタンスに確実に転送されます。 

Front Door Standard または Premium では、次の 4 つのトラフィック ルーティング方法を使用できます。

* **[[待機時間]](#latency):** 待機時間ベースのルーティングでは、感度の範囲内で許容される最低遅延のバックエンドに要求が送信されます。 基本的に、ユーザーの要求は、ネットワーク待機時間に関して "最も近い" バックエンドのセットに送信されます。
* **[[優先順位]](#priority):** すべてのトラフィックに対応するためにプライマリ サービス バックエンドを構成する場合は、バックエンドに優先順位を割り当てられます。 プライマリ バックエンドが使用できなくなった場合、セカンダリ バックエンドはバックアップになる可能性があります。
* **[[重み付け]](#weighted):** バックエンドのセット間でトラフィックを分散する場合は、バックエンドに重み付けを割り当てることができます。 重み付け係数に基づいて均等に分散するかどうかを指定します。

Front Door Standard または Premium のすべての構成には、バックエンドの正常性および自動即時グローバル フェールオーバーの監視が含まれています。 詳細については、[バックエンドの監視](concept-health-probes.md)に関する記事を参照してください。 フロント ドアは、1 つのルーティング方法に基づいて動作することができます。 ただし、アプリケーションのニーズによっては、複数のルーティング方法を組み合わせて最適なルーティング トポロジを構築することもできます。

### <a name="lowest-latencies-based-traffic-routing"></a><a name = "latency"></a>最低遅延に基づくトラフィック ルーティング

世界中の複数の場所にバックエンドをデプロイすると、エンド ユーザーに "最も近い" 宛先にトラフィックをルーティングすることで、アプリケーションの応答性を向上させることができます。 Front Door の構成に対する既定のトラフィック ルーティング方法では、エンド ユーザーからの要求は、要求を受信した Front Door 環境の最も近いバックエンドに転送されます。 このアプローチを、Azure Front Door のエニーキャスト アーキテクチャと組み合わせると、各エンド ユーザーが、エンド ユーザーの場所に基づいて個人設定された最大限のパフォーマンスを得ることができます。

"最も近い" バックエンドは、必ずしも地理的な距離で最も近いとは限りません。 Front Door は、ネットワーク待機時間を測定することによって、最も近いバックエンドを決定します。

全体的な決定の流れを次に示します。

| 使用可能なバックエンド | 優先度 | 待機時間シグナル (正常性プローブに基づく) | 重み |
|-------------| ----------- | ----------- | ----------- |
| 最初に、有効になっていて、正常性プローブに対して正常 (200 OK) を返すすべてのバックエンドを選択します。 A、B、C、D、E、F の 6 つのバックエンドがあり、その中で C は異常、E は無効であるとします。 この場合、使用可能なバックエンドのリストは、A、B、D、F です。  | 次に、使用可能なものの中で優先順位が最も高いバックエンドが選択されます。 バックエンド A、B、D は優先順位 1、バックエンド F は優先順位 2 であるとします。 この場合、選択されるバックエンドは A、B、D です。| 待機時間の範囲 (ミリ秒単位で指定された最小待機時間と待機時間感度) でバックエンドを選択します。 要求が到着する Front Door 環境からバックエンド A が 15 ミリ秒、B が 30 ミリ秒、D が 60 ミリ秒離れていて、待機時間感度が 30 ミリ秒の場合、最低遅延プールは A と B で構成されます。なぜなら、D は最も近いバックエンドつまり A から 30 ミリ秒より大きく離れているためです。 | 最後に、Front Door は、最終的に選択されたプールのバックエンドの間で、指定されている重みの比率を使用して、トラフィックをラウンドロビンします。 たとえば、バックエンド A の重みが 5、バックエンド B の重みが 8 であるとすると、トラフィックはバックエンド A と B に 5:8 の比率で分散されます。 |

>[!NOTE]
> 既定では、待機時間感度プロパティは 0 ミリ秒に設定されます。つまり、要求は常に利用可能な最速のバックエンドに転送されます。

### <a name="priority-based-traffic-routing"></a><a name = "priority"></a>優先順位に基づくトラフィック ルーティング

多くの場合、組織ではサービスの高可用性を提供したいと考えており、主要なサービスがダウンした場合に備えて複数のバックアップ サービスをデプロイすることでこれを実行しています。 業界では、このトポロジはアクティブ/スタンバイまたはアクティブ/パッシブのデプロイ トポロジとも呼ばれます。 "優先順位" トラフィック ルーティング方法を使用すると、Azure ユーザーはこのフェールオーバー パターンを簡単に実装できます。

既定の Front Door には、優先順位が等しいバックエンドのリストが含まれています。 既定では、Front Door は優先順位が最も高い (最も小さい値) バックエンド、つまりバックエンドのプライマリ セットに対してのみ、トラフィックを送信します。 プライマリ バックエンドが使用できない場合、Front Door はバックエンドのセカンダリ セット (2 番目に小さい値) にトラフィックをルーティングします。 プライマリとセカンダリのどちらのエンドポイントも使用できない場合、トラフィックは 3 番目のバックエンドに送信されます。以降も同様です。 バックエンドの可用性は、構成されている状態 (有効または無効) と、正常性プローブによって決定される継続的なバックエンドの正常性状態に基づきます。

#### <a name="configuring-priority-for-backends"></a>バックエンドの優先順位の構成

Front Door 構成のバックエンド プールの各バックエンドは、"優先順位" と呼ばれるプロパティを持っていて、設定できる値は 1 から 5 です。 Azure Front Door では、各バックエンドのこのプロパティを使用して、バックエンドの優先順位を明示的に構成します。 このプロパティの値の範囲は、1 から 5 です。 値が小さいほど、優先順位が高くなります。 複数のバックエンドに同じ優先順位の値を設定できます。

### <a name="weighted-traffic-routing-method"></a><a name = "weighted"></a>加重トラフィック ルーティング方法
"重み付け" トラフィック ルーティング方法を使用すると、トラフィックを均等に分散したり、定義済みの重み付けを使用したりできます。

重み付けトラフィック ルーティング方式では、バックエンド プールの Front Door の構成で各バックエンドに重みを割り当てます。 重みは 1 から 1000 の整数です。 このパラメーターの既定の重みは "50" です。

許容される待機時間感度の使用可能なバックエンドのリストで、トラフィックは指定された重みの比率を使ってラウンドロビン方式で分散されます。 待機時間感度が 0 ミリ秒に設定されている場合、同じネットワーク待機時間のバックエンドが複数存在しない限り、このプロパティは反映されません。 

重み付け方式を使用することで、有用なシナリオをいくつか実現できます。

* **アプリケーションの段階的アップグレード**: 新しいバックエンドにルーティングするトラフィックのパーセンテージを与え、他のバックエンドと同等になるまで時間と共にトラフィックを徐々に増やします。
* **Azure へのアプリケーション移行**: Azure と外部バックエンドの両方を含むバックエンド プールを作成します。 バックエンドの重みを調整して新しいバックエンドを優先します。 最初に新しいバックエンドを無効に設定し、次に最低の重みを割り当て、少しずつ増やしながらほとんどのトラフィックを受け取るレベルまで段階的に上げることができます。 最後に優先順位の低いバックエンドを無効にして、プールから削除します。  
* **追加容量のクラウド バースト**: Front Door に対応させることで、オンプレミスのデプロイをクラウドにすばやく拡張します。 クラウドに追加容量が必要なとき、バックエンドを追加または有効にして、各バックエンドに送るトラフィックの割り当てを指定します。

## <a name="next-steps"></a>次のステップ

[Front Door Standard または Premium を作成する](create-front-door-portal.md)方法について説明します。
