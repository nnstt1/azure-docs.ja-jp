---
title: Azure Migrate 検出および評価ツールでの Azure SQL 評価
description: Azure Migrate 検出および評価ツールでの Azure SQL 評価について説明します
author: rashi-ms
ms.author: rajosh
ms.topic: conceptual
ms.date: 02/07/2021
ms.openlocfilehash: bba3965dc3f03bb0b42595ba6bdf5d8889b483ee
ms.sourcegitcommit: 611b35ce0f667913105ab82b23aab05a67e89fb7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/14/2021
ms.locfileid: "130004295"
---
# <a name="assessment-overview-migrate-to-azure-sql"></a>評価の概要 (Azure SQL への移行)

この記事では、[Azure Migrate: 検出および評価ツール](./migrate-services-overview.md#azure-migrate-discovery-and-assessment-tool)を使用して、オンプレミスの SQL Server インスタンスを VMware 環境から Azure SQL Database または Managed Instance に移行するための評価の概要について説明します。

## <a name="whats-an-assessment"></a>評価とは
検出および評価ツールを使用した評価は、データの特定時点のスナップショットであり、オンプレミスのサーバーの Azure への移行の対応性を測定し、その影響を見積もります。

## <a name="types-of-assessments"></a>評価の種類

Azure Migrate: 検出および評価ツールを使用して作成できる評価には、次の 3 種類があります。

**評価の種類** | **詳細**
--- | --- 
**Azure VM** | オンプレミスのサーバーを Azure 仮想マシンに移行するための評価。 <br/><br/> この評価の種類を使用すると、[VMware](how-to-set-up-appliance-vmware.md) と [Hyper-V](how-to-set-up-appliance-hyper-v.md) の環境にあるオンプレミスのサーバー、および[物理サーバー](how-to-set-up-appliance-physical.md)を Azure VM に移行するために評価できます。
**Azure SQL** | オンプレミスの SQL サーバーを VMware 環境から Azure SQL Database または Azure SQL Managed Instance に移行するための評価。 <br/><br/> お使いの SQL が VMware 以外のプラットフォームで実行されている場合は、[Data Migration Assistant](/sql/dma/dma-assess-sql-data-estate-to-sqldb) を使用して対応性を評価できます。
**Azure VMware Solution (AVS)** | オンプレミスのサーバーを [Azure VMware Solution (AVS)](../azure-vmware/introduction.md) に移行するための評価。 <br/><br/> このタイプの評価を使用すると、Azure VMware Solution (AVS) への移行について、オンプレミスの [VMware VM](how-to-set-up-appliance-vmware.md) を評価できます。 [詳細情報](concepts-azure-vmware-solution-assessment-calculation.md)

> [!NOTE]
> 検出と評価ツールで Azure VM または AVS 評価の数が正しくない場合は、評価の合計数をクリックしてすべての評価に移動し、Azure VM または AVS の評価を計算し直します。 その後、検出と評価ツールには、その評価の種類の正しい数が表示されます。 

Azure SQL 評価には 1 つのサイズ変更の設定基準が用意されています。

**サイズ変更の設定基準** | **詳細** | **データ**
--- | --- | ---
**パフォーマンスベース** | 収集されたパフォーマンス データに基づいて推奨を行う評価 | Azure SQL 構成は、CPU 使用率、メモリ使用率、IOPS (データおよびログ ファイル)、スループット、IO 操作の待機時間など、SQL インスタンスとデータベースのパフォーマンス データに基づいています。

## <a name="how-do-i-assess-my-on-premises-sql-servers"></a>オンプレミスの SQL サーバーを評価する方法

軽量の Azure Migrate アプライアンスによって収集された構成および使用状況データを使用して、オンプレミスの SQL Server インスタンスを評価できます。 アプライアンスでオンプレミスの SQL Server インスタンスとデータベースが検出され、構成およびパフォーマンス データが Azure Migrate に送信されます。 [詳細情報](how-to-set-up-appliance-vmware.md)

## <a name="how-do-i-assess-with-the-appliance"></a>アプライアンスで評価する方法
オンプレミスのサーバーを検出するために Azure Migrate アプライアンスをデプロイする場合は、次の手順を行います。
1.  Azure Migrate と連携するように Azure およびオンプレミス環境を設定します。
2.  最初の評価を行うには、Azure Migrate プロジェクトを作成し、Azure Migrate: 検出および評価ツールを追加します。
3.  軽量の Azure Migrate アプライアンスをデプロイします。 アプライアンスでオンプレミス サーバーが継続的に検出され、構成およびパフォーマンス データが Azure Migrate に送信されます。 アプライアンスは VM または物理サーバーとしてデプロイします。 評価対象のサーバーには何もインストールする必要はありません。

アプライアンスで検出が開始されたら、評価するサーバーをグループにまとめ、評価の種類として **Azure SQL** を使用してそのグループに対する評価を実行できます。

[SQL Server インスタンス](tutorial-assess-sql.md)の評価に関するチュートリアルに従って、これらの手順を試してみてください。

## <a name="how-does-the-appliance-calculate-performance-data-for-sql-instances-and-databases"></a>アプライアンスでの SQL インスタンスとデータベースのパフォーマンス データ計算方法

コンピューティング設定のパフォーマンス データがアプライアンスで収集される手順は次のとおりです。
1. アプライアンスで、リアルタイムのサンプル ポイントが収集されます。 SQL サーバーの場合、サンプル ポイントが 30 秒ごとに収集されます。
2. 30 秒ごとに 10 分間にわたって収集されたサンプル データ ポイントがアプライアンスで集計されます。 データ ポイントを作成するために、アプライアンスではすべてのサンプルからピーク値が選択されます。 各カウンターの最大、平均、および分散が Azure に送信されます。
3. Azure Migrate には、前月の 10 分間のデータ ポイントがすべて格納されています。
4. 評価を作成すると、Azure Migrate により、サイズ設定に使用するために適したデータ ポイントが特定されます。 この特定は、"パフォーマンス履歴" の百分位の値と "百分位の使用率" に基づきます。
    - たとえば、パフォーマンス履歴が 1 週間で、百分位の使用率が 95 パーセンタイルの場合、評価によって前週の 10 分間のサンプル ポイントが並べ替えられます。 並べ替えは昇順で行われ、サイズ設定の値として 95 パーセンタイルが選択されます。
    - 値 95 パーセンタイルを設定すると、99 パーセンタイルを選択した場合に含まれる可能性のある外れ値はすべて無視されます。
    - 期間中のピーク使用率を選択し、外れ値を見落とさないようにする場合は、パーセンタイル使用率として 99 パーセンタイルを選択します。
5. アプライアンスで収集される次のメトリックの有効なパフォーマンス使用率データを得るために、この値には快適性係数が乗算されます。
    - CPU 使用率 (%)
    - メモリ使用率 (%)
    - 読み取り IO/秒と書き込み IO/秒 (データおよびログ ファイル)
    - 読み取り MB/秒と書き込み MB/秒 (スループット)
    - IO 操作の待機時間

## <a name="what-properties-are-used-to-create-and-customize-an-azure-sql-assessment"></a>Azure SQL 評価の作成とカスタマイズに使用するプロパティ

Azure SQL 評価のプロパティに含まれるものは次のとおりです。

**プロパティ** | **詳細**
--- | ---
**ターゲットの場所** | 移行先となる Azure リージョン。 Azure SQL 構成とコストに関する推奨事項は、指定した場所に基づいています。
**Target deployment type (ターゲットのデプロイの種類)** | 評価を実行するターゲットのデプロイの種類: <br/><br/> Azure Migrate によって、Azure SQL MI および Azure SQL DB に移行するための SQL サーバーの対応性が評価され、最適なターゲット デプロイ オプション、ターゲット レベル、Azure SQL 構成、月間見積もりが推奨されるようにする場合は、 **[推奨]** を選択します。<br/><br/>Azure SQL Database への移行のみを目的として SQL サーバーを評価し、ターゲット レベル、Azure SQL DB 構成、月間見積もりを確認する場合は、 **[Azure SQL DB]** を選択します。<br/><br/>Azure SQL Database への移行のみを目的として SQL サーバーを評価し、ターゲット レベル、Azure SQL MI 構成、月間見積もりを確認する場合は、 **[Azure SQL MI]** を選択します。
**予約容量** | 予約容量を指定します。これにより、評価でのコスト見積もりで考慮されます。<br/><br/> 予約容量オプションを選択した場合、[割引 (%)] を指定することはできません。
**サイズ変更の設定基準** | このプロパティは、Azure SQL 構成を適切にサイズ設定するために使用されます。 <br/><br/> 既定値は **[パフォーマンスベース]** です。つまり、評価によって SQL Server インスタンスとデータベースのパフォーマンス メトリックが収集され、最適にサイズ設定された Azure SQL Managed Instance または Azure SQL Database あるいはその両方のレベルと構成に関する推奨事項が提示されます。
**パフォーマンス履歴** | パフォーマンス履歴では、パフォーマンス データを評価するときに使用する期間を指定します。
**百分位数の使用率** | 百分位の使用率では、サイズ設定に使用されるパフォーマンス サンプルのパーセンタイル値を指定します。
**快適性係数** | 評価中に使用されるバッファー。 季節ごとの使用量、短期間のパフォーマンス履歴、将来に使用量が増える可能性などの問題に相当します。<br/><br/> たとえば、使用率 20% の 10 コア インスタンスの結果は、通常 2 コア インスタンスになります。 快適性係数を 2.0 とした場合、結果は 4 コア インスタンスになります。
**オファーまたはライセンス プログラム** | 自分が登録されている [Azure プラン](https://azure.microsoft.com/support/legal/offer-details/)。 現時点では、従量課金制または開発テスト用の従量課金制プランのみを選択できます。 従量課金制プランに加えて、予約容量と Azure ハイブリッド特典を適用することで、追加の割引を利用できることに注意してください。
**サービス レベル** | Azure SQL Database や Azure SQL Managed Instance に移行するためのビジネス ニーズを満たすための最も適切なサービス レベル オプション:<br/><br/>Azure Migrate によってサーバーに最適なサービス レベルが推奨されるようにする場合は **[推奨]** 。 これを汎用目的またはビジネス クリティカルに設定することもできます。 <br/><br/> 予算重視のワークロード向けに設計された Azure SQL 構成が必要な場合は **[汎用]** 。 [詳細情報](../azure-sql/database/service-tier-general-purpose.md) <br/><br/> 障害に対する高い回復性と高速フェールオーバーを備え、低遅延のワークロード向けに設計された Azure SQL 構成が必要な場合は **[ビジネス プラクティカル]** 。 [詳細情報](../azure-sql/database/service-tier-business-critical.md)
**通貨** | アカウントの請求通貨。
**割引率 (%)** | Azure プランに適用される任意のサブスクリプション固有の割引。 既定の設定は 0% です。
**Azure ハイブリッド特典** | SQL Server ライセンスを既に所有しているかどうかを指定します。 <br/><br/> ライセンスを所有しており、SQL Server サブスクリプションのアクティブなソフトウェア アシュアランスの対象となっている場合は、ライセンスを Azure に持ち込む際に Azure ハイブリッド特典を申請できます。

Azure Migrate で評価を作成するための[ベスト プラクティスを確認](best-practices-assessment.md)してください。

## <a name="calculate-readiness"></a>対応性を計算する

> [!NOTE]
評価には、オンライン状態のデータベースのみが含まれます。 それ以外の状態になっているデータベースの対応状態、サイズ設定、コスト計算は無視されます。 そのようなデータベースを評価するには、データベースの状態を変更し、しばらくしてから評価を再計算してください。

### <a name="azure-sql-readiness"></a>Azure SQL 対応性

SQL インスタンスとデータベースの Azure SQL 対応性は、Azure SQL Database および Azure SQL Managed Instance との機能互換性チェックに基づいています。
1. Azure SQL 評価においては、ソース SQL Server ワークロード (SQL Agent のジョブ、リンク サーバーなど) に現在使用されている SQL Server インスタンスの機能と、ユーザー データベースのスキーマ (テーブル、ビュー、トリガー、ストアド プロシージャなど) を検討することで互換性の問題が特定されます。
1. 互換性の問題が見つからなかった場合は、ターゲットのデプロイの種類 (Azure SQL Database または Azure SQL Managed Instance) に対する対応性が **[準備完了]** とマークされます。
1. 機能低下やサポートされていない機能など、ターゲットとする特定のデプロイの種類への移行をブロックしない、重大でない互換性の問題がある場合は、対応性は **[準備完了]** (ハイパーリンク付きの青い情報アイコン) とマークされ、**警告** の詳細と推奨される修復のガイダンスが表示されます。
1. ターゲットとする特定のデプロイの種類への移行を妨げる可能性がある互換性の問題がある場合は、対応性は **[準備不完了]** とマークされ、**問題** の詳細と推奨される修復のガイダンスが表示されます。
    - ターゲットとする特定のデプロイの種類に対応していないデータベースが SQL インスタンス内に 1 つでもある場合、インスタンスはそのデプロイの種類に対して **[準備不完了]** としてマークされます。
1. SQL インスタンスまたはデータベースの検出がまだ進行中であるか、検出に関して問題がある場合は、対応性は **[不明]** としてマークされます。これは、評価でその SQL インスタンスの対応性を計算できなかったためです。

### <a name="recommended-deployment-type"></a>推奨されるデプロイの種類

Azure SQL 評価のプロパティで、ターゲットのデプロイの種類として **[推奨]** を選択した場合、Azure Migrate によって、SQL インスタンスと互換性のある Azure SQL のデプロイの種類が推奨されます。 Microsoft によって推奨されるターゲットに移行すると、移行の全体的な作業量が減ります。 

#### <a name="recommended-deployment-type-based-on-azure-sql-readiness"></a>Azure SQL 対応性に基づいた推奨されるデプロイの種類

 **Azure SQL DB 対応性** | **Azure SQL MI 対応性** | **推奨されるデプロイの種類** | **Azure SQL 構成とコスト見積もりは計算済みか?**
 --- | --- | --- | --- |
 準備 | 準備 | Azure SQL DB または <br/>Azure SQL MI  | はい
 Ready | 準備不完了または<br/> Unknown | Azure SQL DB | はい
 準備不完了または<br/>Unknown | Ready | Azure SQL MI  | はい
 準備不完了 | 準備不完了 | Azure VM に対応の可能性あり | いいえ
 準備不完了または<br/>Unknown | 準備不完了または<br/>不明 | Unknown | いいえ

> [!NOTE]
> 推奨されるデプロイの種類が評価のプロパティで **[推奨]** と選択されている場合に、ソース SQL Server が Azure SQL DB の単一データベースと Azure SQL Managed Instance の両方に適していれば、評価を行うと、コストを最適化し、かつサイズとパフォーマンスの境界内に収まる特定のオプションが推奨されます。

#### <a name="potentially-ready-for-azure-vm"></a>Azure VM に対応の可能性あり

SQL インスタンスが Azure SQL Database と Azure SQL Managed Instance に対応していない場合、推奨されるデプロイの種類は、"*Azure VM に対応の可能性あり*" としてマークされます。
- ユーザーには、評価の種類を "Azure VM" にして Azure Migrate で評価を作成し、代わりにインスタンスが実行されているサーバーが Azure VM への移行に対応しているかどうかを判断することをお勧めします。 以下の点に注意してください。
    - 現在、Azure Migrate での Azure VM の評価ではリフト アンド シフトが重視されており、SQL のインスタンスとデータベースを Azure 仮想マシンで実行した場合の特定のパフォーマンス メトリックは考慮されません。 
    - サーバーで Azure VM の評価を実行した場合、推奨されるサイズとコストの見積もりは、サーバーで実行されているすべてのインスタンスに対するものであり、Server Migration ツールを使用して Azure VM に移行できます。 移行を行う前に、Azure Virtual Machines での SQL Server の[パフォーマンス ガイドラインを確認してください](../azure-sql/virtual-machines/windows/performance-guidelines-best-practices-checklist.md)。


## <a name="calculate-sizing"></a>サイズ設定の計算

### <a name="azure-sql-configuration"></a>Azure SQL 構成

評価によって対応性と推奨される Azure SQL のデプロイの種類が判断された後、オンプレミスの SQL インスタンスのパフォーマンスを満たすか超えることができる、特定のサービス レベルと Azure SQL 構成 (SKU サイズ) が計算されます。
1. 検出プロセス中に、Azure Migrate によって SQL インスタンスの構成とパフォーマンスが収集されます。これには次のものが含まれます。
    - 仮想コア (割り当て済み) と CPU 使用率 (%)
        - SQL インスタンスの CPU 使用率は、SQL サーバー上のインスタンスによって使用されている割り当て済み CPU の割合
        - データベースの CPU 使用率は、SQL インスタンス上のデータベースによって使用されている割り当て済み CPU の割合
    - メモリ (割り当て済み) とメモリ使用率 (%)
    - 読み取り IO/秒と書き込み IO/秒 (データおよびログ ファイル)
        - SQL インスタンス レベルでの読み取り IO/秒と書き込み IO/秒は、そのインスタンスで検出されたすべてのデータベースの読み取り IO/秒と書き込み IO/秒を追加することによって計算されます。
    - 読み取り MB/秒と書き込み MB/秒 (スループット)
    - IO 操作の待機時間
    - DB の合計サイズとデータベース ファイルの構成
        - データベースのサイズは、すべてのデータおよびログ ファイルを追加することによって計算されます。
1. この評価では、すべての構成およびパフォーマンス データが集計され、Azure SQL のさまざまなサービス レベルと構成全体で最適な一致が検出されます。さらに、コストを最適化しながら SQL インスタンスのパフォーマンス要件を満たすか超えることができる構成が選択されます。

### <a name="confidence-ratings"></a>信頼度レーティング 
Azure SQL 評価にはそれぞれ、信頼度レーティングが付けられています。 信頼度の範囲は、星 1 つ (最も低い) から星 5 つ (最も高い) までです。 評価の信頼度は、Azure Migrate によって提示される推奨サイズの信頼性を評価する目安となります。
- 評価の信頼度は、評価に割り当てられます。 信頼度は、評価の計算に必要なデータ ポイントの可用性に基づいています。
- パフォーマンスベースのサイズ設定の場合、評価を行うと、次のようなすべての SQL インスタンスとデータベースのパフォーマンス データが収集されます。
    - CPU 使用率 (%)
    - メモリ使用率 (%)
    - 読み取り IO/秒と書き込み IO/秒 (データおよびログ ファイル)
    - 読み取り MB/秒と書き込み MB/秒 (スループット)
    - IO 操作の待機時間
    
これらの使用率の数値のいずれかが使用できない場合、推奨サイズは信頼できない可能性があります。
次の表は、使用可能なデータ ポイントの割合に応じた評価の信頼度を示します。

**データ ポイントの可用性** | **信頼度レーティング**
--- | ---
0% - 20% | 1 つ星
21% - 40% | 2 つ星
41% - 60% | 3 つ星
61% - 80% | 4 つ星
81% - 100% | 5 つ星

#### <a name="low-confidence-ratings"></a>信頼度レーティングが低い
次のようないくつかの理由で、評価の信頼度レーティングが低くなることがあります。
- 評価を作成する期間について環境をプロファイルしなかった。 たとえば、パフォーマンス期間を 1 日に設定して評価を作成する場合、すべてのデータ ポイントを収集するために、検出を開始してから少なくとも 1 日待つ必要があります。
- 評価期間内に一部または全部のサーバーのパフォーマンス データを評価で収集できません。 高い信頼度レーティングを得るために、次のことを確認してください。
    - 評価期間中、サーバーの電源がオンになっている
    - ポート 443 でのアウトバウンド接続が許可されている
    - SQL エージェントの Azure Migrate 接続状態が "接続済み" になっているかどうか。また、最後のハートビートを確認する 
    - 検出された SQL インスタンスのブレードで、すべての SQL インスタンスの Azure Migrate の接続状態が "接続済み" になっているかどうか

    評価を "再計算" し、信頼性評価に最新の変更を反映してください。
- 評価の計算対象期間中に作成されたデータベースまたはインスタンスがある。 たとえば、前月のパフォーマンス履歴に対する評価を作成した場合に、一部のデータベースまたはインスタンスがわずか 1 週間前に作成されていたとします。 この場合、新しいサーバーのパフォーマンス データは期間全体を通しては利用できず、信頼度レーティングが低くなります。

> [!NOTE]
> Azure SQL 評価はパフォーマンスベースの評価であるため、評価の信頼度が星 5 つを下回る場合は、アプライアンスで環境のプロファイルができるように少なくとも 1 日待ってから、評価を再計算することをお勧めします。 そうしなければ、パフォーマンスベースのサイズ設定は信頼できない可能性があります。

## <a name="calculate-monthly-costs"></a>毎月のコストを計算する
サイズ設定の推奨完了後、推奨される Azure SQL 構成のコンピューティングとストレージのコストが、Azure SQL 評価で内部 pricing API を使用して計算されます。 すべてのインスタンスのコンピューティングとストレージのコストが集計され、月間コンピューティング コストの合計が計算されます。 
### <a name="compute-cost"></a>コンピューティング コスト
- Azure SQL 構成のコンピューティング コストを計算する場合、次のプロパティが評価で考慮されます。
    - SQL ライセンスの Azure ハイブリッド特典
    - 予約容量
    - Azure のターゲットの場所
    - Currency
    - オファーまたはライセンス プログラム
    - 割引 (%)

### <a name="storage-cost"></a>Storage コスト
- ストレージ コストの見積もりにはデータ ファイルのみが含まれ、ログ ファイルは含まれません。 
- Azure SQL 構成のストレージ コストを計算する場合、次のプロパティが評価で考慮されます。
    - Azure のターゲットの場所
    - Currency
    - オファーまたはライセンス プログラム
    - 割引 (%)
- バックアップ ストレージのコストは評価に含まれません。
- **Azure SQL Database**
    - 最低 5 GB のストレージ コストがコスト見積もりに追加され、追加のストレージ コストが 1 GB 単位でストレージに追加されます。 [詳細情報](https://azure.microsoft.com/pricing/details/sql-database/single/)
- **Azure SQL Managed Instance**
    - 最初の 32 GB/インスタンス/月のストレージに対するストレージ コストは追加されず、追加のストレージ コストが 32 GB 単位でストレージに追加されます。 [詳細情報](https://azure.microsoft.com/pricing/details/azure-sql/sql-managed-instance/single/)
        
## <a name="next-steps"></a>次のステップ
- 評価作成のベストプラクティスを[確認](best-practices-assessment.md)します。 
- [Azure SQL 評価](how-to-create-azure-sql-assessment.md)を実行する方法について説明します。
