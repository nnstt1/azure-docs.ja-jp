---
title: チュートリアル:データ コピー サービスを使用してデバイスにコピーする
titleSuffix: Azure Data Box
description: このチュートリアルでは、データ コピー サービス経由で Azure Data Box デバイスにデータをコピーする方法について学習します
services: databox
author: alkohli
ms.service: databox
ms.subservice: pod
ms.topic: tutorial
ms.date: 11/08/2021
ms.author: alkohli
ms.openlocfilehash: 0fd3a8ed38d55580cfe56e6ee4501616771a2b48
ms.sourcegitcommit: 838413a8fc8cd53581973472b7832d87c58e3d5f
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2021
ms.locfileid: "132135748"
---
# <a name="tutorial-use-the-data-copy-service-to-copy-data-into-azure-data-box-preview"></a>チュートリアル:データ コピー サービスを使用してデータを Azure Data Box にコピーする (プレビュー)

このチュートリアルでは、中間ホストを介さずにデータ コピー サービスを使用してデータを取り込む方法について説明します。 データ コピー サービスは、Microsoft Azure Data Box 上でローカルに動作し、SMB 経由でお客様のネットワーク接続ストレージ (NAS) デバイスに接続して、Data Box にデータをコピーします。

データ コピー サービスの用途:

- 中間ホストが必ずしも利用できない NAS 環境。
- データのインジェストとアップロードに数週間かかる小さなファイル。 データ コピー サービスを利用すると、小さなファイルのインジェストとアップロードにかかる時間を大幅に短縮できます。

このチュートリアルでは、以下の内容を学習します。

> [!div class="checklist"]
>
> * Data Box にデータをコピーする

## <a name="prerequisites"></a>前提条件

開始する前に次の点を確認します。

1. 次のチュートリアルを完了していること: [Azure Data Box の設定](data-box-deploy-set-up.md)。
2. Data Box デバイスの受け取りが済んでいて、ポータル内での注文の状態が **[配送済み]** であること。
3. 自分がデータ コピーのために接続するソース NAS デバイスの資格情報があること。
4. 高速ネットワークに接続していること。 10 ギガビット イーサネット (GbE) 接続を少なくとも 1 つ利用することを強くお勧めします。 10 GbE 接続を利用できない場合は、1 GbE データ リンクを使用できます。ただし、コピー速度に影響があります。

## <a name="copy-data-to-data-box"></a>Data Box にデータをコピーする

NAS デバイスに接続したら、次の手順はデータのコピーです。 データのコピーを開始する前に、次の考慮事項を確認してください。

* データのコピー中は、データのサイズが [Azure Storage と Data Box の制限](data-box-limits.md)に関する記事に記載されているサイズ制限に準拠していることを確認してください。

* Data Box によってアップロードされているデータが、Data Box の外部で別のアプリケーションによって同時にアップロードされた場合、アップロードジョブ エラーやデータの破損が生じる可能性があります。

* データ コピー サービスによる読み取りの過程でデータが変更されている場合、エラーやデータの破損が生じる可能性があります。

> [!IMPORTANT]
> Data Box によって Azure Storage にデータが転送されたことを確認できるまでは、ソース データのコピーを保持するようにしてください。

データ コピー サービスを使用してデータをコピーするには、ジョブを作成する必要があります。

1. Data Box デバイスのローカル Web UI で、 **[管理]**  >  **[データのコピー]** の順に移動します。
2. **[データのコピー]** ページで **[作成]** を選択します。

    ![[データのコピー] ページで [作成] を選択する](media/data-box-deploy-copy-data-via-copy-service/click-create.png)

3. **[ジョブの構成と開始]** ダイアログ ボックスで、以下のフィールドを入力します。
    
    |フィールド                          |値    |
    |-------------------------------|---------|
    |**ジョブ名**                       |ジョブの一意の名前を 230 文字未満で指定します。 \<, \>、\|、\?、\*、\\\:、\/、および \\ の各文字は、ジョブの名前には使用できません\.         |
    |**ソースの場所**                |データ ソースの SMB パスを `\\<ServerIPAddress>\<ShareName>` 形式または `\\<ServerName>\<ShareName>` 形式で指定します。        |
    |**ユーザー名**                       |データ ソースにアクセスするための `\\<DomainName><UserName>` 形式のユーザー名。 ローカルの管理者が接続する場合は、明示的なセキュリティ アクセス許可が必要です。 フォルダーを右クリックし、 **[プロパティ]** を選択して、 **[セキュリティ]** を選択します。 これで、 **[セキュリティ]** タブでローカル管理者が追加されます。       |
    |**パスワード**                       |データ ソースにアクセスするためのパスワード。           |
    |**コピー先ストレージ アカウント**    |データのアップロード先となるターゲット ストレージ アカウントを一覧から選択します。         |
    |**送信先の種類**       |ターゲット ストレージの種類を一覧から選択します。 **[ブロック BLOB]** 、 **[ページ BLOB]** 、または **[Azure ファイル]** です。        |
    |**コピー先コンテナー/共有**    |自分のコピー先ストレージ アカウントにおけるデータのアップロード先にしたいコンテナーまたは共有の名前を入力します。 この名前には、共有名またはコンテナー名を使用できます。 たとえば、`myshare` または `mycontainer` を使用します。 `sharename\directory_name` または `containername\virtual_directory_name` の形式で名前を入力することもできます。        |
    |**パターンに一致するファイルのコピー**    | 次の 2 つの方法でファイル名の一致パターンを入力できます。<ul><li>**ワイルドカード式を使用:** ワイルドカード式でサポートされるのは `*` と `?` だけです。 たとえば、`*.vhd` という式は、拡張子が `.vhd` であるすべてのファイルと一致します。 同様に、`*.dl?` は、拡張詞が `.dl` であるか、または `.dl` で始まる (`.dll` など) すべてのファイルと一致します。 さらに、`*foo` は、名前が `foo` で終わるすべてのファイルと一致します。<br>ワイルドカード式はフィールドに直接入力することができます。 フィールドに入力する値は、既定でワイルドカード式として扱われます。</li><li>**正規表現を使用:** POSIX ベースの正規表現がサポートされます。 たとえば、正規表現 `.*\.vhd` は、拡張子が `.vhd` であるすべてのファイルと一致します。 正規表現には、`<pattern>` を直接 `regex(<pattern>)` として指定します。 正規表現の詳細については、[正規表現言語のクイック リファレンス](/dotnet/standard/base-types/regular-expression-language-quick-reference)を参照してください。</li><ul>|
    |**ファイルの最適化**              |この機能が有効な場合、1 MB 未満のファイルがインジェスト中に圧縮されます。 この圧縮により、小さなファイルのデータをより高速にコピーできるようになります。 さらに、ファイル数がディレクトリ数を大幅に超えている場合は、時間が大幅に節約されます。</br>ファイルの最適化を使用する場合:<ul><li>発送準備を実行した後、元のファイル名を一覧表示する [BOM ファイルをダウンロード](data-box-logs.md#inspect-bom-during-prepare-to-ship)して、適切なファイルがすべてコピーされていることを確認できます。</li><li>"ADB_PACK_" から始まる名前の圧縮ファイルは削除しないでください。 圧縮ファイルを削除した場合、今後のデータ コピー時に元のファイルはアップロードされません。</li><li>コピー サービスでコピーしたものと同じファイルを、SMB、NFS、REST API などの他のプロトコルを使用してコピーしないでください。 異なるプロトコルを使用すると、データのアップロード時に競合が発生し、エラーが発生する可能性があります。 </li></ul>    |
 
4. **[スタート]** を選択します。 入力が検証され、検証が成功した場合にジョブが開始されます。 ジョブが開始されるまでに､数分かかる場合があります。

    ![[ジョブの構成と開始] ダイアログ ボックスからジョブを開始する](media/data-box-deploy-copy-data-via-copy-service/configure-and-start.png)

5. 指定した設定のジョブが作成されます。 ジョブの一時停止、再開、取り消し、または再起動を実行できます。 ジョブ名の横にあるチェック ボックスをオンにして、適切なボタンを選択します。

    ![[データのコピー] ページでジョブを管理する](media/data-box-deploy-copy-data-via-copy-service/select-job.png)
    
    - ピーク時にジョブが NAS デバイスのリソースに影響を及ぼしている場合、それを一時停止できます。

        ![[データのコピー] ページでジョブを一時停止する](media/data-box-deploy-copy-data-via-copy-service/pause-job.png)

        ピーク時を避けて後でジョブを再開することができます。

        ![[データのコピー] ページでジョブを再開する](media/data-box-deploy-copy-data-via-copy-service/resume-job.png)

    - ジョブはいつでも取り消すことができます。

        ![[データのコピー] ページでジョブを取り消す](media/data-box-deploy-copy-data-via-copy-service/cancel-job.png)
        
        ジョブを取り消す際には、確認が必要です。

        ![ジョブの取り消しを確認する](media/data-box-deploy-copy-data-via-copy-service/confirm-cancel-job.png)

        ジョブの取り消しを確定した場合でも、既にコピーされたデータは削除されません。 自分の Data Box デバイスにコピーしたデータを削除するには、デバイスをリセットします。

        ![デバイスをリセットする](media/data-box-deploy-copy-data-via-copy-service/reset-device.png)

        >[!NOTE]
        > ジョブの取り消しまたは一時停止を行った場合、大きなファイルが部分的にのみコピーされる可能性があります。 部分的にコピーされたこれらのファイルは、同じ状態で Azure にアップロードされます。 ジョブの取り消しまたは一時停止を行う場合、ファイルが適切にコピーされたことを確認してください。 ファイルを確認するには、SMB 共有を調べるか、BOM ファイルをダウンロードします。

    - ネットワーク障害など、一時的なエラーが原因でジョブが失敗した場合、それを再起動することができます。 ただし、 **[成功]** や **[完了 (エラーあり)]** など、最終状態に達した場合にジョブを再起動することはできません。 ファイルの命名またはファイルサイズの問題が原因で、ジョブ エラーが発生する場合があります。 これらのエラーはログに記録されますが、完了した後にジョブを再起動することはできません。

        ![失敗したジョブを再起動する](media/data-box-deploy-copy-data-via-copy-service/restart-failed-job.png)

        エラーが発生し、ジョブを再起動できない場合は、エラー ログをダウンロードしてログ ファイルでエラーを探します。 問題を修正した後、新しいジョブを作成してファイルをコピーします。 [SMB 経由でファイルをコピー](data-box-deploy-copy-data.md)することもできます。
    
    - このリリースでは、ジョブを削除することはできません。
    
    - ジョブは無制限に作成できますが、任意の一時点に並列で実行できるジョブは最大 10 個だけです。
    - **[ファイルの最適化]** をオンにした場合、コピーのパフォーマンスを高めるために、小さなファイルが取り込み時に圧縮されます。 これらの場合、圧縮されたファイルが表示されます (そのファイル名は GUID になります)。 このファイルは削除しないでください。 これはアップロード中に解凍されます。

6. ジョブの進行中、 **[データのコピー]** ページでは:

    - **[状態]** 列で、コピー ジョブの状態を確認できます。 ステータスの値が示す内容は次のとおりです。
        - **実行中**
        - **Failed**
        - **Succeeded**
        - **一時停止中**
        - **一時停止**
        - **キャンセル中**
        - **Canceled**
        - **完了 (エラーあり)**
    - **[ファイル]** 列で、コピー中のファイルの数と合計サイズを確認できます。
    - **[処理済み]** 列で、処理されたファイルの数と合計サイズを確認できます。
    - **[ジョブの詳細]** 列で **[表示]** を選択すると、ジョブの詳細が表示されます。
    - **[エラー数]** 列に示されているように、コピー プロセス中にエラーが発生した場合、 **[エラー ログ]** 列に移動し、エラー ログをダウンロードしてトラブルシューティングを行います。

コピー ジョブが完了するのを待ちます。 一部のエラーは **[接続とコピー]** ページにしかログが記録されないので、エラーなくコピー ジョブが完了したことを確認してから次の手順に進んでください。

![エラーがない [接続とコピー] ページ](media/data-box-deploy-copy-data-via-copy-service/verify-no-errors-on-connect-and-copy.png)

データ整合性を保証するため、データがコピーされるときにインラインでチェックサムが計算されます。 コピーが完了した後、 **[ダッシュボードの表示]** を選択して、デバイスで使用済み領域と空き領域を確認します。
    
![ダッシュボードで空き領域と使用済み領域を確認する](media/data-box-deploy-copy-data-via-copy-service/verify-used-space-dashboard.png)

コピー ジョブが完了した後、 **[発送準備]** を選択できます。

>[!NOTE]
> コピー ジョブの進行中は **[発送準備]** を実行できません。

## <a name="next-steps"></a>次のステップ

次のチュートリアルに進み、Data Box デバイスを Microsoft に返送する方法を学習してください。

> [!div class="nextstepaction"]
> [Azure Data Box デバイスを Microsoft に発送する](./data-box-deploy-picked-up.md)