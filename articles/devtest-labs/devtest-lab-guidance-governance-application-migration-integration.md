---
title: アプリケーションの移行と統合
description: この記事では、Azure DevTest Labs インフラストラクチャのガバナンスについてのガイダンスを提供します。 コンテキストは、アプリケーションの移行と統合です。
ms.topic: how-to
ms.date: 06/26/2020
ms.reviewer: christianreddington,anthdela,juselph
ms.openlocfilehash: 0c80db4ef4d9fa6b3b58d84d663a84b89f93219f
ms.sourcegitcommit: e1037fa0082931f3f0039b9a2761861b632e986d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/12/2021
ms.locfileid: "132397625"
---
# <a name="governance-of-azure-devtest-labs-infrastructure---application-migration-and-integration"></a>Azure DevTest Labs インフラストラクチャのガバナンス - アプリケーションの移行と統合
開発/テスト ラボ環境が確立された後は、次の質問について考慮する必要があります。

- プロジェクト チーム内で環境をどのように使用しますか。
- どのようにして必要な組織のポリシーに確実に従い、アプリケーションに機敏に価値を追加できるようにしますか。

## <a name="azure-marketplace-images-vs-custom-images"></a>Azure Marketplace イメージとカスタム イメージ

### <a name="question"></a>Question
Azure Marketplace イメージと組織独自のカスタム イメージをどのように使い分ける必要がありますか。

### <a name="answer"></a>回答
特定の問題または組織の要件がない限り、Azure Marketplace を既定で使用する必要があります。 問題や要件とは、たとえば次のようなものです。

- 基本イメージの一部としてアプリケーションを含める必要がある複雑なソフトウェアのセットアップ。
- アプリケーションのインストールとセットアップに多くの時間がかかる場合。これは、Azure Marketplace イメージに追加される計算時間を効率的に使用していないことになります。
- 開発者やテスト担当者が迅速に仮想マシンにアクセスする必要があり、新しい仮想マシンのセットアップ時間を最小限にしたい場合。
- コンプライアンスまたは法規制の条件 (たとえば、セキュリティ ポリシー) をすべてのマシンに適用する必要がある場合。

カスタム イメージの使用は慎重に検討してください。 基になっている基本イメージの VHD ファイルを管理する必要が生じるため、複雑さが増します。 また、基本イメージにソフトウェア更新プログラムを定期的に適用する必要があります。 これらの更新プログラムには、新しいオペレーティング システム (OS) の更新と、ソフトウェア パッケージ自体に必要なすべての更新または構成変更が含まれます。

## <a name="formula-vs-custom-image"></a>定型イメージとカスタム イメージ

### <a name="question"></a>Question
定型イメージとカスタム イメージをどのように使い分ける必要がありますか。

### <a name="answer"></a>回答
通常、このシナリオでの決定要因はコストと再利用です。

次の場合には、カスタム イメージを作成することでコストを削減できます。
- イメージを必要とするユーザーまたはラボが多数存在する。
- 基本イメージの上に多数のソフトウェアを追加したイメージが必要である。

このソリューションを使用する場合、イメージを作成するのは 1 回ということになります。 カスタム イメージを使用すれば、仮想マシンのセットアップ時間が短縮されます。 セットアップ中に仮想マシンを実行することによるコストは発生しません。

もう 1 つの要因は、ソフトウェア パッケージに対する変更の頻度です。 ビルドを毎日実行し、ソフトウェアをユーザーの仮想マシンに展開する必要がある場合は、カスタム イメージではなく定型イメージの使用を検討してください。

## <a name="use-custom-organizational-images"></a>カスタム組織イメージを使用する

### <a name="question"></a>Question
カスタム組織イメージを DevTest Labs 環境に展開する簡単に反復可能なプロセスをセットアップするにはどうすればよいですか。

### <a name="answer"></a>回答
[イメージ ファクトリ パターンに関するこちらのビデオ](./devtest-lab-faq.yml#blog-post)をご覧ください。 これは高度なシナリオであり、提供されているスクリプトはサンプル スクリプトのみです。 何らかの変更が必要な場合は、環境で使用されるスクリプトを自分で管理および保守する必要があります。

DevTest Labs を使用して、Azure Pipelines でカスタムのイメージ パイプラインを作成します。

- [概要: Azure DevTest Labs でイメージ ファクトリを設定して数分で VM を準備する](./devtest-lab-faq.yml#blog-post)
- [イメージ ファクトリ – パート 2:Azure Pipelines とファクトリ ラボを設定して VM を作成する](./devtest-lab-faq.yml#blog-post)
- [イメージ ファクトリ – パート 3: カスタム イメージを保存して複数のラボに配布する](./devtest-lab-faq.yml#blog-post)
- [ビデオ: Azure DevTest Labs でのカスタム イメージ ファクトリ](./devtest-lab-faq.yml#blog-post)

## <a name="patterns-to-set-up-network-configuration"></a>ネットワーク構成を設定するパターン

### <a name="question"></a>Question
開発用とテスト用の仮想マシンがパブリック インターネットに接続できないようにするにはどうすればよいですか。 ネットワーク構成の設定に推奨されるパターンはありますか。

### <a name="answer"></a>回答
はい。 受信トラフィックと送信トラフィックの 2 つの側面を考慮する必要があります。

**インバウンド トラフィック**: 仮想マシンにパブリック IP アドレスが割り当てられていなければ、そのマシンにインターネットから到達することはできません。 サブスクリプションレベルのポリシーを設定して、ユーザーがパブリック IP アドレスを作成できないようにするのが、一般的なアプローチです。

**アウトバウンド トラフィック**: 仮想マシンがパブリック インターネットに直接接続できないようにし、企業のファイアウォールをトラフィックが通過するよう強制するには、強制ルーティングを使用して、オンプレミスのトラフィックを Azure ExpressRoute または VPN 経由でルーティングできます。

> [!NOTE]
> プロキシ設定のないトラフィックをブロックするプロキシ サーバーがある場合は、ラボの成果物ストレージ アカウントに対する例外を追加することを忘れないでください。

仮想マシンまたはサブネットに対してネットワーク セキュリティ グループを使用することもできます。 このステップにより、トラフィックを許可またはブロックする保護レイヤーが追加されます。

## <a name="new-vs-existing-virtual-network"></a>新規の仮想ネットワークと既存の仮想ネットワーク

### <a name="question"></a>Question
どのような場合に DevTest ラボ環境用の新しい仮想ネットワークを作成する必要があり、どのような場合に既存の仮想ネットワークを使用できますか。

### <a name="answer"></a>回答
VM で既存のインフラストラクチャとやり取りする必要がある場合は、DevTest Labs 環境内の既存の仮想ネットワークの使用を検討する必要があります。 ExpressRoute を使用する場合は、サブスクリプションに割り当てられた IP アドレス空間をフラグメント化しないように、仮想ネットワークとサブネットの数はできるだけ少なくしてください。 また、こちら (ハブ - スポーク モデル) では、仮想ネットワーク ピアリング パターンの使用も検討してください。 このアプローチでは、仮想ネットワークとサブネットが、特定のリージョン内でサブスクリプションの境界を越えて通信を行えるようになります。

各 DevTest Labs 環境に専用の仮想ネットワークを割り当てることもできますが、サブスクリプションあたりの仮想ネットワーク数に[制限](../azure-resource-manager/management/azure-subscription-service-limits.md)があります。 既定の数は 50 ですが、この制限は 100 まで増やすことができます。

## <a name="shared-public-or-private-ip"></a>共有 IP アドレス、パブリック IP アドレス、プライベート IP アドレス

### <a name="question"></a>Question
共有 IP アドレス、パブリック IP アドレス、プライベート IP アドレスはどのように使い分ける必要がありますか。

### <a name="answer"></a>回答
サイト間 VPN または ExpressRoute を使用する場合は、マシンが内部ネットワーク経由ではアクセスできてもパブリック インターネット経由ではアクセスできないように、プライベート IP アドレスの使用を検討します。

> [!NOTE]
> ラボの所有者は、このサブネット ポリシーを変更して、ユーザーが各自の VM に誤ってパブリック IP アドレスを作成できないようにすることができます。 サブスクリプションの所有者は、パブリック IP アドレスが作成されるのを防ぐサブスクリプション ポリシーを作成する必要があります。

共有パブリック IP アドレスを使用すると、ラボ内の仮想マシンはパブリック IP アドレスを共有します。 この方法は、特定のサブスクリプションに対するパブリック IP アドレスの制限が違反されるのを防ぐのに役立ちます。

## <a name="limits-of-number-of-virtual-machines-per-user-or-lab"></a>ユーザー単位またはラボ単位の仮想マシンの数の制限

### <a name="question"></a>Question
ユーザーごと、またはラボごとに設定する必要がある仮想マシンの数に関してルールはありますか。

### <a name="answer"></a>回答
ユーザーごと、またはラボごとの仮想マシンの数を検討するときは、3 つの主な懸案事項があります。

- ラボのリソースにチームが費やすことのできる **総コスト**。 多くのマシンを起動するのは簡単です。 コストを制御するための 1 つのメカニズムは、ユーザーごとおよびラボごとの VM の数を制限することです。
- ラボ内の仮想マシンの総数は、使用できる[サブスクリプション レベルのクォータ](../azure-resource-manager/management/azure-subscription-service-limits.md)の影響を受けます。 上限値の 1 つは、サブスクリプションあたり 800 リソース グループです。 現在、DevTest Labs では (共有パブリック IP アドレスが使用されていない場合) VM ごとに新しいリソース グループが作成されます。 サブスクリプションに 10 個のラボがある場合、ラボごとの仮想マシンの数は約 79 になります (上限値 800 から、10 個のラボ自体のリソース グループの数 10 を引いた値)。
- たとえば、ラボが ExpressRoute 経由でオンプレミスに接続されている場合は、VNET/サブネット用に **使用可能な IP アドレス空間が定義されています**。 ラボ内の VM の作成が失敗しないようにするには (エラー: IP アドレスを取得できない)、ラボの所有者は、使用可能な IP アドレス空間に合わせて、ラボあたりの最大 VM 数を指定できます。

## <a name="use-resource-manager-templates"></a>Resource Manager テンプレートを使用する

### <a name="question"></a>Question
DevTest Labs 環境で Resource Manager テンプレートを使用するにはどうすればよいですか。

### <a name="answer"></a>回答
[テスト環境のための Azure DevTest Labs の使用](devtest-lab-test-env.md)に関するページの手順に従って Resource Manager テンプレートをデプロイします。 基本的には、Resource Manager テンプレートを Azure Repos または GitHub Git リポジトリにチェックインし、[テンプレート用のプライベート リポジトリ](devtest-lab-test-env.md)をラボに追加します。

DevTest Labs を使用して開発マシンをホストする場合には、このシナリオが役に立たない可能性があります。 運用環境の典型であるステージング環境を構築する際に、このシナリオを使用してください。

ラボごとまたはユーザーごとの仮想マシン数のオプションは、ラボ自体にネイティブに作成されるマシンの数のみを制限するものです。 Resource Manager テンプレートを使用したどの環境による作成も、このオプションでは制限されません。

## <a name="next-steps"></a>次のステップ
[DevTest Labs での環境の使用](devtest-lab-test-env.md)に関するページをご覧ください。