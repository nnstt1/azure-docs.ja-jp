---
title: Azure の医療 Api の認証と承認
description: この記事では、医療 Api の認証と承認の概要について説明します。
services: healthcare-apis
author: ginalee-dotcom
ms.service: healthcare-apis
ms.topic: overview
ms.date: 07/19/2021
ms.author: ginle
ms.openlocfilehash: 53f31790d5b92234bfd35e723e377e682cd13a4d
ms.sourcegitcommit: 2eac9bd319fb8b3a1080518c73ee337123286fa2
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 08/31/2021
ms.locfileid: "123252526"
---
# <a name="authentication--authorization-for-the-healthcare-apis-preview"></a>医療 Api (プレビュー) の認証 & 承認

> [!IMPORTANT]
> Azure Healthcare APIs は現在プレビュー段階です。 ベータ版、プレビュー版、または一般提供としてまだリリースされていない Azure の機能に適用されるその他の法律条項については、「[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)」に記載されています。

この記事では、医療 Api サービスにアクセスするための認証と承認のプロセスの概要について説明します。

## <a name="authentication"></a>認証

医療 api は、 [OAuth 2.0](https://oauth.net/2/)をサポートするグローバル id プロバイダーである[Azure Active Directory (Azure AD)](../active-directory/index.yml)を使用した、セキュリティで保護されたマネージドサービスのコレクションです。

医療 Api サービスがストレージアカウントやイベントハブなどの Azure リソースにアクセスするには、 **システム管理 id を有効に** し、管理対象 id に **適切なアクセス許可を付与** する必要があります。 詳細については、「 [Azure マネージ id](../active-directory/managed-identities-azure-resources/overview.md)」を参照してください。

医療 Api は、他の id プロバイダーをサポートしていません。 ただし、お客様は独自の id プロバイダーを使用してアプリケーションを保護し、クライアントアプリケーションとユーザーデータアクセス制御を管理することによって、医療 Api との対話を可能にすることができます。

クライアントアプリケーションは Azure AD に登録され、医療 api にアクセスするために使用できます。 ユーザーデータアクセス制御は、ビジネスロジックを実装するアプリケーションまたはサービスで実行されます。

### <a name="application-roles"></a>アプリケーション ロール

医療 Api の認証されたユーザーとクライアントアプリケーションには、適切なアプリケーションロールを付与する必要があります。

医療 Api の FHIR サービスには、次の役割があります。

* **Fhir データリーダー**: fhir データを読み取り (および検索) できます。
* **Fhir データライター**: fhir データの読み取り、書き込み、および削除を実行できます。
* **Fhir データエクスポーター**: データの読み取りとエクスポート ($export 演算子) を実行できます。
* **Fhir データ共同作成者**: すべてのデータプレーン操作を実行できます。
* **Fhir データコンバーター**: コンバーターを使用してデータ変換を実行できます。

医療 Api の DICOM サービスには、次の役割があります。

* **Dicom データ所有者**: dicom データの読み取り、書き込み、削除を実行できます。
* **Dicom データ読み取り**: dicom データを読み取ることができます。

IoT Connector にはアプリケーションロールは必要ありませんが、顧客のサブスクリプションのイベントハブに格納されているデータを取得するために "Azure Event Hubs データ受信者" に依存します。

## <a name="authorization"></a>承認

適切なアプリケーションロールが付与されると、認証されたユーザーとクライアントアプリケーションは、Azure AD によって発行された **有効なアクセストークン** を取得し、アプリケーションロールによって定義された特定の操作を実行することによって、医療 api サービスにアクセスできます。
 
* FHIR サービスの場合、アクセストークンはサービスまたはリソースに固有です。
* DICOM サービスの場合、アクセストークンは特定のサービスではなく、リソースに付与され `dicom.healthcareapis.azure.com` ます。
* IoT Connector の場合、アクセストークンはユーザーまたはクライアントアプリケーションに公開されないため、必要ありません。

### <a name="steps-for-authorization"></a>承認の手順

アクセストークンを取得するには、2つの一般的な方法があります。[承認コードフロー](../active-directory/develop/v2-oauth2-auth-code-flow.md)と[クライアント資格情報フロー](../active-directory/develop/v2-oauth2-client-creds-grant-flow.md)という Azure AD のドキュメントで詳しく説明されています。

医療 Api のアクセストークンを取得するために、 **承認コードフロー** を使用する手順は次のとおりです。

1. **クライアントは Azure AD 認証エンドポイントに要求を送信します。** Azure AD は、ユーザーが適切な資格情報 (たとえば、ユーザー名とパスワード、または2要素認証) を使用して認証されるサインインページにクライアントをリダイレクトします。 **認証が成功すると、認証コードがクライアントに返されます。** Azure AD では、クライアントアプリケーションの登録で構成された登録済みの応答 URL にこの認証コードを返すことのみが許可されます。

2. **クライアントアプリケーションは、Azure AD トークンエンドポイントでアクセストークンの認証コードを交換します。** クライアントアプリケーションは、トークンを要求するときに、クライアントシークレット (アプリケーションの登録時に追加可能) を提供する必要がある場合があります。
 
3. クライアントは、FHIR サービスのすべての患者を検索する要求など、**医療 api に要求を行い** `GET` ます。 要求の作成時には、 **`HTTP` 要求ヘッダーにアクセストークンが含まれ** ます。たとえば、のように **`Authorization: Bearer xxx`** なります。

4. **医療 Api サービスは、トークンに適切な要求 (トークン内のプロパティ) が含まれていることを検証します。** 有効な場合は、要求を完了し、データをクライアントに返します。

**クライアント資格情報のフロー** では、アクセス許可はアプリケーション自体に直接付与されます。 アプリケーションがリソースにトークンを提示すると、リソースは、認証にユーザーが関与していないため、アプリケーション自体がアクションを実行する承認を適用するように強制します。 そのため、次の方法では、 **承認コードフロー** とは異なります。

- ユーザーまたはクライアントは、対話形式でログインする必要がありません。
- 認証コードは必要ありません。
- アクセストークンは、アプリケーションのアクセス許可によって直接取得されます。

### <a name="access-token"></a>アクセス トークン

アクセストークンは、ユーザーまたはクライアントに与えられたクライアントの id、ロール、および特権に関する情報を伝達する、署名済みの、 [Base64](https://en.wikipedia.org/wiki/Base64) でエンコードされたプロパティ (要求) のコレクションです。

通常、医療 Api は [JSON Web トークン](https://en.wikipedia.org/wiki/JSON_Web_Token)を想定しています。 これは、次の 3 つの部分で構成されています。 
* ヘッダー
* ペイロード (要求)
* 次の図に示すように、署名。 詳細については、「 [Azure アクセストークン](../active-directory/develop/active-directory-configurable-token-lifetimes.md)」を参照してください。

[![JASON web トークン署名。 ](media/azure-access-token.png) ](media/azure-access-token.png#lightbox)

などのオンラインツールを使用して [https://jwt.ms](https://jwt.ms/) 、トークンの内容を表示できます。 たとえば、要求の詳細を表示できます。

|**要求の種類**          |**値**               |**注**                               |
|------------------------|------------------------|----------------------------------------|
|aud                     |https://xxx.fhir.azurehealthcareapis.com|トークンの受信者を示します。 `id_tokens`では、対象の受信者は Azure portal でアプリに割り当てられたアプリのアプリケーション ID です。 アプリでは、この値を検証し、値が一致しない場合はトークンを拒否する必要があります。|
|iss                     |https://sts.windows.net/{tenantid}/|トークンを作成して返したセキュリティ トークン サービス (STS)、およびユーザーが認証された Azure AD テナントを示します。 トークンが v2.0 エンドポイントによって発行された場合、URI の末尾は `/v2.0` になります。 ユーザーが Microsoft アカウントを持つコンシューマー ユーザーであることを示す GUID は `9188040d-6c67-4c5b-b112-36a304b66dad` です。 アプリでは、要求の GUID 部分を使用して、アプリにサインインできるテナントのセットを制限する必要があります (該当する場合)。|
|iat                     |(タイムスタンプ)            |"Issued At" は、このトークンの認証がいつ行われたのかを示します。|
|nbf                     |(タイムスタンプ)            |"nbf" (指定時刻よりも後) 要求では、指定した時刻よりも後に JWT の処理を受け入れることができるようになります。|
|exp                     |(タイムスタンプ)            |"exp" (有効期限) 要求は、JWT の処理を受け入れることができなくなる時刻を指定します。 この時間の前にリソースがトークンを拒否することがあることに注意してください。たとえば、認証の変更が必要な場合や、トークンの失効が検出された場合などです。|
|aio                     |E2ZgYxxx                |Azure AD がトークン再利用のためにデータの記録に使用する内部の要求。 無視してください。|
|appid                   |e97e1b8c-xxx            |これは、トークンを使用するクライアントのアプリケーション ID です。 アプリケーションとして識別することもできますが、アプリケーションを使用しているユーザーとして識別することもできます。 アプリケーション ID は通常、アプリケーション オブジェクトを表しますが、Azure AD 内のサービス プリンシパル オブジェクトを表すこともできます。|
|appidacr                |1                       |クライアントが認証された方法を示します。 パブリック クライアントの場合、値は "0" です。 クライアント ID とクライアント シークレットが使用されている場合、値は "1" です。 クライアント証明書が認証に使用された場合、値は "2" です。|
|idp                     |https://sts.windows.net/{tenantid}/|トークンのサブジェクトを認証した ID プロバイダーを記録します。 この値は、ユーザーアカウントが発行者のゲストと同じテナントにない場合 (たとえば、)、発行者の要求の値と同じです。 要求が存在しない場合は、iss の値を代わりに使用できることを意味します。 組織のコンテキストで使用されている個人アカウント (Azure AD テナントに招待された個人のアカウントなど) の場合、idp 要求は ' live.com ' または STS URI になります。これには Microsoft アカウント、テナント 9188040d-6c6747 c5b66dad が含まれます。|
|oid                     |たとえば、tenantid のようになります。         |これは、Microsoft id システム (この場合はユーザーアカウント) 内のオブジェクトの変更できない識別子です。 この ID は、アプリケーション間でユーザーを一意に識別します。同じユーザーにサインインする2つの異なるアプリケーションは、oid 要求で同じ値を受け取ります。 Microsoft Graph は、特定のユーザーアカウントの id プロパティとしてこの id を返します。 Oid では、複数のアプリがユーザーを関連付けることができるため、この要求を受信するにはプロファイルスコープが必要です。 注: 1 人のユーザーが複数のテナントに存在する場合、ユーザーは各テナントに異なるオブジェクト ID を格納します。これは、ユーザーが同じ資格情報で各アカウントにログインしている場合でも、異なるアカウントと見なされます。|
|rh                       |0. ARoxxx              |Azure がトークンの再検証に使用する内部要求。 無視する必要があります。|
|sub                      |たとえば、tenantid のようになります。        |トークンが情報をアサートするプリンシパルです (アプリのユーザーなど)。 この値は変更不可で、再割り当ても再利用もできません。 サブジェクトはペアワイズ識別子で、特定のアプリケーション ID に一意です。 そのため、1 人のユーザーが 2 つの異なるクライアント ID を使用して 2 つの異なるアプリにサインインすると、そのアプリは、サブジェクト要求に対して 2 つの異なる値を受け取ることになります。 この動作が求められているかどうかは、アーキテクチャやプライバシーの要件によって異なります。|
|tid                      |たとえば、tenantid のようになります。        |ユーザーが属している Azure AD テナントを表す GUID です。 職場または学校アカウントの場合、GUID はユーザーが属している組織の不変のテナント ID です。 個人アカウントの場合、この値は 9188040d-6c6747 c54b66dad になります。 この要求を受信するには、プロファイルのスコープが必要です。
|uti                      |bY5glsxxx             |Azure がトークンの再検証に使用する内部要求。 無視する必要があります。|
|ver                      |1                     |トークンのバージョンを示します。|
 
**既定では、アクセストークンは1時間有効です。新しいトークンを取得することも、有効期限が切れる前に更新トークンを使用して更新することもできます。**

アクセストークンを取得するには、Postman などのツール、PowerShell、CLI、curl、 [Azure AD 認証ライブラリ](../active-directory/develop/reference-v2-libraries.md)の Rest クライアント拡張機能 Visual Studio Code 使用できます。

## <a name="encryption"></a>暗号化

Azure の医療 Api の新しいサービスを作成する場合、既定では **Microsoft が管理するキー** を使用してデータが暗号化されます。 

* FHIR サービスは、データがデータストアに保存されるときに保存データの暗号化を提供します。
* DICOM サービスは、埋め込みメタデータを含むイメージングデータをデータストアに保存するときに、保存データの暗号化を提供します。 メタデータが抽出され、FHIR サービスで永続化されると、自動的に暗号化されます。
* IoT Connector、データマッピングと正規化の後、はデバイスメッセージを fhir サービスに永続化します。これは自動的に暗号化されます。 Azure Storage を使用してデータを格納する azure event hub にデバイスメッセージが送信される場合、データは Azure Storage Service Encryption (Azure SSE) を使用して自動的に暗号化されます。

## <a name="next-steps"></a>次の手順

このドキュメントでは、医療 Api の認証と承認について学習しました。 医療 Api サービスのインスタンスをデプロイする方法については、「」を参照してください。

>[!div class="nextstepaction"]
>[Azue ポータルを使用した医療 Api (プレビュー) ワークスペースのデプロイ](healthcare-apis-quickstart.md)
