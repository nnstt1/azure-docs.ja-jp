---
title: Azure Virtual Desktop のホスト プールの負荷分散 - Azure
description: Azure Virtual Desktop 環境でのホスト プールの負荷分散アルゴリズムについて説明します。
author: Heidilohr
ms.topic: conceptual
ms.date: 10/12/2020
ms.author: helohr
manager: femila
ms.openlocfilehash: f2b73879183bf3d85588c17a9b24bf42d649c06f
ms.sourcegitcommit: 677e8acc9a2e8b842e4aef4472599f9264e989e7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/11/2021
ms.locfileid: "132277241"
---
# <a name="host-pool-load-balancing-algorithms"></a>ホスト プールの負荷分散アルゴリズム

>[!IMPORTANT]
>この内容は、Azure Resource Manager Azure Virtual Desktop オブジェクトを含む Azure Virtual Desktop に適用されます。 Azure Resource Manager オブジェクトを含まない Azure Virtual Desktop (クラシック) を使用している場合は、[こちらの記事](./virtual-desktop-fall-2019/host-pool-load-balancing-2019.md)を参照してください。

Azure Virtual Desktop では 2 つの負荷分散アルゴリズムがサポートされます。 それぞれのアルゴリズムにより、ユーザーがホスト プール内のリソースに接続するときにそのユーザーのセッションをホストするセッション ホストが決まります。

Azure Virtual Desktop では以下の負荷分散アルゴリズムを使用できます。

- 幅優先の負荷分散では、ホスト プール内のセッション ホスト間でユーザー セッションを均等に分散させることができます。
- 深さ優先の負荷分散では、セッション ホストをホスト プール内のユーザー セッションで飽和状態にすることができます。 最初のセッション ホストがそのセッション制限のしきい値に達すると、新しいユーザー接続はロード バランサーによってホスト プール内の次のセッション ホストに制限に達するまで送られ、以下同様に送られます。

各ホスト プールで構成できるのは、そのホスト プールに固有の 1 種類の負荷分散だけです。 ただし、属しているホスト プールに関係なく、両方の負荷分散アルゴリズムが以下の動作を共有します。

- ユーザーが既にホスト プール内にアクティブまたは切断済みのセッションを持っていて、再度サインインすると、ロード バランサーは、既存のセッションがあるセッション ホストにユーザーを正常にリダイレクトします。 この動作は、そのセッション ホストの AllowNewConnections プロパティが False (ドレイン モードが有効) に設定されている場合でも適用されます。
- ユーザーがホスト プール内にセッションをまだ持っていない場合、ロード バランサーでは、AllowNewConnections プロパティが False に設定されているセッション ホストは負荷分散時に考慮されません。

## <a name="breadth-first-load-balancing-algorithm"></a>幅優先の負荷分散アルゴリズム

幅優先の負荷分散アルゴリズムを使用すると、セッション ホスト間でユーザー セッションを分散して、セッションのパフォーマンスを最適化できます。 このアルゴリズムは、プールされた仮想デスクトップ環境に接続しているユーザーに最適なエクスペリエンスを提供することを望む組織に最適です。

幅優先のアルゴリズムでは、まず、新しい接続を許可するセッション ホストのクエリが実行されます。 次に、セッションの数が最も少ない半数のセッション ホストから、セッション ホストがランダムに選択されます。 たとえば、11、12、13、14、15、16、17、18、19 のセッションを持つ 9 台のマシンがある場合、新しく作成したセッションは自動的に最初のマシンでホストされるわけではありません。 代わりに、セッションの数が最も少ない最初の 5 台のマシン (11、12、13、14、15) のいずれかでホストされます。

## <a name="depth-first-load-balancing-algorithm"></a>深さ優先の負荷分散アルゴリズム

深さ優先の負荷分散アルゴリズムでは、スケールダウン シナリオに対して最適化するために、一度に 1 つのセッション ホストを飽和状態にすることができます。 このアルゴリズムは、ホスト プールに割り当てられている仮想マシンの数をより細かく制御することを望むコスト意識の高い組織に最適です。

深さ優先のアルゴリズムでは、まず、新しい接続を許可し、セッションの上限を超えていないセッション ホストのクエリが実行されます。 次に、セッションの数が最も多いセッション ホストが選択されます。 同数のものがある場合は、クエリ内の最初のセッション ホストが選択されます。

>[!IMPORTANT]
>深さ優先の負荷分散アルゴリズムを使用すると、セッション ホストの上限に基づいてセッションがセッション ホストに分散されます。 このパラメーターは、深さ優先の負荷分散アルゴリズムを使用する場合に必要です。 最適なユーザー エクスペリエンスを実現するには、セッション ホストの上限パラメーターを実際の環境に最も適した数に変更してください。
