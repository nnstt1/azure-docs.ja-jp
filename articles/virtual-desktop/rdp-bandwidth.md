---
title: Azure Virtual Desktop のリモート デスクトップ プロトコル帯域幅の要件 - Azure
titleSuffix: Azure
description: Azure Virtual Desktop 用 RDP 帯域幅の要件について説明します。
author: gundarev
ms.topic: conceptual
ms.date: 11/16/2020
ms.author: denisgun
ms.openlocfilehash: 3153abcc4a0fa76b0ebb6c0a9715020af6a646ec
ms.sourcegitcommit: 92889674b93087ab7d573622e9587d0937233aa2
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/19/2021
ms.locfileid: "130181485"
---
# <a name="remote-desktop-protocol-rdp-bandwidth-requirements"></a>リモート デスクトップ プロトコル (RDP) の帯域幅の要件

リモート デスクトップ プロトコル (RDP) は、さまざまな手法を使用して、クライアント デバイスへのサーバーのリモート グラフィックス配信を完全に実現する高度なテクノロジです。 RDP は、ユース ケース、コンピューティング リソースの可用性、およびネットワーク帯域幅に応じて、さまざまなパラメーターを動的に調整して、最適なユーザー エクスペリエンスを実現します。

リモート デスクトップ プロトコルは、複数の動的仮想チャネル (DVC) を、異なるネットワーク トランスポート経由で送信される 1 つのデータ チャネルに多重化します。 リモート グラフィックス、入力、デバイス リダイレクト、印刷などのために、個別の DVC があります。 Azure Virtual Desktop パートナーは、DVC インターフェイスを使用する拡張機能も使用できます。

RDP を介して送信されるデータの量は、ユーザーの利用状況によって異なります。 たとえば、ユーザーはほとんどのセッションで基本的なテキスト コンテンツを操作し、最小帯域幅を消費しますが、その後、200 ページのドキュメントの印刷をローカル プリンターに生成できます。 この印刷ジョブでは、大量のネットワーク帯域幅が使用されます。

リモート セッションを使用している場合、ご利用のネットワークで利用できる帯域幅が、エクスペリエンスの品質に大幅に影響を与えます。 さまざまなアプリケーションとディスプレイの解像度に、異なるネットワーク構成が必要です。そのため、ニーズを満たすようにご利用のネットワークが構成されていることを確認することが不可欠です。

## <a name="estimating-bandwidth-utilization"></a>帯域幅の使用率の見積もり

RDP では、さまざまな種類のデータに対してさまざまな圧縮アルゴリズムを使用します。 次の表では、データ転送の見積もりについて説明します。

| データの種類 | Direction | 見積もり方法 |
|---|---|---|
| リモート グラフィックス | クライアントへのセッション ホスト | [詳細なガイドラインを参照](#estimating-bandwidth-used-by-remote-graphics) |
|  ハートビート | 双方向 | 5 秒ごとに最大 20 バイト  |
| 入力 | クライアントからセッション ホストへ | ほとんどの操作では、ユーザー アクティビティに基づいてデータ量は 100 バイト未満  |
| ファイル転送 | 双方向 | ファイル転送で一括圧縮が使用されます。 概算値に .zip 圧縮を使用 |
| 印刷 | クライアントへのセッション ホスト | 印刷ジョブ転送はドライバーに依存し、一括圧縮を使用して概算に .zip 圧縮を使用 |

その他のシナリオでは、次のように使用方法に応じて帯域幅の要件を変更できます。

* 音声会議またはビデオ会議
* リアルタイム通信
* 4K ビデオのストリーム配信

## <a name="estimating-bandwidth-used-by-remote-graphics"></a>リモート グラフィックスによって使用される帯域幅の見積もり

リモート デスクトップで使用される帯域幅を予測するのは困難です。 ユーザー アクティビティは、ほとんどのリモート デスクトップ トラフィックを生成します。 すべてのユーザーが一意であり、作業パターンが異なると、ネットワークの使用が大幅に変化する可能性があります。

帯域幅の要件を理解する最善の方法は、実際のユーザー接続を監視することです。 監視は、組み込みのパフォーマンス カウンターまたはネットワーク機器によって実行できます。

ただし、多くの場合、リモート デスクトップ プロトコルの動作方法を理解し、ユーザーの作業パターンを分析することで、ネットワーク使用率を見積もることができます。

リモート プロトコルは、ローカル モニターに表示するためにリモート サーバーによって生成されたグラフィックスを配信します。 具体的には、サーバー上で完全に構成されたデスクトップ ビットマップを提供します。
デスクトップ ビットマップの配信は、最初のアプローチでは単純なタスクのように見えますが、大量のリソースが必要になります。 たとえば、圧縮されていない形式の 1080 p デスクトップ イメージのサイズは約 8 MB です。 このイメージをローカル接続モニターに表示するには、画面のリフレッシュ レートが 30 Hz の場合は約 237 MB/秒の帯域幅が必要です。

ネットワーク経由で転送されるデータ量を減らすために、RDP では複数の手法を組み合わせて使用します。これには次の手法などがありますが、これらに限定されません。

* フレーム レートの最適化
* 画面コンテンツの分類
* コンテンツ固有のコーデック
* プログレッシブ イメージ エンコード
* クライアント側のキャッシュ

リモート グラフィックスについて理解を深めるには、次の点を考慮してください。

* グラフィックスを充実させると、より多くの帯域幅を消費します。
  * テキスト、ウィンドウ UI 要素、単色の領域では、それら以外よりも消費する帯域幅は少なくなります。
  * 自然画像は、帯域幅を最も大幅に消費します。 しかし、クライアント側でキャッシュされるため、その削減に役立ちます。
* 画面の変更された部分のみが転送されます。 画面に表示される更新部分がない場合は、更新は送信されません。
* ビデオ再生とその他の高フレーム レート コンテンツは、基本的にイメージのスライドショーです。 RDP は、適切なビデオ コーデックを動的に使用して、元のフレーム レートに近い状態でそれらを配信します。 ただし、まだグラフィックスであるため、帯域幅の使用率には最も大きく関与します。
* リモート デスクトップのアイドル時間では、画面の更新は行われない、または最小限になります。そのため、アイドル状態のときは、ネットワークの使用が最小限に抑えられます。
* リモート デスクトップ クライアント ウィンドウが最小化されている場合、セッション ホストからグラフィカルな更新は送信されません。

ネットワークにかかるストレスは、アプリのワークロードの出力フレーム レートと画面の解像度の両方に依存することに注意してください。 フレーム レートまたは画面の解像度を上げると、帯域幅の要件も増加します。 たとえば、高解像度の画面での軽量なワークロードには、通常の解像度または低解像度での軽量なワークロードよりも多くの使用可能な帯域幅が必要です。 画面の解像度が異なる場合は、使用可能な異なる帯域幅が必要です。

次の表は、さまざまなグラフィック シナリオで使用されるデータを見積もる方法を示しています。 これらの数値は、1920 x 1080 の解像度を使用した単一のモニター構成と、既定のグラフィック モードおよび H.264/AVC 444 グラフィック モードの両方に適用されます。

| シナリオ | 既定モード | H.264/AVC 444 モード | サムネイル | シナリオの説明 |
|:---|---:|---:|---|---|
| アイドル | 0.3 Kbps | 0.3 Kbps |:::image type="content" source="media/idle.png" alt-text="アイドル状態の接続のスクリーンショット":::| ユーザーは作業を一時停止しており、アクティブな画面の更新はありません。 |
| Microsoft Word | 100 から 150 Kbps | 200 から 300 Kbps |:::image type="content" source="media/word.gif" alt-text="Microsoft Word のアニメーション":::| 入力、グラフィックスの貼り付け、ドキュメント間の切り替えでユーザーは Microsoft Word を活発に操作中 |
| Microsoft Excel | 150 から 200 Kbps | 400 から 500 Kbps |:::image type="content" source="media/excel.gif" alt-text="Microsoft Excel のアニメーション":::| 数式とグラフを含む複数のセルが同時に更新され、ユーザーは Microsoft Excel を活発に操作中 |
| Microsoft PowerPoint | 4 から 4.5 Mbps | 1.6 から 1.8 Mbps |:::image type="content" source="media/powerpoint.gif" alt-text="Microsoft PowerPoint のアニメーション":::| 入力、貼り付けでユーザーは Microsoft PowerPoint を活発に操作中。 ユーザーは充実したグラフィックスを変更中でもあり、スライドの切り替え効果を使用中 |
| Web 閲覧 | 6 から 6.5 Mbps | 0.9 から 1 Mbps |:::image type="content" source="media/web.gif" alt-text="Web 閲覧のアニメーション":::| ユーザーは複数の静的な画像とアニメーション化されたイメージを含む、グラフィックスが充実した Web サイトを活発に操作中。 ユーザーはページを水平方向および垂直方向にスクロール |
| イメージ ギャラリー | 3.3 から 3.6 Mbps | 0.7 から 0.8 Mbps |:::image type="content" source="media/image-gallery.gif" alt-text="イメージ ギャラリーのアニメーション":::| ユーザーはイメージ ギャラリー アプリケーションを活発に操作中。 画像の参照、ズーム、サイズ変更、および回転 |
| ビデオ再生 | 8.5 から 9.5 Mbps | 2.5 から 2.8 Mbps |:::image type="content" source="media/video.gif" alt-text="ビデオ再生のアニメーション":::| ユーザーは画面の 2 分の 1 を消費する 30 FPS ビデオを視聴中 |
| 全画面ビデオ再生 | 7.5 から 8.5 Mbps | 2.5 から 3.1 Mbps |:::image type="content" source="media/fullscreen-video.gif" alt-text="全画面ビデオ再生のアニメーション":::| ユーザーは全画面に最大化された 30 FPS ビデオの視聴中 |

## <a name="dynamic-bandwidth-allocation"></a>動的な帯域幅割り当て

リモート デスクトップ プロトコルは、変化するネットワークの状態を動的に調整するように設計された最新のプロトコルです。
RDP では、帯域幅使用率のハード制限を使用する代わりに、使用可能なネットワーク帯域幅とパケット ラウンドトリップ時間をアクティブに監視する継続的なネットワーク検出を使用します。 検出結果に基づいて、RDP はグラフィック エンコード オプションを動的に選択し、デバイスのリダイレクトやその他の仮想チャネルに帯域幅を割り当てます。  
このテクノロジによって、RDP は、ネットワークが利用可能なときにネットワーク パイプ全体を使用し、別の用途に必要なときに迅速に戻せます。
他のアプリケーションがネットワークを要求した場合、RDP はそれを検出し、イメージの品質、フレーム レート、または圧縮アルゴリズムを調整します。

## <a name="limit-network-bandwidth-use-with-throttle-rate"></a>ネットワーク帯域幅の使用率をスロットル レートで制限する

ほとんどのシナリオでは、制限がユーザー エクスペリエンスに影響する可能性があるため、帯域幅の使用率を制限する必要はありません。 ただし、制約があるネットワークでは、ネットワーク使用率を制限することができます。 もう 1 つの例として、使用されているトラフィック量に対して課金されるリースのネットワークがあります。

このような場合は、QoS ポリシーでスロットル レートを指定することで、RDP 送信ネットワーク トラフィックを制限できます。

  >[!NOTE]
  > [マネージド ネットワークに RDP Shortpath が有効化されていることを確認してください。](./shortpath.md)スロットル レート制限は、リバース接続トランスポートではサポートされていません。

### <a name="implement-throttle-rate-limiting-on-session-host-using-group-policy"></a>グループ ポリシーを使用してセッション ホストでスロットル レート制限を実装する

グループ ポリシー内でポリシーベースのサービスの品質 (QoS) を使用して、事前に定義されたスロットル レートを設定できます。

ドメインに参加しているセッション ホストの QoS ポリシーを作成するには、まず、グループ ポリシー管理がインストールされているコンピューターにサインインします。 [グループ ポリシーの管理] を開き ([スタート] をクリックし、[管理ツール] をポイントし、[グループ ポリシーの管理] を選択します)、次の手順を実行します。

1. [グループ ポリシーの管理] で、新しいポリシーを作成するコンテナーを見つけます。 たとえば、すべてのセッション ホスト コンピューターが **セッション ホスト** という名前の OU に配置されている場合、新しいポリシーをセッション ホスト OU に作成する必要があります。

2. 適切なコンテナーを右クリックし、 **[このドメインに GPO を作成し、このコンテナーにリンクする]** を選択します。

3. **[新しい GPO]** ダイアログ ボックスで、 **[名前]** ボックスに新しいグループ ポリシー オブジェクトの名前を入力し、 **[OK]** を選択します。

4. 新しく作成されたポリシーを右クリックし、 **[編集]** を選択します。

5. グループ ポリシー管理エディターで、 **[コンピューターの構成]** 、 **[Windows の設定]** の順に展開し、 **[ポリシーベースの QoS]** を右クリックして、 **[新規ポリシーの作成]** を選択します。

6. **[ポリシーベースの QoS]** ダイアログ ボックスの開始ページで、 **[名前]** ボックスに新しいポリシーの名前を入力します。 **[Specify Outbound Throttle Rate]\(送信スロットル レートの指定\)** を選択し、必要な値を設定し、 **[次へ]** を選択します。

7. 次のページで、 **[次の実行可能ファイル名を持つアプリケーションのみ]** を選択し、**svchost.exe** の名前を入力して、 **[次へ]** を選択します。 この設定によって、リモート デスクトップ サービスからの一致するトラフィックにのみ優先順位を付けるように、ポリシーに指示されます。

8. 3 番目のページで、 **[すべての発信元 IP アドレス]** と **[すべての宛先 IP アドレス]** が選択されていることを確認します。 **[次へ]** を選択します。 この 2 つの設定により、パケットを送信するコンピューター (IP アドレス) とパケットを受信するコンピューター (IP アドレス) に関係なく、パケットが管理されるようになります。

9. 4 ページ目で、 **[UDP]** を **[この QoS ポリシーを適用するプロトコルを選択してください]** ドロップダウン リストから選択します。

10. **[宛先ポート番号を指定してください]** の見出しの下で、 **[次の発信元ポート番号か範囲]** を選択します。 付随するテキストボックスに、「**3390**」と入力します。 **[完了]** を選択します。

作成した新しいポリシーは、セッション ホスト コンピューターでグループ ポリシーが更新されるまで有効にはなりません。 グループ ポリシーは定期的に更新されますが、次の手順を実行して即時に更新を適用できます。

1. グループ ポリシーを更新する各セッション ホストで、管理者としてコマンド プロンプトを開きます ( *[管理者として実行]* )。

2. コマンド プロンプトに、次のコマンドを入力します。

   ```console
   gpupdate /force
   ```

### <a name="implement-throttle-rate-limiting-on-session-host-using-powershell"></a>PowerShell を使用してセッション ホストでスロットル レート制限を実装する

次の PowerShell コマンドレットを使用して、マネージド ネットワーク用 RDP Shortpath にスロットル レートを設定できます。

```powershell
New-NetQosPolicy -Name "RDP Shortpath for managed networks" -AppPathNameMatchCondition "svchost.exe" -IPProtocolMatchCondition UDP -IPSrcPortStartMatchCondition 3390 -IPSrcPortEndMatchCondition 3390  -ThrottleRateActionBitsPerSecond 10mb -NetworkProfile All
```

## <a name="next-steps"></a>次のステップ

* Azure Virtual Desktop 用帯域幅の要件の詳細については、[Azure Virtual Desktop のリモート デスクトップ プロトコル (RDP) 帯域幅の要件の概要](rdp-bandwidth.md)に関するトピックをご覧ください。
* Azure Virtual Desktop のネットワーク接続の詳細については、「[Azure Virtual Desktop のネットワーク接続について](network-connectivity.md)」を参照してください。
* Azure Virtual Desktop 用サービス品質 (QoS) の使用を開始するには、[Azure Virtual Desktop 用サービス品質 (QoS) の実装](rdp-quality-of-service-qos.md)に関するページをご覧ください。
