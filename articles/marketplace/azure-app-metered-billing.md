---
title: Marketplace の測定サービスを使用したマネージド アプリケーションの従量制課金 | Azure Marketplace
description: このドキュメントは、柔軟な課金モデル (Azure Marketplace) を使用して Azure アプリケーションを発行する ISV 向けのガイドです。
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: conceptual
ms.date: 10/15/2021
ms.author: mingshen
author: mingshen-ms
ms.openlocfilehash: a067e7bbb649adf8f184cbdee5a2a3edb4a2d962
ms.sourcegitcommit: 147910fb817d93e0e53a36bb8d476207a2dd9e5e
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/18/2021
ms.locfileid: "130132001"
---
# <a name="managed-application-metered-billing"></a>マネージド アプリケーションの従量制課金

Marketplace の測定サービスを使用すると、標準以外の単位に応じて課金される Azure アプリケーション オファー用のマネージド アプリケーション プランを作成できます。 このオファーを公開する前に、帯域幅、チケット、処理された電子メールなどの課金ディメンションを定義します。 顧客は、これらのディメンションの使用量に応じて支払いを行います。  システムでは、課金対象のイベントの発生時にそのイベントのMarketplace の測定サービス API 経由で Microsoft にイベントを通知します。

## <a name="prerequisites-for-metered-billing"></a>従量制課金のための前提条件

マネージド アプリケーション プランで従量制課金を使用するには、次の条件を満たすことが必要です。

* 「[Azure アプリケーション オファーを作成する](azure-app-offer-setup.md)」に記載されているように、すべてのオファー要件を満たしていること。
* サービスに対して月ごとの費用を顧客に請求するための **価格** を構成すること。 固定料金を請求せず、代わりに従量制課金に完全に依存する場合は、価格を 0 にできます。
* 顧客が定額料金に上乗せして支払うことになる、測定イベントの **課金ディメンション** を設定すること。
* 課金対象のイベントを Microsoft に通知するために [Marketplace の測定サービス API](./marketplace-metering-service-apis.md) と統合されていること。

## <a name="how-metered-billing-fits-in-with-pricing"></a>価格モデルに従量制課金を適用する方法

オファーをその価格モデルとともに定義する場合、オファーの階層を理解することが重要です。

* 各 Azure アプリケーション オファーには、ソリューション テンプレートまたはマネージド アプリケーション プランを含めることができます。
* 従量制課金は、マネージド アプリケーション プランでのみ実装されます。
* 各マネージド アプリケーション プランには、価格モデルが関連付けられています。
* 価格モデルには毎月の基本料金が含まれ、0 ドルに設定することもできます。
* 基本料金に加えて、プランには、定額料金には含まれない、使用量に応じて顧客に請求するためのオプションのディメンションを含めることもできます。 各ディメンションは、サービスが [Marketplace の測定サービス API](marketplace-metering-service-apis.md) を使用して Microsoft と通信する課金対象項目を表します。

    > [!IMPORTANT]
    > コード内の使用状況を把握し、基本料金を超えた使用分についてのみ、使用状況のイベントを Microsoft に送信する必要があります。

## <a name="sample-offer"></a>サンプル オファー

たとえば、Contoso は、Contoso Analytics (CoA) と呼ばれるマネージド アプリケーション サービスを使用する発行元です。 CoA を使用すると、顧客はレポートやデータ ウェアハウスのために大量のデータを分析できます。 Contoso は、Azure のお客様にプランを公開するための商業マーケットプレース プログラムの公開元としてパートナー センターに登録されています。 次に示すように、CoA に関連付けられているプランが 2 つあります。

* 基本プラン
    * 100 GB を分析し、0 ドル/月で 100 件のレポートを生成します
    * 100 GB を超えると、1 GB ごとに 10 ドル支払います
    * レポートが 100 件を超えると、レポート 1 件につき 1 ドル支払います
* Premium プラン
    * 1000 GB を分析し、350 ドル/月で 1000 件のレポートを生成します
    * 1000 GB を超えると、1 TB ごとに 100 ドル支払います
    * レポートが 1000 件を超えると、レポート 1 件につき 0.5 ドル支払います

CoA サービスをサブスクライブする Azure の顧客は、選択したプランに基づいて月ごとにレポートを分析および生成できます。 Contoso は、Microsoft に使用状況イベントを送信することなく、無料使用量に達するまで使用量を測定します。 お客様の使用量が無料使用量を超えた場合、プランを変更したり別のことを行ったりする必要はありません。 Contoso は無料使用量の超過分を測定し、[Marketplace の測定サービス API](./marketplace-metering-service-apis.md) を使用して、追加使用についての使用状況イベントを Microsoft に送信し始めます。 Microsoft はこれに応じて、公開元によって指定された追加の使用量に対してお客様に請求します。

## <a name="billing-dimensions"></a>課金ディメンション

課金ディメンションは、ソフトウェアの使用について課金される方法を顧客に通知するために使用されます。  これらのディメンションは、使用状況イベントを Microsoft に伝えるためにも使用されます。 定義は次のとおりです。

* **ディメンション識別子**: 使用状況イベントの生成中に参照される変更できない識別子。
* **ディメンション名**: ディメンションに関連付けられている表示名 (例: "送信されたテキスト メッセージ")。
* **計量単位**: 課金単位の説明 (例: "テキスト メッセージごと"、"電子メール 100 件あたり")。
* **単価**: ディメンションの 1 単位あたりの価格。
* **月間契約の無料使用量**: 定期的な月額料金を支払ったお客様への 1 か月あたりのディメンションの数量。整数である必要があります。

課金ディメンションは、オファーのすべてのプランで共有されます。 一部の属性はすべてのプランのディメンションに適用され、その他の属性はプランに固有です。

ディメンション自体を定義する属性は、オファーのすべてのプランで共有されます。 オファーを公開する前に、あらゆるプランのコンテキストからこれらの属性に加えられた変更は、すべてのプランのディメンション定義に影響を与えます。 プランを公開すると、これらの属性は編集できなくなります。 これらの属性は次のとおりです。

* 識別子
* 名前
* Unit of measure

ディメンションのその他の属性は各プランに固有であり、各プランで異なる値を持つことができます。  これらの値はプランを発行する前に編集でき、このプランのみが影響を受けます。 プランを公開すると、これらの属性は編集できなくなります。 これらの属性は次のとおりです。

* ユニットごとの料金
* 月次払いのお客様の無料使用量 
* 年次払いのお客様の無料使用量 

ディメンションには "有効化" と "無限" という 2 つの特殊な概念もあります。

* **有効化** は、このプランがこのディメンションに参加することを示します。  このディメンションに基づいて使用状況イベントを送信しない新しいプランを作成する場合は、このオプションをオフのままにしておくことをお勧めします。 また、プランが最初に公開された後に追加された新しいディメンションは、既に公開されているプランに対して "無効" として表示されます。  無効なディメンションが、お客様から見たプランのディメンションの一覧に表示されるようになります。
* **無限** は無限大記号 "∞" で表され、このプランはこのディメンションに含まれるが、このディメンションに対して使用量が測定されないことを意味します。 これはお客様に、このディメンションによって表される機能がプランに含まれているが、使用量に制限がないことを示す場合に使用します。  使用量が無限のディメンションは、顧客に表示されるプランのディメンションの一覧に表示されます。  このプランでは、料金は発生しません。

>[!Note] 
>次のシナリオが明示的にサポートされています。  <br> - 新しいディメンションを新しいプランに追加できます。  新しいディメンションは、既に公開されているすべてのプランに対して有効になりません。 <br> - ディメンションを指定せずに月額固定料金のプランを発行した後で、新しいプランを追加して、そのプランの新しいディメンションを構成できます。 新しいディメンションは、既に公開されているプランに対して有効になりません。

## <a name="constraints"></a>制約

### <a name="locking-behavior"></a>ロック動作

Marketplace の測定サービスで使用されるディメンションは、顧客がサービスに対してどのように支払うかの了解事項となります。  オファーが発行されると、ディメンションの詳細はすべて編集できなくなります。  オファーを発行する前に、ディメンションを完全に定義しておくことが重要です。

オファーがディメンションと共に公開されると、そのディメンションについての以下のようなオファーレベルの詳細は変更できなくなります。

* 識別子
* 名前
* Unit of measure

プランが公開されると、以下のようなプラン レベルの詳細を変更できなくなります。

* ユニットごとの料金
* 月間の無料使用量
* プランに対してディメンションが有効になっているかどうか

>[!Note]
>Marketplace の測定サービスを使用した従量制課金は、Azure Government クラウドではまだサポートされていません。

### <a name="upper-limits"></a>上限

1 つのプランに対して構成できる一意のディメンションの最大数は 30 個です。

## <a name="get-support"></a>サポートを受ける

次のいずれかの問題が発生した場合は、サポート チケットを開くことができます。

* Marketplace の測定サービス API に関する技術的な問題。
* お客様の側でのエラーまたはバグが原因でエスカレートする必要がある問題 (例: 間違った使用状況イベント)。
* 従量制課金に関連するその他の問題。

「[パートナー センターでの商業マーケットプレース プログラムのサポート](support.md)」の手順に従って、公開元のサポート オプションを理解し、Microsoft のサポート チケットを開きます。

## <a name="next-steps"></a>次のステップ

- 詳細については、「[Marketplace の測定サービス API](marketplace-metering-service-apis.md)」をご覧ください。
