---
title: マネージド アプリケーション プランを構成する
description: パートナー センターで Azure アプリケーション オファーのマネージド アプリケーション プランを構成します (Azure Marketplace)。
author: aarathin
ms.author: aarathin
ms.reviewer: dannyevers
ms.service: marketplace
ms.subservice: partnercenter-marketplace-publisher
ms.topic: how-to
ms.date: 11/02/2021
ms.openlocfilehash: cbdde26b030b5e3b89d96304ece6e6d698884c19
ms.sourcegitcommit: 702df701fff4ec6cc39134aa607d023c766adec3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/03/2021
ms.locfileid: "131468520"
---
# <a name="configure-a-managed-application-plan"></a>マネージド アプリケーション プランを構成する

この記事は、Azure アプリケーション オファーのマネージド アプリケーション プランにのみ適用されます。 ソリューション テンプレート プランを構成する場合は、[ソリューション テンプレート プランを構成する](azure-app-solution.md)方法に関する記事を参照してください。

## <a name="re-use-technical-configuration-optional"></a>技術的な構成を再利用する (省略可能)

このオファー内で同じ種類のプランが複数作成されていて、それらの間で技術的な構成が同じである場合は、別のプランの技術的な構成を再利用できます。 このプランが公開された後にこの設定を変更することはできません。

技術的な構成を再利用するには:

1. **[This plan reuses the technical configuration from another plan of the same type]\(このプランでは同じ種類の別のプランの技術的な構成を再利用する\)** チェック ボックスをオンにします。
1. 表示された一覧から、目的の基本プランを選択します。

> [!NOTE]
> プランで、同じ種類の別のプランの技術構成を現在再利用している場合、またはこれまで再利用していた場合は、その基本プランに移動して、以前に発行されたパッケージの履歴を表示します。

## <a name="define-markets-pricing-and-availability"></a>市場、価格、および可用性を定義する

すべてのプランは、少なくとも 1 つの市場で利用できる必要があります。 **[価格と可用性]** タブでは、このプランを利用可能にする市場、価格、およびプランをすべてのユーザーに対して表示するか、特定の顧客に対してのみ表示するかを構成できます (後者はプライベート プランとも呼ばれます)。

1. **[市場]** で、 **[市場の編集]** リンクを選択します。
1. 表示されるダイアログ ボックスで、プランを使用できるようにする市場の場所を選択します。 1 から 141 までの市場を選択する必要があります。

    > [!NOTE]
    > このダイアログ ボックスには、Microsoft が代理で消費税と使用税を送金する "税送金済み" 国のみをフィルターするための検索ボックスおよびオプションが含まれています。

1. **[保存]** を選択してダイアログ ボックスを閉じます。

## <a name="define-pricing"></a>価格を定義する

**[価格]** ボックスに、このプランの月額料金を入力します。 このソリューションによってデプロイされるリソースによって発生する Azure インフラストラクチャまたは使用料ベースのコストに、この価格が追加されます。

月ごとの価格に加え、[従量制課金](./azure-app-metered-billing.md)を使用して、非標準ユニットの消費に対する価格を設定することもできます。 月ごとの価格を 0 に設定し、必要に応じて、従量制課金のみを使用して課金することができます。

価格は USD (USD = 米国ドル) で設定され、保存時の最新の為替レートを使用して、選択されたすべての市場の現地通貨に変換されます。 これらの価格は公開前に検証してください。そのためには、価格スプレッドシートをエクスポートして各市場の価格を確認します。 個々の市場でカスタム価格を設定したい場合は、価格スプレッドシートを修正してインポートします。

### <a name="add-a-custom-meter-dimension-optional"></a>カスタム測定ディメンションを追加する (省略可能)

1. **[Marketplace Metering Service dimensions]\(マーケットプレースの測定サービス ディメンション\)** で、 **[Add a Custom Meter Dimension (Max 18)]\(カスタム測定ディメンションの追加 (最大 18)\)** リンクを選択します。
1. **[ID]** ボックスに、使用状況イベントの生成中に参照される変更できない識別子を入力します。
1. **[表示名]** ボックスに、ディメンションに関連付けられている表示名を入力します。 たとえば、"送信されたテキスト メッセージ" などです。
1. **[測定単位]** ボックスに、請求単位の説明を入力します。 たとえば、"テキスト メッセージごと"、"100 電子メールごと" などです。
1. **[米国ドルでの単位あたりの価格]** ボックスに、ディメンションの 1 単位の価格を入力します。
1. **[基本に含まれている月間数量]** ボックスに、定期的な月額料金を支払う顧客に対して毎月含まれるディメンションの数量 (整数) を入力します。 無制限の数量を設定するには、代わりにそのチェック ボックスをオンにします。
1. 別のカスタム測定ディメンションを追加するには、手順 1 から 7 を繰り返します。

### <a name="set-custom-prices-optional"></a>カスタム価格を設定する (省略可能)

USD (USD = 米国ドル) で設定された価格は、保存時の最新の為替レートを使用して、選択されたすべての市場の現地通貨に変換されます。 これらの価格は公開前に検証してください。そのためには、価格スプレッドシートをエクスポートして各市場の価格を確認します。 個々の市場でカスタム価格を設定したい場合は、価格スプレッドシートを修正してインポートします。

プランの発行後に変更できる内容には一部制限があるため、価格は公開前に注意深く確認してください。

> [!NOTE]
> プランの市場の価格は、発行した後では変更できません。

個々の市場でカスタム価格を設定するには、価格スプレッドシートをエクスポートして修正し、インポートします。 公開元がこの価格を検証し、これらの設定を所有する必要があります。 詳細については、「[カスタム価格](plans-pricing.md#custom-prices)」を参照してください。

1. 価格データのエクスポートを有効にするには、先に価格の変更を保存する必要があります。 **[価格と提供の状況]** タブの下部にある **[下書きの保存]** を選択します。
1. **[価格]** で、 **[Import pricing data]\(価格データのエクスポート\)** リンクを選択します。
1. Microsoft Excel で exportedPrice.xlsx ファイルを開きます。
1. スプレッドシートで、価格情報に必要な更新を加え、ファイルを保存します。

   ファイルを更新するには、Excel での編集を有効にする必要がある場合があります。

1. **[価格と提供の状況]** タブの **[価格]** で、 **[Import pricing data]\(価格データのエクスポート\)** リンクを選択します。
1. 表示されるダイアログ ボックスで、 **[はい]** をクリックします。
1. 更新した exportedPrice.xlsx ファイルを選択し、 **[開く]** をクリックします。

## <a name="choose-who-can-see-your-plan"></a>プランを表示できるユーザーを選択する

各プランは、すべてのユーザーに、あるいは特定の対象ユーザーにのみ表示されるように構成できます。 プライベート ユーザーには、Azure サブスクリプション ID を使用してアクセスを付与します。割り当てる各サブスクリプション ID の説明を含めるオプションがあります。 手動では最大 10 個のサブスクリプションを、CSV ファイルを使用すると最大 10,000 個のサブスクリプション ID を追加できます。 Azure サブスクリプション ID は GUID として表されます。文字は小文字にする必要があります。

> [!NOTE]
> プライベート プランを発行する場合は、後でその可視性をパブリックに変更できます。 ただし、パブリック プランを発行した後に、その可視性をプライベートに変更することはできません。

**[プランの可視性]** で、次のいずれかの操作を行います。

- プランをパブリックにするには、 **[パブリック]** オプション ボタン ("_ラジオ ボタン_" とも呼ばれます) を選択します。
- プランをプライベートにするには、 **[プライベート]** オプション ボタンを選択してから、Azure サブスクリプション ID を手動または CSV ファイルで追加します。

> [!NOTE]
> プライベートまたは制限付きの対象ユーザーは、 **[プレビュー]** タブで定義したプレビュー対象ユーザーとは異なります。プレビュー対象ユーザーは、マーケットプレースで公開される "前の" オファーにアクセスできます。 プライベート対象ユーザーの選択は特定のプランにのみ適用されますが、プレビュー対象ユーザーは (プライベートであるかどうかに関係なく) 検証のためすべてのプランを表示できます。

### <a name="manually-add-azure-subscription-ids-for-a-private-plan"></a>プライベート プランの Azure サブスクリプション ID を手動で追加する

1. **[プランの可視性]** で、 **[プライベート]** オプション ボタンを選択します。
1. 表示される **[Azure サブスクリプション ID]** ボックスに、このプライベート プランへのアクセスを付与する対象ユーザーの Azure サブスクリプション ID を入力します。 少なくとも 1 つのサブスクリプション ID が必要です。
1. (省略可能) **[説明]** ボックスに、このユーザーの説明を入力します。
1. 別のサブスクリプション ID を追加するには、 **[ID の追加 (最大 10 個)]** リンクを選択し、手順 2 と 3 を繰り返します。

### <a name="use-a-csv-file-to-add-azure-subscription-ids-for-a-private-plan"></a>.CSV ファイルを使用してプライベート プラン用の Azure サブスクリプション ID を追加する

1. **[プランの可視性]** で、 **[プライベート]** オプション ボタンを選択します。
1. **[対象者のエクスポート (csv)]** リンクを選択します。
1. .CSV ファイルを開き、作成し、プライベート オファーへのアクセスを付与する Azure サブスクリプション ID を **[ID]** 列に追加します。
1. 必要に応じて、 **[説明]** 列に、各ユーザーの説明を入力します。
1. サブスクリプション ID が含まれる各行について、 **[種類]** 列に "SubscriptionId" を追加します。
1. .CSV ファイルを保存します。
1. **[可用性]** タブで、 **[プランの可視性]** の下にある **[対象者のインポート (csv)]** リンクを選択します。
1. 表示されるダイアログ ボックスで、 **[はい]** を選択します。
1. .CSV ファイルを選択して **[開く]** を選択します。 .CSV ファイルが正常にインポートされたことを示すメッセージが表示されます。

## <a name="define-the-technical-configuration"></a>技術的な構成を定義する

**[技術的な構成]** タブでは、顧客によるプランのデプロイを可能にするデプロイ パッケージをアップロードし、そのパッケージのバージョン番号を指定します。 また、その他の技術情報もここで指定します。

> [!NOTE]
> **[プランのセットアップ]** タブで別のプランからパッケージを再利用することを選択した場合、このタブは表示されません。その場合は、「[プランを表示する](#view-your-plans)」に進んでください。

### <a name="assign-a-version-number-for-the-package"></a>パッケージのバージョン番号を割り当てる

**[バージョン]** ボックスに、技術的な構成の現在のバージョンを入力します。 このページに変更を発行するたびに、このバージョンをインクリメントします。 バージョン番号は、"整数.整数.整数" の形式で指定する必要があります。 たとえば、「 `1.0.2` 」のように入力します。

### <a name="upload-a-package-file"></a>パッケージ ファイルをアップロードする

**[パッケージ ファイル (.zip)]** で、パッケージ ファイルを灰色のボックスまでドラッグするか、 **[ファイルの参照]** リンクを選択します。

> [!NOTE]
> ファイルのアップロードで問題が発生した場合は、パートナー センターで使用されている `https://upload.xboxlive.com` サービスがローカル ネットワークでブロックされていないことを確認してください。

#### <a name="previously-published-packages"></a>発行済みのパッケージ

**[発行済みのパッケージ]** サブタブでは、技術的な構成のすべての発行済みバージョンを見ることができます。

### <a name="enable-just-in-time-jit-access-optional"></a>Just-In-Time (JIT) アクセスの有効化 (省略可能)

このプランの JIT アクセスを有効にするには、 **[Just-In-Time (JIT) アクセスの有効化]** チェック ボックスをオンにします。 マネージド アプリケーションの顧客に対し、発行元のアカウントに永続アクセス権を付与するよう要求するには、このオプションをオフのままにします。 このオプションの詳細については、[Just In Time (JIT) アクセス](plan-azure-app-managed-app.md#just-in-time-jit-access)に関するセクションを参照してください。

### <a name="select-a-deployment-mode"></a>デプロイ モードの選択

**[完全]** または **[増分]** デプロイ モードのいずれかを選択します。

- **[完全]** モードでは、顧客がアプリケーションを再デプロイすると、[mainTemplate.json](../azure-resource-manager/managed-applications/publish-service-catalog-app.md?tabs=azure-powershell#create-the-arm-template) で定義されていない管理対象リソース グループのリソースは削除されます。
- **[増分]** モードでは、アプリケーションを再デプロイしても、既存のリソースは変更されずに残ります。

デプロイ モードの詳細については、「[Azure Resource Manager のデプロイ モード](../azure-resource-manager/templates/deployment-modes.md)」をご覧ください。

### <a name="provide-a-notification-endpoint-url"></a>通知エンドポイント URL を指定する

**[通知エンドポイント URL]** ボックスで、このプラン バージョンのマネージド アプリケーション インスタンスでのすべての CRUD 操作に関する通知を受け取るための、HTTPS Webhook エンドポイントを指定します。

Webhook URI を呼び出す前に、Azure によって末尾に `/resource` が追加されます。 そのため、Webhook URL は `/resource` で終わる必要がありますが、 **[通知エンドポイント URL]** ボックスに入力した URL には `/resource` を含めないでください。 Webhook URL の詳細については、「[マネージド アプリケーションを計画する](plan-azure-app-managed-app.md#notification-endpoint-url)」を参照してください。

### <a name="customize-allowed-customer-actions-optional"></a>許可される顧客アクションをカスタマイズする (省略可能)

1. 既定で使用できる "`*/read`" アクションに加えて、顧客が管理対象リソースに対してどのアクションを実行できるかを指定するには、 **[許可されている顧客アクションのカスタマイズ]** ボックスを選択します。
1. 表示されるボックスに、顧客が実行できるようにする追加の制御アクションと許可されるデータ アクションをセミコロンで区切って入力します。 たとえば、仮想マシンの再起動をコンシューマーに許可するには、 **[Allowed control actions]\(許可されている制御アクション\)** ボックスに `Microsoft.Compute/virtualMachines/restart/action` を追加します。

### <a name="choose-who-can-manage-the-application"></a>だれがアプリケーションを管理できるかを選択する

選択された各 Azure リージョンで、次のうちどちらが、このマネージド アプリケーションに対する管理アクセスを持つ必要があるかを指定します:"_グローバル Azure_" および "_Azure Government クラウド_"。 Azure AD ID を使用して、管理対象リソース グループへのアクセス許可を付与するユーザー、グループ、またはアプリケーションを識別します。 詳細については、[Azure アプリケーション オファー用の Azure マネージド アプリケーションをプランする](plan-azure-application-offer.md)方法に関する記事を参照してください。

必要に応じて、グローバル Azure と Azure Government クラウドに対して次の手順を実行します。

1. **[Azure Active Directory テナント ID]** ボックスに、アクセス許可を付与するユーザー、グループ、またはアプリケーションの ID が含まれる Azure AD テナント ID (ディレクトリ ID とも呼ばれる) を入力します。
1. **[プリンシパル ID]** ボックスに、管理対象リソース グループへのアクセス許可を付与するユーザー、グループ、アプリケーションの Azure AD オブジェクト ID を入力します。 プリンシパル ID でユーザーを識別します。これは、Azure portal の [Azure Active Directory ユーザー ブレード](https://portal.azure.com/#blade/Microsoft_AAD_IAM/UsersManagementMenuBlade/AllUsers)にあります。
1. **[ロールの定義]** の一覧から、Azure AD の組み込みロールを選択します。 選択するロールによって、顧客のサブスクリプション内のリソースに対してプリンシパルが持つアクセス許可が記述されます。
1. 別の承認を追加するには **[承認の追加 (最大 100)]** リンクを選択し、手順 1 から 3 を繰り返します。

### <a name="policy-settings-optional"></a>ポリシー設定 (省略可能)

最大 5 つのポリシーと、各ポリシー オプションのただ 1 つのインスタンスを構成できます。 一部のポリシーでは、追加のパラメーターが必要です。

1. **[ポリシー設定]** で **[+ Add policy (max 5)]\(+ ポリシーの追加 (最大 5)\)** を選択します。
1. **[名前]** ボックスに、ポリシーの割り当て名 (50 文字以内) を入力します。
1. **[ポリシー]** リスト ボックスで、顧客サブスクリプションのマネージド アプリケーションによって作成されたリソースに適用される Azure Policy の定義を選択します。
1. **[ポリシー パラメーター]** ボックスで、監査と診断設定のポリシーを適用するパラメーターを指定します。
1. **[ポリシー SKU]** リスト ボックスから、ポリシー SKU の種類を選択します。

    > [!NOTE]
    > 監査ポリシーには _Standard policy_ SKU が必要です。

## <a name="view-your-plans"></a>プランを表示する

- **[下書きの保存]** を選択し、ページの左上にある **[プランの概要]** を選択して、 **[プランの概要]** ページに戻ります。

1 つ以上のプランを作成すると、 **[プランの概要]** タブに、プラン名、プラン ID、プランの種類、可用性 (パブリックまたはプライベート)、現在の発行状態、使用できるすべてのアクションが表示されます。

**[プランの概要]** タブの **[アクション]** 列に表示されるアクションは、プランの状態によって異なり、たとえば次のようになります。

- プランの状態が **[下書き]** の場合、 **[アクション]** 列のリンクは **[ドラフトの削除]** になります。
- プランの状態が **[ライブ]** の場合、 **[アクション]** 列のリンクは **[Stop distribution]\(配布の停止\)** または **[Sync private audience]\(プライベート対象ユーザーの同期\)** のいずれかになります。 **[Sync private audience]\(プライベート対象ユーザーの同期)** リンクにより、オファーに対して行われた可能性のあるその他の更新を発行することなく、プライベートの対象ユーザーだけに変更が発行されます。
- このオファーに対して別のプランを作成するには、 **[プランの概要]** タブの上部にある **[+ 新しいプランの作成]** を選択します。 次に、「[Azure アプリケーション オファーのプランを作成する方法](azure-app-plans.md)」の手順を繰り返します。 それ以外の場合は、プランの作成が完了したら、次のセクションの「次のステップ」に進んでください。

## <a name="next-steps"></a>次のステップ

- [Azure アプリケーション オファーをテストして発行します](azure-app-test-publish.md)。
- **Microsoft との共同販売**、および **CSP プログラムを通じた再販** によって、[Azure アプリケーション オファーを販売](azure-app-marketing.md)します。