---
title: Azure IoT Hub Device Provisioning Service で使用される用語 | Microsoft Docs
description: Device Provisioning Service (DPS) と IoT Hub で使用される一般的な用語について説明します
author: wesmc7777
ms.author: wesmc
ms.date: 09/18/2019
ms.topic: conceptual
ms.service: iot-dps
services: iot-dps
manager: eliotga
ms.openlocfilehash: ff65da89c12366fe477ca0f93779a8b2188d4ef3
ms.sourcegitcommit: 613789059b275cfae44f2a983906cca06a8706ad
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 09/29/2021
ms.locfileid: "129277273"
---
# <a name="iot-hub-device-provisioning-service-dps-terminology"></a>IoT Hub Device Provisioning Service (DPS) の用語

Azure IoT Hub Device Provisioning サービスは IoT Hub のヘルパー サービスです。このサービスは、指定された IoT Hub にプロビジョニングするゼロタッチ デバイスの構成に使用されます。 Device Provisioning Service を使用すると、セキュリティで保護されたスケーラブルな方法で何百万台ものデバイスを[プロビジョニング](about-iot-dps.md#provisioning-process)できます。

デバイス プロビジョニングのプロセスには、2 つの部分があります。 最初の部分では、デバイスを *登録* することで、デバイスと IoT ソリューション間の初期接続を確立します。 2 番目の部分では、ソリューションの特定の要件に基づいて、デバイスに適切な *構成* を適用します。 両方のステップを完了すると、デバイスが完全に *プロビジョニング* されたことになります。 デバイス プロビジョニング サービスでは、デバイスにシームレスなプロビジョニング エクスペリエンスを提供するために、両方のステップを自動化しています。

この記事では、*サービス* の管理に最適なプロビジョニング概念の概要を説明します。 この記事は、デプロイのために準備されたデバイスを取得する[クラウド セットアップ手順](about-iot-dps.md#cloud-setup-step)に関わるユーザーに最も役立ちます。

## <a name="service-operations-endpoint"></a>サービス操作エンドポイント

サービス操作エンドポイントは、サービス設定を管理し加入契約リストを保持するためのエンドポイントです。 このエンドポイントは、サービス管理者によってのみ使用されます。デバイスからは使用されません。

## <a name="device-provisioning-endpoint"></a>デバイス プロビジョニングのエンドポイント

デバイス プロビジョニングのエンドポイントとは、すべてのデバイスが自動プロビジョニングのために使用する単一のエンドポイントです。 URL はすべてプロビジョニング サービス インスタンスで同一です。サプライ チェーンのシナリオで、新しい接続情報を使用してデバイスを更新する必要はありません。 ID スコープで、テナントの分離が確保されます。

## <a name="linked-iot-hubs"></a>リンクされた IoT Hub

デバイス プロビジョニング サービスでは、このサービスにリンクされた IoT Hub にのみデバイスをプロビジョニングできます。 デバイス プロビジョニング サービスのインスタンスに IoT Hub をリンクすると、サービスの読み取り/書き込みのアクセス許可が IoT Hub のデバイス レジストリに付与されます。デバイス プロビジョニング サービスでは、リンクを使用して、デバイス ツインにデバイス ID を登録して初期構成を設定できます。 リンクされた IoT Hub は、任意の Azure リージョン内に置くことができます。 お使いのプロビジョニング サービスに他のサブスクリプションのハブをリンクすることもできます。


## <a name="allocation-policy"></a>割り当てポリシー

サービス レベルの設定では、デバイス プロビジョニング サービスがデバイスを IoT Hub に割り当てる方法を指定します。 次の 3 つの割り当てポリシーがサポートされています。

* **Evenly weighted distribution\(均等に重み付けされた分散\)** : リンクされた各 IoT Hub にデバイスが同程度にプロビジョニングされます。 既定の設定です。 デバイスを 1 つの IoT ハブにのみプロビジョニングする場合は、この設定のままでかまいません。

* **Lowest latency\(最も短い待機時間\)** : デバイスに対する待機時間が最も短い IoT Hub にデバイスをプロビジョニングします。 複数の IoT Hub にリンクしていて、同様に最も短い待機時間になっている場合、プロビジョニング サービスはそれらのハブ全体のデバイスをハッシュします。

* **Static configuration via the enrollment list\(加入契約リストによる静的構成\)** : 加入契約リストの目的の IoT Hub の仕様が、サービス レベルの割り当てポリシーよりも優先されます。

* **カスタム (Azure 関数を使用)** :カスタム割り当てポリシーを使用すると、デバイスを IoT ハブに割り当てる方法をより細かく制御できます。 これは、デバイスを IoT ハブに割り当てる際に、Azure 関数でカスタム コードを使用することで実現されます。 Device Provisioning Service により、デバイスと登録に関するすべての関連情報をコードに提供する Azure 関数コードが呼び出されます。 関数コードが実行され、デバイスのプロビジョニングに使用する IoT ハブ情報が返されます。

## <a name="enrollment"></a>登録

登録とは、自動プロビジョニングで登録できるデバイスまたはデバイス グループのレコードのことです。 登録レコードには、次のようなデバイスまたはデバイス グループに関する情報が含まれています。
- デバイスで使用される[構成証明メカニズム](#attestation-mechanism)
- オプションの初期に必要な構成
- 目的の IoT Hub
- 目的のデバイス ID

デバイス プロビジョニング サービスによってサポートされている登録方法は、2 種類あります。

### <a name="enrollment-group"></a>加入グループ

加入グループは、特定の構成証明メカニズムを共有するデバイスのグループです。 登録グループでは、x.509 と対称の両方がサポートされています。 X.509 登録グループ内のすべてのデバイスでは、同じルートまたは中間の証明機関 (CA) によって署名された X.509 証明書を提示します。 対称キー登録グループ内の各デバイスでは、グループ対称キーから派生した SAS トークンを提示します。 加入グループ名と証明書の名前は、英数字の小文字でなければならず、ハイフンを含めることができます。

> [!TIP]
> 必要な初期構成を共有するデバイスが多数ある場合や、デバイスがすべて同じテナントに属する予定の場合は、加入グループを使用することをお勧めします。

### <a name="individual-enrollment"></a>個別加入

個別加入は、登録する単一のデバイスのエントリです。 個々の登録では、構成証明メカニズムとして X.509 リーフ証明書または (実際の TPM または仮想 TPM の) SAS トークンを使用できます。 個別加入の登録 ID には、英数字、小文字と、必要に応じてハイフンを含めます。 個別登録では、必要な IoT ハブ デバイス ID が指定されている場合があります。

> [!TIP]
> 固有の初期構成を必要とするデバイスや、TPM 構成証明を介した SAS トークンを使用してのみ認証できるデバイスには、個別登録を使用することをお勧めします。


## <a name="attestation-mechanism"></a>構成証明メカニズム

構成証明メカニズムは、デバイスの ID の確認に使用される方法です。 構成証明メカニズムを登録エントリに対して構成すると、登録時にデバイスの ID の確認に使用する方法がプロビジョニング サービスに通知されます。

> [!NOTE]
> IoT Hub は、そのサービスでの同様の概念として "認証スキーム" を使用します。

デバイス プロビジョニング サービスは、以下の形式の構成証明をサポートします。
* 標準の X.509 証明書の認証フローに基づく **X.509 証明書**。 詳細については、[X.509 の構成証明](concepts-x509-attestation.md)に関する記事をご覧ください。
* nonce チャレンジに基づく **トラステッド プラットフォーム モジュール (TPM)** 。キーの TPM 標準を使用し、署名された Shared Access Signature (SAS) トークンを提示します。 このトークンでは、デバイス上の物理 TPM は必須ではありませんが、[TPM 仕様](https://trustedcomputinggroup.org/work-groups/trusted-platform-module/)ごとに保証キーを使用して証明するために、サービスからは物理 TPM が期待されます。詳細については、「[TPM の構成証明](concepts-tpm-attestation.md)」をご覧ください。
* 共有アクセス署名 (SAS) **セキュリティ トークン** に基づく [対称キー](../iot-hub/iot-hub-dev-guide-sas.md#security-tokens)。これにはハッシュの署名と埋め込みの有効期限が含まれています。 詳細については、「[対称キーの構成証明](concepts-symmetric-key-attestation.md)」を参照してください。


## <a name="hardware-security-module"></a>ハードウェア セキュリティ モジュール

ハードウェア セキュリティ モジュール (HSM) は、デバイス シークレットの安全なハードウェア ベースのストレージに使用されます。これは、最も安全な形式のシークレット ストレージです。 X.509 証明書と SAS トークンの両方を HSM に格納できます。 HSM は、プロビジョニング サービスがサポートする両方の構成証明メカニズムで使用できます。

> [!TIP]
> デバイス上に安全にシークレットを保管するために、デバイスに HSM を使用することを強くお勧めします。

デバイス シークレットもソフトウェア (メモリ) に保存できますが、HSM よりも安全性の低い形式のストレージです。



## <a name="id-scope"></a>ID スコープ

ID スコープは、ユーザーによって作成されたときに、デバイス プロビジョニング サービスに割り当てられます。デバイスの登録に利用される特定のプロビジョニング サービスを一意に識別するために使用されます。 サービスによって ID スコープが生成され、この ID スコープが不変であるため、一意性が保証されます。

> [!NOTE]
> 実行時間の長いデプロイ操作や統合と取得のシナリオでは、一意性が重要です。


## <a name="registration"></a>登録

登録は、デバイス プロビジョニング サービス経由で IoT Hub に正常に登録/プロビジョニングされるデバイスのレコードです。 登録レコードは自動的に作成されます。また、削除はできますが、更新はできません。


## <a name="registration-id"></a>登録 ID

登録 ID は、Device Provisioning Service のデバイス登録を一意に識別するために使用されます。 デバイス ID は、プロビジョニング サービスの[ ID スコープ](#id-scope)内で一意である必要があります。 各デバイスに登録 ID が必要です。 登録 ID は大文字と小文字が区別されない英数字であり、コロン、ピリオド、アンダースコア、ハイフンなどの特殊文字を含めることができます。

* TPM の場合、登録 ID は TPM 自身によって提供されます。
* X.509 ベースの構成証明の場合、登録 ID は、証明書のサブジェクト名として提供されます。

## <a name="device-id"></a>デバイス ID

デバイス ID は、IoT Hub に表示される ID です。 加入契約エントリに目的のデバイス ID を設定できますが、設定は必須ではありません。 希望するデバイス ID の設定は、個別の登録でのみサポートされています。 加入契約リストに目的のデバイス ID が指定されていない場合、デバイスの登録時の登録 ID がデバイス ID として使用されます。 詳細については、[IoT Hub のデバイス ID](../iot-hub/iot-hub-devguide-identity-registry.md) に関する記事をご覧ください。



## <a name="operations"></a>操作

操作は、デバイス プロビジョニング サービスの課金単位です。 1 つの操作は、サービスに対する 1 つの手順の正常な完了です。 操作には、デバイスの登録や再登録などがあります。加入契約リスト エントリの追加や更新といったサービス側の変更も操作に入ります。
