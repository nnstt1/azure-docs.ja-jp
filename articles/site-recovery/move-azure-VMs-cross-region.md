---
title: Azure Site Recovery を使用して Azure VM を別のリージョンに移動する
description: Azure Site Recovery を使用して、異なる Azure リージョン間で Azure IaaS VM を移動します。
services: site-recovery
author: sideeksh
ms.service: site-recovery
ms.topic: tutorial
ms.date: 01/28/2019
ms.author: sideeksh
ms.custom: MVC
ms.openlocfilehash: f29e001de392bac4990641cefe685afb650f4207
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2021
ms.locfileid: "131083418"
---
# <a name="move-azure-vms-to-another-azure-region"></a>Azure VM を別の Azure リージョンに移動する

信頼性、可用性、管理、またはガバナンスを向上するために、Azure サービスとしてのインフラストラクチャ (IaaS) 仮想マシンをあるリージョンから別のリージョンに移動する場合があります。 このチュートリアルでは、Azure Site Recovery を使用して、VM を別のリージョンに移動する方法を説明します。 学習内容は次のとおりです。

> [!div class="checklist"]
> * 前提条件を確認する
> * ソース VM を準備する
> * ターゲット リージョンを準備する
> * ターゲット リージョンにデータをコピーする
> * 構成をテストする
> * 移動を実行する
> * ソース リージョンのリソースを破棄する


> [!IMPORTANT]
> この記事では、Azure VM を *そのまま* 別のリージョンに移動する方法を説明しています。 VM を可用性ゾーンに移動してインフラストラクチャの可用性を向上することが目的の場合は、「[Azure VM を Availability Zones に移動する](move-azure-vms-avset-azone.md)」を参照してください。

## <a name="prerequisites"></a>前提条件

- "*移動元*" のソース Azure リージョンに Azure VM が存在する。
- 選択した[ソース リージョンとターゲット リージョンの組み合わせがサポート対象](./azure-to-azure-support-matrix.md#region-support)であることを確認し、ターゲット リージョンを慎重に選択する。
- [シナリオのアーキテクチャとコンポーネント](azure-to-azure-architecture.md)を理解している。
- [サポートの制限と要件](azure-to-azure-support-matrix.md)を確認する。
- アカウントのアクセス許可を確認する。 無料の Azure アカウントを作成したばかりであれば、"*自分*" がサブスクリプションの管理者です。 管理者でなければ、必要なアクセス許可の割り当てを管理者に依頼します。
  -  VM のレプリケーションを有効にし、Site Recovery を使用してデータをターゲットにコピーするには、Azure リソースに VM を作成できるアクセス許可を持っている必要があります。 "仮想マシン共同作成者" 組み込みロールには、以上のアクセス許可が与えられています。 アクセス許可があると、次の操作を実行できます。
        - 選択したリソース グループ内に VM を作成する。
        - 選択した仮想ネットワーク内に VM を作成する。
        - 選択したストレージ アカウントに書き込む。

  - このほか、Site Recovery 操作を管理するためのアクセス許可も必要です。 Site Recovery 共同作成者ロールには、Azure Recovery Services コンテナーでの Site Recovery の操作の管理に必要なアクセス許可がすべて付与されています。

## <a name="prepare-the-source-vms"></a>ソース VM を準備する

1. 移動する Azure VM に最新のルート証明書が存在することを確認します。 ない場合は、セキュリティの制約のため、ターゲット リージョンのデータ コピーを有効にすることができません。

    - Windows VM については、最新の Windows 更新プログラムをインストールして、すべての信頼されたルート証明書をマシンに用意します。 接続されていない環境の場合は、組織の標準の Windows Update プロセスおよび証明書更新プロセスに従ってください。
    - Linux VM の場合は、Linux ディストリビューターのガイダンスに従って、最新の信頼されたルート証明書と証明書失効リストを取得します。
2. 移動対象の VM のネットワーク接続を制御するために認証プロキシを使用していないことを確認します。
3. 移動対象の VM にインターネットへのアクセスが存在しない場合や、ファイアウォール プロキシを使用してアウトバウンド アクセスを制御している場合は、[要件](azure-to-azure-tutorial-enable-replication.md#set-up-vm-connectivity)を確認してください。
4. ロード バランサー、ネットワーク セキュリティ グループ、パブリック IP アドレスなど、ソース ネットワーク レイアウトと現在使用しているすべてのリソースを確認のために文書化します。

## <a name="prepare-the-target-region"></a>ターゲット リージョンを準備する

1. Azure サブスクリプションで、ディザスター リカバリーに使用されるターゲット リージョンに VM を作成できることを確認します。 必要に応じてサポートに連絡し、必要なクォータを有効にしてください。

2. サブスクリプションに、ソース VM をサポートするための十分なリソースがあることを確認します。 Site Recovery を使用してターゲットにデータをコピーする場合、ターゲット VM には、同じサイズ (または可能な限り近いサイズ) が選択されます。

3. ソース ネットワーク レイアウトから特定されたすべてのコンポーネントについてターゲット リソースを作成します。 これにより、ソース リージョンにあったすべての機能をターゲット リージョンの VM に確保します。

   ソース VM のレプリケーションを有効にすると、Azure Site Recovery によって仮想ネットワークとストレージ アカウントが自動的に検出されて作成されます。 レプリケーションを有効にする手順の一環として、このようなリソースを事前に作成して VM に割り当てることもできます。 ただし、その他のリソースについては、ターゲット リージョンに手動で作成する必要があります。 最も一般的に使用されるネットワーク リソースについては、次のドキュメントを参照して、実際のソース VM の構成に基づいて作成してください。

   - [ネットワーク セキュリティ グループ](../virtual-network/manage-network-security-group.md)
   - [ロード バランサー](../load-balancer/index.yml)
   - [パブリック IP](../virtual-network/ip-services/virtual-network-public-ip-address.md)
    
   その他のネットワーク コンポーネントについては、[Azure ネットワークに関するドキュメント](../index.yml?pivot=products&panel=network)を参照してください。 

4. 移動を行う前に構成をテストする場合は、ターゲット リージョンに手動で[非運用ネットワークを作成](../virtual-network/quick-create-portal.md)します。 セットアップのテストは運用環境への影響が最小限で済むため、この方法をお勧めします。
    
## <a name="copy-data-to-the-target-region"></a>ターゲット リージョンにデータをコピーする
以下の手順では、Azure Site Recovery を使用してターゲット リージョンにデータをコピーします。

### <a name="create-the-vault-in-any-region-except-the-source"></a>任意のリージョン (ソースを除く) にコンテナーを作成する

1. [Azure Portal](https://portal.azure.com) > **Recovery Services** にサインインします。
2. **[リソースの作成]**  >  **[管理ツール]**  >  **[Backup and Site Recovery]** の順に選択します。
3. **[名前]** に、フレンドリ名 **ContosoVMVault** を指定します。 複数のサブスクリプションがある場合は、適切なものを選択します。
4. リソース グループ **ContosoRG** を作成します。
5. Azure リージョンを指定します。 サポートされているリージョンについては、[Azure Site Recovery の価格の詳細](https://azure.microsoft.com/pricing/details/site-recovery/)に関するページをご覧ください。
6. [Recovery Services コンテナー] で、 **[概要]**  >  **[ConsotoVMVault]**  >  **[+ レプリケート]** の順に選択します。
7. **[ソース]** で **[Azure]** を選択します。
8. **[ソースの場所]** で、現在 VM が実行されているソースの Azure リージョンを選択します。
9. Azure Resource Manager デプロイ モデルを選択します。 次に、 **[ソース サブスクリプション]** と **[ソース リソース グループ]** を選択します。
10. **[OK]** を選択して設定を保存します。

### <a name="enable-replication-for-azure-vms-and-start-copying-the-data"></a>Azure VM のレプリケーションを有効にしてデータのコピーを開始する

Site Recovery は、サブスクリプションとリソース グループに関連付けられている VM の一覧を取得します。

1. 移動する VM を選択し、 **[OK]** を選択します。
2. **[設定]** で、 **[ディザスター リカバリー]** を選択します。
3. **[ディザスター リカバリーの構成]**  >  **[ターゲット リージョン]** で、レプリケート先のターゲット リージョンを選択します。
4. 既定のターゲット リソースを使用するか、事前に作成しておいたターゲット リソースを使用します。
5. **[レプリケーションを有効にする]** を選択してジョブを開始します。


 

## <a name="test-the-configuration"></a>構成をテストする


1. コンテナーに移動します。 **[設定]**  >  **[レプリケートされたアイテム]** で、ターゲット リージョンに移動する仮想マシンを選択します。 次に **[テスト フェールオーバー]** を選択します。
2. **[テスト フェールオーバー]** で、フェールオーバーに使用する復旧ポイントを選択します。

   - **最後に処理があった時点**:Site Recovery サービスによって処理された最新の復旧ポイントに VM をフェールオーバーします。 タイム スタンプが表示されます。 このオプションを使用すると、データの処理に時間がかからないため、目標復旧時間 (RTO) が低くなります。
   - **最新のアプリ整合性**:すべての VM が最新のアプリ整合性の復旧ポイントにフェールオーバーされます。 タイム スタンプが表示されます。
   - **Custom**:任意の復旧ポイントを選択します。

3. Azure VM の移動先となるターゲット Azure 仮想ネットワークを選択し、構成をテストします。

   > [!IMPORTANT]
   > テスト フェールオーバーには、ターゲット リージョンの運用環境のネットワークではなく、別個の Azure VM ネットワークを使用することをお勧めします。

4. 移動テストを開始するには、 **[OK]** を選択します。 進行状況を追跡するには、VM を選択して、その **[プロパティ]** を開きます。 または、コンテナーの **[フェールオーバーのテスト]** ジョブを選択します。 次に **[設定]**  >  **[ジョブ]**  >  **[Site Recovery ジョブ]** の順に選択します。
5. フェールオーバーの完了後、レプリカの Azure VM は、Azure Portal の **[仮想マシン]** に表示されます。 VM が実行中で、適切なサイズであること、また、適切なネットワークに接続されていることを確認してください。
6. テスト用に作成した VM を削除するには、レプリケートされたアイテムに対して **[テスト フェールオーバーのクリーンアップ]** を選択します。 **[メモ]** から、テストに関連する観察結果をすべて記録し、保存します。

## <a name="perform-the-move-and-confirm"></a>移動の実行と確認

1. **[設定]**  >  **[レプリケートされたアイテム]** でコンテナーに移動し、仮想マシンを選択し、 **[フェールオーバー]** を選択します。
1. **[フェールオーバー]** で **[最新]** を選択します。 
2. **[フェールオーバーを開始する前にマシンをシャットダウンします]** を選択します。 Site Recovery は、フェールオーバーを開始する前にソース VM をシャットダウンしようとします。 ただし、仮にシャットダウンが失敗したとしても、フェールオーバーは続行されます。 フェールオーバーの進行状況は **[ジョブ]** ページで確認できます。
3. ジョブが完了したら、ターゲット Azure リージョンに VM が正しく表示されることを確認します。
4. **[レプリケートされたアイテム]** で [VM] を右クリックし、**[コミット]** を選択します。 これで移動は完了です。 コミット ジョブが完了するまでお待ちください。

## <a name="discard-the-resources-from-the-source-region"></a>ソース リージョンのリソースを破棄する

- VM に移動し、**[レプリケーションの無効化]** を選択します。 これで VM のデータをコピーするプロセスが停止します。

  > [!IMPORTANT]
  > 移動度に Site Recovery レプリケーションの請求を避けるために、この手順を完了します。

ソース リソースを再利用する予定がない場合は、次の手順に従ってください。

1. 「[ソース VM を準備する](#prepare-the-source-vms)」の手順 4 に記載されている該当するネットワーク リソースをソース リージョンからすべて削除します。
2. 対応するストレージ アカウントをソース リージョンから削除します。

## <a name="next-steps"></a>次のステップ

このチュートリアルでは、Azure VM を別の Azure リージョンに移動する方法について説明しました。 次は、これらの VM のディザスター リカバリーを構成できます。

> [!div class="nextstepaction"]
> [移行後のディザスター リカバリーのセットアップ](azure-to-azure-quickstart.md)