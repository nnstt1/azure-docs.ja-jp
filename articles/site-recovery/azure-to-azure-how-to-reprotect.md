---
title: Azure Site Recovery で Azure VM をプライマリ リージョンに再保護する | Microsoft Docs
description: Azure Site Recovery を使用して、(セカンダリからプライマリ リージョンに) フェールオーバーした後に Azure VM を再保護する方法について説明します。
services: site-recovery
author: Rajeswari-Mamilla
manager: gaggupta
ms.service: site-recovery
ms.topic: article
ms.date: 11/27/2018
ms.author: ramamill
ms.openlocfilehash: 09613c037dd8dd2465b05fdc6f33a807a9871d3e
ms.sourcegitcommit: 0415f4d064530e0d7799fe295f1d8dc003f17202
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/17/2021
ms.locfileid: "132722717"
---
# <a name="reprotect-failed-over-azure-vms-to-the-primary-region"></a>プライマリ リージョンに対してフェールオーバーされた Azure VM を再保護する

[Azure Site Recovery](site-recovery-overview.md) を使用してリージョンから別のリージョンに Azure VM を [フェールオーバー](site-recovery-failover.md)すると、VM は **保護されていない** 状態でセカンダリ リージョンで起動されます。 VM をプライマリ リージョンにフェールバックする場合、次の操作を行います。

1. プライマリ リージョンへのレプリケートを開始できるように、セカンダリ リージョンの VM を再保護します。
1. 再保護が完了して、VM がレプリケートされると、セカンダリからプライマリ リージョンにフェールオーバーすることができます。

## <a name="prerequisites"></a>前提条件

- VM のプライマリからセカンダリ リージョンへのフェールオーバーは、コミットされている必要があります。
- プライマリ ターゲット サイトが使用可能で、そのリージョンでリソースにアクセスしたり、リソースを作成したりできる必要があります。

## <a name="reprotect-a-vm"></a>VM の再保護

1. **[コンテナー]**  >  **[レプリケートされたアイテム]** で、フェールオーバーされた VM を右クリックし、 **[再保護]** を選択します。 再保護の方向には、セカンダリからプライマリへの方向が示されています。

   ![コンテキスト メニューで [再保護] が選択された仮想マシンを示すスクリーンショット。](./media/site-recovery-how-to-reprotect-azure-to-azure/reprotect.png)

1. リソース グループ、ネットワーク、ストレージ、および可用性セットを確認します。 **[OK]** をクリックします。 新規としてマークされているリソースがある場合は、再保護プロセスの一環として作成されます。
1. 再保護のジョブにより、最新のデータでターゲット サイトがシード処理されます。 ジョブが完了したら、差分レプリケーションが行われます。 その後、プライマリ サイトへのフェールバックを行うことができます。 カスタマイズ オプションを使用して、再保護中に使用するストレージ アカウントまたはネットワークを選択できます。

   ![カスタマイズ オプション](./media/site-recovery-how-to-reprotect-azure-to-azure/customize.png)

### <a name="customize-reprotect-settings"></a>再保護設定のカスタマイズ

再保護中にカスタマイズできるのは、ターゲット VM の次のプロパティです。

![カスタマイズ](./media/site-recovery-how-to-reprotect-azure-to-azure/customizeblade.png)

|プロパティ |Notes  |
|---------|---------|
|ターゲット リソース グループ | VM が作成されるターゲット リソース グループを変更します。 再保護の一環として、ターゲット VM が削除されます。 フェールオーバー後に VM を作成する新しいリソース グループを選ぶことができます。 |
|ターゲット仮想ネットワーク | 再保護ジョブの間に、ターゲット ネットワークを変更することはできません。 ネットワークを変更するには、ネットワーク マッピングを再実行します。 |
|ターゲット ストレージ (セカンダリ VM では、マネージド ディスクが使用されません) | フェールオーバー後に、VM で使用するストレージ アカウントを変更できます。 |
|レプリカ マネージド ディスク (セカンダリ VM では、マネージド ディスクが使用されます) | Site Recovery によりプライマリ リージョンにレプリカ マネージド ディスクが作成され、セカンダリ VM のマネージド ディスクがミラーリングされます。 |
|キャッシュ ストレージ | レプリケーション時に使用されるキャッシュ ストレージ アカウントを指定できます。 既定では、存在しない場合は、新しいキャッシュ ストレージ アカウントが作成されます。 |
|可用性セット | セカンダリ リージョンの VM が可用性セットの一部である場合は、プライマリ リージョンのターゲット VM に対して可用性セットを選ぶことができます。 既定では、Site Recovery によって、プライマリ リージョンの既存の可用性セットが検索され、使用されます。 カスタマイズするときに、新しい可用性セットを指定できます。 |

### <a name="what-happens-during-reprotection"></a>再保護中の動作

既定では、次のように動作します。

1. フェールオーバーされた VM が実行されているリージョンにキャッシュ ストレージ アカウントが作成されます。
1. ターゲット ストレージ アカウント (プライマリ リージョンの元のストレージ アカウント) が存在しない場合は、新しいアカウントが作成されます。 割り当てられたストレージ アカウント名は、`asr` のサフィックスが付けられた、セカンダリ VM によって使用されるストレージ アカウントの名前です。
1. VM でマネージド ディスクが使用されている場合、レプリカ マネージド ディスクがプライマリ リージョンで作成され、セカンダリ VM のディスクから複製されたデータが保管されます。
1. ソース ディスク (セカンダリ リージョンの VM に接続されているディスク) の一時レプリカが、`ms-asr-<GUID>` という名前で作成され、データの転送/読み取りに使用されます。 一時ディスクでは、(VM に接続されている) 元のディスクでの 16% のみの帯域幅の代わりに、ディスクの完全な帯域幅を利用できます。 再保護が完了すると、一時ディスクは削除されます。
1. ターゲットの可用性セットが存在しない場合は、必要に応じて、新しい可用性セットが再保護ジョブの一環として作成されます。 再保護設定をカスタマイズした場合は、選択したセットが使用されます。

再保護ジョブをトリガーして、ターゲット VM が存在する場合は、次のように動作します。

1. ターゲット側の VM が実行されている場合は、オフにされます。
1. VM がマネージド ディスクを使用している場合、元ディスクのコピーが `-ASRReplica` サフィックスを使用して作成されます。 元のディスクは削除されます。 `-ASRReplica` のコピーはレプリケーションに使用されます。
1. VM が非管理対象のディスクを使用している場合、ターゲット VM のデータ ディスクはデタッチされてレプリケーションに使用されます。 OS ディスクのコピーが作成されて、VM にアタッチされます。 元の OS ディスクはデタッチされて、レプリケーションに使用されます。
1. ソース ディスクとターゲット ディスクの間の変更のみが同期されます。 両方のディスクを比較することによって差分が計算され、転送されます。 以下で、再保護を完了するための推定所要時間を確認してください。
1. 同期が完了した後、差分レプリケーションが始まり、再保護ポリシーに従って復旧ポイントが作成されます。

再保護ジョブをトリガーして、ターゲット VM およびディスクが存在しない場合は、次のように動作します。

1. VM がマネージド ディスクを使用している場合、レプリカ ディスクが `-ASRReplica` サフィックスを使用して作成されます。 `-ASRReplica` のコピーはレプリケーションに使用されます。
1. VM が非管理対象ディスクを使用している場合、レプリカ ディスクがターゲット ストレージ アカウントに作成されます。
1. ディスク全体が、フェールオーバーされたリージョンから新しいターゲット リージョンにコピーされます。
1. 同期が完了した後、差分レプリケーションが始まり、再保護ポリシーに従って復旧ポイントが作成されます。

#### <a name="estimated-time-to-do-the-reprotection"></a>再保護を行うための推定時間

ほとんどの場合、Azure Site Recovery では、完全なデータがソース リージョンにレプリケートされることはありません。
次の条件によって、レプリケートされるデータの量が決まります。

1. リソース グループの変更や削除など、何らかの理由で、ソース VM のデータが削除されたり、破損していたり、アクセス不可の場合、使用するソース リージョンに利用できるデータがないため、再保護中に完全な初期レプリケーションが発生します。 データ転送は、ディスク スループットの 23% 以下で行われます。
1. ソース VM のデータにアクセスできる場合は、両方のディスクを比較することによって差分のみが計算され、転送されます。 以下の表で推定時間を確認してください。 差分の計算と比較はディスク スループットの 46% 以下で行われ、差分データの転送はディスク スループットの 23% 以下で行われます。

|状況の例 | 再保護にかかる時間 |
|---|---|
|ソース リージョンには 1 TB の Standard ディスクを使用した 1 つの VM がある。<br/>127 GB のデータのみが使用され、ディスクの残りの部分は空である。<br/>ディスクの種類はスループットが 60 MBps の Standard ディスク。<br/>フェールオーバー後にデータは変更されない。| おおよその時間: 75 分から 105 分。<br/> 再保護中、Site Recovery によって、すべてのデータのチェックサムが設定される。これはディスク スループットの 46% (28 MBps) で実行される。 そのため、合計時間は 127 GB/28 MBps で約 76 分。<br/>Site Recovery で自動スケールを行うために、およそ 20 分から 30 分のオーバーヘッド時間が必要となる場合がある。 |
|ソース リージョンには 1 TB の Standard ディスクを使用した 1 つの VM がある。<br/>127 GB のデータのみが使用され、ディスクの残りの部分は空である。<br/>ディスクの種類はスループットが 60 MBps の Standard ディスク。<br/>フェールオーバー後に 45 GB のデータが変更される。| おおよその時間: 2 時間から 2.5 時間。<br/> 再保護中、Site Recovery によって、すべてのデータのチェックサムが設定される。これはディスク スループットの 46% (28 MBps) で実行される。 合計時間は 127 GB/28 MBps で約 76 分。<br/>転送速度はスループットの約 23% (14 MBps)。 そのため、45 GB の変更を適用する転送時間は 45 GB/14 MBps で約 55 分。<br/>Site Recovery で自動スケールを行うために、およそ 20 分から 30 分のオーバーヘッド時間が必要となる場合がある。 |
|ソース リージョンには 1 TB の Standard ディスクを使用した 1 つの VM がある。<br/>20 GB のデータのみが使用され、ディスクの残りの部分は空である。<br/>ディスクの種類はスループットが 60 MBps の Standard ディスク。<br/>フェールオーバー直後のディスクの初期データは 15 GB。 フェールオーバー後に、5 GB のデータ変更があった。 そのため、入力されたデータの合計は 20 GB。| おおよその時間: 30 分から 60 分。<br/>ディスクに入力されたデータはディスクのサイズの 10% 未満であるため、完全な初期レプリケーションを実行する。<br/> 転送速度はスループットの約 23% (14 MBps)。 そのため、20 GB の変更を適用する転送時間は 20 GB/14 MBps で約 24 分。<br/>Site Recovery で自動スケールを行うために、およそ 20 分から 30 分のオーバーヘッド時間が必要となる場合がある。 |
|ソース リージョンには 1 TB の Premium ディスクを使用した 1 つの VM がある。<br/>127 GB のデータのみが使用され、ディスクの残りの部分は空である。<br/>ディスクの種類はスループットが 200 MBps の Premium ディスク。<br/>フェールオーバー後にデータは変更されない。| おおよその時間: 30 分から 60 分。<br/>再保護中、Site Recovery によって、すべてのデータのチェックサムが設定される。これはディスク スループットの 46% (92 MBps) で実行される。 合計時間は 127 GB/92 MBps で約 25 分。<br/>Site Recovery で自動スケールを行うために、およそ 20 分から 30 分のオーバーヘッド時間が必要となる場合がある。 |
|ソース リージョンには 1 TB の Premium ディスクを使用した 1 つの VM がある。<br/>127 GB のデータのみが使用され、ディスクの残りの部分は空である。<br/>ディスクの種類はスループットが 200 MBps の Premium ディスク。<br/>フェールオーバー後に 45 GB のデータが変更される。| おおよその時間: 45 分から 75 分。<br/>再保護中、Site Recovery によって、すべてのデータのチェックサムが設定される。これはディスク スループットの 46% (92 MBps) で実行される。 合計時間は 127 GB/92 MBps で約 25 分。 </br>転送速度はスループットの約 23% (46 MBps)。 そのため、45 GB の変更を適用する転送時間は 45 GB/46 MBps で約 17 分。<br/>Site Recovery で自動スケールを行うために、およそ 20 分から 30 分のオーバーヘッド時間が必要となる場合がある。 |
|ソース リージョンには 1 TB の Premium ディスクを使用した 1 つの VM がある。<br/>20 GB のデータのみが使用され、ディスクの残りの部分は空である。<br/>ディスクの種類はスループットが 200 MBps の Premium ディスク。<br/>フェールオーバー直後のディスクの初期データは 15 GB。 フェールオーバー後に、5 GB のデータ変更があった。 そのため、入力されたデータの合計は 20 GB| おおよその時間: 10 分から 40 分。<br/>ディスクに入力されたデータはディスクのサイズの 10% 未満であるため、完全な初期レプリケーションを実行する。<br/>転送速度はスループットの約 23% (46 MBps)。 そのため、20 GB の変更を適用する転送時間は 20 GB/46 MBps で約 8 分。<br/>Site Recovery で自動スケールを行うために、およそ 20 分から 30 分のオーバーヘッド時間が必要となる場合がある |

プライマリ リージョンにフェールバックした後に VM が再保護された場合 (つまり、VM がプライマリ リージョンから DR リージョンに再保護された場合)、ターゲット VM および関連 NIC は削除されます。

VM が DR リージョンからプライマリ リージョンに再保護された場合、以前のプライマリ VM および関連 NIC は削除されません。

## <a name="next-steps"></a>次のステップ

VM が保護されたら、フェールオーバーを開始できます。 フェールオーバーでは、セカンダリ リージョンの VM をシャットダウンし、プライマリ リージョンに VM を作成して起動します。このプロセス中に短いダウンタイムが発生します。 プライマリ サイトへの完全なフェールオーバーを開始する前に、この処理に対する適切な時間を選択し、テスト フェールオーバーを実行することをお勧めします。 Azure Site Recovery フェールオーバーの[詳細を確認してください](site-recovery-failover.md)。
