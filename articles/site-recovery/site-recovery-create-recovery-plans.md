---
title: Azure Site Recovery での復旧計画の作成/カスタマイズ
description: Azure Site Recovery サービスを使用してディザスター リカバリーのための復旧計画を作成してカスタマイズする方法について説明します。
ms.topic: how-to
ms.date: 01/23/2020
ms.openlocfilehash: ee7386b07c93182bb8703702e2ce63e10626457d
ms.sourcegitcommit: aaaa6ee55f5843ed69944f5c3869368e54793b48
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 07/13/2021
ms.locfileid: "113666161"
---
# <a name="create-and-customize-recovery-plans"></a>復旧計画を作成してカスタマイズする

この記事では、[Azure Site Recovery](site-recovery-overview.md) でフェールオーバーの復旧計画を作成してカスタマイズする方法について説明します。 開始する前に、復旧計画の[詳細](recovery-plan-overview.md)を確認してください。

## <a name="create-a-recovery-plan"></a>復旧計画の作成

1. Recovery Services コンテナーで、 **[復旧計画 (Site Recovery)]**  >  **[+ 復旧計画]** と選択します。
2. **[復旧計画の作成]** で、計画の名前を指定します。
3. 計画内のマシンに基づいてソースとターゲットを選択し、デプロイメント モデル用に **リソース マネージャー** を選択します。 ソースの場所には、フェールオーバーと復旧が有効になったマシンが必要になります。 

    **[フェールオーバー]** | **ソース** | **移行先** 
   --- | --- | ---
   Azure から Azure | Azure リージョンを選択します | Azure リージョンを選択します
   VMware から Azure | 構成サーバーを選択します | Azure を選択します
   物理マシンから Azure | 構成サーバーを選択します | Azure を選択します   
   Hyper-V から Azure | Hyper-V サイト名を選択します | Azure を選択します
   (VMM によって管理される) Hyper-V から Azure  | VMM サーバーを選択します | Azure を選択します
  
    次のことを考慮してください。
    - Azure へのフェールオーバーと Azure からのフェールバックの両方に復旧計画を使用できます。
    - ソースの場所には、フェールオーバーと復旧が有効になったマシンが必要になります。
    - 復旧計画には、ソースとターゲットが同一のマシンを含めることができます。
    - VMM によって管理される VMware VM と Hyper-V VM を同じ計画に含めることができます。
    - VMware VM と物理サーバーを同じ計画に含めることができます。
    - 1 つの復旧計画に含まれる VM はすべて、単一サブスクリプションにレプリケートする必要があります。 異なる VM を異なるサブスクリプションにレプリケートする場合は、複数の復旧計画 (ターゲット サブスクリプションごとに少なくとも 1 つ) を使用してください。

4. **[Select items virtual machines]\(仮想マシンの項目の選択\)** で、計画に追加する必要のあるマシン (またはレプリケーション グループ) を選択します。 次に、 **[OK]** をクリックします
    - マシンがその計画の既定のグループ (グループ 1) に追加されます。 フェールオーバー後、このグループのすべてのマシンが同時に開始されます。
    - 指定したソースおよびターゲットの場所にあるマシンのみを選択できます。 
5. **[OK]** をクリックすると、計画が作成されます。

## <a name="add-a-group-to-a-plan"></a>計画にグループを追加する

追加のグループを作成し、異なるグループにマシンを追加して、グループごとに異なる動作を指定します。 たとえば、フェールオーバー後にグループのマシンを開始するように指定することや、グループごとにカスタマイズしたアクションを指定できます。

1. **[復旧計画]** で、計画を右クリックして **[カスタマイズ]** を選択します。 既定では、計画を作成した後に追加したすべてのマシンは、既定のグループ 1 に入ります。
2. **[+ グループ]** をクリックします。 既定では、新しいグループは追加した順序で番号が付けられます。 最大で 7 つのグループを追加できます。
3. 新しいグループに追加するマシンを選択し、 **[グループの変更]** をクリックして、新しいグループを選択します。 または、グループ名を右クリックし、 **[保護された項目]** を選択して、マシンをグループに追加します。 マシンやレプリケーション グループは、復旧計画内の 1 つのグループにのみ所属することができます。


## <a name="add-a-script-or-manual-action"></a>スクリプトまたは手動アクションを追加する

スクリプトまたは手動アクションを追加することで、復旧計画をカスタマイズできます。 以下の点に注意してください。

- Azure にレプリケートする場合、Azure Automation の Runbook を復旧計画に組み込むことができます。 [詳細については、こちらを参照してください](site-recovery-runbook-automation.md)。
- System Center の VMM によって管理される Hyper-V の仮想マシンをレプリケートする場合、オンプレミスの VMM サーバーにスクリプトを作成し、それを復旧計画に含めることができます。
- スクリプトを追加すると、グループに対して新しい一連のアクションが追加されます。 たとえば、グループ 1 の前処理ステップ セットが "*グループ 1: 前処理ステップ*" という名前で作成されます。 すべての前処理ステップが、このセット内に一覧表示されます。 プライマリ サイトにスクリプトを追加できるのは、VMM サーバーがデプロイされている場合のみです。
- 手動アクションを追加した場合、復旧計画を実行すると、手動アクションを挿入した位置で停止します。 ダイアログ ボックスで、手動アクションが完了したことを指定するように求められます。
- VMM サーバーにスクリプトを作成するには、[この記事](hyper-v-vmm-recovery-script.md)の手順に従います。
- スクリプトはセカンダリ サイトへのフェールオーバー中、およびセカンダリ サイトからプライマリへのフェールバック中に適用できます。 サポートはレプリケーション シナリオによって変わります。
    
    **シナリオ** | **[フェールオーバー]** | **フェールバック**
    --- | --- | --- 
    Azure から Azure  | Runbook | Runbook
    VMware から Azure | Runbook | NA 
    Hyper-V (VMM を使用) から Azure | Runbook | スクリプト
    Hyper-V サイトから Azure | Runbook | NA
    VMM からセカンダリ VMM | スクリプト | スクリプト

1. 復旧計画で、アクションを追加するステップをクリックし、そのアクションを実行するタイミングを指定します。
    1. フェールオーバー後、グループ内のマシンが開始される前にアクションを発生させる場合は、 **[事前アクションの追加]** を選択します。
    1. フェールオーバー後、グループ内のマシンが開始された後にアクションを発生させる場合は、 **[事後アクションの追加]** を選択します。 アクションの位置を移動するには、 **[上へ移動]** ボタンまたは **[下へ移動]** ボタンを使用します。
2. **[アクションの挿入]** で、 **[スクリプト]** または **[手動アクション]** を選択します。
3. 手動アクションを追加する場合は、次の操作を行います。
    1. アクションの名前を入力し、アクションの手順を入力します。 これらの手順は、フェールオーバーを実行しているユーザーに表示されます。
    1. すべての種類のフェールオーバー (テスト、フェールオーバー、計画されたフェールオーバー (該当する場合)) にその手動アクションを追加するかどうかを指定します。 次に、 **[OK]** をクリックします
4. スクリプトを追加する場合は、次の操作を行います。
    1. VMM スクリプトを追加する場合、 **[Failover to VMM script]\(VMM へのフェールオーバー スクリプト\)** を選択して、 **[スクリプト パス]** に共有の相対パスを入力します。 たとえば、共有が \\\<VMMServerName>\MSSCVMMLibrary\RPScripts に配置されている場合は、パスとして「\RPScripts\RPScript.PS1」と入力します。
    1. Azure Automation Runbook を追加する場合、Runbook が配置されている **Azure Automation アカウント** を指定し、適切な **Azure Runbook スクリプト** を選択します。
5. 復旧計画のテスト フェールオーバーを実行して、スクリプトが期待どおりに動作することを確認します。

## <a name="watch-a-video"></a>ビデオを視聴する

復旧計画を作成する方法を示すビデオをご覧ください。


> [!VIDEO https://www.youtube.com/embed/1KUVdtvGqw8]

## <a name="next-steps"></a>次のステップ

フェールオーバーの実行については、[こちら](site-recovery-failover.md)を参照してください。  

    
