---
title: モビリティ サービスとアプライアンスのコンポーネントをアップグレードする - プレビュー
description: この記事では、モビリティ エージェントの自動更新と、手動更新に関連する手順について説明します (プレビュー)。
ms.service: site-recovery
ms.topic: article
ms.date: 09/01/2021
ms.openlocfilehash: a683aacc762ce169045ee17891b49624ef1ee991
ms.sourcegitcommit: 702df701fff4ec6cc39134aa607d023c766adec3
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/03/2021
ms.locfileid: "131437651"
---
# <a name="upgrade-mobility-service-and-appliance-components-preview"></a>モビリティ サービスとアプライアンスのコンポーネントをアップグレードする (プレビュー)

このプレビューから、アップグレードの実行ではソース マシンのルートまたは管理者の資格情報を維持する必要はありません。 資格情報は、エージェントの初回インストール時にのみ必要です。 完了したら、資格情報を削除できます。


## <a name="update-mobility-agent-automatically"></a>モビリティ エージェントを自動的に更新する

既定では、コンテナーで自動更新が有効になっています。 自動更新は、新しいバージョンが利用可能な場合、毎日、ローカル時間の午前 0 時にトリガーされます。

> [!NOTE]
> プライベート プレビューを使用している場合は、保護対象のマシンの自動更新がブロックされます。 新しいプレビュー アプライアンスを使用して、マシンに Site Recovery を再設定していることを確認してください。

最新の機能、機能強化、修正プログラムを利用するには、 **[モビリティ エージェントのアップグレード設定 (プレビュー)]** の **[Site Recovery の管理を許可する]** オプションを選択することをお勧めします。 自動更新では、再起動は不要で、仮想マシンの進行中のレプリケーションに影響しません。 また、自動更新によって、コンテナー内のすべてのレプリケーション アプライアンスが自動的に更新されます。

![モビリティ エージェントの自動更新をオンにする](./media/upgrade-mobility-service-preview/automatic-updates-on.png)

自動更新をオフにするには、 **[Site Recovery の管理を許可する]** ボタンを切り替えます。

![モビリティ エージェントの自動更新をオフにする](./media/upgrade-mobility-service-preview/automatic-updates-off.png)


## <a name="update-mobility-agent-manually"></a>モビリティ エージェントを手動で更新する

モビリティ エージェントの自動更新をオフにした場合は、次の手順に従ってエージェントを手動で更新できます。

### <a name="upgrade-mobility-agent-on-multiple-protected-items"></a>複数の保護された項目でモビリティ エージェントをアップグレードする

複数の保護された項目でモビリティ エージェントを手動で更新するには、次の手順を実行します。

1. **[Recovery Services コンテナー]**  >  **[レプリケートされたアイテム]** に移動し、 *[新しい Site Recovery モビリティ エージェントの更新プログラムが利用可能]* をクリックします。 クリックしてインストールしてください。

   ![複数の保護された項目でのモビリティ エージェントの手動アップグレード](./media/upgrade-mobility-service-preview/agent-update.png)

2. 更新するソース マシンを選択し、 **[OK]** をクリックします。

   >[!NOTE]
   >Mobility Service をアップグレードするための前提条件が満たされていない場合は、VM を選択できません。 [解決する方法](#resolve-blocking-issues-for-agent-upgrade)の情報を参照してください。


4. アップグレードを開始すると、アップグレード操作ごとにコンテナーに Site Recovery ジョブが作成され、 **[監視]**  >  **[Site Recovery ジョブ]** に移動して追跡できます。

### <a name="update-mobility-agent-for-a-single-protected-machine"></a>1 台の保護対象のマシンのモビリティ エージェントを更新する

保護された項目のモビリティ エージェントを更新するには、次の手順を実行します。
1. **[Recovery Services コンテナー]**  >  **[レプリケートされたアイテム]** に移動して、VM を選択します。
2. VM の **[概要]** ブレードの **[エージェントのバージョン]** で、モビリティ エージェントの現在のバージョンを表示します。 新しい更新プログラムが利用可能な場合は、状態が **[新しい更新プログラムが利用可能]** に更新されます。

   ![1 つの保護された項目でのモビリティ エージェントの手動アップグレード](./media/upgrade-mobility-service-preview/agent-version.png)

3. **[新しい更新プログラムが利用可能]** をクリックすると、利用可能な最新バージョンが表示されます。 **[このバージョンに更新]** をクリックして、更新ジョブを開始します。

   ![モビリティ エージェントの更新の詳細](./media/upgrade-mobility-service-preview/agent-update-details.png)

   > [!NOTE]
   > アップグレードがブロックされている場合は、エラーを[こちら](#resolve-blocking-issues-for-agent-upgrade)で説明されているように確認して解決します。

## <a name="mobility-agent-on-latest-version"></a>最新バージョンのモビリティ エージェント

モビリティ エージェントを最新バージョンに更新したか、最新バージョンに自動的に更新されると、状態は **[最新の状態]** として表示されます。

### <a name="resolve-blocking-issues-for-agent-upgrade"></a>エージェントのアップグレードでのブロックに関する問題を解決する

モビリティ エージェントをアップグレードするための前提条件が満たされていない場合、VM を更新することはできません。 アップグレードを続行するには、これらを解決してください。

前提条件には次のものが含まれますが、これらに限定されるわけではありません。

- 保護対象のマシンで保留中の必須の再起動。

- レプリケーション アプライアンスが互換性のないバージョンにある場合。

- レプリケーション アプライアンスのコンポーネント (プロキシ サーバーまたはプロセス サーバー) で Azure サービスと通信できない場合。

- 保護対象のマシン上のモビリティ エージェントがレプリケーション アプライアンスと通信できない場合。

上記の問題のいずれかに該当する場合、状態は **[最新バージョンに更新できません]** に更新されます。 状態をクリックして、更新がブロックされている理由と、問題を解決するために推奨されるアクションを確認します。

>[!NOTE]
>ブロックの理由を解決した後、30 分間待ってから操作を再試行してください。 Site Recovery サービスでは、最新の情報で更新されるまでに時間がかかります。

### <a name="mobility-agent-upgrade-job-failure"></a>モビリティ エージェントのアップグレード ジョブの失敗

モビリティ エージェントのアップグレード操作が失敗した場合 (手動でトリガーされたか、自動アップグレード操作で)、ジョブが失敗の理由とともに更新されます。 エラーを解決してから、操作を再試行してください。

エラーを表示するには、Site Recovery ジョブに移動し、特定のジョブをクリックしてエラーの解決を取り込みます。 または、次の手順を使用できます。

1. レプリケートされたアイテム セクションに移動し、特定の VM を選択します。

2. **[概要]** ブレードの **[エージェントのバージョン]** に、モビリティ エージェントの現在のバージョンが表示されます。

3. 現在のバージョンの横の状態が、 **[更新に失敗]** というメッセージで更新されます。 状態をクリックして、更新操作を再試行します。

4.  前のアップグレード ジョブへのリンクを使用できます。 ジョブをクリックして、特定のジョブに移動します。

5. 前のジョブ エラーを解決します。

前回失敗したジョブのエラーを解決してから、更新操作をトリガーします。

## <a name="upgrade-appliance"></a>アプライアンスのアップグレード

既定では、アプライアンスで自動更新が有効になっています。 自動更新は、いずれかのコンポーネントで新しいバージョンが利用可能な場合、毎日、ローカル時間の午前 0 時にトリガーされます。

コンポーネントの更新状態を確認するには、アプライアンス サーバーに移動して **Microsoft Azure アプライアンス構成マネージャー** を開きます。 **[アプライアンスのコンポーネント]** に移動して、それを展開し、すべてのコンポーネントとそのバージョンの一覧を表示します。

これらのいずれかを更新する必要がある場合、 **[状態]** が同様に反映されます。 ステータス メッセージをクリックして、コンポーネントをアップグレードします。

  ![レプリケーション アプライアンスのコンポーネント](./media/upgrade-mobility-service-preview/appliance-components.png)

### <a name="turn-off-auto-update"></a>自動更新をオフにする

1. アプライアンスを実行しているサーバーで、レジストリ エディターを開きます。
2. **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance** に移動します。
3. 自動更新をオフにするには、DWORD 値が 0 のレジストリ キー **AutoUpdate** キーを作成します。

    ![レジストリ キーを設定する](./media/upgrade-mobility-service-preview/registry-key.png)


### <a name="turn-on-auto-update"></a>自動更新を有効にする

自動更新は、HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance から AutoUpdate レジストリ キーを削除することで有効にできます。

レジストリ キーを削除するには、次の手順を実行します。

1. アプライアンスを実行しているサーバーで、レジストリ エディターを開きます。
2. **HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\AzureAppliance** に移動します。
3. 自動更新を無効にするために作成したレジストリ キー **AutoUpdate** を削除します。

### <a name="resolve-issues-with-component-upgrade"></a>コンポーネントのアップグレードに関する問題を解決する

コンポーネントをアップグレードするための前提条件が満たされていない場合、コンポーネントを更新することはできません。 次のような理由と前提条件がありますが、これらに限定されるわけではありません。

- レプリケーション アプライアンスのコンポーネントのいずれかが互換性のないバージョンにある場合。

- レプリケーション アプライアンスで Azure サービスと通信できない場合。

上記の問題のいずれかに該当する場合、状態は **[最新バージョンに更新できません]** に更新されます。 状態をクリックして、更新がブロックされている理由と、問題を解決するために推奨されるアクションを確認します。 ブロックの理由を解決したら、手動で更新を試みてください。
