---
title: Azure HPC Cache のストレージ ターゲットを管理する
description: Azure HPC Cache のストレージ ターゲットを中断、削除、強制削除、フラッシュする方法と、ストレージ ターゲットの状態を理解する方法
author: femila
ms.service: hpc-cache
ms.topic: how-to
ms.date: 09/27/2021
ms.author: femila
ms.openlocfilehash: ebab51f480751e6a9d6c60cad09d6884c5d6cc7e
ms.sourcegitcommit: 106f5c9fa5c6d3498dd1cfe63181a7ed4125ae6d
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/02/2021
ms.locfileid: "131051061"
---
# <a name="view-and-manage-storage-targets"></a>ストレージ ターゲットの表示と管理

ストレージ ターゲットの設定ページには、HPC Cache の各ストレージ ターゲットに関する情報が表示され、個々のストレージ ターゲットを管理するためのオプションが提供されます。

> [!TIP]
> Azure CLI を使用してストレージ ターゲットを一覧表示するための手順は、「[ストレージ ターゲットを追加する](hpc-cache-add-storage.md#view-storage-targets)」の記事に含まれています。 ここに一覧表示されているその他のアクションは、Azure CLI ではまだ使用できない可能性があります。

![Azure portal の [設定] > [ストレージ ターゲット] ページのスクリーンショット。 一覧には複数のストレージ ターゲットがあり、列見出しには、それぞれの名前、種類、状態、プロビジョニング状態、アドレス/コンテナー、使用モデルが表示されます。](media/storage-targets-list-states.png)

## <a name="manage-storage-targets"></a>ストレージ ターゲットを管理する

個々のストレージ ターゲットに対して管理アクションを実行できます。 これらのアクションは、「[キャッシュを管理する](hpc-cache-manage.md)」で説明されているキャッシュレベルのオプションを補完します。

これらの制御を利用して、予期しない状況 (ストレージ ターゲットが応答しないなど) から回復したり、一部の自動キャッシュ アクション (変更されたファイルを長期ストレージ システムに書き戻すなど) をオーバーライドしたりできます。

Azure portal で **[ストレージ ターゲット]** ページを開きます。 ストレージ ターゲットの一覧の右端にある **...** の画像をクリックして、タスクの一覧を開きます。

![Azure portal の [ストレージ ターゲット] ページのスクリーンショット。一覧のストレージ ターゲットの行の右端にある 3 つのドット (...) 記号をクリックして表示されたメニューの上にマウス カーソルがある状態。](media/storage-target-manage-options.png)

次のオプションを使用できます。

* **フラッシュ** - キャッシュされたすべての変更をバックエンド ストレージに書き込みます
* **中断** - ストレージ ターゲットによる要求の処理を一時的に停止します
* **再開** - 中断されたストレージ ターゲットを稼動状態に戻します
* **強制削除** - ストレージ ターゲットを削除し、一部の安全手順をスキップします (**強制削除によって、データが失われる可能性があります**)
* **削除** - ストレージ ターゲットを完全に削除します

一部のストレージ ターゲットには、このメニューに **[DNS の更新]** オプションがあります。これにより、カスタム DNS サーバーからストレージ ターゲット IP アドレスが更新されます。 この構成は一般的ではありません。

これらのオプションの詳細については、この記事の残りの部分を参照してください。

### <a name="write-cached-files-to-the-storage-target"></a>キャッシュされたファイルをストレージ ターゲットに書き込む

**[フラッシュ]** オプションでは、キャッシュに格納されている変更されたファイルをすぐにバックエンド ストレージ システムにコピーするようにキャッシュが設定されます。 たとえば、クライアント コンピューターで特定のファイルが繰り返し更新されている場合、それはすばやくアクセスできるようにキャッシュに保持され、数分から数時間にわたって長期ストレージ システムに書き込まれません。

**[フラッシュ]** アクションでは、すべてのファイルをストレージ システムに書き込むようにキャッシュが設定されます。

キャッシュでは、フラッシュが完了するまで、このストレージ ターゲット上のファイルに対するクライアントからの要求が受け入れられません。

このオプションを使用すると、バックアップを実行する前や、バックエンド ストレージに最新の更新プログラムを確実に適用する必要がある状況で、バックエンド ストレージにデータを確実に読み込むことができます。

このオプションは主に、書き込みキャッシュを含む使用モデルに適用されます。 読み取りおよび書き込みキャッシュの詳細については、「[キャッシュ使用モデルについて](cache-usage-models.md)」を参照してください。

### <a name="suspend-a-storage-target"></a>ストレージ ターゲットを中断する

中断機能では、ストレージ ターゲットへのクライアント アクセスが無効になりますが、キャッシュからストレージ ターゲットが完全には削除されません。 このオプションは、メンテナンス、修復、または交換のために、バックエンド ストレージ システムを無効にする必要がある場合に使用できます。

### <a name="put-a-suspended-storage-target-back-in-service"></a>中断されたストレージ ターゲットを稼動状態に戻す

ストレージ ターゲットの中断を解除するには、 **[再開]** を使用します。

### <a name="force-remove-a-storage-target"></a>ストレージ ターゲットを強制削除する

> [!NOTE]
> このオプションを使用すると、影響を受けるストレージ ターゲットのデータが失われる可能性があります。

通常の削除アクションでストレージ ターゲットを削除できない場合は、 **[強制削除]** オプションを使用して Azure HPC Cache からストレージ ターゲットを削除できます。

このアクションでは、キャッシュ内のファイルをバックエンド ストレージ システム内のファイルと同期する手順はスキップされます。 HPC Cache に書き込まれた変更がバックエンド ストレージ システムに書き込まれる保証はないため、このオプションを使用すると、変更が失われる可能性があります。

また、キャッシュから削除された後のバックエンド ストレージ システムにアクセスできる保証もありません。

強制削除は、通常、ストレージ ターゲットが応答しなくなるか、または正常な状態でない場合にのみ使用されます。 このオプションを使用すると、より抜本的な対策を講じなくても、問題があるストレージ ターゲットを削除できます。

### <a name="delete-a-storage-target"></a>ストレージ ターゲットを削除する

Azure portal または Azure CLI を使用して、ストレージ アカウントを削除できます。

通常の削除オプションでは、HPC Cache からストレージ ターゲットが完全に削除されますが、最初にキャッシュの内容がバックエンド ストレージ システムと同期されます。 これは、データを同期しない強制削除オプションとは異なります。

ストレージ ターゲットを削除すると、この Azure HPC Cache とストレージ システムの関連付けは削除されますが、バックエンド ストレージ システムは変更されません。 たとえば、Azure BLOB ストレージ コンテナーを使用した場合、コンテナーとその内容はキャッシュから削除された後も存在します。 コンテナーを別の Azure HPC Cache に追加したり、このキャッシュに再度追加したり、Azure portal で削除したりすることができます。

キャッシュに変更されたデータが大量に格納されている場合、ストレージ ターゲットの削除が完了するまでに数分かかることがあります。 このアクションが完了するのを待って、データが長期ストレージ システムに安全に格納されたことを確認してください。

#### <a name="portal"></a>[ポータル](#tab/azure-portal)

ストレージ ターゲットを削除するには、 **[ストレージ ターゲット]** ページを開きます。 ストレージ ターゲットの横にある [...] をクリックして、メニューの **[削除]** をクリックします。

#### <a name="azure-cli"></a>[Azure CLI](#tab/azure-cli)

[Azure HPC Cache 向けに Azure CLI を設定します](./az-cli-prerequisites.md)。

[az hpc-cache storage-target remove](/cli/azure/hpc-cache/storage-target#az_hpc_cache_storage_target_remove) を使用し、キャッシュからストレージ ターゲットを削除します。

```azurecli
$ az hpc-cache storage-target remove --resource-group cache-rg --cache-name doc-cache0629 --name blob1

{- Finished ..
  "endTime": "2020-07-09T21:45:06.1631571+00:00",
  "name": "2f95eac1-aded-4860-b19c-3f089531a7ec",
  "startTime": "2020-07-09T21:43:38.5461495+00:00",
  "status": "Succeeded"
}
```

---

### <a name="update-ip-address-custom-dns-configurations-only"></a>IP アドレスの更新 (カスタム DNS 構成のみ)

キャッシュで既定以外の DNS 構成を使用している場合は、バックエンドの DNS の変更により、NFS ストレージ ターゲットの IP アドレスが変更される可能性があります。 DNS サーバーでバックエンド ストレージ システムの IP アドレスが変更された場合、Azure HPC Cache ではストレージ システムにアクセスできなくなる可能性があります。

理想をいえば、キャッシュのカスタム DNS システムのマネージャーと連携して、更新プログラムの計画を立てる必要があります。これらの変更によってストレージが使用できなくなるためです。

ストレージ ターゲットの DNS で指定された IP アドレスを更新する必要がある場合は、 **[ストレージ ターゲット]** ページを使用します。 右側の列の **[...]** 記号をクリックして、コンテキスト メニューを開きます。 **[DNS の更新]** をクリックして、カスタム DNS サーバーで新しい IP アドレスを照会します。

![ストレージ ターゲットの一覧のスクリーンショット。 ストレージ ターゲットが 1 つの場合は、右端の列にある "..." のメニューが開き、[フラッシュ]、[中断]、[DNS の更新]、[強制削除]、[再開] (このオプションは無効になってます)、[削除] の各オプションが表示されます。](media/refresh-dns.png)

成功の場合、更新には 2 分もかかりません。 更新できるストレージ ターゲットは一度に 1 つだけです。前の操作が完了するまで待ってから、別のものをお試しください。

## <a name="understand-storage-target-state"></a>ストレージ ターゲットの状態を理解する

ストレージ ターゲットの一覧には、 **[状態]** と **[プロビジョニング状態]** という 2 種類の状態が表示されます。

* **[状態]** は、ストレージ ターゲットの動作状態を示します。 この値は定期的に更新され、そのストレージ ターゲットがクライアント要求に対して使用可能かどうかや、どの管理オプションが使用できるかを理解するために役立ちます。
* **[プロビジョニング状態]** は、ストレージ ターゲットを追加または編集するための最後のアクションが成功したかどうかを示します。 この値は、そのストレージ ターゲットを編集した場合にのみ更新されます。

**[状態]** の値は、どの管理オプションを使用できるかに影響を与えます。 これらの値とその効果の簡単な説明を次に示します。

* **[準備完了]** - ストレージ ターゲットは正常に動作しており、クライアントに対して使用可能です。 このストレージ ターゲットでは任意の管理オプションを使用できます (中断されたストレージ ターゲットに対してのみ有効な **[再開]** を除く)。
* **[ビジー]** - ストレージ ターゲットが別の操作を処理しています。 このストレージ ターゲットは、削除または強制削除できます。
* **[中断]** - ストレージ ターゲットがオフラインになっています。 このストレージ ターゲットは引き続き、フラッシュ、削除、または強制削除できます。 このターゲットを稼動状態に戻すには、 **[再開]** を選択します。
* **[フラッシュ中]** - ストレージ ターゲットがバックエンド ストレージにデータを書き込んでいます。 このターゲットは、フラッシュ中はクライアント要求を処理できませんが、データの書き込みを完了すると自動的に以前の状態に戻ります。

## <a name="next-steps"></a>次のステップ

* [キャッシュ レベルの管理アクション](hpc-cache-manage.md)について確認する
* [ストレージ ターゲットを編集する](hpc-cache-edit-storage.md)
