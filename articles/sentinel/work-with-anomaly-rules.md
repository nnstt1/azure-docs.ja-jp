---
title: Microsoft Sentinel で異常検出分析ルールを使用する | Microsoft Docs
description: この記事では、Microsoft Sentinel で異常検出分析ルールを表示、作成、管理、評価、および微調整する方法について説明します。
services: sentinel
cloud: na
documentationcenter: na
author: yelevin
manager: rkarlin
ms.workload: na
ms.tgt_pltfrm: na
ms.devlang: na
ms.topic: how-to
ms.date: 11/09/2021
ms.author: yelevin
ms.custom: ignite-fall-2021
ms.openlocfilehash: a0a5fa5f316e744e5cfd50abd7113fe8782f7ca9
ms.sourcegitcommit: 0415f4d064530e0d7799fe295f1d8dc003f17202
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/17/2021
ms.locfileid: "132710934"
---
# <a name="work-with-anomaly-detection-analytics-rules-in-microsoft-sentinel"></a>Microsoft Sentinel で異常検出分析ルールを使用する

[!INCLUDE [Banner for top of topics](./includes/banner.md)]

> [!IMPORTANT]
>
> - 異常ルールは現在、**プレビュー** の段階です。 ベータ版、プレビュー版、または一般提供としてまだリリースされていない Azure の機能に適用されるその他の法律条項については、「[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)」を参照してください。

## <a name="view-soc-ml-anomaly-rule-templates"></a>SOC-ML 異常ルール テンプレートを表示する

Microsoft Sentinel の [SOC-ML 異常機能](soc-ml-anomalies.md)により、イミディエイト値にすぐに使用できる[組み込みの異常テンプレート](detect-threats-built-in.md#anomaly)が提供されます。 これらの異常テンプレートは、数千のデータ ソースと数百万のイベントを使用して堅牢になるように開発されましたが、この機能を使用すると、ユーザー インターフェイス内で異常のしきい値とパラメーターを簡単に変更することもできます。 異常ルールによって異常が生成 ( **[ログ]** セクションの **[異常]** テーブルに表示) されるようにするには、事前にアクティブにする必要があります。

1. Microsoft Sentinel のナビゲーション メニューから **[分析]** を選択します。

1. **[分析]** ブレードで、 **[ルール テンプレート]** タブを選択します。

1. **異常** テンプレートのリストをフィルター処理します。

    1. **[ルールの種類]** フィルターをクリックし、下に表示されるドロップダウン リストをクリックします。

    1. **[すべて選択]** のマークを解除し、 **[異常]** をマークします。

    1. 必要に応じて、ドロップダウン リストの上部をクリックして取り消してから、 **[OK]** をクリックします。

## <a name="activate-anomaly-rules"></a>異常ルールをアクティブにする

ルール テンプレートのいずれかをクリックすると、詳細ウィンドウに **[ルールの作成]** ボタンと共に次の情報が表示されます。

- **[説明]** : 異常がどのように機能するか、および必要なデータについて説明します。

- **[データ ソース]** : 分析するために取り込む必要があるログの種類を示します。

- **[Tactics]\(戦術\)** : 異常の対象となる MITRE ATT&CK フレームワークの戦術です。

- **[パラメーター]** : 異常に対して構成可能な属性です。

- **[しきい値]** : イベントがどの程度異常になったら異常を作成するかを示す構成可能な値です。

- **[ルールの頻度]** : 異常を検出するログ処理ジョブ間の時間です。

- **[Anomaly version]\(異常バージョン\)** : ルールによって使用されるテンプレートのバージョンを示します。 既にアクティブになっているルールで使用されているバージョンを変更する場合は、ルールを再作成する必要があります。

- **[Template last updated]\(テンプレートの最終更新日\)** : 異常バージョンが変更された日付です。

ルールをアクティブにするには、次の手順を実行します。

1. **[IN USE]\(使用中\)** というラベルがまだ付いていないルール テンプレートを選択します。 **[ルールの作成]** ボタンをクリックして、ルール作成ウィザードを開きます。

    ウィザードはルール テンプレートごとに若干異なりますが、 **[全般]** 、 **[構成]** 、 **[確認と作成]** の 3 つの手順またはタブがあります。

    ウィザードで値を変更することはできません。まず、ルールを作成してアクティブにする必要があります。

1. タブを切り替え、 **[確認と作成]** タブに "検証に成功しました" というメッセージが表示されるのを待ち、 **[作成]** ボタンを選択します。

    各テンプレートから作成できるアクティブなルールは 1 つだけです。 ウィザードを完了すると、 **[アクティブなルール]** タブにアクティブな異常ルールが作成され、( **[ルール テンプレート]** タブ内の) テンプレートが **[IN USE]\(使用中\)** とマークされます。

    > [!NOTE]
    > 必要なデータが使用可能であると仮定しても、 **[アクティブなルール]** タブに新しいルールが表示されるまでに最大 24 時間かかる場合があります。新しいルールを表示するには、[アクティブなルール] タブを選択し、上記のルール テンプレート のリストをフィルター処理したのと同じ方法でフィルター処理します。

異常ルールがアクティブになると、検出された異常は、Microsoft Sentinel ワークスペースの **[ログ]** セクションの **[異常]** テーブルに格納されます。

各異常ルールにはトレーニング期間があります。そのトレーニング期間が終了するまで、異常はテーブルに表示されません。 トレーニング期間は、各異常ルールの説明で確認できます。

## <a name="assess-the-quality-of-anomalies"></a>異常の質を評価する

過去 24 時間でルールによって作成された異常のサンプルを確認することで、異常ルールのパフォーマンスを確認できます。 

1. Microsoft Sentinel のナビゲーション メニューから **[分析]** を選択します。

1. **[分析]** ブレードで、 **[アクティブなルール]** タブが選択されていることを確認します。

1. (前述のように) **異常** ルールのリストをフィルター処理します。

1. 評価するルールを選択し、その名前を詳細ウィンドウの上部から右側にコピーします。

1. Microsoft Sentinel のナビゲーション メニューから **[ログ]** を選択します。

1. **クエリ** ギャラリーが上部にポップアップ表示された場合は、閉じます。

1. **[ログ]** ブレードの左側のウィンドウで **[テーブル]** タブを選択します。

1. **[時間範囲]** フィルターを **[過去 24 時間]** に設定します。

1. 下の Kusto クエリをコピーし、クエリ ウィンドウに ("クエリをこちらに入力するか..." と表示されているところに) 貼り付けます。

    ```kusto
    Anomalies 
    | where AnomalyTemplateName contains "________________________________"
    ```
    上記でコピーしたルール名を、引用符の間のアンダースコアの場所に貼り付けます。

1. **[実行]** をクリックします。 

結果が複数ある場合は、異常の質の評価を開始できます。 結果が得られない場合は、時間範囲を広げてみてください。

各異常の結果を展開してから、 **[AnomalyReasons]** フィールドを展開します。 これにより、異常が発生した理由が示されます。

異常の "妥当性" または "有用性" は、お使いの環境の条件によって異なる場合がありますが、異常ルールによってあまりにも多くの異常が生成される理由として一般的なのは、しきい値が低すぎることです。

## <a name="tune-anomaly-rules"></a>異常ルールを調整する

異常ルールは、最大限の効果がすぐに得られるように設計されていますが、すべての状況は一意であり、ときには異常ルールを調整する必要があります。

元のアクティブなルールは編集できないので、最初にアクティブな異常ルールを複製してから、コピーをカスタマイズする必要があります。

元の異常ルールは、無効にするか削除するまで実行され続けます。

これは仕様によるもので、元の構成と新しいものによって生成された結果を比較する機会を提供するためです。 重複するルールは既定で無効になっています。 特定の異常ルールのカスタマイズされたコピーを 1 つだけ作成できます。 2 つ目のコピーを作成しようとすると失敗します。

1. 異常ルールの構成を変更するには、 **[アクティブなルール]** タブで異常ルールを選択します。

1. ルールの行の任意の場所を右クリックするか、行の末尾にある省略記号 (...) を左クリックし、 **[複製]** をクリックします。

1. ルールの新しいコピーには、ルール名に "- Customized" というサフィックスが付けられます。 このルールを実際にカスタマイズするには、このルールを選択し、 **[編集]** をクリックします。

1. 分析ルール ウィザードでこのルールが開きます。 ここで、ルールのパラメーターとそのしきい値を変更できます。 変更できるパラメーターは、異常の種類とアルゴリズムによって異なります。

    変更の結果は、 **[結果のプレビュー] ウィンドウ** でプレビューできます。 結果のプレビューで **[異常 ID]** をクリックすると、ML モデルによってそれが異常と識別される理由が表示されます。

1. カスタマイズしたルールを有効にして結果を生成します。 一部の変更ではルールの再実行が必要な場合があるため、それが完了するまで待ち、ログ ページに戻って結果を確認する必要があります。 カスタマイズされた異常ルールは、既定で **フライティング** (テスト) モードで実行されます。 既定では、元のルールは引き続き **実稼働** モードで実行されます。

1. 結果を比較するには、 **[ログ]** の [異常] テーブルに戻って [以前と同じように新しいルールを評価します](#assess-the-quality-of-anomalies)。 **[AnomalyTemplateName]** 列で、元のルール名を持つ行と、"- Customized" が付加された重複するルール名のみを検索します。

    カスタマイズしたルールの結果に問題がなければ、 **[アクティブなルール]** タブに戻り、カスタマイズしたルールをクリックし、 **[編集]** ボタンをクリックし、 **[全般]** タブで **[フライティング]** から **[実稼働]** に切り替えます。 実稼働では同じルールの 2 つのバージョンを同時に持つことはできないため、元のルールは自動的に **[フライティング]** に変更されます。 

## <a name="next-steps"></a>次のステップ

このドキュメントでは、Microsoft Sentinel で SOC-ML 異常検出分析ルールを使用する方法を学習しました。

- [SOC-ML](soc-ml-anomalies.md) に関する背景情報をさらに取得します。
- その他の[分析ルールの種類](detect-threats-built-in.md)を確認します。
