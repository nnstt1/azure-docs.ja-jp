---
title: Microsoft Sentinel でのデータの調査にハンティング ブックマークを使用する
description: この記事では、Microsoft Sentinel 検出ブックマークを使用してデータを追跡する方法について説明します。
author: yelevin
ms.author: yelevin
manager: rkarlin
ms.assetid: 320ccdad-8767-41f3-b083-0bc48f1eeb37
ms.topic: how-to
ms.custom: mvc, ignite-fall-2021
ms.date: 11/09/2021
ms.openlocfilehash: b423543ee06f02be08b066bb5f435d5f89a54d28
ms.sourcegitcommit: 0415f4d064530e0d7799fe295f1d8dc003f17202
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/17/2021
ms.locfileid: "132716273"
---
# <a name="keep-track-of-data-during-hunting-with-microsoft-sentinel"></a>Microsoft Sentinel によるハンティング中にデータを追跡する

[!INCLUDE [Banner for top of topics](./includes/banner.md)]

[!INCLUDE [reference-to-feature-availability](includes/reference-to-feature-availability.md)]

脅威検出では、通常、山のようなログ データを調べて、悪意のある動作の証拠を探す必要があります。 このプロセス中に調査担当者は、可能性のある仮説の実証と、侵害の詳細の把握の一環として、記憶し、再考し、分析する必要のあるイベントを探します。

この操作では、**Microsoft Sentinel - Logs** で実行したクエリが、関連すると思われるクエリ結果と共に保持される、Microsoft Sentinel のハンティング ブックマークが役立ちます。 また、メモやタグを追加することにより、コンテキストに関する所見を記録し、調査結果を参照することもできます。 ブックマークが設定されたデータは、自身とチームメイトが見ることができコラボレーションを簡単に行えるようにしています。

自分のカスタム ハンティング クエリを MITRE ATT&CK 手法にマッピングすることで、すべてのハンティング クエリにわたって MITRE ATT&CK 手法カバレッジのギャップを特定して対処できます。

> [!IMPORTANT]
>
> MITRE ATT&CK 手法のブックマークへのマッピングは、現在 **プレビュー** 段階です。 ベータ版、プレビュー版、または一般提供としてまだリリースされていない Azure の機能に適用されるその他の法律条項については、「[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)」を参照してください。

また、Microsoft Sentinel Analytics でサポートされているエンティティ型と識別子の完全なセットをカスタム クエリでマッピングすることで、ブックマークを使用してハンティング中にさらに多くの種類のエンティティを調査することもできます。 これにより、[エンティティ ページ](entities.md#entity-pages)、[インシデント](investigate-cases.md)、[調査グラフ](investigate-cases.md#use-the-investigation-graph-to-deep-dive)を使用して、ハンティング クエリ結果で返されるエンティティをブックマークを使用して探索できます。 ブックマークがハンティング クエリの結果をキャプチャすると、クエリの MITRE ATT&CK 手法とエンティティ マッピングが自動的に継承されます。

> [!IMPORTANT]
>
> エンティティ型と識別子の拡張セットとブックマークのマッピングは、現在 **プレビュー** 段階です。 ベータ版、プレビュー版、または一般提供としてまだリリースされていない Azure の機能に適用されるその他の法律条項については、「[Microsoft Azure プレビューの追加使用条件](https://azure.microsoft.com/support/legal/preview-supplemental-terms/)」を参照してください。
>

ログのハンティング中に緊急に対処する必要があるものを検出した場合は、簡単にブックマークを作成し、インシデントに昇格するか、既存のインシデントに追加することができます。 インシデントについて詳しくは、[Microsoft Sentinel でインシデントを調査する](investigate-cases.md)方法に関するページをご覧ください。

ブックマークに値するものが見つかったが、緊急ではない場合は、ブックマークを作成し、 **[ハンティング]** ウィンドウの **[ブックマーク]** タブで、ブックマークされたデータをいつでも再確認できます。 フィルタリングおよび検索オプションを使用して、現在の調査の特定のデータをすばやく見つけられます。

ブックマークの詳細から **[調査]** を選ぶと、ブックマークされたデータを視覚化できます。 これにより、対話型のエンティティ-グラフ ダイアグラムおよびタイムラインを使用して、調査結果を表示、調査、および視覚的に伝達できる調査エクスペリエンスが開始します。

または、ブックマークが設定されたデータを、Log Analytics ワークスペースの **[HuntingBookmark]\(ハンティング ブックマーク\)** テーブルで直接確認できます。 次に例を示します。

:::image type="content" source="media/bookmarks/bookmark-table.png" alt-text="ハンティング ブックマーク テーブルの表示のスクリーンショット。" lightbox="media/bookmarks/bookmark-table.png":::

テーブルでブックマークを表示すると、ブックマークが設定されたデータをフィルター処理、要約、および他のデータ ソースと結合でき、裏付けとなる証拠を簡単に見つけられます。

## <a name="add-a-bookmark"></a>ブックマークを追加する

1. Azure portal で、 **[Microsoft Sentinel]** 、 **[脅威の管理]** 、 **[ハンティング]** の順に移動して、不審な動作や異常な動作についてクエリを実行します。

1. ハンティング クエリの 1 つを選択し、右側のハンティング クエリの詳細で **[クエリの実行]** を選択します。

1. **[View query results]\(クエリ結果の表示\)** を選択します。 次に例を示します。

    :::image type="content" source="media/bookmarks/new-processes-observed-example.png" alt-text="Microsoft Sentinel ハンティングのクエリ結果を表示するスクリーンショット。":::

    このアクションにより、**[ログ]** ウィンドウにクエリ結果が表示されます。

1. ログ クエリ結果の一覧でチェック ボックスを使用して、興味のある情報が含まれている 1 つまたは複数の行を選択します。

1. **[ブックマークの追加]** を選択します。

    :::image type="content" source="media/bookmarks/add-hunting-bookmark.png" alt-text="ハンティング ブックマークをクエリに追加するスクリーンショット。" lightbox="media/bookmarks/add-hunting-bookmark.png":::

1. 右側の **[ブックマークの追加]** ウィンドウで、必要に応じてブックマーク名を更新し、タグを追加し、項目に関して興味深かったことを識別するために役立つメモを追加します。

1. **(プレビュー)** ブックマークは、必要に応じて MITRE ATT&CK 手法またはサブ手法にマップできます。 MITRE ATT&CK のマッピングは、ハンティング クエリ内のマップされた値から継承されますが、手動で作成することもできます。 **[ブックマークの追加]** ウィンドウの **[戦術と手法 (プレビュー)]** セクションのドロップダウン メニューから、目的の手法に関連付けられている MITRE ATT&CK 戦術選びます。 メニューが展開され、すべての MITRE ATT&CK 手法が表示されます。このメニューでは複数の手法とサブ手法を選択できます。

    :::image type="content" source="media/bookmarks/mitre-attack-mapping.png" alt-text="Mitre の攻撃の戦術と手法をブックマークにマップする方法のスクリーンショット。":::

1. **(プレビュー)** ブックマークされたクエリ結果からエンティティの拡張セットを抽出し、さらに調査できます。 **[エンティティ マッピング (プレビュー)]** セクションで、ドロップダウンを使用して [エンティティの種類と識別子](entities-reference.md)を選択します。 次に、対応する識別子を含むクエリ結果の列をマップします。 次に例を示します。

    :::image type="content" source="media/bookmarks/map-entity-types-bookmark.png" alt-text="ハンティング ブックマークのエンティティ型をマップするスクリーンショット。":::

    調査グラフでブックマークを表示するには、少なくとも 1 つのエンティティをマップする必要があります。 このプレビューより前に作成されたアカウント、ホスト、IP、URL エンティティ型へのエンティティ マッピングは引き続きサポートされ、下位互換性が維持されます。

1. **[保存]** をクリックして変更をコミットし、ブックマークを追加します。 ブックマークが設定されたすべてのデータは他の調査担当者と共有され、共同の調査エクスペリエンスに向けた最初の一歩となります。

> [!NOTE]
> このウィンドウが Microsoft Sentinel から開くたびに、ログクエリの結果にブックマークが設定されます。 たとえば、ナビゲーション バーから **[全般]**  >  **[ログ]** を選択したり、調査グラフでイベント リンクを選択したり、インシデントの完全な詳細からアラート ID を選択したり (現在プレビュー段階) する場合です。 Azure Monitor から直接など、他の場所から **[ログ]** ウィンドウを開く場合、ブックマークを作成することはできません。

## <a name="view-and-update-bookmarks"></a>ブックマークを表示および更新する

1. Azure portal で、 **[Microsoft Sentinel]** 、 **[脅威の管理]** 、 **[ハンティング]** の順に移動します。

2. ブックマークの一覧を表示するには、**[ブックマーク]** タブを選択します。

3. 特定のブックマークを検索するには、検索ボックスやフィルター オプションを使用します。

4. 個々のブックマークを選択して、右側の詳細ウィンドウでブックマークの詳細を表示します。

5. 必要に応じて変更を行います。これは、自動的に保存されます。

## <a name="exploring-bookmarks-in-the-investigation-graph"></a>調査グラフでのブックマークの探索

1. Azure portal で、 **[Microsoft Sentinel]** 、 **[脅威の管理]** 、 **[ハンティング]** 、 **[ブックマーク]** タブの順に移動して、調査するブックマーク (複数可) を選択します。

2. ブックマークの詳細で、少なくとも 1 つのエンティティが確実にマップされているようにします。

3. 調査グラフのブックマークを表示するには、 **[調査]** を選びます。

調査グラフを使用する手順については、「[調査グラフを使用して詳細を確認する](investigate-cases.md#use-the-investigation-graph-to-deep-dive)」を参照してください。

## <a name="add-bookmarks-to-a-new-or-existing-incident"></a>新規または既存のインシデントにブックマークを追加する

1. Azure portal で、 **[Microsoft Sentinel]** 、 **[脅威の管理]** 、 **[ハンティング]** 、 **[ブックマーク]** タブの順に移動して、インシデントに追加するブックマーク (複数可) を選択します。

2. コマンド バーから **[インシデント アクション]** を選択します。

    :::image type="content" source="media/bookmarks/incident-actions.png" alt-text="インシデントにブックマークを追加するスクリーンショット。":::

3. 必要に応じて、 **[新しいインシデントを作成する]** または **[既存のインシデントに追加]** のどちらかを選択します。 その後、以下を実行します。

    - 新しいインシデントの場合: 必要に応じて、インシデントの詳細を更新し、 **[作成]** を選択します。
    - 既存のインシデントにブックマークを追加する場合: インシデントを 1 つ選択し、 **[追加]** を選択します。

インシデント内のブックマークを表示するには、 **[Microsoft Sentinel]** 、 **[脅威の管理]** 、 **[インシデント]** の順に移動し、ブックマークが設定されたインシデントを選択します。 **[View full details]\(完全な詳細の表示\)** を選択し、**[ブックマーク]** タブを選択します。

> [!TIP]
> コマンド バーの **[インシデント アクション]** オプションの代替手段として、1 つまたは複数のブックマークのコンテキスト メニュー ( **[...]** ) を使用して、 **[新しいインシデントを作成する]** 、 **[既存のインシデントに追加]** 、および **[インシデントから削除する]** オプションを選択できます。

## <a name="view-bookmarked-data-in-logs"></a>ログでブックマークが設定されたデータを表示する

ブックマークが設定されたクエリ、結果、または履歴を表示するには、 **[ハンティング]**  >  **[ブックマーク]** タブでブックマークを選択し、詳細ウィンドウで表示されるリンクを使用します。

- **[ソース クエリの表示]** では、**[ログ]** ウィンドウにソース クエリが表示されます。

- **[View bookmark log]\(ブックマーク ログの表示\)** では、更新を行ったユーザー、更新された値、更新が行われた時刻など、すべてのブックマーク メタデータが表示されます。

また、**[ハンティング]** > **[ブックマーク]** タブのコマンド バーで **[Bookmark Logs]\(ブックマーク ログ\)** を選択して、すべてのブックマークの生のブックマーク データを表示することもできます。

:::image type="content" source="media/bookmarks/bookmark-logs.png" alt-text="ブックマーク ログ コマンドのスクリーンショット。":::

このビューには、メタデータが関連付けられているすべてのブックマークが表示されます。 [Kusto クエリ言語](/azure/data-explorer/kql-quick-reference) (KQL) クエリを使用して、検索している特定のブックマークの最新版に絞り込むことができます。

> [!NOTE]
> ブックマークの作成時から、それが **[ブックマーク]** タブに表示されるまでの間に、著しい遅れ (分単位) が発生することがあります。

## <a name="delete-a-bookmark"></a>ブックマークを削除する

1. Azure portal で、 **[Microsoft Sentinel]** 、 **[脅威の管理]** 、 **[ハンティング]** 、 **[ブックマーク]** タブの順に移動して、削除するブックマーク (複数可) を選択します。

2. 選択内容を右クリックし、選択したブックマークの数を削除するオプションを選びます。

ブックマークを削除すると、 **[ブックマーク]** タブの一覧からブックマークが除かれます。Log Analytics ワークスペースの **[HuntingBookmark]** (検出ブックマーク) テーブルには、以前のブックマーク エントリが含まれたままですが、最新のエントリでは **[SoftDelete]** 値が true に変更されるため、古いブックマークを簡単に除外できます。 ブックマークを削除しても、他のブックマークやアラートに関連付けられている調査エクスペリエンスからはどのエンティティも削除されません。

## <a name="next-steps"></a>次のステップ

この記事では、Microsoft Sentinel でブックマークを使用して検出調査を実行する方法を学習しました。 Microsoft Azure Sentinel の詳細については、次の記事を参照してください。

- [脅威を事前に検出する](hunting.md)
- [ノートブックを使用して自動化された検出キャンペーンを実行する](notebooks.md)
- [Microsoft Sentinel による脅威のハンティング (Learn モジュール)](/learn/modules/hunt-threats-sentinel/)
