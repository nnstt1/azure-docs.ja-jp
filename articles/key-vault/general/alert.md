---
title: Azure Key Vault のアラートの構成
description: キーコンテナーの正常性を監視するためのアラートを作成する方法について説明します。
services: key-vault
author: msmbaldwin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: general
ms.topic: how-to
ms.date: 03/31/2021
ms.author: mbaldwin
ms.openlocfilehash: c7661f91475b85ad8d606770ff74777bb3b8abab
ms.sourcegitcommit: 611b35ce0f667913105ab82b23aab05a67e89fb7
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 10/14/2021
ms.locfileid: "129994273"
---
# <a name="configure-azure-key-vault-alerts"></a>Azure Key Vault のアラートの構成

Azure Key Vault を使用して運用環境のシークレットの保管を開始した後は、サービスが意図したとおりに動作しているか確認するために、キー コンテナーの正常性を監視することが重要です。 

サービスのスケーリングを開始すると、キー コンテナーに送信される要求の数が増加します。 この増加によって、要求の待機時間が長くなる可能性があります。 極端なケースでは、要求がスロットルされ、サービスのパフォーマンスに影響を与える可能性があります。 また、アクセス ポリシーやファイアウォールの構成の問題に即座に対応できるよう、キー コンテナーが異常な数のエラー コードを送信しているかどうかを知る必要があります。 

この記事では、キー コンテナーの状態が正常でない場合にチームにすぐに対処するよう警告できるように、しきい値を指定してアラートを構成する方法について説明します。 電子メールを (望ましくはチーム配布リストに) 送信したり、Azure Event Grid 通知を起動したり、電話番号に発信したりテキストを送信したりするアラートを構成できます。 

次のアラートの種類から選択できます。

- 固定値に基づく静的アラート
- 監視対象のメトリックが、定義された時間範囲内でキー コンテナーの平均値を一定回数超えた場合にアラートを生成する動的アラート。

> [!IMPORTANT]
> 新しく構成されたアラートが通知の送信を開始するまでに最大 10 分かかる場合があります。 

この記事では、Key Vault のアラートに焦点を当てています。 ログとメトリックの両方を組み合わせてグローバル監視ソリューションを提供する Key Vault 分析情報の詳細については、[Key Vault 分析情報を使用したキー コンテナーの監視](../../azure-monitor/insights/key-vault-insights-overview.md#introduction-to-key-vault-insights)に関するページを参照してください。

## <a name="configure-an-action-group"></a>アクション グループを構成する 

アクション グループは、通知とプロパティの構成可能な一覧です。 アラートを構成するための最初の手順は、アクション グループを作成してアラートの種類を選択することです。

1. Azure portal にサインインします。
2. 検索ボックスで「**アラート**」を検索します。
3. **[アクションの管理]** を選択します。

   > [!div class="mx-imgBorder"]
   > ![[アクションの管理] ボタンが強調表示されているスクリーンショット。](../media/alert-6.png)

4. **[+ アクション グループの追加]** を選択します。

   > [!div class="mx-imgBorder"]
   > ![アクション グループを追加するためのボタンが強調表示されたスクリーンショット。](../media/alert-7.png)

5. アクション グループの **[アクションの種類]** の値を選択します。 この例では、電子メールと SMS アラートを作成します。 **[Email/SMS/Push/Voice]\(メール、SMS、プッシュ、音声\)** を選択します。

   > [!div class="mx-imgBorder"]
   > ![アクション グループを追加するための選択項目が強調表示されているスクリーンショット。](../media/alert-8.png)

6. ダイアログで、電子メールと SMS の詳細を入力してから、 **[OK]** を選択します。

   > [!div class="mx-imgBorder"]
   > ![電子メールと S M S のメッセージ アラートを追加するための選択項目を示すスクリーンショット。](../media/alert-9.png)

## <a name="configure-alert-thresholds"></a>アラートのしきい値を構成する 

次に、ルールを作成し、以下のようにアラートをトリガーするしきい値を構成します。

1. Azure portal でキー コンテナー リソースを選択してから、 **[監視]** の下にある **[アラート]** を選択します。

   > [!div class="mx-imgBorder"]
   > ![[監視] セクションの [アラート] メニューを示しているスクリーンショット。](../media/alert-10.png)

2. **[新しいアラート ルール]** を選択します。

   > [!div class="mx-imgBorder"]
   > ![新しいアラート ルールを追加するためのボタンを示すスクリーンショット。](../media/alert-11.png)

3. アラート ルールのスコープを選択します。 1 つまたは複数のコンテナーを選択できます。 

   > [!IMPORTANT]
   > アラートのスコープに対して複数のコンテナーを選択する場合は、選択したすべてのコンテナーが同じリージョンに存在する必要があります。 異なるリージョンのコンテナーに対して個別のアラート ルールを構成する必要があります。 

   > [!div class="mx-imgBorder"]
   > ![コンテナーの選択方法を示しているスクリーンショット。](../media/alert-12.png)

4. アラートのロジックを定義するしきい値を選択してから、 **[追加]** を選択します。 Key Vault チームでは、次のしきい値を構成することをお勧めします。 

    + Key Vault の可用性が 100% を下回る (静的しきい値)
    + Key Vault の待機時間が 1,000 ミリ秒を超える (静的しきい値) 
    + コンテナーの全体的な飽和度が 75% を超える (静的しきい値) 
    + コンテナーの全体的な飽和度が平均を超える (動的しきい値)
    + エラー コードの総数が平均を超える (動的しきい値) 

   > [!div class="mx-imgBorder"]
   > ![アラートの条件を選択する場所を示しているスクリーンショット。](../media/alert-13.png)

### <a name="example-configure-a-static-alert-threshold-for-latency"></a>例: 待機時間に対する静的アラートのしきい値の構成

1. シグナル名として **[サービス API の全体的な待機時間]** を選択します。

   > [!div class="mx-imgBorder"]
   > ![シグナル名を選択しているスクリーンショット。](../media/alert-14.png)

1. 次の構成パラメーターを使用します。

   + **[しきい値]** を **[静的]** に設定します。 
   + **[演算子]** を **[より大きい]** に設定します。
   + **[集計の種類]** を **[平均]** に設定します。
   + **[しきい値]** を **[1000]** に設定します。
   + **[集約粒度 (期間)]** を **[5 分]** に設定します。
   + **[評価の頻度]** を **[1 分ごと]** に設定します。

   > [!div class="mx-imgBorder"]
   > ![静的アラートしきい値に構成されたロジックを示すスクリーンショット。](../media/alert-15.png)

1. **[Done]** を選択します。  

### <a name="example-configure-a-dynamic-alert-threshold-for-vault-saturation"></a>例: コンテナーの飽和度に対する動的アラートのしきい値の構成 

動的アラートを使用すると、選択したキー コンテナーの履歴データを表示できるようになります。 青色の領域は、キー コンテナーの平均使用量を表します。 赤色の領域は、アラート構成の他の条件が満たされた場合にアラートをトリガーするスパイクを示しています。 赤色の点は、集約期間の時間枠でアラートの条件が満たされた違反のインスタンスを示します。 

> [!div class="mx-imgBorder"]
> ![コンテナーの全体的な飽和状態のグラフを示しているスクリーンショット。](../media/alert-16.png)

設定した時間内に特定の数の違反が発生した後に起動するようにアラートを設定できます。 過去のデータを含めたくない場合は、詳細設定に除外するオプションがあります。 

1. 次の構成パラメーターを使用します。

   + **[しきい値]** を **[動的]** に設定します。 
   + **[演算子]** を **[より大きい]** に設定します。
   + **[集計の種類]** を **[平均]** に設定します。
   + **[しきい値の感度]** を **[中]** に設定します。
   + **[集約粒度 (期間)]** を **[5 分]** に設定します。
   + **[評価の頻度]** を **[5 分ごと]** に設定します。
   + **[詳細設定]** を構成します (省略可能)。 

   > [!div class="mx-imgBorder"]
   > ![動的アラートしきい値に構成されたロジックを示すスクリーンショット。](../media/alert-17.png)

1. **[Done]** を選択します。

1. **[追加]** を選択して、構成したアクション グループを追加します。

   > [!div class="mx-imgBorder"]
   > ![アクション グループを追加するためのボタンがを示すスクリーンショット。](../media/alert-18.png)

1. アラートの詳細で、アラートを有効にし、重要度を割り当てます。

   > [!div class="mx-imgBorder"]
   > ![アラートの有効化と重大度の割り当てを行う場所を示しているスクリーンショット。](../media/alert-19.png)

1. アラートを作成します。 

### <a name="example-email-alert"></a>電子メール アラートの例 

上記のすべての手順を実行すると、構成したアラート条件をキー コンテナーが満たした場合に電子メール アラートが届きます。 電子メール アラートの例を以下に示します。 

> [!div class="mx-imgBorder"]
> ![電子メール アラートを構成するために必要な情報が強調表示されているスクリーンショット。](../media/alert-20.png)

## <a name="next-steps"></a>次のステップ

この記事で設定したツールを使用して、キー コンテナーの正常性をアクティブに監視します。

- [キー コンテナーの監視](monitor-key-vault.md)
- [Key Vault データ参照の監視](monitor-key-vault-reference.md)
