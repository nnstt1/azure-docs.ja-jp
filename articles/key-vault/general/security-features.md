---
title: Azure Key Vault のセキュリティの概要
description: Azure Key Vault のセキュリティ機能とベスト プラクティスの概要。
services: key-vault
author: msmbaldwin
tags: azure-resource-manager
ms.service: key-vault
ms.subservice: general
ms.topic: conceptual
ms.date: 04/15/2021
ms.author: mbaldwin
ms.openlocfilehash: f3ec562a6a33c2211f6acaf661a1ee3125a86149
ms.sourcegitcommit: 0415f4d064530e0d7799fe295f1d8dc003f17202
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/17/2021
ms.locfileid: "132718072"
---
# <a name="azure-key-vault-security"></a>Azure Key Vault セキュリティ

Azure Key Vault により、クラウド内の暗号化キー、証明書 (および証明書に関連付けられている秘密キー)、シークレット (接続文字列やパスワードなど) が保護されます。 ただし、ビジネスに不可欠な機密データを格納する場合は、コンテナーとそこに格納されるデータのセキュリティを最大化するための手順を実行する必要があります。

この記事では、Azure Key Vault のセキュリティ機能とベスト プラクティスの概要について説明します。

> [!NOTE]
> Azure Key Vault のセキュリティに関する推奨事項の包括的な一覧については、「[Key Vault 用の Azure セキュリティ ベースライン](security-baseline.md)」を参照してください。

## <a name="network-security"></a>ネットワークのセキュリティ

コンテナーに対するアクセス権を持つ IP アドレスを指定することで、コンテナーの公開を縮小できます。 Azure Key Vault の仮想ネットワーク サービス エンドポイントを使用すると、指定した仮想ネットワークに対するアクセスを制限できます。 エンドポイントでは、IPv4 (インターネット プロトコル バージョン 4) アドレス範囲のリストへのアクセスを制限することもできます。 このようなソースの外部からお使いのキー コンテナーに接続するユーザーはすべて、アクセスを拒否されます。  詳細については、「[Azure Key Vault の仮想ネットワーク サービス エンドポイント](overview-vnet-service-endpoints.md)」を参照してください。

ファイアウォール ルールを有効にした後は、要求が許可された仮想ネットワークまたは IPv4 アドレス範囲から送信された場合にのみ、ユーザーは Key Vault のデータを読み取ることができます。 これは、Azure portal から Key Vault にアクセスする場合にも適用されます。 ユーザーは Azure portal からキー コンテナーを参照できますが、クライアント マシンが許可リストに登録されていない場合、キー/シークレット/証明書を一覧表示できない場合があります。 実装の手順については、「[Azure Key Vault のファイアウォールと仮想ネットワークを構成する](network-security.md)」を参照してください。

Azure Private Link サービスを使用すると、自分の仮想ネットワーク内のプライベート エンドポイント経由で、Azure Key Vault および Azure でホストされている顧客サービスやパートナー サービスにアクセスできます。 Azure プライベート エンドポイントは、Azure Private Link を使用するサービスにプライベートかつ安全に接続するためのネットワーク インターフェイスです。 プライベート エンドポイントは、ご自分の VNet からのプライベート IP アドレスを使用して、サービスを実質的に VNet に取り込みます。 サービスへのすべてのトラフィックをプライベート エンドポイント経由でルーティングできるため、ゲートウェイ、NAT デバイス、ExpressRoute または VPN 接続、パブリック IP アドレスは必要ありません。 仮想ネットワークとサービスの間のトラフィックは、Microsoft のバックボーン ネットワークを経由して、パブリック インターネットからの公開を排除します。 最高レベルの細分性でアクセスを制御しながら Azure リソースのインスタンスに接続できます。  実装の手順については、「[Key Vault を Azure Private Link と統合する](private-link-service.md)」を参照してください。

## <a name="tls-and-https"></a>TLS と HTTPS

- Key Vault のフロントエンド (データ プレーン) はマルチテナント サーバーです。 つまり、異なる顧客のキー コンテナーで同じパブリック IP アドレスを共有できます。 分離を実現するため、各 HTTP 要求は、他の要求とは別に認証および承認されます。
- 古いバージョンの TLS で脆弱性が報告される場合がありますが、パブリック IP アドレスが共有されているため、Key Vault サービス チームは、トランスポート レベルで個別のキー コンテナーに対して古いバージョンの TLS を無効にすることはできません。
- HTTPS プロトコルを使用すると、クライアントは TLS ネゴシエーションに参加できます。 **クライアントで最新バージョンの TLS を強制する** ことができ、クライアントでそれを行うと常に、接続全体で対応するレベルの保護が使用されます。 Azure Active Directory との通信、または Azure Active Directory に対する認証を行うアプリケーションは、TLS 1.2 または最新バージョンを使用して通信できない場合、期待どおりに動作しない可能性があります。
- TLS プロトコルには既知の脆弱性がありますが、攻撃者が脆弱性のある TLS のバージョンで接続を開始したときに、悪意のあるエージェントがキー コンテナーから情報を抽出できるような、既知の攻撃はありません。 攻撃者はやはり認証と承認を行う必要があり、正当なクライアントが常に最新バージョンの TLS で接続している限り、古いバージョンの TLS の脆弱性によって資格情報が漏洩することはありません。

> [!NOTE]
> Azure Key Vault の場合、Keyvault サービスにアクセスするアプリケーションが、TLS 1.2 または最新バージョンをサポートするプラン形式で実行されている必要があります。 アプリケーションが .NET Framework に依存している場合は、アプリケーションも更新する必要があります。 また、[この記事](/troubleshoot/azure/active-directory/enable-support-tls-environment) で説明されているレジストリの変更を行って、OS レベルおよび .NET Framework で TLS 1.2 の使用を明示的に有効にすることもできます。

## <a name="key-vault-authentication-options"></a>Key Vault の認証オプション

Azure サブスクリプション内でキー コンテナーを作成すると、作成したキー コンテナーは、そのサブスクリプションの Azure AD テナントに自動的に関連付けられます。 両方のプレーンの呼び出し元はすべて、このテナントに登録されている必要があり、キー コンテナーにアクセスするには認証を行う必要があります。 どちらの場合も、アプリケーションは次の 3 つの方法で Key Vault にアクセスできます。

- **アプリケーションのみ**: このアプリケーションは、サービス プリンシパルまたはマネージド ID を表します。 この ID は、キー コンテナーの証明書、キー、またはシークレットに定期的にアクセスする必要があるアプリケーションの最も一般的なシナリオです。 このシナリオが機能するには、アプリケーションの `objectId` をアクセス ポリシーで指定する必要があり、`applicationId` を指定 _しない_ ようにするか、または `null` にする必要があります。
- **ユーザーのみ**: ユーザーは、テナントに登録されている任意のアプリケーションからキー コンテナーにアクセスします。 この種類のアクセスの例として、Azure PowerShell や Azure portal があります。 このシナリオが機能するには、ユーザーの `objectId` をアクセス ポリシーで指定する必要があり、`applicationId` を指定 _しない_ ようにするか、または `null` にする必要があります。
- **アプリケーションとユーザー** (_複合 ID_ とも呼ばれます): ユーザーは、特定のアプリケーションからキー コンテナーにアクセスする必要があり、_かつ_ そのアプリケーションは On-Behalf-Of 認証 (OBO) フローを使用してそのユーザーを偽装する必要があります。 このシナリオが機能するには、`applicationId` と `objectId` の両方をアクセス ポリシーで指定する必要があります。 `applicationId` によってその必要なアプリケーションが識別され、`objectId` によってそのユーザーが識別されます。 現時点では、このオプションはデータ プレーンの Azure RBAC では使用できません。

すべての種類のアクセスで、アプリケーションは Azure AD を使用して認証します。 アプリケーションでは、アプリケーションの種類に基づいて[サポートされる認証方法](../../active-directory/develop/authentication-vs-authorization.md)が使用されます。 アプリケーションでは、アクセス権を付与するプレーン内のリソース用のトークを取得します。 このリソースは、管理プレーンまたはデータ プレーン内にあるエンドポイントであり、Azure 環境に基づいています。 アプリケーションでは、このトークンを使用して、Key Vault に REST API 要求を送信します。 詳細については、[認証フロー全体](../../active-directory/develop/v2-oauth2-auth-code-flow.md)に関するページを確認してください。

1 つのメカニズムで両方のプレーンを認証するモデルには次のようないくつかの利点があります。

- 組織では、組織内のすべてのキー コンテナーへのアクセスを一元的に管理できます。
- 退職したユーザーは、組織内のすべてのキー コンテナーに即座にアクセスできなくなります。
- 組織では、Azure AD のオプションを使用して認証をカスタマイズできます (セキュリティを強化するために多要素認証を有効にするなど)。

詳細については、「[Key Vault 認証の基礎](authentication.md)」を参照してください。

## <a name="access-model-overview"></a>アクセス モデルの概要

キー コンテナーへのアクセスは、2 つのインターフェイス (**管理プレーン** と **データ プレーン**) を使用して制御します。 管理プレーンでは、Key Vault 自体の管理を行います。 このプレーンでは、キー コンテナーの作成および削除、Key Vault のプロパティの取得、アクセス ポリシーの更新などの操作を行います。 データ プレーンでは、キー コンテナーに格納されているデータを操作します。 キー、シークレット、証明書の追加、削除、および変更を行うことができます。

認証については、両方のプレーンで [Azure Active Directory (Azure AD)](../../active-directory/fundamentals/active-directory-whatis.md) が使用されます。 認可については、管理プレーンでは [Azure ロールベースのアクセス制御 (Azure RBAC)](../../role-based-access-control/overview.md) が使用され、データ プレーンでは [Key Vault アクセス ポリシー](./assign-access-policy-portal.md)と [Key Vault データ プレーン操作用の Azure RBAC](./rbac-guide.md) が使用されます。

いずれのプレーン内でもキー コンテナーにアクセスするには、すべての呼び出し元 (ユーザーまたはアプリケーション) が適切な認証と承認を必要とします。 認証では、呼び出し元の ID が確立されます。 承認では、呼び出し元が実行できる操作が決定されます。 Key Vault による認証は、特定の **セキュリティ プリンシパル** の ID の認証を行う [Azure Active Directory (Azure AD)](../../active-directory/fundamentals/active-directory-whatis.md) と連携して機能します。

セキュリティ プリンシパルは、Azure リソースへのアクセスを要求するユーザー、グループ、サービス、またはアプリケーションを表すオブジェクトです。 すべてのセキュリティ プリンシパルには、Azure によって一意の **オブジェクト ID** が割り当てられます。

- **ユーザー** セキュリティ プリンシパルでは、Azure Active Directory 内にプロファイルを持つ個人が示されます。
- **グループ** セキュリティ プリンシパルでは、Azure Active Directory 内に作成されたユーザーのセットが示されます。 グループに割り当てられたすべてのロールまたはアクセス許可は、グループ内のすべてのユーザーに付与されます。
- **サービス プリンシパル** は、アプリケーションまたはサービス、つまりユーザーまたはグループではなくコードを示すセキュリティ プリンシパルの一種です。 サービス プリンシパルのオブジェクト ID は **クライアント ID** と呼ばれ、ユーザー名のように機能します。 サービス プリンシパルの **クライアント シークレット** または **証明書** は、パスワードのように機能します。 多くの Azure サービスによって、**クライアント ID** および **証明書** の自動管理による [マネージド ID](../../active-directory/managed-identities-azure-resources/overview.md) の割り当てがサポートされます。 マネージド ID は、Azure 内での認証で最も安全かつ推奨されるオプションです。

Key Vault の認証の詳細については、「[Azure Key Vault に対する認証](authentication.md)」を参照してください。

## <a name="conditional-access"></a>条件付きアクセス 

Key Vault では、Azure Active Directory の条件付きアクセス ポリシーがサポートされています。 条件付きアクセス ポリシーを使用すると、必要な場合は Key Vault に適切なアクセスの制御を適用して組織のセキュリティを維持し、必要でない場合はユーザーの邪魔にならないようにすることができます。

詳しくは、[条件付きアクセスの概要](../../active-directory/conditional-access/overview.md)に関するページをご覧ください。

## <a name="privileged-access"></a>特権アクセス

承認によって、呼び出し元が実行できる操作が決定されます。 Key Vault での認可では、[Azure ロール ベースのアクセス制御](../../role-based-access-control/overview.md) (Azure RBAC) と Azure Key Vault アクセス ポリシーの組み合わせが使用されます。

コンテナーに対するアクセスは 2 つのインターフェイスすなわちプレーンを介して行います。 これらのプレーンは、管理プレーンとデータ プレーンです。

- "*管理プレーン*" は Key Vault そのものを管理する場所であり、コンテナーの作成と削除に使用されるインターフェイスです。 キー コンテナーのプロパティを読み取り、アクセス ポリシーを管理することもできます。
- "*データ プレーン*" では、キー コンテナーに格納されているデータを操作できます。 キー、シークレット、証明書の追加、削除、および変更を行うことができます。

アプリケーションによって、エンドポイントを介してプレーンにアクセスされます。 2 つのプレーンに対するアクセス制御は独立して機能します。 キー コンテナー内のキーを使用するためのアクセスをアプリケーションに許可する場合は、Key Vault アクセス ポリシーまたは Azure RBAC を使用してデータ プレーンのアクセスを許可します。 ユーザーに対して Key Vault のプロパティおよびタグの読み取りアクセスは許可するが、データ (キー、シークレット、証明書) へのアクセスは許可しない場合は、Azure RBAC を使用して管理プレーンのアクセスを許可します。

次の表に、管理プレーンとデータ プレーンのエンドポイントを示します。

| アクセス&nbsp; プレーン | アクセス エンドポイント | 操作 | アクセス制御メカニズム&nbsp; |
| --- | --- | --- | --- |
| 管理プレーン | **グローバル:**<br> management.azure.com:443<br><br> **Azure China 21Vianet:**<br> management.chinacloudapi.cn:443<br><br> **Azure US Government:**<br> management.usgovcloudapi.net:443<br><br> **Azure Germany:**<br> management.microsoftazure.de:443 | キー コンテナーの作成、読み取り、更新、削除<br><br>Key Vault アクセス ポリシーの設定<br><br>Key Vault タグの設定 | Azure RBAC |
| データ プレーン | **グローバル:**<br> &lt;vault-name&gt;.vault.azure.net:443<br><br> **Azure China 21Vianet:**<br> &lt;vault-name&gt;.vault.azure.cn:443<br><br> **Azure US Government:**<br> &lt;vault-name&gt;.vault.usgovcloudapi.net:443<br><br> **Azure Germany:**<br> &lt;vault-name&gt;.vault.microsoftazure.de:443 | キー: 暗号化、暗号化解除、キーのラップ、キーのラップ解除、署名、確認、取得、一覧表示、作成、更新、インポート、削除、回復、バックアップ、復元、消去<br><br> 証明書: 連絡先の管理、発行者の取得、発行者の一覧表示、発行者の設定、発行者の削除、発行者の管理、取得、一覧表示、作成、インポート、更新、削除、回復、バックアップ、復元、消去<br><br>  シークレット: 取得、一覧表示、設定、削除、回復、バックアップ、復元、消去 | Key Vault アクセス ポリシーまたは Azure RBAC |

### <a name="managing-administrative-access-to-key-vault"></a>キー コンテナーに対する管理アクセスの管理

リソース グループ内にキー コンテナーを作成するとき、Azure AD を使用してアクセスを管理します。 リソース グループ内のキー コンテナーを管理する権限をユーザーまたはグループに付与します。 適切な Azure ロールを割り当てることで、特定のスコープ レベルでアクセスを付与できます。 キー コンテナーを管理するためのアクセス権をユーザーに付与するには、定義済みの `key vault Contributor` ロールを特定のスコープでそのユーザーに割り当てます。 Azure ロールには以下のスコープ レベルを割り当てることができます。

- **サブスクリプション**:サブスクリプション レベルで割り当てられた Azure ロールは、そのサブスクリプション内のすべてのリソース グループとリソースに適用されます。
- **[リソース グループ]** :リソース グループ レベルで割り当てられた Azure ロールは、そのリソース グループ内のすべてのリソースに適用されます。
- **特定のリソース**: 特定のリソースに対して割り当てられた Azure ロールは、そのリソースに適用されます。 この場合、リソースは特定のキー コンテナーです。

定義済みのロールが複数あります。 定義済みのロールがニーズに合わない場合は、独自のロールを定義できます。 詳細については、[Azure RBAC: 組み込みのロール](../../role-based-access-control/built-in-roles.md)に関するページをご覧ください。

> [!IMPORTANT]
> ユーザーがキー コンテナーの管理プレーンに対する `Contributor` 権限を持っている場合は、そのユーザーは Key Vault アクセス ポリシーを設定することで、データ プレーンへのアクセス権を自分自身に付与できます。 ご利用のキー コンテナーへの `Contributor` ロール アクセス権を持つユーザーの管理は厳密に行う必要があります。 承認されたユーザーだけがコンテナー、キー、シークレット、証明書にアクセスできるようにします。

### <a name="controlling-access-to-key-vault-data"></a>Key Vault データへのアクセスの制御

Key Vault アクセス ポリシーでは、キー、シークレット、または証明書へのアクセス許可が個別に付与されます。 ユーザーに対してはキーへのアクセス権のみ付与でき、シークレットへのアクセス権は付与できません。 キー、シークレット、証明書へのアクセス許可は、コンテナー レベルで管理されます。

> [!IMPORTANT]
> Key Vault アクセス ポリシーでは、特定のキー、シークレット、証明書など、細かいオブジェクト レベルのアクセス許可はサポートされていません。 キーを作成および削除するためのアクセス許可を付与されたユーザーは、そのキー コンテナー内のすべてのキーに対してそれらの操作を実行できます。

キー コンテナーのアクセス ポリシーは、[Azure portal](assign-access-policy-portal.md)、[Azure CLI](assign-access-policy-cli.md)、[Azure PowerShell](assign-access-policy-powershell.md)、または [Key Vault 管理 REST API](/rest/api/keyvault/) を使用して設定できます。

## <a name="logging-and-monitoring"></a>ログ記録と監視

Key Vault のログによって、コンテナーに対して実行されたアクティビティの情報が保存されます。 詳細については、[Key Vault のログ記録](logging.md)に関する記事を参照してください。

Key Vault を Event Grid に統合して、キー コンテナーに格納されているキー、証明書、またはシークレットの状態が変更されたときに通知を受けることができます。 詳細については、「[Azure Event Grid での Key Vault の監視](event-grid-overview.md)」を参照してください。

また、サービスが意図したとおりに動作していることを確認するために、キー コンテナーの正常性を監視することも重要です。 その方法の詳細については、「[Azure Key Vault の監視とアラート](alert.md)」を参照してください。

## <a name="backup-and-recovery"></a>バックアップと回復

Azure Key Vault の論理的な削除と消去保護を使用すると、削除されたコンテナーとコンテナー オブジェクトを復旧できます。 詳細については、「[Azure Key Vault の論理的な削除の概要](soft-delete-overview.md)」を参照してください。

また、コンテナー内のオブジェクトの更新、削除、作成の際には、コンテナーの定期的バックアップを取る必要があります。  

## <a name="next-steps"></a>次のステップ

- [Azure Key Vault 用の Azure セキュリティ ベースライン](security-baseline.md)
- [Azure Key Vault のベスト プラクティス](security-baseline.md)
- [Azure Key Vault の仮想ネットワーク サービス エンドポイント](overview-vnet-service-endpoints.md)
- [Azure RBAC: 組み込みのロール](../../role-based-access-control/built-in-roles.md)に関するページを参照してください。